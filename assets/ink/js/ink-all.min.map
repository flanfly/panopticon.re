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             /*jshint evil:true */\n                    return eval('(' + strJSON + ')');\n                } catch(e) {\n                    throw new Error('ERROR: Bad JSON string...');\n                }\n            }\n            return null;\n        }\n    };\n\n    /**\n     * Loads content from a given url through an XMLHttpRequest.\n     *\n     * Shortcut function for simple AJAX use cases. Works with JSON, XML and plain text.\n     *\n     * @method load\n     * @param {String}   url        Request URL\n     * @param {Function} callback   Callback to be executed if the request is successful\n     * @return {Object}             XMLHttpRequest object\n     *\n     * @sample Ink_Net_Ajax_load.html \n     */\n    Ajax.load = function(url, callback){\n        return new Ajax(url, {\n            method: 'GET',\n            onSuccess: function(response){\n                callback(response.responseJSON || response.responseText, response);\n            }\n        });\n    };\n\n    /**\n     * Loads content from a given url through an XMLHttpRequest.\n     * Shortcut function for simple AJAX use cases.\n     *\n     * @method ping\n     * @param {String}   url        Request url\n     * @param {Function} callback   Callback to be executed if the request is successful\n     * @return {Object}             XMLHttpRequest object\n     */\n    Ajax.ping = function(url, callback){\n        return new Ajax(url, {\n            method: 'HEAD',\n            onSuccess: function(response){\n                if (typeof callback === 'function'){\n                    callback(response);\n                }\n            }\n        });\n    };\n\n\n    return Ajax;\n});\n","/**\n * Cross Browser JsonP requests\n * @module Ink.Net.JsonP_1\n * @version 1\n */\n\nInk.createModule('Ink.Net.JsonP', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * Executes a JSONP request\n     *\n     * @class Ink.Net.JsonP\n     * @constructor\n     *\n     * @param {String}      uri                         Request URL\n     * @param {Object}      options                     Request options\n     * @param {Function}    options.onSuccess           Success callback\n     * @param {Function}    [options.onFailure]         Failure callback\n     * @param {Object}      [options.failureObj]        Object to be passed as argument to failure callback\n     * @param {Number}      [options.timeout]           Timeout for request fail, in seconds. defaults to 10\n     * @param {Object}      [options.params]            Object with the parameters and respective values to unfold\n     * @param {String}      [options.callbackParam]     Parameter to use as callback. defaults to 'jsoncallback'\n     * @param {String}      [options.internalCallback]  Name of the callback function stored in the Ink.Net.JsonP object.\n     * @param {String}      [options.randVar]           (Advanced, not recommended unless you know what you're doing) A string to append to the callback name. By default, generate a random number. Use an empty string if you already passed the correct name in the internalCallback option.\n     *\n     * @sample Ink_Net_JsonP_1.html \n     */\n    var JsonP = function(uri, options) {\n        this.init(uri, options);\n    };\n\n    JsonP.prototype = {\n\n        init: function(uri, options) {\n            this.options = Ink.extendObj( {\n                onSuccess:         undefined,\n                onFailure:          undefined,\n                failureObj:         {},\n                timeout:            10,\n                params:             {},\n                callbackParam:      'jsoncallback',\n                internalCallback:   '_cb',\n                randVar:            false\n            }, options || {});\n\n            if(this.options.randVar !== false) {\n                this.randVar = this.options.randVar;\n            } else {\n                this.randVar = parseInt(Math.random() * 100000, 10);\n            }\n\n            this.options.internalCallback += this.randVar;\n\n            this.uri = uri;\n\n            // prevent SAPO legacy onComplete - make it onSuccess\n            if(typeof(this.options.onComplete) === 'function') {\n                this.options.onSuccess = this.options.onComplete;\n            }\n\n            if (typeof this.uri !== 'string') {\n                throw 'Please define an URI';\n            }\n\n            if (typeof this.options.onSuccess !== 'function') {\n                throw 'please define a callback function on option onSuccess!';\n            }\n\n            Ink.Net.JsonP[this.options.internalCallback] = Ink.bind(function() {\n                window.clearTimeout(this.timeout);\n                delete window.Ink.Net.JsonP[this.options.internalCallback];\n                this._removeScriptTag();\n                this.options.onSuccess(arguments[0]);\n            }, this);\n\n            this._addScriptTag();\n        },\n\n        _addParamsToGet: function(uri, params) {\n            var hasQuestionMark = uri.indexOf('?') !== -1;\n            var sep, pKey, pValue, parts = [uri];\n\n            for (pKey in params) {\n                if (params.hasOwnProperty(pKey)) {\n                    if (!hasQuestionMark) { sep = '?';  hasQuestionMark = true; }\n                    else {                  sep = '&';                          }\n                    pValue = params[pKey];\n                    if (typeof pValue !== 'number' && !pValue) {    pValue = '';    }\n                    parts = parts.concat([sep, pKey, '=', encodeURIComponent(pValue)]);\n                }\n            }\n\n            return parts.join('');\n        },\n\n        _getScriptContainer: function() {\n            var headEls = document.getElementsByTagName('head');\n            if (headEls.length === 0) {\n                var scriptEls = document.getElementsByTagName('script');\n                return scriptEls[0];\n            }\n            return headEls[0];\n        },\n\n        _addScriptTag: function() {\n            // enrich options will callback and random seed\n            this.options.params[this.options.callbackParam] = 'Ink.Net.JsonP.' + this.options.internalCallback;\n            this.options.params.rnd_seed = this.randVar;\n            this.uri = this._addParamsToGet(this.uri, this.options.params);\n            // create script tag\n            var scriptEl = document.createElement('script');\n            scriptEl.type = 'text/javascript';\n            scriptEl.src = this.uri;\n            var scriptCtn = this._getScriptContainer();\n            scriptCtn.appendChild(scriptEl);\n            this.timeout = setTimeout(Ink.bind(this._requestFailed, this), (this.options.timeout * 1000));\n        },\n\n        _requestFailed : function () {\n            delete Ink.Net.JsonP[this.options.internalCallback];\n            this._removeScriptTag();\n            if(typeof this.options.onFailure === 'function'){\n                this.options.onFailure(this.options.failureObj);\n            }\n        },\n\n        _removeScriptTag: function() {\n            var scriptEl;\n            var scriptEls = document.getElementsByTagName('script');\n            var scriptUri;\n            for (var i = 0, f = scriptEls.length; i < f; ++i) {\n                scriptEl = scriptEls[i];\n                scriptUri = scriptEl.getAttribute('src') || scriptEl.src;\n                if (scriptUri !== null && scriptUri === this.uri) {\n                    scriptEl.parentNode.removeChild(scriptEl);\n                    return;\n                }\n            }\n        }\n\n    };\n\n    return JsonP;\n\n});\n","/**\n * Browser Detection and User Agent sniffing\n * @module Ink.Dom.Browser_1\n * @version 1\n */\nInk.createModule('Ink.Dom.Browser', '1', [], function() {\n    'use strict';    \n\n    /**\n     * @namespace Ink.Dom.Browser\n     * @version 1\n     * @static\n     * @example\n     *     <script>\n     *         Ink.requireModules(['Ink.Dom.Browser_1'],function( InkBrowser ){\n     *             if( InkBrowser.CHROME ){\n     *                 console.log( 'This is a CHROME browser.' );\n     *             }\n     *         });\n     *     </script>\n     */\n    var Browser = {\n        /**\n         * True if the browser is Internet Explorer\n         *\n         * @property IE\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        IE: false,\n\n        /**\n         * True if the browser is Gecko based\n         *\n         * @property GECKO\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        GECKO: false,\n\n        /**\n         * True if the browser is Opera\n         *\n         * @property OPERA\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        OPERA: false,\n\n        /**\n         * True if the browser is Safari\n         *\n         * @property SAFARI\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        SAFARI: false,\n\n        /**\n         * True if the browser is Konqueror\n         *\n         * @property KONQUEROR\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        KONQUEROR: false,\n\n        /**\n         * True if browser is Chrome\n         *\n         * @property CHROME\n         * @type {Boolean}\n         * @public\n         * @static\n         */\n        CHROME: false,\n\n        /**\n         * The specific browser model.\n         * False if it is unavailable.\n         *\n         * @property model\n         * @type {Boolean|String}\n         * @public\n         * @static\n         */\n        model: false,\n\n        /**\n         * The browser version.\n         * False if it is unavailable.\n         *\n         * @property version\n         * @type {Boolean|String}\n         * @public\n         * @static\n         */\n        version: false,\n\n        /**\n         * The user agent string.\n         * False if it is unavailable.\n         *\n         * @property userAgent\n         * @type {Boolean|String}\n         * @public\n         * @static\n         */\n        userAgent: false,\n\n        /**\n         * The CSS prefix (-moz-, -webkit-, -ms-, ...)\n         * False if it is unavailable \n         *\n         * @property cssPrefix \n         * @type {Boolean|String}\n         * @public \n         * @static \n         */\n        cssPrefix: false, \n\n        /**\n         * The DOM prefix (Moz, Webkit, ms, ...)\n         * False if it is unavailable \n         * @property domPrefix \n         * @type {Boolean|String}\n         * @public \n         * @static \n         */\n        domPrefix: false,\n\n        /**\n         * Initialization function for the Browser object.\n         *\n         * Is called automatically when this module is loaded, and calls setDimensions, setBrowser and setReferrer.\n         *\n         * @method init\n         * @public\n         */\n        init: function() {\n            this.detectBrowser();\n            this.setDimensions();\n            this.setReferrer();\n        },\n\n        /**\n         * Retrieves and stores window dimensions in this object. Called automatically when this module is loaded.\n         *\n         * @method setDimensions\n         * @public\n         */\n        setDimensions: function() {\n            //this.windowWidth=window.innerWidth !== null? window.innerWidth : document.documentElement && document.documentElement.clientWidth ? document.documentElement.clientWidth : document.body !== null ? document.body.clientWidth : null;\n            //this.windowHeight=window.innerHeight != null? window.innerHeight : document.documentElement && document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body != null? document.body.clientHeight : null;\n            var myWidth = 0, myHeight = 0;\n            if ( typeof window.innerWidth=== 'number' ) {\n                myWidth = window.innerWidth;\n                myHeight = window.innerHeight;\n            } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {\n                myWidth = document.documentElement.clientWidth;\n                myHeight = document.documentElement.clientHeight;\n            } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {\n                myWidth = document.body.clientWidth;\n                myHeight = document.body.clientHeight;\n            }\n            this.windowWidth = myWidth;\n            this.windowHeight = myHeight;\n        },\n\n        /**\n         * Stores the referrer. Called automatically when this module is loaded.\n         *\n         * @method setReferrer\n         * @public\n         */\n        setReferrer: function() {\n            if (document.referrer && document.referrer.length) {\n                this.referrer = window.escape(document.referrer);\n            } else {\n                this.referrer = false;\n            }\n        },\n\n        /**\n         * Detects the browser and stores the found properties. Called automatically when this module is loaded.\n         *\n         * @method detectBrowser\n         * @public\n         */\n        detectBrowser: function() {\n            this._sniffUserAgent(navigator.userAgent);\n        },\n\n        _sniffUserAgent: function (sAgent) {\n            this.userAgent = sAgent;\n\n            sAgent = sAgent.toLowerCase();\n\n            if (/applewebkit\\//.test(sAgent)) {\n                this.cssPrefix = '-webkit-';\n                this.domPrefix = 'Webkit';\n                if(/(chrome|crios)\\//.test(sAgent)) {\n                    // Chrome\n                    this.CHROME = true;\n                    this.model = 'chrome';\n                    this.version = sAgent.replace(/(.*)chrome\\/([^\\s]+)(.*)/, \"$2\");\n                } else {\n                    // Safari\n                    this.SAFARI = true;\n                    this.model = 'safari';\n                    var rVersion = /version\\/([^) ]+)/;\n                    if (rVersion.test(sAgent)) {\n                        this.version = sAgent.match(rVersion)[1];\n                    } else {\n                        this.version = sAgent.replace(/(.*)applewebkit\\/([^\\s]+)(.*)/, \"$2\");\n                    }\n                }\n            } else if (/opera/.test(sAgent)) {\n                // Opera\n                this.OPERA = true;\n                this.model = 'opera';\n                this.version = sAgent.replace(/(.*)opera.([^\\s$]+)(.*)/, \"$2\");\n                this.cssPrefix = '-o-';\n                this.domPrefix = 'O';\n            } else if (/konqueror/.test(sAgent)) {\n                // Konqueroh\n                this.KONQUEROR = true;\n                this.model = 'konqueror';\n                this.version = sAgent.replace(/(.*)konqueror\\/([^;]+);(.*)/, \"$2\");\n                this.cssPrefix = '-khtml-';\n                this.domPrefix = 'Khtml';\n            } else if (/(msie|trident)/i.test(sAgent)) {\n                // MSIE\n                this.IE = true;\n                this.model = 'ie';\n                if (/rv:((?:\\d|\\.)+)/.test(sAgent)) {  // IE 11\n                    this.version = sAgent.match(/rv:((?:\\d|\\.)+)/)[1];\n                } else {\n                    this.version = sAgent.replace(/(.*)\\smsie\\s([^;]+);(.*)/, \"$2\");\n                }\n                this.cssPrefix = '-ms-';\n                this.domPrefix = 'ms';\n            } else if (/gecko/.test(sAgent)) {\n                // GECKO\n                // Supports only:\n                // Camino, Chimera, Epiphany, Minefield (firefox 3), Firefox, Firebird, Phoenix, Galeon,\n                // Iceweasel, K-Meleon, SeaMonkey, Netscape, Songbird, Sylera,\n                this.cssPrefix = '-moz-';\n                this.domPrefix = 'Moz';\n\n                this.GECKO = true;\n\n                var re = /(camino|chimera|epiphany|minefield|firefox|firebird|phoenix|galeon|iceweasel|k\\-meleon|seamonkey|netscape|songbird|sylera)/;\n                if(re.test(sAgent)) {\n                    this.model = sAgent.match(re)[1];\n                    this.version = sAgent.replace(new RegExp(\"(.*)\"+this.model+\"\\/([^;\\\\s$]+)(.*)\"), \"$2\");\n                } else {\n                    // probably is mozilla\n                    this.model = 'mozilla';\n                    var reVersion = /(.*)rv:([^)]+)(.*)/;\n                    if(reVersion.test(sAgent)) {\n                        this.version = sAgent.replace(reVersion, \"$2\");\n                    }\n                }\n            }\n        },\n\n        /**\n         * Debug function which displays browser (and Ink.Dom.Browser) information as an alert message.\n         *\n         * @method debug\n         * @public\n         * @sample Ink_Dom_Browser_1_debug.html\n         */\n        debug: function() {\n            /*global alert:false */\n            var str = \"known browsers: (ie, gecko, opera, safari, konqueror) \\n\";\n                str += [this.IE, this.GECKO, this.OPERA, this.SAFARI, this.KONQUEROR] +\"\\n\";\n                str += \"cssPrefix -> \"+this.cssPrefix+\"\\n\";\n                str += \"domPrefix -> \"+this.domPrefix+\"\\n\";\n                str += \"model -> \"+this.model+\"\\n\";\n                str += \"version -> \"+this.version+\"\\n\";\n                str += \"\\n\";\n                str += \"original UA -> \"+this.userAgent;\n\n            alert(str);\n        }\n    };\n\n    Browser.init();\n\n    return Browser;\n});\n","/**\n * CSS Utilities and toolbox\n * @module Ink.Dom.Css_1\n * @version 1\n */\n\nInk.createModule( 'Ink.Dom.Css', 1, [], function() {\n\n    'use strict';\n\n     // getComputedStyle feature detection.\n     var getCs = (\"defaultView\" in document) && (\"getComputedStyle\" in document.defaultView) ? document.defaultView.getComputedStyle : window.getComputedStyle;\n\n    /**\n     * @namespace Ink.Dom.Css\n     * @static\n     */\n\n    var Css = {\n        /**\n         * Adds of removes a class.\n         * Depending on addRemState, this method either adds a class if it's true or removes if if false.\n         *\n         * @method addRemoveClassName\n         * @param {DOMElement|string}   elm          DOM element or element id\n         * @param {string}              className    class name to add or remove.\n         * @param {boolean}             addRemState  Whether to add or remove. `true` to add, `false` to remove.\n         * @sample Ink_Dom_Css_addRemoveClassName.html \n         */\n        addRemoveClassName: function(elm, className, addRemState) {\n            if (addRemState) {\n                return this.addClassName(elm, className);\n            }\n            this.removeClassName(elm, className);\n        },\n\n        /**\n         * Adds a class to a given element\n         *\n         * @method addClassName\n         * @param {DOMElement|String}   elm          DOM element or element id\n         * @param {String|Array}        className    Classes \n         * @sample Ink_Dom_Css_addClassName.html\n         */\n        addClassName: function(elm, className) {\n            elm = Ink.i(elm);\n            if (!elm || !className) { return null; }\n            className = ('' + className).split(/[, ]+/);\n            var i = 0;\n            var len = className.length;\n\n            for (; i < len; i++) {\n                // remove whitespace and ignore on empty string\n                if (className[i].replace(/^\\s+|\\s+$/g, '')) {\n                    if (typeof elm.classList !== \"undefined\") {\n                        elm.classList.add(className[i]);\n                    } else if (!Css.hasClassName(elm, className[i])) {\n                        elm.className += (elm.className ? ' ' : '') + className[i];\n                    }\n                }\n            }\n        },\n\n        /**\n         * Removes a class from a given element\n         *\n         * @method removeClassName\n         * @param {DOMElement|String}   elm        DOM element or element id\n         * @param {String|Array}        className  Class names to remove. You can either use a space separated string of classnames, comma-separated list or an array\n         * @sample Ink_Dom_Css_removeClassName.html \n         */\n        removeClassName: function(elm, className) {\n            elm = Ink.i(elm);\n            if (!elm || !className) { return null; }\n            \n            className = ('' + className).split(/[, ]+/);\n            var i = 0;\n            var len = className.length;\n\n            if (typeof elm.classList !== \"undefined\"){\n                for (; i < len; i++) {\n                    elm.classList.remove(className[i]);\n                }\n            } else {\n                var elmClassName = elm.className || '';\n                var re;\n                for (; i < len; i++) {\n                    re = new RegExp(\"(^|\\\\s+)\" + className[i] + \"(\\\\s+|$)\");\n                    elmClassName = elmClassName.replace(re, ' ');\n                }\n                elm.className = (elmClassName\n                    .replace(/^\\s+/, '')\n                    .replace(/\\s+$/, ''));\n            }\n        },\n\n        /**\n         * Alias to addRemoveClassName. \n         * Utility function, saves many if/elses.\n         *\n         * @method setClassName\n         * @uses addRemoveClassName\n         * @param {DOMElement|String}  elm          DOM element or element id\n         * @param {String|Array}       className    Class names to add\\remove. Comma separated, space separated or simply an Array\n         * @param {Boolean}            [add]=false  Flag to switch behavior from removal to addition. true to add, false to remove\n         */\n        setClassName: function(elm, className, add) {\n            this.addRemoveClassName(elm, className, add || false);\n        },\n\n        /**\n         * Checks if an element has a class.\n         * This method verifies if an element has ONE of a list of classes. If the last argument is flagged as true, instead checks if the element has ALL the classes\n         * \n         * @method hasClassName\n         * @param {DOMElement|String}  elm         DOM element or element id\n         * @param {String|Array}       className   Class names to test\n         * @param {Boolean}            [all]=false If flagged as true, it will check if the element contains ALL the CSS classes\n         * @return {Boolean} true if a given class is applied to a given element\n         * @sample Ink_Dom_Css_hasClassName.html \n         */\n        hasClassName: function(elm, className, all) {\n            elm = Ink.i(elm);\n            if (!elm || !className) { return false; }\n\n            className = ('' + className).split(/[, ]+/);\n            var i = 0;\n            var len = className.length;\n            var has;\n            var re;\n\n            for ( ; i < len; i++) {\n                if (typeof elm.classList !== \"undefined\"){\n                    has = elm.classList.contains(className[i]);\n                } else {\n                    var elmClassName = elm.className;\n                    if (elmClassName === className[i]) {\n                        has = true;\n                    } else {\n                        re = new RegExp(\"(^|\\\\s)\" + className[i] + \"(\\\\s|$)\");\n                        has = re.test(elmClassName);\n                    }\n                }\n                if (has && !all) { return true; }  // return if looking for any class\n                if (!has && all) { return false; }  // return if looking for all classes\n            }\n\n            if (all) {\n                // if we got here, all classes were found so far\n                return true;\n            } else {\n                // if we got here with all == false, no class was found\n                return false;\n            }\n        },\n\n        /**\n         * Blinks a class from an element\n         * Add and removes the class from the element with a timeout, so it blinks\n         *\n         * @method blinkClass\n         * @uses addRemoveClassName\n         * @param {DOMElement|String}  elm        DOM element or element id\n         * @param {String|Array}       className  Class name(s) to blink\n         * @param {Number}            timeout    timeout in ms between adding and removing, default 100 ms\n         * @param {Boolean}            negate     is true, class is removed then added\n         * @sample Ink_Dom_Css_blinkClass.html \n         */\n        blinkClass: function(element, className, timeout, negate){\n            element = Ink.i(element);\n            Css.addRemoveClassName(element, className, !negate);\n            setTimeout(function() {\n                Css.addRemoveClassName(element, className, negate);\n            }, Number(timeout) || 100);\n        },\n\n        /**\n         * Toggles a class name from a given element\n         *\n         * @method toggleClassName\n         * @param {DOMElement|String}  elm        DOM element or element id\n         * @param {String}             className  Class name\n         * @param {Boolean}            [forceAdd] Flag to force adding the the classe names if they don't exist yet.\n         * @sample Ink_Dom_Css_toggleClassName.html \n         */\n        toggleClassName: function(elm, className, forceAdd) {\n            if (elm && className){\n                if (typeof elm.classList !== \"undefined\" && !/[, ]/.test(className)){\n                    elm = Ink.i(elm);\n                    if (elm !== null){\n                        elm.classList.toggle(className);\n                    }\n                    return true;\n                }\n            }\n\n            if (typeof forceAdd !== 'undefined') {\n                if (forceAdd === true) {\n                    Css.addClassName(elm, className);\n                }\n                else if (forceAdd === false) {\n                    Css.removeClassName(elm, className);\n                }\n            } else {\n                if (Css.hasClassName(elm, className)) {\n                    Css.removeClassName(elm, className);\n                } else {\n                    Css.addClassName(elm, className);\n                }\n            }\n        },\n\n        /**\n         * Sets the opacity of given element \n         *\n         * @method setOpacity\n         * @param {DOMElement|String}  elm    DOM element or element id\n         * @param {Number}             value  allows 0 to 1(default mode decimal) or percentage (warning using 0 or 1 will reset to default mode)\n         * @sample Ink_Dom_Css_setOpacity.html \n         */\n        setOpacity: function(elm, value) {\n            elm = Ink.i(elm);\n            if (elm !== null){\n                var val = 1;\n\n                if (!isNaN(Number(value))){\n                    if      (value <= 0) {   val = 0;           }\n                    else if (value <= 1) {   val = value;       }\n                    else if (value <= 100) { val = value / 100; }\n                    else {                   val = 1;           }\n                }\n\n                if (typeof elm.style.opacity !== 'undefined') {\n                    elm.style.opacity = val;\n                }\n                else {\n                    elm.style.filter = \"alpha(opacity:\"+(val*100|0)+\")\";\n                }\n            }\n        },\n\n        /**\n         * Converts a css property name to a string in camelcase to be used with CSSStyleDeclaration.\n         * @method _camelCase\n         * @private\n         * @param {String} str  String to convert\n         * @return {String} Converted string\n         */\n        _camelCase: function(str) {\n            return str ? str.replace(/-(\\w)/g, function (_, $1) {\n                return $1.toUpperCase();\n            }) : str;\n        },\n\n\n        /**\n         * Gets the value for an element's style attribute\n         *\n         * @method getStyle\n         * @param {DOMElement|String}  elm    DOM element or element id\n         * @param {String}             style  Which css attribute to fetch\n         * @return Style value\n         * @sample Ink_Dom_Css_getStyle.html \n         */\n         getStyle: function(elm, style) {\n             elm = Ink.i(elm);\n             if (elm !== null && elm.style) {\n                 style = style === 'float' ? 'cssFloat': this._camelCase(style);\n\n                 var value = elm.style[style];\n\n                 if (getCs && (!value || value === 'auto')) {\n                     var css = getCs(elm, null);\n                     value = css ? css[style] : null;\n                 }\n                 else if (!value && elm.currentStyle) {\n                      value = elm.currentStyle[style];\n                      if (value === 'auto' && (style === 'width' || style === 'height')) {\n                        value = elm[\"offset\" + style.charAt(0).toUpperCase() + style.slice(1)] + \"px\";\n                      }\n                 }\n\n                 if (style === 'opacity') {\n                     return value ? parseFloat(value, 10) : 1.0;\n                 }\n                 else if (style === 'borderTopWidth'   || style === 'borderBottomWidth' ||\n                          style === 'borderRightWidth' || style === 'borderLeftWidth'       ) {\n                      if      (value === 'thin') {      return '1px';   }\n                      else if (value === 'medium') {    return '3px';   }\n                      else if (value === 'thick') {     return '5px';   }\n                 }\n\n                 return value === 'auto' ? null : value;\n             }\n         },\n\n\n        /**\n         * Adds CSS rules to an element's style attribute.\n         *\n         * @method setStyle\n         * @param {DOMElement|String}  elm    DOM element or element id\n         * @param {String}             style  Which css attribute to set\n         * @sample Ink_Dom_Css_setStyle.html \n         */\n        setStyle: function(elm, style) {\n            elm = Ink.i(elm);\n            if (elm === null) { return; }\n            if (typeof style === 'string') {\n                elm.style.cssText += '; '+style;\n\n                if (style.indexOf('opacity') !== -1) {\n                    this.setOpacity(elm, style.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1]);\n                }\n            }\n            else {\n                for (var prop in style) {\n                    if (style.hasOwnProperty(prop)){\n                        if (prop === 'opacity') {\n                            this.setOpacity(elm, style[prop]);\n                        }\n                        else if (prop === 'float' || prop === 'cssFloat') {\n                            if (typeof elm.style.styleFloat === 'undefined') {\n                                elm.style.cssFloat = style[prop];\n                            }\n                            else {\n                                elm.style.styleFloat = style[prop];\n                            }\n                        } else {\n                            elm.style[prop] = style[prop];\n                        }\n                    }\n                }\n            }\n        },\n\n\n        /**\n         * Shows an element.\n         * Internally it unsets the display property of an element. You can force a specific display property using forceDisplayProperty\n         *\n         * @method show\n         * @param {DOMElement|String}  elm                      DOM element or element id\n         * @param {String}             [forceDisplayProperty]   Css display property to apply on show\n         * @sample Ink_Dom_Css_show.html \n         */\n        show: function(elm, forceDisplayProperty) {\n            elm = Ink.i(elm);\n            if (elm !== null) {\n                elm.style.display = (forceDisplayProperty) ? forceDisplayProperty : '';\n            }\n        },\n\n        /**\n         * Hides an element.\n         *\n         * @method hide\n         * @param {DOMElement|String}  elm  DOM element or element id\n         * @sample Ink_Dom_Css_hide.html \n         */\n        hide: function(elm) {\n            elm = Ink.i(elm);\n            if (elm !== null) {\n                elm.style.display = 'none';\n            }\n        },\n\n        /**\n         * Shows or hides an element.\n         * If the show parameter is true, it shows the element. Otherwise, hides it.\n         *\n         * @method showHide\n         * @param {DOMElement|String}  elm          DOM element or element id\n         * @param {boolean}            [show]=false Whether to show or hide `elm`.\n         * @sample Ink_Dom_Css_showHide.html \n         */\n        showHide: function(elm, show) {\n            elm = Ink.i(elm);\n            if (elm) {\n                elm.style.display = show ? '' : 'none';\n            }\n        },\n\n        /**\n         * Toggles an element visibility.\n         * \n         * @method toggle\n         * @param {DOMElement|String}  elm        DOM element or element id\n         * @param {Boolean}            forceShow  Forces showing if element is hidden\n         * @sample Ink_Dom_Css_toggle.html \n         */\n        toggle: function(elm, forceShow) {\n            elm = Ink.i(elm);\n            if (elm !== null) {\n                if (typeof forceShow !== 'undefined') {\n                    if (forceShow === true) {\n                        this.show(elm);\n                    } else {\n                        this.hide(elm);\n                    }\n                } else {\n                    if (this.getStyle(elm,'display').toLowerCase() === 'none') {\n                        this.show(elm);\n                    }\n                    else {\n                        this.hide(elm);\n                    }\n                }\n            }\n        },\n\n        _getRefTag: function(head){\n            if (head.firstElementChild) {\n                return head.firstElementChild;\n            }\n\n            for (var child = head.firstChild; child; child = child.nextSibling){\n                if (child.nodeType === 1){\n                    return child;\n                }\n            }\n            return null;\n        },\n\n        /**\n         * Injects style tags with rules to the page.\n         *\n         * @method appendStyleTag\n         * @param {String}  selector  The css selector for the rule\n         * @param {String}  style     The content of the style rule\n         * @param {Object}  options   Options for the tag\n         *    @param {String}  [options.type]='text/css'   File type\n         *    @param {Boolean} [options.force]=false  If true, the style tag will be appended to end of head\n         * \n         * @sample Ink_Dom_Css_appendStyleTag.html \n         */\n        appendStyleTag: function(selector, style, options){\n            options = Ink.extendObj({\n                type: 'text/css',\n                force: false\n            }, options || {});\n\n            var styles = document.getElementsByTagName(\"style\"),\n                oldStyle = false, setStyle = true, i, l;\n\n            for (i=0, l=styles.length; i<l; i++) {\n                oldStyle = styles[i].innerHTML;\n                if (oldStyle.indexOf(selector) >= 0) {\n                    setStyle = false;\n                }\n            }\n\n            if (setStyle) {\n                var defStyle = document.createElement(\"style\"),\n                    head = document.getElementsByTagName(\"head\")[0],\n                    refTag = false, styleStr = '';\n\n                defStyle.type  = options.type;\n\n                styleStr += selector +\" {\";\n                styleStr += style;\n                styleStr += \"} \";\n\n                if (typeof defStyle.styleSheet !== \"undefined\") {\n                    defStyle.styleSheet.cssText = styleStr;\n                } else {\n                    defStyle.appendChild(document.createTextNode(styleStr));\n                }\n\n                if (options.force){\n                    head.appendChild(defStyle);\n                } else {\n                    refTag = this._getRefTag(head);\n                    if (refTag){\n                        head.insertBefore(defStyle, refTag);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Injects an external link tag.\n         * This method add a stylesheet to the head of a page\n         *\n         * @method appendStylesheet\n         * @param {String}  path     File path\n         * @param {Object}  options  Options for the tag\n         *    @param {String}   [options.media]='screen'    Media type\n         *    @param {String}   [options.type]='text/css'   File type\n         *    @param {Boolean}  [options.force]=false       If true, tag will be appended to end of head\n         * @sample Ink_Dom_Css_appendStylesheet.html \n         */\n        appendStylesheet: function(path, options){\n            options = Ink.extendObj({\n                media: 'screen',\n                type: 'text/css',\n                force: false\n            }, options || {});\n\n            var refTag,\n                style = document.createElement(\"link\"),\n                head = document.getElementsByTagName(\"head\")[0];\n\n            style.media = options.media;\n            style.type = options.type;\n            style.href = path;\n            style.rel = \"Stylesheet\";\n\n            if (options.force){\n                head.appendChild(style);\n            }\n            else {\n                refTag = this._getRefTag(head);\n                if (refTag){\n                    head.insertBefore(style, refTag);\n                }\n            }\n        },\n\n        /**\n         * Injects an external link tag.\n         * Loads CSS via LINK element inclusion in HEAD (skips append if already there)\n         *\n         * Works similarly to appendStylesheet but:\n         *   supports optional callback which gets invoked once the CSS has been applied\n         *\n         * @method appendStylesheetCb\n         * @param {String}            cssURI      URI of the CSS to load, if empty ignores and just calls back directly\n         * @param {Function(cssURI)}  [callback]  optional callback which will be called once the CSS is loaded\n         * @sample Ink_Dom_Css_appendStylesheetCb.html \n         */\n        _loadingCSSFiles: {},\n        _loadedCSSFiles:  {},\n        appendStylesheetCb: function(url, callback) {\n            if (!url) {\n                return callback(url);\n            }\n\n            if (this._loadedCSSFiles[url]) {\n                return callback(url);\n            }\n\n            var cbs = this._loadingCSSFiles[url];\n            if (cbs) {\n                return cbs.push(callback);\n            }\n\n            this._loadingCSSFiles[url] = [callback];\n\n            var linkEl = document.createElement('link');\n            linkEl.type = 'text/css';\n            linkEl.rel  = 'stylesheet';\n            linkEl.href = url;\n\n            var headEl = document.getElementsByTagName('head')[0];\n            headEl.appendChild(linkEl);\n\n            var imgEl = document.createElement('img');\n            /*\n            var _self = this;\n            (function(_url) {\n                imgEl.onerror = function() {\n                    //var url = this;\n                    var url = _url;\n                    _self._loadedCSSFiles[url] = true;\n                    var callbacks = _self._loadingCSSFiles[url];\n                    for (var i = 0, f = callbacks.length; i < f; ++i) {\n                        callbacks[i](url);\n                    }\n                    delete _self._loadingCSSFiles[url];\n                };\n            })(url);\n            */\n            imgEl.onerror = Ink.bindEvent(function(event, _url) {\n                //var url = this;\n                var url = _url;\n                this._loadedCSSFiles[url] = true;\n                var callbacks = this._loadingCSSFiles[url];\n                for (var i = 0, f = callbacks.length; i < f; ++i) {\n                    callbacks[i](url);\n                }\n                delete this._loadingCSSFiles[url];\n            }, this, url);\n            imgEl.src = url;\n        },\n\n        /**\n         * Converts decimal to hexadecimal values\n         * Useful to convert colors to their hexadecimal representation.\n         *\n         * @method decToHex\n         * @param {String} dec Either a single decimal value, an rgb(r, g, b) string or an Object with r, g and b properties\n         * @return {String} Hexadecimal value\n         * @sample Ink_Dom_Css_decToHex.html \n         */\n        decToHex: function(dec) {\n            var normalizeTo2 = function(val) {\n                if (val.length === 1) {\n                    val = '0' + val;\n                }\n                val = val.toUpperCase();\n                return val;\n            };\n\n            if (typeof dec === 'object') {\n                var rDec = normalizeTo2(parseInt(dec.r, 10).toString(16));\n                var gDec = normalizeTo2(parseInt(dec.g, 10).toString(16));\n                var bDec = normalizeTo2(parseInt(dec.b, 10).toString(16));\n                return rDec+gDec+bDec;\n            }\n            else {\n                dec += '';\n                var rgb = dec.match(/\\((\\d+),\\s?(\\d+),\\s?(\\d+)\\)/);\n                if (rgb !== null) {\n                    return  normalizeTo2(parseInt(rgb[1], 10).toString(16)) +\n                            normalizeTo2(parseInt(rgb[2], 10).toString(16)) +\n                            normalizeTo2(parseInt(rgb[3], 10).toString(16));\n                }\n                else {\n                    return normalizeTo2(parseInt(dec, 10).toString(16));\n                }\n            }\n        },\n\n        /**\n         * Converts hexadecimal values to decimal\n         * Useful to use with CSS colors\n         *\n         * @method hexToDec\n         * @param {String}  hex  hexadecimal Value with 6, 3, 2 or 1 characters\n         * @return {Number} Object with properties r, g, b if length of number is >= 3 or decimal value instead.\n         * @sample Ink_Dom_Css_hexToDec.html \n         */\n        hexToDec: function(hex){\n            if (hex.indexOf('#') === 0) {\n                hex = hex.substr(1);\n            }\n            if (hex.length === 6) { // will return object RGB\n                return {\n                    r: parseInt(hex.substr(0,2), 16),\n                    g: parseInt(hex.substr(2,2), 16),\n                    b: parseInt(hex.substr(4,2), 16)\n                };\n            }\n            else if (hex.length === 3) { // will return object RGB\n                return {\n                    r: parseInt(hex.charAt(0) + hex.charAt(0), 16),\n                    g: parseInt(hex.charAt(1) + hex.charAt(1), 16),\n                    b: parseInt(hex.charAt(2) + hex.charAt(2), 16)\n                };\n            }\n            else if (hex.length <= 2) { // will return int\n                return parseInt(hex, 16);\n            }\n        },\n\n        /**\n         * Get a single property from a stylesheet.\n         * Use this to obtain the value of a CSS property (searched from loaded CSS documents)\n         *\n         * @method getPropertyFromStylesheet\n         * @param {String}  selector  a CSS rule. must be an exact match\n         * @param {String}  property  a CSS property\n         * @return {String} value of the found property, or null if it wasn't matched\n         */\n        getPropertyFromStylesheet: function(selector, property) {\n            var rule = this.getRuleFromStylesheet(selector);\n            if (rule) {\n                return rule.style[property];\n            }\n            return null;\n        },\n\n        getPropertyFromStylesheet2: function(selector, property) {\n            var rules = this.getRulesFromStylesheet(selector);\n            /*\n            rules.forEach(function(rule) {\n                var x = rule.style[property];\n                if (x !== null && x !== undefined) {\n                    return x;\n                }\n            });\n            */\n            var x;\n            for(var i=0, t=rules.length; i < t; i++) {\n                x = rules[i].style[property];\n                if (x !== null && x !== undefined) {\n                    return x;\n                }\n            }\n            return null;\n        },\n\n        getRuleFromStylesheet: function(selector) {\n            var sheet, rules, ri, rf, rule;\n            var s = document.styleSheets;\n            if (!s) {\n                return null;\n            }\n\n            for (var si = 0, sf = document.styleSheets.length; si < sf; ++si) {\n                sheet = document.styleSheets[si];\n                rules = sheet.rules ? sheet.rules : sheet.cssRules;\n                if (!rules) { return null; }\n\n                for (ri = 0, rf = rules.length; ri < rf; ++ri) {\n                    rule = rules[ri];\n                    if (!rule.selectorText) { continue; }\n                    if (rule.selectorText === selector) {\n                        return rule;\n                    }\n                }\n            }\n\n            return null;\n        },\n\n        getRulesFromStylesheet: function(selector) {\n            var res = [];\n            var sheet, rules, ri, rf, rule;\n            var s = document.styleSheets;\n            if (!s) { return res; }\n\n            for (var si = 0, sf = document.styleSheets.length; si < sf; ++si) {\n                sheet = document.styleSheets[si];\n                rules = sheet.rules ? sheet.rules : sheet.cssRules;\n                if (!rules) {\n                    return null;\n                }\n\n                for (ri = 0, rf = rules.length; ri < rf; ++ri) {\n                    rule = rules[ri];\n                    if (!rule.selectorText) { continue; }\n                    if (rule.selectorText === selector) {\n                        res.push(rule);\n                    }\n                }\n            }\n\n            return res;\n        },\n\n        getPropertiesFromRule: function(selector) {\n            var rule = this.getRuleFromStylesheet(selector);\n            var props = {};\n            var prop, i, f;\n\n            /*if (typeof rule.style.length === 'snumber') {\n                for (i = 0, f = rule.style.length; i < f; ++i) {\n                    prop = this._camelCase( rule.style[i]   );\n                    props[prop] = rule.style[prop];\n                }\n            }\n            else {  // HANDLES IE 8, FIREFOX RULE JOINING... */\n                rule = rule.style.cssText;\n                var parts = rule.split(';');\n                var steps, val, pre, pos;\n                for (i = 0, f = parts.length; i < f; ++i) {\n                    if (parts[i].charAt(0) === ' ') {\n                        parts[i] = parts[i].substring(1);\n                    }\n                    steps = parts[i].split(':');\n                    prop = this._camelCase( steps[0].toLowerCase()  );\n                    val = steps[1];\n                    if (val) {\n                        val = val.substring(1);\n\n                        if (prop === 'padding' || prop === 'margin' || prop === 'borderWidth') {\n\n                            if (prop === 'borderWidth') {   pre = 'border'; pos = 'Width';  }\n                            else {                          pre = prop;     pos = '';       }\n\n                            if (val.indexOf(' ') !== -1) {\n                                val = val.split(' ');\n                                props[pre + 'Top'   + pos]  = val[0];\n                                props[pre + 'Bottom'+ pos]  = val[0];\n                                props[pre + 'Left'  + pos]  = val[1];\n                                props[pre + 'Right' + pos]  = val[1];\n                            }\n                            else {\n                                props[pre + 'Top'   + pos]  = val;\n                                props[pre + 'Bottom'+ pos]  = val;\n                                props[pre + 'Left'  + pos]  = val;\n                                props[pre + 'Right' + pos]  = val;\n                            }\n                        }\n                        else if (prop === 'borderRadius') {\n                            if (val.indexOf(' ') !== -1) {\n                                val = val.split(' ');\n                                props.borderTopLeftRadius       = val[0];\n                                props.borderBottomRightRadius   = val[0];\n                                props.borderTopRightRadius      = val[1];\n                                props.borderBottomLeftRadius    = val[1];\n                            }\n                            else {\n                                props.borderTopLeftRadius       = val;\n                                props.borderTopRightRadius      = val;\n                                props.borderBottomLeftRadius    = val;\n                                props.borderBottomRightRadius   = val;\n                            }\n                        }\n                        else {\n                            props[prop] = val;\n                        }\n                    }\n                }\n            //}\n            //console.log(props);\n\n            return props;\n        },\n\n        /**\n         * Change the font size of elements.\n         * Changes the font size of the elements which match the given CSS rule\n         * For this function to work, the CSS file must be in the same domain than the host page, otherwise JS can't access it.\n         *\n         * @method changeFontSize\n         * @param {String}  selector  CSS selector rule\n         * @param {Number}  delta     Number of pixels to change on font-size\n         * @param {String}  [op]      Supported operations are '+' and '*'. defaults to '+'\n         * @param {Number}  [minVal]  If result gets smaller than minVal, change does not occurr\n         * @param {Number}  [maxVal]  If result gets bigger  than maxVal, change does not occurr\n         */\n        changeFontSize: function(selector, delta, op, minVal, maxVal) {\n            var that = this;\n            Ink.requireModules(['Ink.Dom.Selector_1'], function(Selector) {\n                var e;\n                if      (typeof selector !== 'string') { e = '1st argument must be a CSS selector rule.'; }\n                else if (typeof delta    !== 'number') { e = '2nd argument must be a number.'; }\n                else if (op !== undefined && op !== '+' && op !== '*') { e = '3rd argument must be one of \"+\", \"*\".'; }\n                else if (minVal !== undefined && (typeof minVal !== 'number' || minVal <= 0)) { e = '4th argument must be a positive number.'; }\n                else if (maxVal !== undefined && (typeof maxVal !== 'number' || maxVal < maxVal)) { e = '5th argument must be a positive number greater than minValue.'; }\n                if (e) { throw new TypeError(e); }\n\n                var val, el, els = Selector.select(selector);\n                if (minVal === undefined) { minVal = 1; }\n                op = (op === '*') ? function(a,b){return a*b;} : function(a,b){return a+b;};\n                for (var i = 0, f = els.length; i < f; ++i) {\n                    el = els[i];\n                    val = parseFloat( that.getStyle(el, 'fontSize'));\n                    val = op(val, delta);\n                    if (val < minVal) { continue; }\n                    if (typeof maxVal === 'number' && val > maxVal) { continue; }\n                    el.style.fontSize = val + 'px';\n                }\n            });\n        }\n\n    };\n\n    return Css;\n\n});\n","/**\n * DOM Traversal and manipulation\n * @module Ink.Dom.Element_1\n * @version 1\n */\n\nInk.createModule('Ink.Dom.Element', 1, [], function() {\n\n    'use strict';\n\n    var createContextualFragmentSupport = (\n        typeof document.createRange === 'function' &&\n        typeof window.Range.prototype.createContextualFragment === 'function');\n\n    var deleteThisTbodyToken = 'Ink.Dom.Element tbody: ' + Math.random();\n    var browserCreatesTbodies = (function () {\n        var div = document.createElement('div');\n        div.innerHTML = '<table>';\n        return div.getElementsByTagName('tbody').length !== 0;\n    }());\n\n    function rect(elem){\n        var dimensions = {};\n        try {\n            dimensions = elem.getBoundingClientRect();\n        } catch(e){\n            dimensions = { top: elem.offsetTop, left: elem.offsetLeft };\n        }\n        return dimensions;\n    }\n\n    /**\n     * @namespace Ink.Dom.Element_1\n     */\n\n    var InkElement = {\n\n        /**\n         * Checks if something is a DOM Element.\n         *\n         * @method isDOMElement\n         * @static\n         * @param   {Mixed}     o   The object to be checked.\n         * @return  {Boolean}       True if it's a valid DOM Element.\n         * @example\n         *     var el = Ink.s('#element');\n         *     if( InkElement.isDOMElement( el ) === true ){\n         *         // It is a DOM Element.\n         *     } else {\n         *         // It is NOT a DOM Element.\n         *     }\n         */\n        isDOMElement: function(o) {\n            return o !== null && typeof o === 'object' && 'nodeType' in o && o.nodeType === 1;\n        },\n\n        /**\n         * Shortcut for `document.getElementById`\n         *\n         * @method get\n         * @param {String|DOMElement} elm   Either an ID of an element, or an element.\n         * @return {DOMElement|null} The DOM element with the given id or null when it was not found\n         * @sample Ink_Dom_Element_1_get.html\n         */\n        get: function(elm) {\n            if(typeof elm !== 'undefined') {\n                if(typeof elm === 'string') {\n                    return document.getElementById(elm);\n                }\n                return elm;\n            }\n            return null;\n        },\n\n        /**\n         * Creates a DOM element\n         *\n         * @method create\n         * @param {String} tag        tag name\n         * @param {Object} properties  object with properties to be set on the element. You can also call other functions in Ink.Dom.Element like this\n         * @sample Ink_Dom_Element_1_create.html\n         */\n        create: function(tag, properties) {\n            var el = document.createElement(tag);\n            //Ink.extendObj(el, properties);\n            for(var property in properties) {\n                if(properties.hasOwnProperty(property)) {\n                    if (property in InkElement) {\n                        InkElement[property](el, properties[property]);\n                    } else {\n                        if(property === 'className' || property === 'class') {\n                            el.className = properties.className || properties['class'];\n                        } else {\n                            el.setAttribute(property, properties[property]);\n                        }\n                    }\n                }\n            }\n            return el;\n        },\n\n        /**\n         * Removes a DOM Element\n         *\n         * @method remove\n         * @param {DOMElement} elm  The element to remove\n         * @sample Ink_Dom_Element_1_remove.html\n         */\n        remove: function(el) {\n            el = Ink.i(el);\n            var parEl;\n            if (el && (parEl = el.parentNode)) {\n                parEl.removeChild(el);\n            }\n        },\n\n        /**\n         * Scrolls the window to an element\n         *\n         * @method scrollTo\n         * @param {DOMElement|String} elm  Element where to scroll\n         * @sample Ink_Dom_Element_1_scrollTo.html\n         */\n        scrollTo: function(elm) {\n            elm = InkElement.get(elm);\n            if(elm) {\n                if (elm.scrollIntoView) {\n                    return elm.scrollIntoView();\n                }\n\n                var elmOffset = {},\n                    elmTop = 0, elmLeft = 0;\n\n                do {\n                    elmTop += elm.offsetTop || 0;\n                    elmLeft += elm.offsetLeft || 0;\n\n                    elm = elm.offsetParent;\n                } while(elm);\n\n                elmOffset = {x: elmLeft, y: elmTop};\n\n                window.scrollTo(elmOffset.x, elmOffset.y);\n            }\n        },\n\n        /**\n         * Gets the top offset of an element\n         *\n         * @method offsetTop\n         * @uses Ink.Dom.Browser\n         *\n         * @param {DOMElement|String} elm  Target element\n         * @return {Number} Offset from the target element to the top of the document\n         * @sample Ink_Dom_Element_1_offsetTop.html\n         */\n        offsetTop: function(elm) {\n            return InkElement.offset(elm)[1];\n        },\n\n        /**\n         * Gets the left offset of an element\n         *\n         * @method offsetLeft\n         * @uses Ink.Dom.Browser\n         *\n         * @param {DOMElement|String} elm  Target element\n         * @return {Number} Offset from the target element to the left of the document\n         * @sample Ink_Dom_Element_1_offsetLeft.html\n         */\n        offsetLeft: function(elm) {\n            return InkElement.offset(elm)[0];\n        },\n\n        /**\n        * Gets the relative offset of an element\n        *\n        * @method positionedOffset\n        * @param {DOMElement|String} elm  Target element\n        * @return {Array} Array with the element offsetleft and offsettop relative to the closest positioned ancestor\n        * @sample Ink_Dom_Element_1_positionedOffset.html\n        */\n        positionedOffset: function(element) {\n            var valueTop = 0, valueLeft = 0;\n            element = InkElement.get(element);\n            do {\n                valueTop  += element.offsetTop  || 0;\n                valueLeft += element.offsetLeft || 0;\n                element = element.offsetParent;\n                if (element) {\n                    if (element.tagName.toLowerCase() === 'body') { break;  }\n\n                    var value = element.style.position;\n                    if (!value && element.currentStyle) {\n                        value = element.currentStyle.position;\n                    }\n                    if ((!value || value === 'auto') && typeof getComputedStyle !== 'undefined') {\n                        var css = getComputedStyle(element, null);\n                        value = css ? css.position : null;\n                    }\n                    if (value === 'relative' || value === 'absolute') { break;  }\n                }\n            } while (element);\n            return [valueLeft, valueTop];\n        },\n\n        /**\n         * Gets the cumulative offset for an element\n         *\n         * Returns the top left position of the element on the page\n         *\n         * @method offset\n         * @uses Ink.Dom.Browser\n         *\n         * @method offset\n         * @param {DOMElement|String}   elm     Target element\n         * @return {[Number, Number]}   Array with pixel distance from the target element to the top left corner of the document\n         * @sample Ink_Dom_Element_1_offset.html\n         */\n        offset: function(el) {\n            /*jshint boss:true */\n            el = Ink.i(el);\n            var res = [0, 0];\n            var doc = el.ownerDocument,\n                docElem = doc.documentElement,\n                box = rect(el),\n                body = doc.body,\n                clientTop  = docElem.clientTop  || body.clientTop  || 0,\n                clientLeft = docElem.clientLeft || body.clientLeft || 0,\n                scrollTop  = doc.pageYOffset || docElem.scrollTop  || body.scrollTop,\n                scrollLeft = doc.pageXOffset || docElem.scrollLeft || body.scrollLeft,\n                top  = box.top  + scrollTop  - clientTop,\n                left = box.left + scrollLeft - clientLeft;\n            res = [left, top];\n            return res;\n        },\n\n        /**\n         * Gets the scroll of the element\n         *\n         * @method scroll\n         * @param {DOMElement|String} [elm] Target element or document.body\n         * @returns {Array} offset values for x and y scroll\n         * @sample Ink_Dom_Element_1_scroll.html\n         */\n        scroll: function(elm) {\n            elm = elm ? Ink.i(elm) : document.body;\n            return [\n                ( ( !window.pageXOffset ) ? elm.scrollLeft : window.pageXOffset ),\n                ( ( !window.pageYOffset ) ? elm.scrollTop : window.pageYOffset )\n            ];\n        },\n\n        _getPropPx: function(cs, prop) {\n            var n, c;\n            var val = cs.getPropertyValue ? cs.getPropertyValue(prop) : cs[prop];\n            if (!val) { n = 0; }\n            else {\n                c = val.indexOf('px');\n                if (c === -1) { n = 0; }\n                else {\n                    n = parseFloat(val, 10);\n                }\n            }\n\n            //console.log([prop, ' \"', val, '\" ', n].join(''));\n\n            return n;\n        },\n\n        /**\n         * Alias for offset()\n         *\n         * @method offset2\n         * @deprecated Kept for historic reasons. Use offset() instead.\n         */\n        offset2: function(el) {\n            return InkElement.offset(el);\n        },\n\n        /**\n         * Checks if an element has an attribute\n         *\n         * @method hasAttribute\n         * @param {Object} elm   Target element\n         * @param {String} attr  Attribute name\n         * @return {Boolean} Boolean based on existance of attribute\n         * @sample Ink_Dom_Element_1_hasAttribute.html\n         */\n        hasAttribute: function(elm, attr){\n            elm = Ink.i(elm);\n            return elm.hasAttribute ? elm.hasAttribute(attr) : !!elm.getAttribute(attr);\n        },\n        /**\n         * Inserts an element right after another\n         *\n         * @method insertAfter\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertAfter.html\n         */\n        insertAfter: function(newElm, targetElm) {\n            /*jshint boss:true */\n            if (targetElm = InkElement.get(targetElm)) {\n                if (targetElm.nextSibling !== null) {\n                    targetElm.parentNode.insertBefore(newElm, targetElm.nextSibling);\n                } else {\n                    targetElm.parentNode.appendChild(newElm);\n                }\n            }\n        },\n\n        /**\n         * Inserts an element before another\n         *\n         * @method insertBefore\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertBefore.html\n         */\n        insertBefore: function (newElm, targetElm) {\n            /*jshint boss:true */\n            if ( (targetElm = InkElement.get(targetElm)) ) {\n                targetElm.parentNode.insertBefore(newElm, targetElm);\n            }\n        },\n\n        /**\n         * Inserts an element as the first child of another\n         *\n         * @method insertTop\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertTop.html\n         */\n        insertTop: function(newElm,targetElm) {\n            /*jshint boss:true */\n            if (targetElm = InkElement.get(targetElm)) {\n                if (targetElm.firstChild) {\n                    targetElm.insertBefore(newElm, targetElm.firstChild);\n                } else {\n                    targetElm.appendChild(newElm);\n                }\n            }\n        },\n\n        /**\n         * Inserts an element as the last child of another\n         *\n         * @method insertBottom\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertBottom.html\n         */\n        insertBottom: function(newElm, targetElm) {\n            /*jshint boss:true */\n            targetElm = Ink.i(targetElm);\n            targetElm.appendChild(newElm);\n        },\n\n        /**\n         * Retrieves textContent from node\n         *\n         * @method textContent\n         * @param {DOMNode} node Where to retreive text from. Can be any node type.\n         * @return {String} the text\n         * @sample Ink_Dom_Element_1_textContent.html\n         */\n        textContent: function(node){\n            node = Ink.i(node);\n            var text, k, cs, m;\n\n            switch(node && node.nodeType) {\n            case 9: /*DOCUMENT_NODE*/\n                // IE quirks mode does not have documentElement\n                return InkElement.textContent(node.documentElement || node.body && node.body.parentNode || node.body);\n\n            case 1: /*ELEMENT_NODE*/\n                text = node.innerText;\n                if (typeof text !== 'undefined') {\n                    return text;\n                }\n                /* falls through */\n            case 11: /*DOCUMENT_FRAGMENT_NODE*/\n                text = node.textContent;\n                if (typeof text !== 'undefined') {\n                    return text;\n                }\n\n                if (node.firstChild === node.lastChild) {\n                    // Common case: 0 or 1 children\n                    return InkElement.textContent(node.firstChild);\n                }\n\n                text = [];\n                cs = node.childNodes;\n                for (k = 0, m = cs.length; k < m; ++k) {\n                    text.push( InkElement.textContent( cs[k] ) );\n                }\n                return text.join('');\n\n            case 3: /*TEXT_NODE*/\n            case 4: /*CDATA_SECTION_NODE*/\n                return node.nodeValue;\n            }\n            return '';\n        },\n\n        /**\n         * Replaces text content of a DOM Node\n         * This method removes any child node previously present\n         *\n         * @method setTextContent\n         * @param {DOMNode} node    node Target node where the text will be added.\n         * @param {String}  text    text Text to be added on the node.\n         * @sample Ink_Dom_Element_1_setTextContent.html\n         */\n        setTextContent: function(node, text){\n            node = Ink.i(node);\n            switch(node && node.nodeType)\n            {\n            case 1: /*ELEMENT_NODE*/\n                if ('innerText' in node) {\n                    node.innerText = text;\n                    break;\n                }\n                /* falls through */\n            case 11: /*DOCUMENT_FRAGMENT_NODE*/\n                if ('textContent' in node) {\n                    node.textContent = text;\n                    break;\n                }\n                /* falls through */\n            case 9: /*DOCUMENT_NODE*/\n                while(node.firstChild) {\n                    node.removeChild(node.firstChild);\n                }\n                if (text !== '') {\n                    var doc = node.ownerDocument || node;\n                    node.appendChild(doc.createTextNode(text));\n                }\n                break;\n\n            case 3: /*TEXT_NODE*/\n            case 4: /*CDATA_SECTION_NODE*/\n                node.nodeValue = text;\n                break;\n            }\n        },\n\n        /**\n         * Checks if an element is a link\n         *\n         * @method isLink\n         * @param {DOMNode} node    Node to check if it's link\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isLink.html\n         */\n        isLink: function(element){\n            var b = element && element.nodeType === 1 && ((/^a|area$/i).test(element.tagName) ||\n                element.hasAttributeNS && element.hasAttributeNS('http://www.w3.org/1999/xlink','href'));\n            return !!b;\n        },\n\n        /**\n         * Checks if a node is an ancestor of another\n         *\n         * @method isAncestorOf\n         * @param {DOMNode} ancestor  Ancestor node\n         * @param {DOMNode} node      Descendant node\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isAncestorOf.html\n         */\n        isAncestorOf: function(ancestor, node){\n            /*jshint boss:true */\n            if (!node || !ancestor) {\n                return false;\n            }\n            if (node.compareDocumentPosition) {\n                return (ancestor.compareDocumentPosition(node) & 0x10) !== 0;/*Node.DOCUMENT_POSITION_CONTAINED_BY*/\n            }\n            while (node = node.parentNode){\n                if (node === ancestor){\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Checks if a node is descendant of another\n         *\n         * @method descendantOf\n         * @param {DOMNode} node        The ancestor\n         * @param {DOMNode} descendant  The descendant\n         * @return {Boolean} true if 'descendant' is descendant of 'node'\n         * @sample Ink_Dom_Element_1_descendantOf.html\n         */\n        descendantOf: function(node, descendant){\n            return node !== descendant && InkElement.isAncestorOf(node, descendant);\n        },\n\n        /**\n         * Get first child element of another\n         * @method firstElementChild\n         * @param {DOMElement} elm Parent node\n         * @return {DOMElement} the Element child\n         * @sample Ink_Dom_Element_1_firstElementChild.html\n         */\n        firstElementChild: function(elm){\n            if(!elm) {\n                return null;\n            }\n            if ('firstElementChild' in elm) {\n                return elm.firstElementChild;\n            }\n            var child = elm.firstChild;\n            while(child && child.nodeType !== 1) {\n                child = child.nextSibling;\n            }\n            return child;\n        },\n\n        /**\n         * Get the last child element of another\n         * @method lastElementChild\n         * @param {DOMElement} elm Parent node\n         * @return {DOMElement} the Element child\n         * @sample Ink_Dom_Element_1_lastElementChild.html\n         */\n        lastElementChild: function(elm){\n            if(!elm) {\n                return null;\n            }\n            if ('lastElementChild' in elm) {\n                return elm.lastElementChild;\n            }\n            var child = elm.lastChild;\n            while(child && child.nodeType !== 1) {\n                child = child.previousSibling;\n            }\n            return child;\n        },\n\n        /**\n         * Get the first sibling element after the node\n         *\n         * @method nextElementSibling\n         * @param {DOMNode} node  The current node\n         * @return {DOMElement|Null} The first sibling element after node or null if none is found\n         * @sample Ink_Dom_Element_1_nextElementSibling.html \n         */\n        nextElementSibling: function(node){\n            var sibling = null;\n\n            if(!node){ return sibling; }\n\n            if(\"nextElementSibling\" in node){\n                return node.nextElementSibling;\n            } else {\n                sibling = node.nextSibling;\n\n                // 1 === Node.ELEMENT_NODE\n                while(sibling && sibling.nodeType !== 1){\n                    sibling = sibling.nextSibling;\n                }\n\n                return sibling;\n            }\n        },\n\n        /**\n         * Get the first sibling element before the node\n         *\n         * @method previousElementSibling\n         * @param {DOMNode}        node The current node\n         * @return {DOMElement|Null} The first element sibling before node or null if none is found\n         * @sample Ink_Dom_Element_1_previousElementSibling.html \n         */\n        previousElementSibling: function(node){\n            var sibling = null;\n\n            if(!node){ return sibling; }\n\n            if(\"previousElementSibling\" in node){\n                return node.previousElementSibling;\n            } else {\n                sibling = node.previousSibling;\n\n                // 1 === Node.ELEMENT_NODE\n                while(sibling && sibling.nodeType !== 1){\n                    sibling = sibling.previousSibling;\n                }\n\n                return sibling;\n            }\n        },\n\n        /**\n         * Get an element's width in pixels.\n         *\n         * @method elementWidth\n         * @param {DOMElement|String} element Target DOM element or target ID\n         * @return {Number} The element's width\n         * @sample Ink_Dom_Element_1_elementWidth.html \n         */\n        elementWidth: function(element) {\n            if(typeof element === \"string\") {\n                element = document.getElementById(element);\n            }\n            return element.offsetWidth;\n        },\n\n        /**\n         * Get an element's height in pixels.\n         *\n         * @method elementHeight\n         * @param {DOMElement|String} element DOM element or target ID\n         * @return {Number} The element's height\n         * @sample Ink_Dom_Element_1_elementHeight.html \n         */\n        elementHeight: function(element) {\n            if(typeof element === \"string\") {\n                element = document.getElementById(element);\n            }\n            return element.offsetHeight;\n        },\n\n        /**\n         * Deprecated. Alias for offsetLeft()\n         *\n         * @method elementLeft\n         * @param {DOMElement|String}       element     DOM element or target ID\n         * @return {Number} Element's left position\n         */\n        elementLeft: function(element) {\n            return InkElement.offsetLeft(element);\n        },\n\n        /**\n         * Deprecated. Alias for offsetTop()\n         *\n         * @method elementTop\n         * @param {DOMElement|string}   element     Target DOM element or target ID\n         * @return {Number} element's top position\n         */\n        elementTop: function(element) {\n            return InkElement.offsetTop(element);\n        },\n\n        /**\n         * Get an element's dimensions in pixels.\n         *\n         * @method elementDimensions\n         * @param {DOMElement|string}   element     DOM element or target ID\n         * @return {Array} Array with element's width and height\n         * @sample Ink_Dom_Element_1_elementDimensions.html \n         */\n        elementDimensions: function(element) {\n            element = Ink.i(element);\n            return [element.offsetWidth, element.offsetHeight];\n        },\n\n        /**\n         * Get the outer dimensions of an element in pixels.\n         *\n         * @method outerDimensions\n         * @uses Ink.Dom.Css\n         *\n         * @param {DOMElement} element Target element\n         * @return {Array} Array with element width and height.\n         * @sample Ink_Dom_Element_1_outerDimensions.html \n         */\n        outerDimensions: function (element) {\n            var bbox = rect(element);\n\n            var Css = Ink.getModule('Ink.Dom.Css_1');\n            var getStyle = Ink.bindMethod(Css, 'getStyle', element);\n\n            return [\n                bbox.right - bbox.left + parseFloat(getStyle('marginLeft') || 0) + parseFloat(getStyle('marginRight') || 0),  // w\n                bbox.bottom - bbox.top + parseFloat(getStyle('marginTop') || 0) + parseFloat(getStyle('marginBottom') || 0)  // h\n            ];\n        },\n\n        /**\n         * Check if an element is inside the viewport\n         *\n         * @method inViewport\n         * @param {DOMElement} element DOM Element\n         * @param {Object}  [options]  Options object. If you pass a Boolean value here, it is interpreted as `options.partial`\n         * @param {Boolean} [options.partial]=false    Return `true` even if it is only partially visible.\n         * @param {Number}  [options.margin]=0         Consider a margin all around the viewport with `opts.margin` width a dead zone.\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_inViewport.html \n         */\n        inViewport: function (element, opts) {\n            var dims = rect(Ink.i(element));\n            if (typeof opts === 'boolean') {\n                opts = {partial: opts, margin: 0};\n            }\n            opts = Ink.extendObj({ partial: false, margin: 0}, opts || {});\n            if (opts.partial) {\n                return  dims.bottom + opts.margin > 0                           && // from the top\n                        dims.left   - opts.margin < InkElement.viewportWidth()  && // from the right\n                        dims.top    - opts.margin < InkElement.viewportHeight() && // from the bottom\n                        dims.right  + opts.margin > 0;                             // from the left\n            } else {\n                return  dims.top    + opts.margin > 0                           && // from the top\n                        dims.right  - opts.margin < InkElement.viewportWidth()  && // from the right\n                        dims.bottom - opts.margin < InkElement.viewportHeight() && // from the bottom\n                        dims.left   + opts.margin > 0;                             // from the left\n            }\n        },\n\n        /**\n         * Check if an element is hidden.\n         * Taken from Mootools Element extras ( https://gist.github.com/cheeaun/73342 )\n         * Does not take into account visibility:hidden\n         * @method isHidden\n         * @param {DOMElement} element Element to check\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isHidden.html \n         */\n\n        isHidden: function (element) {\n            var w = element.offsetWidth, \n                h = element.offsetHeight,\n                force = (element.tagName.toLowerCase() === 'tr');\n\n            var Css = Ink.getModule('Ink.Dom.Css_1');\n\n            return (w===0 && h===0 && !force) ? true :\n                (w!==0 && h!==0 && !force) ? false :\n                Css.getStyle(element, 'display').toLowerCase() === 'none';\n         },\n\n        /**\n         * Check if an element is visible \n         *\n         * @method isVisible\n         * @uses isHidden\n         * @param {DOMElement} element Element to check\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isVisible.html \n         */\n\n        isVisible: function (element) {\n            return !this.isHidden(element);\n        },\n\n        /**\n         * Clones an element's position to another\n         *\n         * @method clonePosition\n         * @param {DOMElement} cloneTo    element to be position cloned\n         * @param {DOMElement} cloneFrom  element to get the cloned position\n         * @return {DOMElement} The element with positionClone\n         * @sample Ink_Dom_Element_1_clonePosition.html \n         */\n        clonePosition: function(cloneTo, cloneFrom){\n            var pos = InkElement.offset(cloneFrom);\n            cloneTo.style.left = pos[0]+'px';\n            cloneTo.style.top = pos[1]+'px';\n\n            return cloneTo;\n        },\n\n        /**\n         * Text-overflow: ellipsis emulation\n         * Slices off a piece of text at the end of the element and adds the ellipsis so all text fits inside.\n         *\n         * @method ellipsizeText\n         * @param {DOMElement} element              Element to modify text content\n         * @param {String}     [ellipsis]='\\u2026'  String to append to the chopped text\n         */\n        ellipsizeText: function(element/*, ellipsis*/){\n            if ((element = Ink.i(element))) {\n                element.style.overflow = 'hidden';\n                element.style.whiteSpace = 'nowrap';\n                element.style.textOverflow = 'ellipsis';\n            }\n        },\n\n        /**\n         * Finds the closest ancestor element matching your test function\n         * \n         *\n         * @method findUpwardsHaving\n         * @param {DOMElement} element     Element to base the search from\n         * @param {Function}    boolTest   Testing function\n         * @return {DOMElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsHaving.html \n         */\n        findUpwardsHaving: function(element, boolTest) {\n            while (element && element.nodeType === 1) {\n                if (boolTest(element)) {\n                    return element;\n                }\n                element = element.parentNode;\n            }\n            return false;\n        },\n\n        /**\n         * Finds the closest ancestor by class name\n         *\n         * @method findUpwardsByClass\n         * @uses findUpwardsHaving\n         * @param {DOMElement} element      Element to base the search from\n         * @param {String}      className   Class name to search\n         * @returns {DOMElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsByClass.html \n         */\n        findUpwardsByClass: function(element, className) {\n            var re = new RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\n            var tst = function(el) {\n                var cls = el.className;\n                return cls && re.test(cls);\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by tag name\n         *\n         * @method findUpwardsByTag\n         * @param {DOMElement} element  Element to base the search from\n         * @param {String}      tag     Tag to search\n         * @returns {DOMElement|false} the matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsByTag.html \n         */\n        findUpwardsByTag: function(element, tag) {\n            tag = tag.toUpperCase();\n            var tst = function(el) {\n                return el.nodeName && el.nodeName.toUpperCase() === tag;\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by id\n         *\n         * @method findUpwardsById\n         * @param {HtmlElement} element     Element to base the search from\n         * @param {String}      id          ID to search\n         * @returns {HtmlElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsById.html \n         */\n        findUpwardsById: function(element, id) {\n            var tst = function(el) {\n                return el.id === id;\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by CSS selector\n         *\n         * @method findUpwardsBySelector\n         * @param {HtmlElement} element     Element to base the search from\n         * @param {String}      sel         CSS selector\n         * @returns {HtmlElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsBySelector.html \n         */\n        findUpwardsBySelector: function(element, sel) {\n            var Selector = Ink.getModule('Ink.Dom.Selector', '1');\n            if (!Selector) {\n                throw new Error('This method requires Ink.Dom.Selector');\n            }\n            var tst = function(el) {\n                return Selector.matchesSelector(el, sel);\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Gets the trimmed text of an element\n         *\n         * @method getChildrenText\n         * @param {DOMElement}  el          Element to base the search from\n         * @param {Boolean}     [removeIt]  Flag to remove the text from the element\n         * @return {String} Text found\n         * @sample Ink_Dom_Element_1_getChildrenText.html \n         */\n        getChildrenText: function(el, removeIt) {\n            var node,\n                j,\n                part,\n                nodes = el.childNodes,\n                jLen = nodes.length,\n                text = '';\n\n            if (!el) {\n                return text;\n            }\n\n            for (j = 0; j < jLen; ++j) {\n                node = nodes[j];\n                if (!node) {    continue;   }\n                if (node.nodeType === 3) {  // TEXT NODE\n                    part = InkElement._trimString( String(node.data) );\n                    if (part.length > 0) {\n                        text += part;\n                        if (removeIt) { el.removeChild(node);   }\n                    }\n                    else {  el.removeChild(node);   }\n                }\n            }\n\n            return text;\n        },\n\n        /**\n         * String trim implementation\n         * Used by getChildrenText\n         *\n         * function _trimString\n         * param {String} text\n         * return {String} trimmed text\n         */\n        _trimString: function(text) {\n            return (String.prototype.trim) ? text.trim() : text.replace(/^\\s*/, '').replace(/\\s*$/, '');\n        },\n\n        /**\n         * Gets value of a select element\n         *\n         * @method getSelectValues\n         * @param {DOMElement|String} select element\n         * @return {Array} The selected values\n         * @sample Ink_Dom_Element_1_getSelectValues.html \n         */\n        getSelectValues: function (select) {\n            var selectEl = Ink.i(select);\n            var values = [];\n            for (var i = 0; i < selectEl.options.length; ++i) {\n                values.push( selectEl.options[i].value );\n            }\n            return values;\n        },\n\n\n        /* used by fills */\n        _normalizeData: function(data) {\n            var d, data2 = [];\n            for (var i = 0, f = data.length; i < f; ++i) {\n                d = data[i];\n\n                if (!(d instanceof Array)) {    // if not array, wraps primitive twice:     val -> [val, val]\n                    d = [d, d];\n                }\n                else if (d.length === 1) {      // if 1 element array:                      [val] -> [val, val]\n                    d.push(d[0]);\n                }\n                data2.push(d);\n            }\n            return data2;\n        },\n\n\n        /**\n         * Fills a select element with options\n         *\n         * @method fillSelect\n         * @param {DOMElement|String}  container       Select element which will get filled\n         * @param {Array}              data            Data to populate the component\n         * @param {Boolean}            [skipEmpty]     Flag to skip empty option\n         * @param {String|Number}      [defaultValue]  Initial selected value\n         *\n         * @sample Ink_Dom_Element_1_fillSelect.html \n         */\n        fillSelect: function(container, data, skipEmpty, defaultValue) {\n            var containerEl = Ink.i(container);\n            if (!containerEl) {   return; }\n\n            containerEl.innerHTML = '';\n            var d, optionEl;\n\n            if (!skipEmpty) {\n                // add initial empty option\n                optionEl = document.createElement('option');\n                optionEl.setAttribute('value', '');\n                containerEl.appendChild(optionEl);\n            }\n\n            data = InkElement._normalizeData(data);\n\n            for (var i = 0, f = data.length; i < f; ++i) {\n                d = data[i];\n\n                optionEl = document.createElement('option');\n                optionEl.setAttribute('value', d[0]);\n                if (d.length > 2) {\n                    optionEl.setAttribute('extra', d[2]);\n                }\n                optionEl.appendChild( document.createTextNode(d[1]) );\n\n                if (d[0] === defaultValue) {\n                    optionEl.setAttribute('selected', 'selected');\n                }\n\n                containerEl.appendChild(optionEl);\n            }\n        },\n\n\n        /**\n         * Creates a set of radio buttons from an array of data\n         *\n         * @method fillRadios\n         * @param {DOMElement|String}  insertAfterEl    Element after which the input elements will be created\n         * @param {String}             name             Name for the form field ([] is added if not present as a suffix)\n         * @param {Array}              data             Data to populate the component\n         * @param {Boolean}            [skipEmpty]      Flag to skip creation of empty options\n         * @param {String|Number}      [defaultValue]   Initial selected value\n         * @param {String}             [splitEl]        Name of element to add after each input element (example: 'br')\n         * @return {DOMElement} Wrapper element around the radio buttons\n         */\n        fillRadios: function(insertAfterEl, name, data, skipEmpty, defaultValue, splitEl) {\n            insertAfterEl = Ink.i(insertAfterEl);\n            var containerEl = document.createElement('span');\n            InkElement.insertAfter(containerEl, insertAfterEl);\n\n            data = InkElement._normalizeData(data);\n\n            /*\n            if (name.substring(name.length - 1) !== ']') {\n                name += '[]';\n            }\n            */\n\n            var d, inputEl;\n\n            if (!skipEmpty) {\n                // add initial empty option\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'radio');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', '');\n                containerEl.appendChild(inputEl);\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n            }\n\n            for (var i = 0; i < data.length; ++i) {\n                d = data[i];\n\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'radio');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', d[0]);\n                containerEl.appendChild(inputEl);\n                containerEl.appendChild( document.createTextNode(d[1]) );\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n\n                if (d[0] === defaultValue) {\n                    inputEl.checked = true;\n                }\n            }\n\n            return containerEl;\n        },\n\n\n        /**\n         * Creates set of checkbox buttons\n         *\n         * @method fillChecks\n         * @param {DOMElement|String}  insertAfterEl   Element after which the input elements will be created\n         * @param {String}             name            Name for the form field ([] is added if not present as a suffix)\n         * @param {Array}              data            Data to populate the component\n         * @param {Boolean}            [skipEmpty]     Flag to skip creation of empty options\n         * @param {String|Number}      [defaultValue]  Initial selected value\n         * @param {String}             [splitEl]       Name of element to add after each input element (example: 'br')\n         * @return {DOMElement} Wrapper element around the checkboxes\n         */\n        fillChecks: function(insertAfterEl, name, data, defaultValue, splitEl) {\n            insertAfterEl = Ink.i(insertAfterEl);\n            var containerEl = document.createElement('span');\n            InkElement.insertAfter(containerEl, insertAfterEl);\n\n            data = InkElement._normalizeData(data);\n\n            if (name.substring(name.length - 1) !== ']') {\n                name += '[]';\n            }\n\n            var d, inputEl;\n\n            for (var i = 0; i < data.length; ++i) {\n                d = data[i];\n\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'checkbox');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', d[0]);\n                containerEl.appendChild(inputEl);\n                containerEl.appendChild( document.createTextNode(d[1]) );\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n\n                if (d[0] === defaultValue) {\n                    inputEl.checked = true;\n                }\n            }\n\n            return containerEl;\n        },\n\n\n        /**\n         * Gets the index of an element relative to a parent\n         *\n         * @method parentIndexOf\n         * @param {DOMElement}  parentEl  Element to parse\n         * @param {DOMElement}  childEl   Child Element to look for\n         * @return {Number} The index of the childEl inside parentEl. Returns -1 if it's not a direct child\n         * @sample Ink_Dom_Element_1_parentIndexOf.html \n         */\n        parentIndexOf: function(parentEl, childEl) {\n            var node, idx = 0;\n            for (var i = 0, f = parentEl.childNodes.length; i < f; ++i) {\n                node = parentEl.childNodes[i];\n                if (node.nodeType === 1) {  // ELEMENT\n                    if (node === childEl) { return idx; }\n                    ++idx;\n                }\n            }\n            return -1;\n        },\n\n\n        /**\n         * Gets the next siblings of an element\n         *\n         * @method nextSiblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of next sibling elements\n         * @sample Ink_Dom_Element_1_nextSiblings.html \n         */\n        nextSiblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements = [],\n                    siblings = elm.parentNode.children,\n                    index    = InkElement.parentIndexOf(elm.parentNode, elm);\n\n                for(var i = ++index, len = siblings.length; i<len; i++) {\n                    elements.push(siblings[i]);\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n\n        /**\n         * Gets the previous siblings of an element\n         *\n         * @method previousSiblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of previous sibling elements\n         * @sample Ink_Dom_Element_1_previousSiblings.html \n         */\n        previousSiblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements    = [],\n                    siblings    = elm.parentNode.children,\n                    index       = InkElement.parentIndexOf(elm.parentNode, elm);\n\n                for(var i = 0, len = index; i<len; i++) {\n                    elements.push(siblings[i]);\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n\n        /**\n         * Gets the all siblings of an element\n         *\n         * @method siblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of sibling elements\n         * @sample Ink_Dom_Element_1_siblings.html \n         */\n        siblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements   = [],\n                    siblings   = elm.parentNode.children;\n\n                for(var i = 0, len = siblings.length; i<len; i++) {\n                    if(elm !== siblings[i]) {\n                        elements.push(siblings[i]);\n                    }\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n        /**\n         * Counts the number of children of an element\n         *\n         * @method childElementCount\n         * @param {String|DOMElement} elm element\n         * @return {Number} number of child elements\n         * @sample Ink_Dom_Element_1_childElementCount.html \n         */\n        childElementCount: function(elm) {\n            elm = Ink.i(elm);\n            if ('childElementCount' in elm) {\n                return elm.childElementCount;\n            }\n            if (!elm) { return 0; }\n            return InkElement.siblings(elm).length + 1;\n        },\n\n        _wrapElements: {\n            TABLE: function (div, html) {\n                /* If we don't create a tbody, IE7 does that for us. Adding a tbody with a random string and then filtering for that random string is the only way to avoid double insertion of tbodies. */\n                if (browserCreatesTbodies) {\n                    div.innerHTML = \"<table>\" + html + \"<tbody><tr><td>\" + deleteThisTbodyToken + \"</tr></td></tbody></table>\";\n                } else {\n                    div.innerHTML = \"<table>\" + html + \"</table>\";\n                }\n                return div.firstChild;\n            },\n            TBODY: function (div, html) {\n                div.innerHTML = '<table><tbody>' + html + '</tbody></table>';\n                return div.firstChild.getElementsByTagName('tbody')[0];\n            },\n            THEAD: function (div, html) {\n                div.innerHTML = '<table><thead>' + html + '</thead><tbody></tbody></table>';\n                return div.firstChild.getElementsByTagName('thead')[0];\n            },\n            TFOOT: function (div, html) {\n                div.innerHTML = '<table><tfoot>' + html + '</tfoot><tbody></tbody></table>';\n                return div.firstChild.getElementsByTagName('tfoot')[0];\n            },\n            TR: function (div, html) {\n                div.innerHTML = '<table><tbody><tr>' + html + '</tr></tbody></table>';\n                return div.firstChild.firstChild.firstChild;\n            }\n        },\n\n        /**\n         * Gets a wrapper DIV with a certain HTML content to be inserted inside another element.\n         * This is necessary for appendHTML,prependHTML functions, because they need a container element to copy the children from.\n         *\n         * Works around IE table quirks\n         * @method _getWrapper\n         * @private\n         * @param elm\n         * @param html\n         */\n        _getWrapper: function (elm, html) {\n            var nodeName = elm.nodeName && elm.nodeName.toUpperCase();\n            var wrapper = document.createElement('div');\n            var wrapFunc = InkElement._wrapElements[nodeName];\n\n            if ( !wrapFunc ) {\n                wrapper.innerHTML = html;\n                return wrapper;\n            }\n            // special cases\n            wrapper = wrapFunc(wrapper, html);\n            // worst case: tbody auto-creation even when our HTML has a tbody.\n            if (browserCreatesTbodies && nodeName === 'TABLE') {\n                // terrible case. Deal with tbody creation too.\n                var tds = wrapper.getElementsByTagName('td');\n                for (var i = 0, len = tds.length; i < len; i++) {\n                    if (tds[i].innerHTML === deleteThisTbodyToken) {\n                        var tbody = tds[i].parentNode.parentNode;\n                        tbody.parentNode.removeChild(tbody);\n                    }\n                }\n            }\n            return wrapper;\n        },\n\n        /**\n         * Appends HTML to an element.\n         * This method parses the html string and doesn't modify its contents\n         *\n         * @method appendHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_appendHTML.html \n         */\n        appendHTML: function(elm, html){\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                var wrapper = InkElement._getWrapper(elm, html);\n                while (wrapper.firstChild) {\n                    elm.appendChild(wrapper.firstChild);\n                }\n            }\n        },\n\n        /**\n         * Prepends HTML to an element.\n         * This method parses the html string and doesn't modify its contents\n         *\n         * @method prependHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_prependHTML.html \n         */\n        prependHTML: function(elm, html){\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                var wrapper = InkElement._getWrapper(elm, html);\n                while (wrapper.lastChild) {\n                    elm.insertBefore(wrapper.lastChild, elm.firstChild);\n                }\n            }\n        },\n\n        /**\n         * Sets the inner HTML of an element.\n         *\n         * @method setHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_setHTML.html \n         */\n        setHTML: function (elm, html) {\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                try {\n                    elm.innerHTML = html;\n                } catch (e) {\n                    // Tables in IE7\n                    while (elm.firstChild) {\n                        elm.removeChild(elm.firstChild);\n                    }\n                    InkElement.appendHTML(elm, html);\n                }\n            }\n        },\n\n        /**\n         * Wraps an element inside a container.\n         *\n         * The container may or may not be in the document yet.\n         *\n         * @method wrap\n         * @param {String|DOMElement}   target      Element to be wrapped\n         * @param {String|DOMElement}   container   Element to wrap the target\n         * @return Container element\n         * @sample Ink_Dom_Element_1_wrap.html \n         *\n         * @example\n         * before:\n         *\n         *     <div id=\"target\"></div>\n         *\n         * call this function to wrap #target with a wrapper div.\n         *\n         *     InkElement.wrap('target', InkElement.create('div', {id: 'container'});\n         * \n         * after: \n         *\n         *     <div id=\"container\"><div id=\"target\"></div></div>\n         */\n        wrap: function (target, container) {\n            target = Ink.i(target);\n            container = Ink.i(container);\n            \n            var nextNode = target.nextSibling;\n            var parent = target.parentNode;\n\n            container.appendChild(target);\n\n            if (nextNode !== null) {\n                parent.insertBefore(container, nextNode);\n            } else {\n                parent.appendChild(container);\n            }\n\n            return container;\n        },\n\n        /**\n         * Places an element outside a wrapper.\n         *\n         * @method unwrap\n         * @param {DOMElement}  elem                The element you're trying to unwrap. This should be an ancestor of the wrapper.\n         * @param {String}      [wrapperSelector]   CSS Selector for the ancestor. Use this if your wrapper is not the direct parent of elem.\n         * @sample Ink_Dom_Element_1_unwrap.html \n         *\n         * @example\n         *\n         * When you have this:\n         *\n         *      <div id=\"wrapper\">\n         *          <div id=\"unwrapMe\"></div>\n         *      </div>\n         *\n         * If you do this:\n         *\n         *      InkElement.unwrap('unwrapMe');\n         *\n         * You get this:\n         *\n         *      <div id=\"unwrapMe\"></div>\n         *      <div id=\"wrapper\"></div>\n         *      \n         **/\n        unwrap: function (elem, wrapperSelector) {\n            elem = Ink.i(elem);\n            var wrapper;\n            if (typeof wrapperSelector === 'string') {\n                wrapper = InkElement.findUpwardsBySelector(elem, wrapperSelector);\n            } else if (typeof wrapperSelector === 'object' && wrapperSelector.tagName) {\n                wrapper = InkElement.findUpwardsHaving(elem, function (ancestor) {\n                    return ancestor === wrapperSelector;\n                });\n            } else {\n                wrapper = elem.parentNode;\n            }\n            if (!wrapper || !wrapper.parentNode) { return; }\n\n            InkElement.insertBefore(elem, wrapper);\n        },\n\n        /**\n         * Replaces an element with another.\n         *\n         * @method replace\n         * @param element       The element to be replaced.\n         * @param replacement   The new element.\n         * @sample Ink_Dom_Element_1_replace.html \n         *\n         * @example\n         *       var newelement1 = InkElement.create('div');\n         *       // ...\n         *       replace(Ink.i('element1'), newelement1);\n         */\n        replace: function (element, replacement) {\n            element = Ink.i(element);\n            if(element !== null) {\n                element.parentNode.replaceChild(replacement, element);\n            }\n        },\n\n        /**\n         * Removes direct text children.\n         * Useful to remove nasty layout gaps generated by whitespace on the markup.\n         *\n         * @method removeTextNodeChildren\n         * @param  {DOMElement} el          Element to remove text from\n         * @sample Ink_Dom_Element_1_removeTextNodeChildren.html \n         */\n        removeTextNodeChildren: function(el) {\n            el = Ink.i(el);\n            if(el !== null) {\n                var prevEl, toRemove, parent = el;\n                el = el.firstChild;\n                while (el) {\n                    toRemove = (el.nodeType === 3);\n                    prevEl = el;\n                    el = el.nextSibling;\n                    if (toRemove) {\n                        parent.removeChild(prevEl);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Creates a documentFragment from an HTML string.\n         *\n         * @method htmlToFragment\n         * @param  {String} html  HTML string\n         * @return {DocumentFragment} DocumentFragment containing all of the elements from the html string\n         * @sample Ink_Dom_Element_1_htmlToFragment.html \n         */\n        htmlToFragment: (createContextualFragmentSupport ?\n            function(html){\n                var range;\n\n                if(typeof html !== 'string'){ return document.createDocumentFragment(); }\n\n                range = document.createRange();\n\n                // set the context to document.body (firefox does this already, webkit doesn't)\n                range.selectNode(document.body);\n\n                return range.createContextualFragment(html);\n            } : function (html) {\n                var fragment = document.createDocumentFragment(),\n                    tempElement,\n                    current;\n\n                if(typeof html !== 'string'){ return fragment; }\n\n                tempElement = document.createElement('div');\n                tempElement.innerHTML = html;\n\n                // append child removes elements from the original parent\n                while( (current = tempElement.firstChild) ){ // intentional assignment\n                    fragment.appendChild(current);\n                }\n\n                return fragment;\n            }),\n\n        _camelCase: function(str)\n        {\n            return str ? str.replace(/-(\\w)/g, function (_, $1){\n                return $1.toUpperCase();\n            }) : str;\n        },\n\n        /**\n         * Gets data attributes from an element\n         *\n         * @method data\n         * @param {String|DOMElement} selector Element or CSS selector\n         * @return {Object} Object with the data-* properties. If no data-attributes are present, an empty object is returned.\n         * @sample Ink_Dom_Element_1_data.html \n        */\n        data: function(selector) {\n            var el;\n            if (typeof selector !== 'object' && typeof selector !== 'string') {\n                throw '[Ink.Dom.Element.data] :: Invalid selector defined';\n            }\n\n            if (typeof selector === 'object') {\n                el = selector;\n            }\n            else {\n                var InkDomSelector = Ink.getModule('Ink.Dom.Selector', 1);\n                if (!InkDomSelector) {\n                    throw \"[Ink.Dom.Element.data] :: this method requires Ink.Dom.Selector - v1\";\n                }\n                el = InkDomSelector.select(selector);\n                if (el.length <= 0) {\n                    throw \"[Ink.Dom.Element.data] :: Can't find any element with the specified selector\";\n                }\n                el = el[0];\n            }\n\n            var dataset = {};\n            var attrs = el.attributes || [];\n\n            var curAttr, curAttrName, curAttrValue;\n            if (attrs) {\n                for (var i = 0, total = attrs.length; i < total; ++i) {\n                    curAttr = attrs[i];\n                    curAttrName = curAttr.name;\n                    curAttrValue = curAttr.value;\n                    if (curAttrName && curAttrName.indexOf('data-') === 0) {\n                        dataset[InkElement._camelCase(curAttrName.replace('data-', ''))] = curAttrValue;\n                    }\n                }\n            }\n\n            return dataset;\n        },\n\n        /**\n         * Move the cursor on an input or textarea element.\n         * @method moveCursorTo\n         * @param  {DOMElement} el  Input or Textarea element\n         * @param  {Number}     t   Index of the character to move the cursor to\n         * @sample Ink_Dom_Element_1_moveCursorTo.html \n         */\n        moveCursorTo: function(el, t) {\n            el = Ink.i(el);\n            if(el !== null) {\n                if (el.setSelectionRange) {\n                    el.setSelectionRange(t, t);\n                    //el.focus();\n                }\n                else {\n                    var range = el.createTextRange();\n                    range.collapse(true);\n                    range.moveEnd(  'character', t);\n                    range.moveStart('character', t);\n                    range.select();\n                }\n            }\n        },\n\n        /**\n         * Get the page's width.\n         * @method pageWidth\n         * @return {Number} Page width in pixels\n         * @sample Ink_Dom_Element_1_pageWidth.html \n         */\n        pageWidth: function() {\n            var xScroll;\n\n            if (window.innerWidth && window.scrollMaxX) {\n                xScroll = window.innerWidth + window.scrollMaxX;\n            } else if (document.body.scrollWidth > document.body.offsetWidth){\n                xScroll = document.body.scrollWidth;\n            } else {\n                xScroll = document.body.offsetWidth;\n            }\n\n            var windowWidth;\n\n            if (window.self.innerWidth) {\n                if(document.documentElement.clientWidth){\n                    windowWidth = document.documentElement.clientWidth;\n                } else {\n                    windowWidth = window.self.innerWidth;\n                }\n            } else if (document.documentElement && document.documentElement.clientWidth) {\n                windowWidth = document.documentElement.clientWidth;\n            } else if (document.body) {\n                windowWidth = document.body.clientWidth;\n            }\n\n            if(xScroll < windowWidth){\n                return xScroll;\n            } else {\n                return windowWidth;\n            }\n        },\n\n        /**\n         * Get the page's height.\n         * @method pageHeight\n         * @return {Number} Page height in pixels\n         * @sample Ink_Dom_Element_1_pageHeight.html \n         */\n        pageHeight: function() {\n            var yScroll;\n\n            if (window.innerHeight && window.scrollMaxY) {\n                yScroll = window.innerHeight + window.scrollMaxY;\n            } else if (document.body.scrollHeight > document.body.offsetHeight){\n                yScroll = document.body.scrollHeight;\n            } else {\n                yScroll = document.body.offsetHeight;\n            }\n\n            var windowHeight;\n\n            if (window.self.innerHeight) {\n                windowHeight = window.self.innerHeight;\n            } else if (document.documentElement && document.documentElement.clientHeight) {\n                windowHeight = document.documentElement.clientHeight;\n            } else if (document.body) {\n                windowHeight = document.body.clientHeight;\n            }\n\n            if(yScroll < windowHeight){\n                return windowHeight;\n            } else {\n                return yScroll;\n            }\n        },\n\n       /**\n         * Get the viewport's width.\n         * @method viewportWidth\n         * @return {Number} Viewport width in pixels\n         * @sample Ink_Dom_Element_1_viewportWidth.html \n         */\n        viewportWidth: function() {\n            if(typeof window.innerWidth !== \"undefined\") {\n                return window.innerWidth;\n            }\n            if (document.documentElement && typeof document.documentElement.offsetWidth !== \"undefined\") {\n                return document.documentElement.offsetWidth;\n            }\n        },\n\n        /**\n         * Get the viewport's height.\n         * @method viewportHeight\n         * @return {Number} Viewport height in pixels\n         * @sample Ink_Dom_Element_1_viewportHeight.html \n         */\n        viewportHeight: function() {\n            if (typeof window.innerHeight !== \"undefined\") {\n                return window.innerHeight;\n            }\n            if (document.documentElement && typeof document.documentElement.offsetHeight !== \"undefined\") {\n                return document.documentElement.offsetHeight;\n            }\n        },\n\n        /**\n         * Get the scroll's width.\n         * @method scrollWidth\n         * @return {Number} Scroll width\n         */\n        scrollWidth: function() {\n            if (typeof window.self.pageXOffset !== 'undefined') {\n                return window.self.pageXOffset;\n            }\n            if (typeof document.documentElement !== 'undefined' && typeof document.documentElement.scrollLeft !== 'undefined') {\n                return document.documentElement.scrollLeft;\n            }\n            return document.body.scrollLeft;\n        },\n\n        /**\n         * Get the scroll's height.\n         * @method scrollHeight\n         * @return {Number} Scroll height\n         */\n        scrollHeight: function() {\n            if (typeof window.self.pageYOffset !== 'undefined') {\n                return window.self.pageYOffset;\n            }\n            if (typeof document.documentElement !== 'undefined' && typeof document.documentElement.scrollTop !== 'undefined') {\n                return document.documentElement.scrollTop;\n            }\n            return document.body.scrollTop;\n        }\n    };\n\n    return InkElement;\n\n});\n","/**\n * Event management\n * @module Ink.Dom.Event_1\n * @version 1\n */\n\nInk.createModule('Ink.Dom.Event', 1, [], function() {\n    /* jshint\n           asi:true,\n           strict:false,\n           laxcomma:true,\n           eqeqeq:false,\n           laxbreak:true,\n           boss:true,\n           curly:false,\n           expr:true\n           */\n\n    /**\n     * @namespace Ink.Dom.Event_1\n     * @static\n     */\n\n    /*!\n      * Bean - copyright (c) Jacob Thornton 2011-2012\n      * https://github.com/fat/bean\n      * MIT license\n      */\n    var bean = (function (name, context, definition) {\n      return definition()\n    })('bean', this, function (name, context) {\n      name    = name    || 'bean'\n      context = context || this\n\n      var win            = window\n        , old            = context[name]\n        , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\n        , nameRegex      = /\\..*/\n        , addEvent       = 'addEventListener'\n        , removeEvent    = 'removeEventListener'\n        , doc            = document || {}\n        , root           = doc.documentElement || {}\n        , W3C_MODEL      = root[addEvent]\n        , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\n        , ONE            = {} // singleton for quick matching making add() do one()\n\n        , slice          = Array.prototype.slice\n        , str2arr        = function (s, d) { return s.split(d || ' ') }\n        , isString       = function (o) { return typeof o == 'string' }\n        , isFunction     = function (o) { return typeof o == 'function' }\n\n          // events that we consider to be 'native', anything not in this list will\n          // be treated as a custom event\n        , standardNativeEvents =\n            'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\n            'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\n            'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\n            'keydown keypress keyup '                                        + // keyboard\n            'orientationchange '                                             + // mobile\n            'focus blur change reset select submit '                         + // form elements\n            'load unload beforeunload resize move DOMContentLoaded '         + // window\n            'readystatechange message '                                      + // window\n            'error abort scroll '                                              // misc\n          // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\n          // that doesn't actually exist, so make sure we only do these on newer browsers\n        , w3cNativeEvents =\n            'show '                                                          + // mouse buttons\n            'input invalid '                                                 + // form elements\n            'touchstart touchmove touchend touchcancel '                     + // touch\n            'gesturestart gesturechange gestureend '                         + // gesture\n            'textinput'                                                      + // TextEvent\n            'readystatechange pageshow pagehide popstate '                   + // window\n            'hashchange offline online '                                     + // window\n            'afterprint beforeprint '                                        + // printing\n            'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\n            'loadstart progress suspend emptied stalled loadmetadata '       + // media\n            'loadeddata canplay canplaythrough playing waiting seeking '     + // media\n            'seeked ended durationchange timeupdate play pause ratechange '  + // media\n            'volumechange cuechange '                                        + // media\n            'checking noupdate downloading cached updateready obsolete '       // appcache\n\n          // convert to a hash for quick lookups\n        , nativeEvents = (function (hash, events, i) {\n            for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\n            return hash\n          }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\n\n          // custom events are events that we *fake*, they are not provided natively but\n          // we can use native events to generate them\n        , customEvents = (function () {\n            var isAncestor = 'compareDocumentPosition' in root\n                  ? function (element, container) {\n                      return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\n                    }\n                  : 'contains' in root\n                    ? function (element, container) {\n                        container = container.nodeType === 9 || container === window ? root : container\n                        return container !== element && container.contains(element)\n                      }\n                    : function (element, container) {\n                        while (element = element.parentNode) if (element === container) return 1\n                        return 0\n                      }\n              , check = function (event) {\n                  var related = event.relatedTarget\n                  return !related\n                    ? related == null\n                    : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\n                        && !isAncestor(related, this))\n                }\n\n            return {\n                mouseenter: { base: 'mouseover', condition: check }\n              , mouseleave: { base: 'mouseout', condition: check }\n              , mousewheel: { base: /Firefox/.test(navigator.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\n            }\n          }())\n\n          // we provide a consistent Event object across browsers by taking the actual DOM\n          // event object and generating a new one from its properties.\n        , Event = (function () {\n                // a whitelist of properties (for different event types) tells us what to check for and copy\n            var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\n                  'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\n                  'srcElement target timeStamp type view which propertyName')\n              , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\n                  'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\n              , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\n                  'axis')) // 'axis' is FF specific\n              , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\n                  'keyLocation location'))\n              , textProps    = commonProps.concat(str2arr('data'))\n              , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\n              , messageProps = commonProps.concat(str2arr('data origin source'))\n              , stateProps   = commonProps.concat(str2arr('state'))\n              , overOutRegex = /over|out/\n                // some event types need special handling and some need special properties, do that all here\n              , typeFixers   = [\n                    { // key events\n                        reg: /key/i\n                      , fix: function (event, newEvent) {\n                          newEvent.keyCode = event.keyCode || event.which\n                          return keyProps\n                        }\n                    }\n                  , { // mouse events\n                        reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\n                      , fix: function (event, newEvent, type) {\n                          newEvent.rightClick = event.which === 3 || event.button === 2\n                          newEvent.pos = { x: 0, y: 0 }\n                          if (event.pageX || event.pageY) {\n                            newEvent.clientX = event.pageX\n                            newEvent.clientY = event.pageY\n                          } else if (event.clientX || event.clientY) {\n                            newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\n                            newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\n                          }\n                          if (overOutRegex.test(type)) {\n                            newEvent.relatedTarget = event.relatedTarget\n                              || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\n                          }\n                          return mouseProps\n                        }\n                    }\n                  , { // mouse wheel events\n                        reg: /mouse.*(wheel|scroll)/i\n                      , fix: function () { return mouseWheelProps }\n                    }\n                  , { // TextEvent\n                        reg: /^text/i\n                      , fix: function () { return textProps }\n                    }\n                  , { // touch and gesture events\n                        reg: /^touch|^gesture/i\n                      , fix: function () { return touchProps }\n                    }\n                  , { // message events\n                        reg: /^message$/i\n                      , fix: function () { return messageProps }\n                    }\n                  , { // popstate events\n                        reg: /^popstate$/i\n                      , fix: function () { return stateProps }\n                    }\n                  , { // everything else\n                        reg: /.*/\n                      , fix: function () { return commonProps }\n                    }\n                ]\n              , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\n\n              , Event = function (event, element, isNative) {\n                  if (!arguments.length) return\n                  event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\n                  this.originalEvent = event\n                  this.isNative       = isNative\n                  this.isBean         = true\n\n                  if (!event) return\n\n                  var type   = event.type\n                    , target = event.target || event.srcElement\n                    , i, l, p, props, fixer\n\n                  this.target = target && target.nodeType === 3 ? target.parentNode : target\n\n                  if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\n                    fixer = typeFixerMap[type]\n                    if (!fixer) { // haven't encountered this event type before, map a fixer function for it\n                      for (i = 0, l = typeFixers.length; i < l; i++) {\n                        if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\n                          typeFixerMap[type] = fixer = typeFixers[i].fix\n                          break\n                        }\n                      }\n                    }\n\n                    props = fixer(event, this, type)\n                    for (i = props.length; i--;) {\n                      if (!((p = props[i]) in this) && p in event) this[p] = event[p]\n                    }\n                  }\n                }\n\n            // preventDefault() and stopPropagation() are a consistent interface to those functions\n            // on the DOM, stop() is an alias for both of them together\n            Event.prototype.preventDefault = function () {\n              if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\n              else this.originalEvent.returnValue = false\n            }\n            Event.prototype.stopPropagation = function () {\n              if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\n              else this.originalEvent.cancelBubble = true\n            }\n            Event.prototype.stop = function () {\n              this.preventDefault()\n              this.stopPropagation()\n              this.stopped = true\n            }\n            // stopImmediatePropagation() has to be handled internally because we manage the event list for\n            // each element\n            // note that originalElement may be a Bean#Event object in some situations\n            Event.prototype.stopImmediatePropagation = function () {\n              if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\n              this.isImmediatePropagationStopped = function () { return true }\n            }\n            Event.prototype.isImmediatePropagationStopped = function () {\n              return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\n            }\n            Event.prototype.clone = function (currentTarget) {\n              //TODO: this is ripe for optimisation, new events are *expensive*\n              // improving this will speed up delegated events\n              var ne = new Event(this, this.element, this.isNative)\n              ne.currentTarget = currentTarget\n              return ne\n            }\n\n            return Event\n          }())\n\n          // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\n        , targetElement = function (element, isNative) {\n            return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\n          }\n\n          /**\n            * Bean maintains an internal registry for event listeners. We don't touch elements, objects\n            * or functions to identify them, instead we store everything in the registry.\n            * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\n            */\n        , RegEntry = (function () {\n            // each handler is wrapped so we can handle delegation and custom events\n            var wrappedHandler = function (element, fn, condition, args) {\n           () {\n            if (this._options.pagination) {\n                if (Common.isDOMElement(this._options.pagination) ||\n                        typeof this._options.pagination === 'string') {\n                    // if dom element or css selector string...\n                    this._pagination = new Pagination(this._options.pagination, {\n                        size:     this._numPages,\n                        onChange: this._handlers.paginationChange\n                    });\n                } else {\n                    // assumes instantiated pagination\n                    this._pagination = this._options.pagination;\n                    this._pagination._options.onChange = this._handlers.paginationChange;\n                    this._pagination.setSize(this._numPages);\n                }\n                this._pagination.setCurrent(this._options.initialPage || 0);\n            } else {\n                this._currentPage = this._options.initialPage || 0;\n            }\n        },\n\n        _setUpAutoAdvance: function () {\n            if (!this._options.autoAdvance) { return; }\n            var self = this;\n\n            setTimeout(function autoAdvance() {\n                self.nextPage(true /* wrap */);\n                setTimeout(autoAdvance, self._options.autoAdvance);\n            }, this._options.autoAdvance);\n        },\n\n        _setUpHider: function () {\n            if (this._options.hideLast) {\n                var hiderEl = InkElement.create('div', {\n                    className: 'hider',\n                    insertBottom: this._element\n                });\n                hiderEl.style.position = 'absolute';\n                hiderEl.style[ this._isY ? 'left' : 'top' ] = '0';  // fix to top..\n                hiderEl.style[ this._isY ? 'right' : 'bottom' ] = '0';  // and bottom...\n                hiderEl.style[ this._isY ? 'bottom' : 'right' ] = '0';  // and move to the end.\n                this._hiderEl = hiderEl;\n            }\n        },\n\n        // [3.1.0] Deprecate this already\n        _center: function() {\n            if (!this._options.center) { return; }\n            var gap = Math.floor( (this._ctnLength - (this._elLength * this._slidesPerPage) ) / 2 );\n\n            var pad;\n            if (this._isY) {\n                pad = [gap, 'px 0'];\n            } else {\n                pad = ['0 ', gap, 'px'];\n            }\n\n            this._ulEl.style.padding = pad.join('');\n        },\n\n        // [3.1.0] Deprecate this already\n        _updateHider: function() {\n            if (!this._hiderEl) { return; }\n            if (this.getPage() === 0) {\n                var gap = Math.floor( this._ctnLength - (this._elLength * this._slidesPerPage) );\n                if (this._options.center) {\n                    gap /= 2;\n                }\n                this._hiderEl.style[ this._isY ? 'height' : 'width' ] = gap + 'px';\n            } else {\n                this._hiderEl.style[ this._isY ? 'height' : 'width' ] = '0px';\n            }\n        },\n        \n        /**\n         * Refits elements for IE7 because it doesn't support inline-block.\n         *\n         * @method _IE7\n         * @private\n         */\n        _IE7: function () {\n            if (Browser.IE && '' + Browser.version.split('.')[0] === '7') {\n                // var numPages = this._numPages;\n                var slides = Ink.ss('li.slide', this._ulEl);\n                var stl = function (prop, val) {slides[i].style[prop] = val; };\n                for (var i = 0, len = slides.length; i < len; i++) {\n                    stl('position', 'absolute');\n                    stl(this._isY ? 'top' : 'left', (i * this._elLength) + 'px');\n                }\n            }\n        },\n\n        _onTouchStart: function (event) {\n            if (event.touches.length > 1) { return; }\n\n            this._swipeData = {\n                x: InkEvent.pointerX(event),\n                y: InkEvent.pointerY(event)\n            };\n\n            var ulRect = this._ulEl.getBoundingClientRect();\n\n            this._swipeData.firstUlPos = ulRect[this._isY ? 'top' : 'left'];\n\n            this._swipeData.inUlX =  this._swipeData.x - ulRect.left;\n            this._swipeData.inUlY =  this._swipeData.y - ulRect.top;\n\n            setTransitionProperty(this._ulEl, 'none');\n\n            this._touchMoveIsFirstTouchMove = true;\n        },\n\n        _onTouchMove: function (event) {\n            if (event.touches.length > 1) { return; /* multitouch event, not my problem. */ }\n\n            var pointerX = InkEvent.pointerX(event);\n            var pointerY = InkEvent.pointerY(event);\n\n            var deltaY = Math.abs(pointerY - this._swipeData.y);\n            var deltaX = Math.abs(pointerX - this._swipeData.x);\n\n            if (this._touchMoveIsFirstTouchMove) {\n                this._touchMoveIsFirstTouchMove = undefined;\n                this._scrolling = this._isY ?\n                    deltaX > deltaY :\n                    deltaY > deltaX ;\n\n                if (!this._scrolling) {\n                    this._onAnimationFrame();\n                }\n            }\n\n            if (!this._scrolling && this._swipeData) {\n                InkEvent.stopDefault(event);\n\n                this._swipeData.pointerPos = this._isY ? pointerY : pointerX;\n            }\n        },\n\n        _onAnimationFrame: function () {\n            var swipeData = this._swipeData;\n\n            if (!swipeData || this._scrolling || this._touchMoveIsFirstTouchMove) { return; }\n\n            var elRect = this._element.getBoundingClientRect();\n\n            var newPos;\n\n            if (!this._isY) {\n                newPos = swipeData.pointerPos - swipeData.inUlX - elRect.left;\n            } else {\n                newPos = swipeData.pointerPos - swipeData.inUlY - elRect.top;\n            }\n\n            this._ulEl.style[this._isY ? 'top' : 'left'] = newPos + 'px';\n\n            requestAnimationFrame(Ink.bindMethod(this, '_onAnimationFrame'));\n        },\n\n        _onTouchEnd: function (event) {\n            if (this._swipeData && this._swipeData.pointerPos && !this._scrolling && !this._touchMoveIsFirstTouchMove) {\n                var snapToNext = 0.1;  // swipe 10% of the way to change page\n\n                var relProgress = this._swipeData.firstUlPos -\n                    this._ulEl.getBoundingClientRect()[this._isY ? 'top' : 'left'];\n\n                var curPage = this.getPage();\n\n                // How many pages were advanced? May be fractional.\n                var progressInPages = relProgress / this._elLength / this._slidesPerPage;\n\n                // Have we advanced enough to change page?\n                if (Math.abs(progressInPages) > snapToNext) {\n                    curPage += Math[ relProgress < 0 ? 'floor' : 'ceil' ](progressInPages);\n                }\n\n                // If something used to calculate progressInPages was zero, we get NaN here.\n                if (!isNaN(curPage)) {\n                    this.setPage(curPage);\n                }\n\n                InkEvent.stopDefault(event);\n            }\n\n            setTransitionProperty(this._ulEl, null /* transition: left, top */);\n            this._swipeData = null;\n            this._touchMoveIsFirstTouchMove = undefined;\n            this._scrolling = undefined;\n        },\n\n        _onPaginationChange: function(pgn) {\n            this._setPage(pgn.getCurrent());\n        },\n\n        /**\n         * Gets the current page index\n         * @method getPage\n         * @return The current page number\n         **/\n        getPage: function () {\n            if (this._pagination) {\n                return this._pagination.getCurrent();\n            } else {\n                return this._currentPage || 0;\n            }\n        },\n\n        /**\n         * Sets the current page index\n         * @method setPage\n         * @param {Number}  page    Index of the destination page.\n         * @param {Boolean} [wrap]  Flag to activate circular counting.\n         **/\n        setPage: function (page, wrap) {\n            if (wrap) {\n                // Pages outside the range [0..this._numPages] are wrapped.\n                page = page % this._numPages;\n                if (page < 0) { page = this._numPages - page; }\n            }\n            page = limitRange(page, 0, this._numPages - 1);\n\n            if (this._pagination) {\n                this._pagination.setCurrent(page);  // _setPage is called by pagination because it listens to its Change event.\n            } else {\n                this._setPage(page);\n            }\n        },\n\n        _setPage: function (page) {\n            var _lengthToGo = page * this._deltaLength;\n            var isLastPage = page === (this._numPages - 1);\n\n            if (!this._options.spaceAfterLastSlide && isLastPage && page > 0) { \n                var _itemsInLastPage = this._liEls.length - (page * this._slidesPerPage);\n                if(_itemsInLastPage < this._slidesPerPage) {\n                    _lengthToGo = ((page - 1) * this._deltaLength) + (_itemsInLastPage * this._elLength);\n                }\n            }\n\n            this._ulEl.style[ this._isY ? 'top' : 'left'] =\n                ['-', _lengthToGo, 'px'].join('');\n\n            if (this._options.onChange) {\n                this._options.onChange.call(this, page);\n            }\n\n            this._currentPage = page;\n\n            this._updateHider();\n        },\n\n        /**\n         * Goes to the next page\n         * @method nextPage\n         * @param {Boolean} [wrap] Flag to loop from last page to first page.\n         **/\n        nextPage: function (wrap) {\n            this.setPage(this.getPage() + 1, wrap);\n        },\n\n        /**\n         * Goes to the previous page\n         * @method previousPage\n         * @param {Boolean} [wrap] Flag to loop from first page to last page.\n         **/\n        previousPage: function (wrap) { this.setPage(this.getPage() - 1, wrap); },\n\n        /**\n         * Returns how many slides fit into a page\n         * @method getSlidesPerPage\n         * @return {Number} The number of slides per page\n         * @public\n         */\n        getSlidesPerPage: function() {\n            return this._slidesPerPage;\n        },\n\n        /**\n         * Get the amount of pages in the carousel.\n         * @method getTotalPages\n         * @return {Number} The number of pages\n         * @public\n         */\n        getTotalPages: function() {\n            return this._numPages;\n        },\n\n        /**\n         * Get the stage element (your UL with the class \".stage\").\n         * @method getStageElm\n         * @public\n         * @return {DOMElement} Stage element\n         **/\n        getStageElm: function() {\n            return this._ulEl;\n        },\n\n        /**\n         * Get a list of your slides (elements with the \".slide\" class inside your stage)\n         * @method getSlidesList\n         * @return {DOMElement[]} Array containing the slides.\n         * @public\n         */\n        getSlidesList: function() {\n            return this._liEls;\n        },\n\n        /**\n         * Get the total number of slides\n         * @method getTotalSlides\n         * @return {Number} The number of slides\n         * @public\n         */\n        getTotalSlides: function() {\n            return this.getSlidesList().length;\n        }\n    };\n\n    function setTransitionProperty(el, newTransition) {\n        el.style.transitionProperty =\n        el.style.oTransitionProperty =\n        el.style.msTransitionProperty =\n        el.style.mozTransitionProperty =\n        el.style.webkitTransitionProperty = newTransition;\n    }\n\n    Common.createUIComponent(Carousel);\n\n    return Carousel;\n\n});\n","/**\n * Closing utilities\n * @module Ink.UI.Close_1\n * @version 1\n */\nInk.createModule('Ink.UI.Close', '1', ['Ink.Dom.Event_1','Ink.Dom.Element_1'], function(InkEvent, InkElement) {\n    'use strict';\n\n    /**\n     * Subscribes clicks on the document.body.\n     * Whenever an element with the classes \".ink-close\" or \".ink-dismiss\" is clicked, this module finds an ancestor \".ink-alert\" or \".ink-alert-block\" element and removes it from the DOM.\n     * This module should be created only once per page.\n     * \n     * @class Ink.UI.Close\n     * @constructor\n     * @example\n     *     <script>\n     *         Ink.requireModules(['Ink.UI.Close_1'],function( Close ){\n     *             new Close();\n     *         });\n     *     </script>\n     *\n     * @sample Ink_UI_Close_1.html\n     */\n    var Close = function() {\n        InkEvent.observe(document.body, 'click', function(ev) {\n            var el = InkEvent.element(ev);\n\n            el = InkElement.findUpwardsByClass(el, 'ink-close') ||\n                 InkElement.findUpwardsByClass(el, 'ink-dismiss');\n\n            if (!el) {\n                return;  // ink-close or ink-dismiss class not found\n            }\n\n            var toRemove = InkElement.findUpwardsByClass(el, 'ink-alert') ||\n                           InkElement.findUpwardsByClass(el, 'ink-alert-block') ||\n                           el;\n\n            if (toRemove) {\n                InkEvent.stop(ev);\n                InkElement.remove(toRemove);\n            }\n        });\n    };\n\n    Close._name = 'Close_1';\n\n    return Close;\n});\n","/**\n * Auxiliar utilities for UI Modules\n * @module Ink.UI.Common_1\n * @version 1\n */\n \nInk.createModule('Ink.UI.Common', '1', ['Ink.Dom.Element_1', 'Ink.Net.Ajax_1','Ink.Dom.Css_1','Ink.Dom.Selector_1','Ink.Util.Url_1'], function(InkElement, Ajax,Css,Selector,Url) {\n\n    'use strict';\n\n    var nothing = {} /* a marker, for reference comparison. */;\n\n    var keys = Object.keys || function (obj) {\n        var ret = [];\n        for (var k in obj) if (obj.hasOwnProperty(k)) {\n            ret.push(k);\n        }\n        return ret;\n    };\n\n    var es6WeakMapSupport = 'WeakMap' in window;\n    var instances = es6WeakMapSupport ? new WeakMap() : null;\n\n    var domRegistry = {\n        get: function get(el) {\n            return es6WeakMapSupport ?\n                instances.get(el) :\n                el.__InkInstances;\n        },\n        set: function set(el, thing) {\n            if (es6WeakMapSupport) {\n                instances.set(el, thing);\n            } else {\n                el.__InkInstances = thing;\n            }\n        }\n    };\n\n    /**\n     * @namespace Ink.UI.Common_1\n     */\n\n    var Common = {\n\n        /**\n         * Supported Ink Layouts\n         *\n         * @property Layouts\n         * @type Object\n         * @readOnly\n         */\n        Layouts: {\n            TINY: 'tiny',\n            SMALL:  'small',\n            MEDIUM: 'medium',\n            LARGE:  'large',\n            XLARGE: 'xlarge'\n        },\n\n        /**\n         * Checks if an item is a valid DOM Element.\n         *\n         * @method isDOMElement\n         * @static\n         * @param   {Mixed}     o   The object to be checked.\n         * @return  {Boolean}       True if it's a valid DOM Element.\n         * @example\n         *     var el = Ink.s('#element');\n         *     if( Ink.UI.Common.isDOMElement( el ) === true ){\n         *         // It is a DOM Element.\n         *     } else {\n         *         // It is NOT a DOM Element.\n         *     }\n         */\n        isDOMElement: InkElement.isDOMElement,\n\n        /**\n         * Checks if an item is a valid integer.\n         *\n         * @method isInteger\n         * @static\n         * @param {Mixed} n     The value to be checked.\n         * @return {Boolean}    True if it's a valid integer.\n         * @example\n         *     var value = 1;\n         *     if( Ink.UI.Common.isInteger( value ) === true ){\n         *         // It is an integer.\n         *     } else {\n         *         // It is NOT an integer.\n         *     }\n         */\n        isInteger: function(n) {\n            return (typeof n === 'number' && n % 1 === 0);\n        },\n\n        /**\n         * Gets a DOM Element. \n         *\n         * @method elOrSelector\n         * @static\n         * @param  {DOMElement|String}      elOrSelector    DOM Element or CSS Selector\n         * @param  {String}                 fieldName       The name of the field. Commonly used for debugging.\n         * @return {DOMElement} Returns the DOMElement passed or the first result of the CSS Selector. Otherwise it throws an exception.\n         * @example\n         *     // In case there are several .myInput, it will retrieve the first found\n         *     var el = Ink.UI.Common.elOrSelector('.myInput','My Input');\n         */\n        elOrSelector: function(elOrSelector, fieldName) {\n            if (!this.isDOMElement(elOrSelector)) {\n                var t = Selector.select(elOrSelector);\n                if (t.length === 0) {\n                    Ink.warn(fieldName + ' must either be a DOM Element or a selector expression!\\nThe script element must also be after the DOM Element itself.');\n                    return null;\n                }\n                return t[0];\n            }\n            return elOrSelector;\n        },\n\n        /**\n         * Alias for `elOrSelector` but returns an array of elements.\n         *\n         * @method elsOrSelector\n         *\n         * @static\n         * @param  {DOMElement|String}      elOrSelector    DOM Element or CSS Selector\n         * @param  {String}                 fieldName       The name of the field. Commonly used for debugging.\n         * @return {DOMElement} Returns the DOMElement passed or the first result of the CSS Selector. Otherwise it throws an exception.\n         * @param {Boolean} required Flag to accept an empty array as output.\n         * @return {Array} The selected DOM Elements.\n         * @example\n         *     var elements = Ink.UI.Common.elsOrSelector('input.my-inputs', 'My Input');\n         */\n        elsOrSelector: function(elsOrSelector, fieldName, required) {\n            var ret;\n            if (typeof elsOrSelector === 'string') {\n                ret = Selector.select(elsOrSelector);\n            } else if (Common.isDOMElement(elsOrSelector)) {\n                ret = [elsOrSelector];\n            } else if (elsOrSelector && typeof elsOrSelector === 'object' && typeof elsOrSelector.length === 'number') {\n                ret = elsOrSelector;\n            }\n\n            if (ret && ret.length) {\n                return ret;\n            } else {\n                if (required) {\n                    throw new TypeError(fieldName + ' must either be a DOM Element, an Array of elements, or a selector expression!\\nThe script element must also be after the DOM Element itself.');\n                } else {\n                    return [];\n                }\n            }\n        },\n\n        /**\n         * Gets options an object and element's metadata.\n         *\n         * The element's data attributes take precedence. Values from the element's data-atrributes are coerced into the required type.\n         *\n         * @method options\n         *\n         * @param {Object}      [fieldId]   Name to be used in debugging features.\n         * @param {Object}      defaults    Object with the options' types and defaults.\n         * @param {Object}      overrides   Options to override the defaults. Usually passed when instantiating an UI module.\n         * @param {DOMElement}  [element]   Element with data-attributes\n         *\n         * @example\n         *\n         *      this._options = Ink.UI.Common.options('MyComponent', {\n         *          'anobject': ['Object', null],  // Defaults to null\n         *          'target': ['Element', null],\n         *          'stuff': ['Number', 0.1],\n         *          'stuff2': ['Integer', 0],\n         *          'doKickFlip': ['Boolean', false],\n         *          'targets': ['Elements'], // Required option since no default was given\n         *          'onClick': ['Function', null]\n         *      }, options || {}, elm)\n         *\n         * @example\n         *\n         * ### Note about booleans\n         *\n         * Here is how options are read from the markup\n         * data-attributes, for several values`data-a-boolean`.\n         *\n         * Options considered true:\n         *\n         *   - `data-a-boolean=\"true\"`\n         *   - (Every other value which is not on the list below.)\n         * \n         * Options considered false:\n         *\n         *   - `data-a-boolean=\"false\"`\n         *   - `data-a-boolean=\"\"`\n         *   - `data-a-boolean`\n         *\n         * Options which go to default:\n         *\n         *   - (no attribute). When `data-a-boolean` is ommitted, the\n         *   option is not considered true nor false, and as such\n         *   defaults to what is in the `defaults` argument.\n         *\n         **/\n        options: function (fieldId, defaults, overrides, element) {\n            if (typeof fieldId !== 'string') {\n                element = overrides;\n                overrides = defaults;\n                defaults = fieldId;\n                fieldId = '';\n            }\n            overrides = overrides || {};\n            var out = {};\n            var dataAttrs = element ? InkElement.data(element) : {};\n            var fromDataAttrs;\n            var type;\n            var lType;\n            var defaultVal;\n\n            var invalidStr = function (str) {\n                if (fieldId) { str = fieldId + ': \"' + ('' + str).replace(/\"/, '\\\\\"') + '\"'; }\n                return str;\n            };\n\n            var quote = function (str) {\n                return '\"' + ('' + str).replace(/\"/, '\\\\\"') + '\"';\n            };\n\n            var invalidThrow = function (str) {\n                throw new Error(invalidStr(str));\n            };\n\n            var invalid = function (str) {\n                Ink.error(invalidStr(str) + '. Ignoring option.');\n            };\n\n            function optionValue(key) {\n                type = defaults[key][0];\n                lType = type.toLowerCase();\n                defaultVal = defaults[key].length === 2 ? defaults[key][1] : nothing;\n\n                if (!type) {\n                    invalidThrow('Ink.UI.Common.options: Always specify a type!');\n                }\n                if (!(lType in Common._coerce_funcs)) {\n                    invalidThrow('Ink.UI.Common.options: ' + defaults[key][0] + ' is not a valid type. Use one of ' + keys(Common._coerce_funcs).join(', '));\n\n                }\n                if (!defaults[key].length || defaults[key].length > 2) {\n                    invalidThrow('the \"defaults\" argument must be an object mapping option names to [typestring, optional] arrays.');\n                }\n\n                if (key in dataAttrs) {\n                    fromDataAttrs = Common._coerce_from_string(lType, dataAttrs[key], key, fieldId);\n                    // (above can return `nothing`)\n                } else {\n                    fromDataAttrs = nothing;\n                }\n\n                if (fromDataAttrs !== nothing) {\n                    if (!Common._options_validate(fromDataAttrs, lType)) {\n                        invalid('(' + key + ' option) Invalid ' + lType + ' ' + quote(fromDataAttrs));\n                        return defaultVal;\n                    } else {\n                        return fromDataAttrs;\n                    }\n                } else if (key in overrides) {\n                    return overrides[key];\n                } else if (defaultVal !== nothing) {\n                    return defaultVal;\n                } else {\n                    invalidThrow('Option ' + key + ' is required!');\n                }\n            }\n\n            for (var key in defaults) {\n                if (defaults.hasOwnProperty(key)) {\n                    out[key] = optionValue(key);\n                }\n            }\n\n            return out;\n        },\n\n        _coerce_from_string: function (type, val, paramName, fieldId) {\n            if (type in Common._coerce_funcs) {\n                return Common._coerce_funcs[type](val, paramName, fieldId);\n            } else {\n                return val;\n            }\n        },\n\n        _options_validate: function (val, type) {\n            if (type in Common._options_validate_types) {\n                return Common._options_validate_types[type].call(Common, val);\n            } else {\n                // 'object' options cannot be passed through data-attributes.\n                // Json you say? Not any good to embed in HTML.\n                return false;\n            }\n        },\n\n        _coerce_funcs: (function () {\n            var ret = {\n                element: function (val) {\n                    return Common.elOrSelector(val, '');\n                },\n                elements: function (val) {\n                    return Common.elsOrSelector(val, '', false /*not required, so don't throw an exception now*/);\n                },\n                object: function (val) { return val; },\n                number: function (val) { return parseFloat(val); },\n                'boolean': function (val) {\n                    return !(val === 'false' || val === '' || val === null);\n                },\n                string: function (val) { return val; },\n                'function': function (val, paramName, fieldId) {\n                    Ink.error(fieldId + ': You cannot specify the option \"' + paramName + '\" through data-attributes because it\\'s a function');\n                    return nothing;\n                }\n            };\n            ret['float'] = ret.integer = ret.number;\n            return ret;\n        }()),\n\n        _options_validate_types: (function () {\n            var types = {\n                string: function (val) {\n                    return typeof val === 'string';\n                },\n                number: function (val) {\n                    return typeof val === 'number' && !isNaN(val) && isFinite(val);\n                },\n                integer: function (val) {\n                    return val === Math.round(val);\n                },\n                element: function (val) {\n                    return Common.isDOMElement(val);\n                },\n                elements: function (val) {\n                    return val && typeof val === 'object' && typeof val.length === 'number' && val.length;\n                },\n                'boolean': function (val) {\n                    return typeof val === 'boolean';\n                },\n                object: function () { return true; }\n            };\n            types['float'] = types.number;\n            return types;\n        }()),\n\n        /**\n         * Deep copy (clone) an object.\n         * Note: The object cannot have referece loops.\n         *\n         * @method clone\n         * @static\n         * @param  {Object} o The object to be cloned/copied.\n         * @return {Object} Returns the result of the clone/copy.\n         * @example\n         *     var originalObj = {\n         *         key1: 'value1',\n         *         key2: 'value2',\n         *         key3: 'value3'\n         *     };\n         *     var cloneObj = Ink.UI.Common.clone( originalObj );\n         */\n        clone: function(o) {\n            try {\n                return JSON.parse( JSON.stringify(o) );\n            } catch (ex) {\n                throw new Error('Given object cannot have loops!');\n            }\n        },\n\n\n        /**\n         * Gets an element's one-base index relative to its parent.\n         *\n         * @method childIndex\n         * @static\n         * @param  {DOMElement}     childEl     Valid DOM Element.\n         * @return {Number}                     Numerical position of an element relatively to its parent.\n         * @example\n         *     <!-- Imagine the following HTML: -->\n         *     <ul>\n         *       <li>One</li>\n         *       <li>Two</li>\n         *       <li id=\"test\">Three</li>\n         *       <li>Four</li>\n         *     </ul>\n         *\n         *     <script>\n         *         var testLi = Ink.s('#test');\n         *         Ink.UI.Common.childIndex( testLi ); // Returned value: 3\n         *     </script>\n         */\n        childIndex: function(childEl) {\n            if( Common.isDOMElement(childEl) ){\n                var els = Selector.select('> *', childEl.parentNode);\n                for (var i = 0, f = els.length; i < f; ++i) {\n                    if (els[i] === childEl) {\n                        return i;\n                    }\n                }\n            }\n            throw 'not found!';\n        },\n\n\n        /**\n         * AJAX JSON request shortcut method\n         * It provides a more convenient way to do an AJAX request and expect a JSON response.It also offers a callback option, as third parameter, for better async handling.\n         *\n         * @method ajaxJSON\n         * @static\n         * @async\n         * @param   {String}    endpoint    Valid URL to be used as target by the request.\n         * @param   {Object}    params      This field is used in the thrown Exception to identify the parameter.\n         * @param   {Function}  cb          Callback for the request.\n         * @example\n         *     // In case there are several .myInput, it will retrieve the first found\n         *     var el = Ink.UI.Common.elOrSelector('.myInput','My Input');\n         */\n        ajaxJSON: function(endpoint, params, cb) {\n            new Ajax(\n                endpoint,\n                {\n                    evalJS:         'force',\n                    method:         'POST',\n                    parameters:     params,\n\n                    onSuccess:  function( r) {\n                        try {\n                            r = r.responseJSON;\n                            if (r.status !== 'ok') {\n                                throw 'server error: ' + r.message;\n                            }\n                            cb(null, r);\n                        } catch (ex) {\n                            cb(ex);\n                        }\n                    },\n\n                    onFailure: function() {\n                        cb('communication failure');\n                    }\n                }\n            );\n        },\n\n\n        /**\n         * Gets the current Ink layout.\n         *\n         * @method currentLayout\n         * @static\n         * @return {String}         A string representation of the current layout name.\n         * @example\n         *      var inkLayout = Ink.UI.Common.currentLayout();\n         *      if (inkLayout === 'small') {\n         *          // ...\n         *      }\n         */\n        currentLayout: function() {\n            var i, f, k, v, el, detectorEl = Selector.select('#ink-layout-detector')[0];\n            if (!detectorEl) {\n                detectorEl = document.createElement('div');\n                detectorEl.id = 'ink-layout-detector';\n                for (k in this.Layouts) {\n                    if (this.Layouts.hasOwnProperty(k)) {\n                        v = this.Layouts[k];\n                        el = document.createElement('div');\n                        el.className = 'show-' + v + ' hide-all';\n                        el.setAttribute('data-ink-layout', v);\n                        detectorEl.appendChild(el);\n                    }\n                }\n                document.body.appendChild(detectorEl);\n            }\n\n            for (i = 0, f = detectorEl.children.length; i < f; ++i) {\n                el = detectorEl.children[i];\n                if (Css.getStyle(el, 'display') === 'block') {\n                    return el.getAttribute('data-ink-layout');\n                }\n            }\n\n            return 'large';\n        },\n\n\n        /**\n         * Sets the location's hash (window.location.hash).\n         *\n         * @method hashSet\n         * @static\n         * @param  {Object} o   Object with the info to be placed in the location's hash.\n         * @example\n         *     // It will set the location's hash like: <url>#key1=value1&key2=value2&key3=value3\n         *     Ink.UI.Common.hashSet({\n         *         key1: 'value1',\n         *         key2: 'value2',\n         *         key3: 'value3'\n         *     });\n         */\n        hashSet: function(o) {\n            if (typeof o !== 'object') { throw new TypeError('o should be an object!'); }\n            var hashParams = Url.getAnchorString();\n            hashParams = Ink.extendObj(hashParams, o);\n            window.location.hash = Url.genQueryString('', hashParams).substring(1);\n        },\n\n        /**\n         * Removes children nodes from a given object.\n         * This method was initially created to help solve a problem in Internet Explorer(s) that occurred when trying to set the innerHTML of some specific elements like 'table'.\n         *\n         * @method cleanChildren\n         * @static\n         * @param  {DOMElement} parentEl Valid DOM Element\n         * @example\n         *     <!-- Imagine the following HTML: -->\n         *     <ul id=\"myUl\">\n         *       <li>One</li>\n         *       <li>Two</li>\n         *       <li>Three</li>\n         *       <li>Four</li>\n         *     </ul>\n         *\n         *     <script>\n         *     Ink.UI.Common.cleanChildren( Ink.s( '#myUl' ) );\n         *     </script>\n         *\n         *     <!-- After running it, the HTML changes to: -->\n         *     <ul id=\"myUl\"></ul>\n         */\n        cleanChildren: function(parentEl) {\n            if( !Common.isDOMElement(parentEl) ){\n                throw 'Please provide a valid DOMElement';\n            }\n            var prevEl, el = parentEl.lastChild;\n            while (el) {\n                prevEl = el.previousSibling;\n                parentEl.removeChild(el);\n                el = prevEl;\n            }\n        },\n\n        /**\n         * Stores the id and/or classes of an element in an object.\n         *\n         * @method storeIdAndClasses\n         * @static\n         * @param  {DOMElement} fromEl    Valid DOM Element to get the id and classes from.\n         * @param  {Object}     inObj     Object where the id and classes will be saved.\n         * @example\n         *     <div id=\"myDiv\" class=\"aClass\"></div>\n         *\n         *     <script>\n         *         var storageObj = {};\n         *         Ink.UI.Common.storeIdAndClasses( Ink.s('#myDiv'), storageObj );\n         *         // storageObj changes to:\n         *         {\n         *           _id: 'myDiv',\n         *           _classes: 'aClass'\n         *         }\n         *     </script>\n         */\n        storeIdAndClasses: function(fromEl, inObj) {\n            if( !Common.isDOMElement(fromEl) ){\n                throw 'Please provide a valid DOMElement as first parameter';\n            }\n\n            var id = fromEl.id;\n            if (id) {\n                inObj._id = id;\n            }\n\n            var classes = fromEl.className;\n            if (classes) {\n                inObj._classes = classes;\n            }\n        },\n\n        /**\n         * Sets the id and className properties of an element based \n         *\n         * @method restoreIdAndClasses\n         * @static\n         * @param  {DOMElement} toEl    Valid DOM Element to set the id and classes on.\n         * @param  {Object}     inObj   Object where the id and classes to be set are. This method uses the same format as the one given in `storeIdAndClasses`\n         * @example\n         *     <div></div>\n         *\n         *     <script>\n         *         var storageObj = {\n         *           _id: 'myDiv',\n         *           _classes: 'aClass'\n         *         };\n         *\n         *         Ink.UI.Common.storeIdAndClasses( Ink.s('div'), storageObj );\n         *     </script>\n         *\n         *     <!-- After the code runs the div element changes to: -->\n         *     <div id=\"myDiv\" class=\"aClass\"></div>\n         */\n        restoreIdAndClasses: function(toEl, inObj) {\n\n            if( !Common.isDOMElement(toEl) ){\n                throw 'Please provide a valid DOMElement as first parameter';\n            }\n\n            if (inObj._id && toEl.id !== inObj._id) {\n                toEl.id = inObj._id;\n            }\n\n            if (inObj._classes && toEl.className.indexOf(inObj._classes) === -1) {\n                if (toEl.className) { toEl.className += ' ' + inObj._classes; }\n                else {                toEl.className  =       inObj._classes; }\n            }\n\n            if (inObj._instanceId && !toEl.getAttribute('data-instance')) {\n                toEl.setAttribute('data-instance', inObj._instanceId);\n            }\n        },\n\n        _warnDoubleInstantiation: function (elm, newInstance) {\n            var instances = Common.getInstance(elm);\n\n            if (getName(newInstance) === '') { return; }\n            if (!instances) { return; }\n\n            var nameWithoutVersion = getName(newInstance);\n\n            if (!nameWithoutVersion) { return; }\n\n            for (var i = 0, len = instances.length; i < len; i++) {\n                if (nameWithoutVersion === getName(instances[i])) {\n                    // Yes, I am using + to concatenate and , to split\n                    // arguments.\n                    //\n                    // Elements can't be concatenated with strings, but if\n                    // they are passed in an argument, modern debuggers will\n                    // pretty-print them and make it easy to find them in the\n                    // element inspector.\n                    //\n                    // On the other hand, if strings are passed as different\n                    // arguments, they get pretty printed. And the pretty\n                    // print of a string has quotes around it.\n                    //\n                    // If some day people find out that strings are not\n                    // just text and they start preserving contextual\n                    // information, then by all means change this to a\n                    // regular concatenation.\n                    //\n                    // But they won't. So don't change this.\n                    Ink.warn('Creating more than one ' + nameWithoutVersion + '.',\n                            '(Was creating a ' + nameWithoutVersion + ' on:', elm, ').');\n                    return false;\n                }\n            }\n\n            function getName(thing) {\n                return ((thing.constructor && (thing.constructor._name)) ||\n                    thing._name ||\n                    '').replace(/_.*?$/, '');\n            }\n\n            return true;\n        },\n\n        /**\n         * Saves a component's instance reference for later retrieval.\n         *\n         * @method registerInstance\n         * @static\n         * @param  {Object}     inst                Object that holds the instance.\n         * @param  {DOMElement} el                  DOM Element to associate with the object.\n         */\n        registerInstance: function(inst, el) {\n            if (!inst) { return; }\n\n            if (!Common.isDOMElement(el)) { throw new TypeError('Ink.UI.Common.registerInstance: The element passed in is not a DOM element!'); }\n\n            // [todo] this belongs in the BaseUIComponent's initialization\n            if (Common._warnDoubleInstantiation(el, inst) === false) {\n                return false;\n            }\n\n            var instances = domRegistry.get(el);\n\n            if (!instances) {\n                instances = [];\n                domRegistry.set(el, instances);\n            }\n\n            instances.push(inst);\n\n            return true;\n        },\n\n        /**\n         * Deletes an instance with a given id.\n         *\n         * @method unregisterInstance\n         * @static\n         * @param  {String}     id       Id of the instance to be destroyed.\n         */\n        unregisterInstance: function(inst) {\n            if (!inst || !inst._element) { return; }\n            var instances = domRegistry.get(inst._element);\n            for (var i = 0, len = instances.length; i < len; i++) {\n                if (instances[i] === inst) {\n                    instances.splice(i, 1);\n                }\n            }\n        },\n\n        /**\n         * Gets an UI instance from an element or instance id.\n         *\n         * @method getInstance\n         * @static\n         * @param  {String|DOMElement}      el      DOM Element from which we want the instances.\n         * @return  {Object|Array}                  Returns an instance or a collection of instances.\n         */\n        getInstance: function(el, UIComponent) {\n            el = Common.elOrSelector(el);\n            var instances = domRegistry.get(el);\n\n            if (!instances) {\n                instances = [];\n            }\n\n            if (typeof UIComponent !== 'function') {\n                return instances;\n            }\n\n            for (var i = 0, len = instances.length; i < len; i++) {\n                if (instances[i] instanceof UIComponent) {\n                    return instances[i];\n                }\n            }\n\n            return null;\n        },\n\n        /**\n         * Gets an instance based on a selector.\n         *\n         * @method getInstanceFromSelector\n         * @static\n         * @param  {String}             selector    CSS selector to get the instances from.\n         * @return  {Object|Array}               Returns an instance or a collection of instances.\n         */\n        getInstanceFromSelector: function(selector) {\n            return Common.getInstance(Common.elOrSelector(selector));\n        },\n\n        /**\n         * Gets all the instance ids\n         *\n         * @method getInstanceIds\n         * @static\n         * @return  {Array}     Collection of instance ids\n         */\n        getInstanceIds: function() {\n            var res = [];\n            for (var id in instances) {\n                if (instances.hasOwnProperty(id)) {\n                    res.push( id );\n                }\n            }\n            return res;\n        },\n\n        /**\n         * Gets all the instances\n         *\n         * @method getInstances\n         * @static\n         * @return  {Array}     Collection of existing instances.\n         */\n        getInstances: function() {\n            var res = [];\n            for (var id in instances) {\n                if (instances.hasOwnProperty(id)) {\n                    res.push( instances[id] );\n                }\n            }\n            return res;\n        },\n\n        /**\n         * Boilerplate method to destroy a component.\n         * Components should copy this method as its destroy method and modify it.\n         *\n         * @method destroyComponent\n         * @static\n         */\n        destroyComponent: function() {\n            Common.unregisterInstance(this);\n            this._element.parentNode.removeChild(this._element);\n        }\n\n    };\n\n\n\n\n    /**\n     * Ink UI Base Class\n     **/\n\n    function warnStub() {\n        /* jshint validthis: true */\n        if (!this || this === window || typeof this.constructor !== 'function') { return; }\n        Ink.warn('You called a method on an incorrectly instantiated ' + this.constructor._name + ' component. Check the warnings above to see what went wrong.');\n    }\n\n    function stub(prototype, obj) {\n        for (var k in prototype) if (prototype.hasOwnProperty(k)) {\n            if (k === 'constructor') { continue; }\n            if (typeof obj[k] === 'function') {\n                obj[k] = warnStub;\n            }\n        }\n    }\n\n    /**\n     * Ink UI Base Class\n     *\n     * You don't use this class directly, or inherit from it directly.\n     *\n     * See createUIComponent() (in this module) for how to create a UI component and inherit from this. It's not plain old JS inheritance, for several reasons.\n     *\n     * @class Ink.UI.Common.BaseUIComponent\n     * @constructor\n     *\n     * @param element\n     * @param options\n     **/\n    function BaseUIComponent(element, options) {\n        var constructor = this.constructor;\n        var _name = constructor._name;\n\n        if (!this || this === window) {\n            throw new Error('Use \"new InkComponent()\" instead of \"InkComponent()\"');\n        }\n\n        if (this && !(this instanceof BaseUIComponent)) {\n            throw new Error('You forgot to call Ink.UI.Common.createUIComponent() on this module!');\n        }\n\n        if (!element && !constructor._componentOptions.elementIsOptional) {\n            Ink.error(new Error(_name + ': You need to pass an element or a selector as the first argument to \"new ' + _name + '()\"'));\n            return;\n        } else {\n            this._element = Common.elsOrSelector(element,\n                _name + ': An element with the selector \"' + element + '\" was not found!')[0];\n        }\n\n        if (!this._element && !constructor._componentOptions.elementIsOptional) {\n            isValidInstance = false;\n            Ink.error(new Error(element + ' does not match an element on the page. You need to pass a valid selector to \"new ' + _name + '\".'));\n        }\n\n        // TODO Change Common.options's signature? the below looks better, more manageable\n        // var options = Common.options({\n        //     element: this._element,\n        //     modName: constructor._name,\n        //     options: constructor._optionDefinition,\n        //     defaults: constructor._globalDefaults\n        // });\n\n        this._options = Common.options(_name, constructor._optionDefinition, options, this._element);\n\n        var isValidInstance = BaseUIComponent._validateInstance(this) === true;\n\n        if (isValidInstance && typeof this._init === 'function') {\n            try {\n                this._init.apply(this, arguments);\n            } catch(e) {\n                isValidInstance = false;\n                Ink.error(e);\n            }\n        }\n\n        if (!isValidInstance) {\n            BaseUIComponent._stubInstance(this, constructor, _name);\n        } else if (this._element) {\n            Common.registerInstance(this, this._element);\n        }\n    }\n\n    /**\n     * Calls the `instance`'s _validate() method so it can validate itself.\n     *\n     * Returns false if the method exists, was called, but no Error was returned or thrown.\n     *\n     * @method _validateInstance\n     * @private\n     */\n    BaseUIComponent._validateInstance = function (instance) {\n        var err;\n\n        if (typeof instance._validate !== 'function') { return true; }\n\n        try {\n            err = instance._validate();\n        } catch (e) {\n            err = e;\n        }\n\n        if (err instanceof Error) {\n            instance._validationError = err;\n            return false;\n        }\n\n        return true;\n    };\n\n\n    /**\n     * Replaces every method in the instance with stub functions which just call Ink.warn().\n     *\n     * This avoids breaking the page when there are errors.\n     *\n     * @method _stubInstance\n     * @param instance\n     * @param constructor\n     * @param name\n     * @private\n     */\n    BaseUIComponent._stubInstance = function (instance, constructor, name) {\n        stub(constructor.prototype, instance);\n        stub(BaseUIComponent.prototype, instance);\n        Ink.warn(name + ' was not correctly created. ' + (instance._validationError || ''));\n    };\n\n    // TODO BaseUIComponent.setGlobalOptions = function () {}\n    // TODO BaseUIComponent.createMany = function (selector) {}\n    BaseUIComponent.getInstance = function (elOrSelector) {\n        elOrSelector = Common.elOrSelector(elOrSelector);\n        return Common.getInstance(elOrSelector, this /* get instance by constructor */);\n    };\n\n    Ink.extendObj(BaseUIComponent.prototype, {\n        /**\n         * Get an UI component's option's value.\n         *\n         * @method getOption\n         * @param name\n         *\n         * @return The option value, or undefined if nothing is found.\n         *\n         * @example\n         *\n         * var myUIComponent = new Modal('#element', { trigger: '#trigger' }); // or anything else inheriting BaseUIComponent\n         * myUIComponent.getOption('trigger');  // -> The trigger element (not the selector string, mind you)\n         *\n         **/\n        getOption: function (name) {\n            if (this.constructor && !(name in this.constructor._optionDefinition)) {\n                Ink.error('\"' + name + '\" is not an option for ' + this.constructor._name);\n                return undefined;\n            }\n\n            return this._options[name];\n        },\n\n        /**\n         * Sets an option's value\n         *\n         * @method getOption\n         * @param name\n         * @param value\n         *\n         * @example\n         *\n         * var myUIComponent = new Modal(...);\n         * myUIComponent.setOption('trigger', '#some-element');\n         **/\n        setOption: function (name, value) {\n            if (this.constructor && !(name in this.constructor._optionDefinition)) {\n                Ink.error('\"' + name + ' is not an option for ' + this.constructor._name);\n                return;\n            }\n\n            this._options[name] = value;\n        },\n\n        /**\n         * Get the element associated with an UI component (IE the one you used in the constructor)\n         *\n         * @method getElement\n         * @return {Element} The component's element.\n         *\n         * @example\n         * var myUIComponent = new Modal('#element'); // or anything else inheriting BaseUIComponent\n         * myUIComponent.getElement();  // -> The '#element' (not the selector string, mind you).\n         *\n         **/\n        getElement: function () {\n            return this._element;\n        }\n    });\n\n    Common.BaseUIComponent = BaseUIComponent;\n\n    /**\n     * @method createUIComponent\n     * @param theConstructor UI component constructor. It should have an _init function in its prototype, an _optionDefinition object, and a _name property indicating its name.\n     * @param options\n     * @param [options.elementIsOptional=false] Whether the element argument is optional (For example, when the component might work on existing markup or create its own).\n     **/\n    Common.createUIComponent = function createUIComponent(theConstructor, options) {\n        theConstructor._componentOptions = options || {};\n\n        function assert(test, msg) {\n            if (!test) {\n                throw new Error('Ink.UI_1.createUIComponent: ' + msg);\n            }\n        }\n\n        function assertProp(prop, propType, message) {\n            var propVal = theConstructor[prop];\n            // Check that the property was passed\n            assert(typeof propVal !== 'undefined',\n                theConstructor + ' doesn\\'t have a \"' + prop + '\" property. ' + message);\n            // Check that its type is correct\n            assert(propType && typeof propVal === propType,\n                'typeof ' + theConstructor + '.' + prop + ' is not \"' + propType + '\". ' + message);\n        }\n\n        assert(typeof theConstructor === 'function',\n            'constructor argument is not a function!');\n\n        assertProp('_name', 'string', 'This property is used for error ' +\n            'messages. Set it to the full module path and version (Ink.My.Module_1).');\n        assertProp('_optionDefinition', 'object', 'This property contains the ' +\n            'option names, types and defaults. See Ink.UI.Common.options() for reference.');\n\n        // Extend the instance methods and props\n        var _oldProto = theConstructor.prototype;\n\n        if (typeof Object.create === 'function') {\n            theConstructor.prototype = Object.create(BaseUIComponent.prototype);\n        } else {\n            theConstructor.prototype = (function hideF() {\n                function F() {}\n                F.prototype = BaseUIComponent.prototype;\n                return new F();\n            }());\n        }\n\n        Ink.extendObj(theConstructor.prototype, _oldProto);\n        theConstructor.prototype.constructor = theConstructor;\n        // Extend static methods\n        Ink.extendObj(theConstructor, BaseUIComponent);\n    };\n\n    return Common;\n\n});\n","/**\n * Date selector\n * @module Ink.UI.DatePicker_1\n * @version 1\n */\n\nInk.createModule('Ink.UI.DatePicker', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1','Ink.Util.Array_1','Ink.Util.Date_1', 'Ink.Dom.Browser_1'], function(Common, Event, Css, InkElement, Selector, InkArray, InkDate ) {\n    'use strict';\n\n    // Clamp a number into a min/max limit\n    function clamp(n, min, max) {\n        if (n > max) { n = max; }\n        if (n < min) { n = min; }\n\n        return n;\n    }\n\n    function dateishFromYMDString(YMD) {\n        var split = YMD.split('-');\n        return dateishFromYMD(+split[0], +split[1] - 1, +split[2]);\n    }\n\n    function dateishFromYMD(year, month, day) {\n        return {_year: year, _month: month, _day: day};\n    }\n\n    function dateishFromDate(date) {\n        return {_year: date.getFullYear(), _month: date.getMonth(), _day: date.getDate()};\n    }\n\n    /**\n     * @class Ink.UI.DatePicker\n     * @constructor\n     * @version 1\n     *\n     * @param {String|DOMElement}   selector\n     * @param {Object}              [options]                   Options\n     * @param {Boolean}             [options.autoOpen]          Flag to automatically open the datepicker.\n     * @param {String}              [options.cleanText]         Text for the clean button. Defaults to 'Clear'.\n     * @param {String}              [options.closeText]         Text for the close button. Defaults to 'Close'.\n     * @param {String}              [options.cssClass]          CSS class to be applied on the datepicker\n     * @param {String|DOMElement}   [options.pickerField]       (if not using in an input[type=\"text\"]) Element which displays the DatePicker when clicked. Defaults to an \"open\" link.\n     * @param {String}              [options.dateRange]         Enforce limits to year, month and day for the Date, ex: '1990-08-25:2020-11'\n     * @param {Boolean}             [options.displayInSelect]   Flag to display the component in a select element.\n     * @param {String|DOMElement}   [options.dayField]          (if using options.displayInSelect) `select` field with days.\n     * @param {String|DOMElement}   [options.monthField]        (if using options.displayInSelect) `select` field with months.\n     * @param {String|DOMElement}   [options.yearField]         (if using options.displayInSelect) `select` field with years.\n     * @param {String}              [options.format]            Date format string\n     * @param {Object}              [options.month]             Hash of month names. Defaults to portuguese month names. January is 1.\n     * @param {String}              [options.nextLinkText]      Text for the previous button. Defaults to ''.\n     * @param {String}              [options.ofText]            Text to show between month and year. Defaults to ' of '.\n     * @param {Boolean}             [options.onFocus]           If the datepicker should open when the target element is focused. Defaults to true.\n     * @param {Function}            [options.onMonthSelected]   Callback to execute when the month is selected.\n     * @param {Function}            [options.onSetDate]         Callback to execute when the date is set.\n     * @param {Function}            [options.onYearSelected]    Callback to execute when the year is selected.\n     * @param {String}              [options.position]          Position for the datepicker. Either 'right' or 'bottom'. Defaults to 'right'.\n     * @param {String}              [options.prevLinkText]      Text for the previous button. Defaults to ''.\n     * @param {Boolean}             [options.showClean]         If the clean button should be visible. Defaults to true.\n     * @param {Boolean}             [options.showClose]         If the close button should be visible. Defaults to true.\n     * @param {Boolean}             [options.shy]               If the datepicker should start automatically. Defaults to true.\n     * @param {String}              [options.startDate]         Date to define initial month. Must be in yyyy-mm-dd format.\n     * @param {Number}              [options.startWeekDay]      First day of the week. Sunday is zero. Defaults to 1 (Monday).\n     * @param {Function}            [options.validYearFn]       Callback to execute when 'rendering' the month (in the month view)\n     * @param {Function}            [options.validMonthFn]      Callback to execute when 'rendering' the month (in the month view)\n     * @param {Function}            [options.validDayFn]        Callback to execute when 'rendering' the day (in the month view)\n     * @param {Function}            [options.nextValidDateFn]   Function to calculate the next valid date, given the current. Useful when there's invalid dates or time frames.\n     * @param {Function}            [options.prevValidDateFn]   Function to calculate the previous valid date, given the current. Useful when there's invalid dates or time frames.\n     * @param {Object}              [options.wDay]              Hash of week day names. Sunday is 0. Defaults to { 0:'Sunday', 1:'Monday', etc...\n     * @param {String}              [options.yearRange]         Enforce limits to year for the Date, ex: '1990:2020' (deprecated)\n     *\n     * @sample Ink_UI_DatePicker_1.html\n     */\n    var DatePicker = function() {\n        Common.BaseUIComponent.apply(this, arguments);\n    };\n\n    DatePicker._name = 'DatePicker_1';\n\n    DatePicker._optionDefinition = {\n        autoOpen:        ['Boolean', false],\n        cleanText:       ['String', 'Clear'],\n        closeText:       ['String', 'Close'],\n        pickerField:     ['Element', null],\n        containerElement:['Element', null],\n        cssClass:        ['String', 'ink-calendar bottom'],\n        dateRange:       ['String', null],\n        \n        // use this in a <select>\n        displayInSelect: ['Boolean', false],\n        dayField:        ['Element', null],\n        monthField:      ['Element', null],\n        yearField:       ['Element', null],\n\n        format:          ['String', 'yyyy-mm-dd'],\n        nextLinkText:    ['String', ''],\n        ofText:          ['String', ' of '],\n        onFocus:         ['Boolean', true],\n        onMonthSelected: ['Function', null],\n        onSetDate:       ['Function', null],\n        onYearSelected:  ['Function', null],\n        position:        ['String', 'right'],\n        prevLinkText:    ['String', ''],\n        showClean:       ['Boolean', true],\n        showClose:       ['Boolean', true],\n        shy:             ['Boolean', true],\n        startDate:       ['String', null], // format yyyy-mm-dd,\n        startWeekDay:    ['Number', 1],\n\n        // Validation\n        validDayFn:      ['Function', null],\n        validMonthFn:    ['Function', null],\n        validYearFn:     ['Function', null],\n        nextValidDateFn: ['Function', null],\n        prevValidDateFn: ['Function', null],\n        yearRange:       ['String', null],\n\n        // Text\n        month: ['Object', {\n             1:'January',\n             2:'February',\n             3:'March',\n             4:'April',\n             5:'May',\n             6:'June',\n             7:'July',\n             8:'August',\n             9:'September',\n            10:'October',\n            11:'November',\n            12:'December'\n        }],\n        wDay: ['Object', {\n            0:'Sunday',\n            1:'Monday',\n            2:'Tuesday',\n            3:'Wednesday',\n            4:'Thursday',\n            5:'Friday',\n            6:'Saturday'\n        }]\n    };\n\n    DatePicker.prototype = {\n        /**\n         * Initialization function. Called by the constructor and receives the same parameters.\n         *\n         * @method _init\n         * @private\n         */\n        _init: function(){\n            this._options.format = this._dateParsers[ this._options.format ] || this._options.format;\n\n            this._hoverPicker = false;\n\n            this._picker = this._options.pickerField || null;\n\n            this._setMinMax( this._options.dateRange || this._options.yearRange );\n\n            if(this._options.startDate) {\n                this.setDate( this._options.startDate );\n            } else if (this._element && this._element.value) {\n                this.setDate( this._element.value );\n            } else {\n                this.setDate(new Date());\n            }\n\n            if (this._options.startWeekDay < 0 || this._options.startWeekDay > 6) {\n                Ink.warn('Ink.UI.DatePicker_1: option \"startWeekDay\" must be between 0 (sunday) and 6 (saturday)');\n                this._options.startWeekDay = clamp(this._options.startWeekDay, 0, 6);\n            }\n\n            Ink.extendObj(this._options,this._lang || {});\n\n            this._render();\n            this._listenToContainerObjectEvents();\n        },\n\n        _validate: function () {\n            if(this._options.displayInSelect &&\n                    !(this._options.dayField && this._options.monthField && this._options.yearField)){\n                throw new Error(\n                    'Ink.UI.DatePicker: displayInSelect option enabled.'+\n                    'Please specify dayField, monthField and yearField selectors.');\n            }\n        },\n\n        /**\n         * Renders the DatePicker's markup.\n         *\n         * @method _render\n         * @private\n         */\n        _render: function() {\n            this._containerObject = document.createElement('div');\n\n            this._containerObject.className = this._options.cssClass + ' ink-datepicker-calendar hide-all';\n\n            this._renderSuperTopBar();\n\n            var calendarTop = document.createElement(\"div\");\n            calendarTop.className = 'ink-calendar-top';\n\n            this._monthDescContainer = document.createElement(\"div\");\n            this._monthDescContainer.className = 'ink-calendar-month_desc';\n\n            this._monthPrev = document.createElement('div');\n            this._monthPrev.className = 'ink-calendar-prev';\n            this._monthPrev.appendChild(InkElement.create('a', {\n                href: '#prev',\n                className: 'change_month_prev',\n                setHTML: this._options.prevLinkText\n            }));\n\n            this._monthNext = document.createElement('div');\n            this._monthNext.className = 'ink-calendar-next';\n            this._monthNext.appendChild(InkElement.create('a', {\n                href: '#next',\n                className: 'change_month_next',\n                setHTML: this._options.nextLinkText\n            }));\n\n            calendarTop.appendChild(this._monthPrev);\n            calendarTop.appendChild(this._monthDescContainer);\n            calendarTop.appendChild(this._monthNext);\n\n            this._monthContainer = document.createElement(\"div\");\n            this._monthContainer.className = 'ink-calendar-month';\n\n            this._containerObject.appendChild(calendarTop);\n            this._containerObject.appendChild(this._monthContainer);\n\n            this._monthSelector = this._renderMonthSelector();\n            this._containerObject.appendChild(this._monthSelector);\n\n            this._yearSelector = document.createElement('ul');\n            this._yearSelector.className = 'ink-calendar-year-selector';\n\n            this._containerObject.appendChild(this._yearSelector);\n\n            if(!this._options.onFocus || this._options.displayInSelect){\n                if(!this._options.pickerField){\n                    this._picker = InkElement.create('a', {\n                        href: '#open_cal',\n                        setHTML: 'open',\n                        insertBottom: this._element.parentNode,\n                        className: 'ink-datepicker-picker-field'\n                    });\n                } else {\n                    this._picker = Common.elOrSelector(this._options.pickerField, 'pickerField');\n                }\n            }\n\n            this._appendDatePickerToDom();\n\n            this._renderMonth();\n\n            this._monthChanger = InkElement.create('a', {\n                href: '#monthchanger',\n                className: 'ink-calendar-link-month',\n                setTextContent: this._options.month[this._month + 1]\n            });\n\n            this._ofText = InkElement.create('span', {\n                className: 'ink-calendar-of-text',\n                setHTML: this._options.ofText\n            });\n\n            this._yearChanger = InkElement.create('a', {\n                href: '#yearchanger',\n                className: 'ink-calendar-link-year',\n                setTextContent: this._year\n            });\n\n            this._monthDescContainer.appendChild(this._monthChanger);\n            this._monthDescContainer.appendChild(this._ofText);\n            this._monthDescContainer.appendChild(this._yearChanger);\n\n            if (!this._options.inline) {\n                this._addOpenCloseEvents();\n            } else {\n                this.show();\n            }\n            this._addDateChangeHandlersToInputs();\n        },\n\n        _addDateChangeHandlersToInputs: function () {\n            var fields = this._element;\n            if (this._options.displayInSelect) {\n                fields = [\n                    this._options.dayField,\n                    this._options.monthField,\n                    this._options.yearField];\n            }\n            Event.observeMulti(fields ,'change', Ink.bindEvent(function(){\n                this._updateDate( );\n                this._showDefaultView( );\n                this.setDate( );\n                if ( !this._inline && !this._hoverPicker ) {\n                    this._hide(true);\n                }\n            },this));\n        },\n\n        /**\n         * Shows the calendar.\n         *\n         * @method show\n         **/\n        show: function () {\n            this._updateDate();\n            this._renderMonth();\n            Css.removeClassName(this._containerObject, 'hide-all');\n        },\n\n        _addOpenCloseEvents: function () {\n            var opener = this._picker || this._element;\n\n            Event.observe(opener, 'click', Ink.bindEvent(function(e){\n                Event.stop(e);\n                this.show();\n            },this));\n\n            if (this._options.autoOpen) {\n                this.show();\n            }\n\n            if(!this._options.displayInSelect){\n                Event.observe(opener, 'blur', Ink.bindEvent(function() {\n                    if ( !this._hoverPicker ) {\n                        this._hide(true);\n                    }\n                },this));\n            }\n\n            if (this._options.shy) {\n                // Close the picker when clicking elsewhere.\n                Event.observe(document,'click',Ink.bindEvent(function(e){\n                    var target = Event.element(e);\n\n                    // \"elsewhere\" is outside any of these elements:\n                    var cannotBe = [\n                        this._options.dayField,\n                        this._options.monthField,\n                        this._options.yearField,\n                        this._picker,\n                        this._element\n                    ];\n\n                    for (var i = 0, len = cannotBe.length; i < len; i++) {\n                        if (cannotBe[i] && InkElement.descendantOf(cannotBe[i], target)) {\n                            return;\n                        }\n                    }\n\n                    this._hide(true);\n                },this));\n            }\n        },\n\n        /**\n         * Creates the markup of the view with months.\n         *\n         * @method _renderMonthSelector\n         * @private\n         */\n        _renderMonthSelector: function () {\n            var selector = document.createElement('ul');\n            selector.className = 'ink-calendar-month-selector';\n\n            var ulSelector = document.createElement('ul');\n            for(var mon=1; mon<=12; mon++){\n                ulSelector.appendChild(this._renderMonthButton(mon));\n\n                if (mon % 4 === 0) {\n                    selector.appendChild(ulSelector);\n                    ulSelector = document.createElement('ul');\n                }\n            }\n            return selector;\n        },\n\n        /**\n         * Renders a single month button.\n         */\n        _renderMonthButton: function (mon) {\n            var liMonth = document.createElement('li');\n            liMonth.appendChild(InkElement.create('a', {\n                'data-cal-month': mon,\n                setTextContent: this._options.month[mon].substring(0, 3)\n            }));\n            return liMonth;\n        },\n\n        _appendDatePickerToDom: function () {\n            if(this._options.containerElement) {\n                var appendTarget =\n                    Common.elOrSelector(this._options.containerElement);\n                appendTarget.appendChild(this._containerObject);\n            }\n\n            var parentIsControl = Selector.matchesSelector(\n                this._element.parentNode,\n                '.ink-form .control-group .control');\n\n            if (parentIsControl) {\n                this._wrapper = this._element.parentNode;\n                this._wrapperIsControl = true;\n            } else {\n                this._wrapper = InkElement.create('div', { className: 'ink-datepicker-wrapper' });\n                InkElement.wrap(this._element, this._wrapper);\n            }\n\n            InkElement.insertAfter(this._containerObject, this._element);\n        },\n\n        /**\n         * Render the topmost bar with the \"close\" and \"clear\" buttons.\n         */\n        _renderSuperTopBar: function () {\n            if((!this._options.showClose) || (!this._options.showClean)){ return; }\n\n            this._superTopBar = document.createElement(\"div\");\n            this._superTopBar.className = 'ink-calendar-top-options';\n            if(this._options.showClean){\n                this._superTopBar.appendChild(InkElement.create('a', {\n                    className: 'clean',\n                    setHTML: this._options.cleanText\n                }));\n            }\n            if(this._options.showClose){\n                this._superTopBar.appendChild(InkElement.create('a', {\n                    className: 'close',\n                    setHTML: this._options.closeText\n                }));\n            }\n            this._containerObject.appendChild(this._superTopBar);\n        },\n\n        _listenToContainerObjectEvents: function () {\n            Event.observe(this._containerObject,'mouseover',Ink.bindEvent(function(e){\n                Event.stop( e );\n                this._hoverPicker = true;\n            },this));\n\n            Event.observe(this._containerObject,'mouseout',Ink.bindEvent(function(e){\n                Event.stop( e );\n                this._hoverPicker = false;\n            },this));\n\n            Event.observe(this._containerObject,'click',Ink.bindEvent(this._onClick, this));\n        },\n\n        _onClick: function(e){\n            var elem = Event.element(e);\n\n            if (Css.hasClassName(elem, 'ink-calendar-off')) {\n                Event.stopDefault(e);\n                return null;\n            }\n\n            Event.stop(e);\n\n            // Relative changers\n            this._onRelativeChangerClick(elem);\n\n            // Absolute changers\n            this._onAbsoluteChangerClick(elem);\n\n            // Mode changers\n            if (Css.hasClassName(elem, 'ink-calendar-link-month')) {\n                this._showMonthSelector();\n            } else if (Css.hasClassName(elem, 'ink-calendar-link-year')) {\n                this._showYearSelector();\n            } else if(Css.hasClassName(elem, 'clean')){\n                this._clean();\n            } else if(Css.hasClassName(elem, 'close')){\n                this._hide(false);\n            }\n\n            this._updateDescription();\n        },\n\n        /**\n         * Handles click events on a changer ( ) for next/prev year/month\n         * @method _onChangerClick\n         * @private\n         **/\n        _onRelativeChangerClick: function (elem) {\n            var changeYear = {\n                change_year_next: 1,\n                change_year_prev: -1\n            };\n            var changeMonth = {\n                change_month_next: 1,\n                change_month_prev: -1\n            };\n\n            if( elem.className in changeMonth ) {\n                this._updateCal(changeMonth[elem.className]);\n            } else if( elem.className in changeYear ) {\n                this._showYearSelector(changeYear[elem.className]);\n            }\n        },\n\n        /**\n         * Handles click events on an atom-changer (day button, month button, year button)\n         *\n         * @method _onAbsoluteChangerClick\n         * @private\n         */\n        _onAbsoluteChangerClick: function (elem) {\n            var elemData = InkElement.data(elem);\n\n            if( Number(elemData.calDay) ){\n                this.setDate(new Date(this._year, this._month, elemData.calDay));\n                this._hide();\n            } else if( Number(elemData.calMonth) ) {\n                this._month = Number(elemData.calMonth) - 1;\n                this._showDefaultView();\n                this._updateCal();\n            } else if( Number(elemData.calYear) ){\n                this._changeYear(Number(elemData.calYear));\n            }\n        },\n\n        _changeYear: function (year) {\n            year = +year;\n            if(!isNaN(year)){\n                this._year = year;\n                if( typeof this._options.onYearSelected === 'function' ){\n                    this._options.onYearSelected(this, {\n                        'year': this._year\n                    });\n                }\n                this._showMonthSelector();\n            }\n        },\n\n        _clean: function () {\n            if(this._options.displayInSelect){\n                this._options.yearField.selectedIndex = 0;\n                this._options.monthField.selectedIndex = 0;\n                this._options.dayField.selectedIndex = 0;\n            } else {\n                this._element.value = '';\n            }\n        },\n\n        /**\n         * Hides the DatePicker.\n         * If the component is shy (options.shy), behaves differently.\n         *\n         * @method _hide\n         * @param {Boolean}    [blur]   If false, forces hiding even if the component is shy.\n         */\n        _hide: function(blur) {\n            blur = blur === undefined ? true : blur;\n            if (blur === false || (blur && this._options.shy)) {\n                Css.addClassName(this._containerObject, 'hide-all');\n            }\n        },\n\n        /**\n         * Sets the range of dates allowed to be selected in the Date Picker\n         *\n         * @method _setMinMax\n         * @param {String} dateRange Two dates separated by a ':'. Example: 2013-01-01:2013-12-12\n         * @private\n         */\n        _setMinMax: function( dateRange ) {\n            var self = this;\n\n            var noMinLimit = {\n                _year: -Number.MAX_VALUE,\n                _month: 0,\n                _day: 1\n            };\n\n            var noMaxLimit = {\n                _year: Number.MAX_VALUE,\n                _month: 11,\n                _day: 31\n            };\n\n            function noLimits() {\n                self._min = noMinLimit;\n                self._max = noMaxLimit;\n            }\n\n            if (!dateRange) { return noLimits(); }\n\n            var dates = dateRange.split( ':' );\n            var rDate = /^(\\d{4})((\\-)(\\d{1,2})((\\-)(\\d{1,2}))?)?$/;\n\n            InkArray.each([\n                        {name: '_min', date: dates[0], noLim: noMinLimit},\n                        {name: '_max', date: dates[1], noLim: noMaxLimit}\n                    ], Ink.bind(function (data) {\n\n                var lim = data.noLim;\n\n                if ( data.date.toUpperCase() === 'NOW' ) {\n                    var now = new Date();\n                    lim = dateishFromDate(now);\n                } else if (data.date.toUpperCase() === 'EVER') {\n                    lim = data.noLim;\n                } else if ( rDate.test( data.date ) ) {\n                    lim = dateishFromYMDString(data.date);\n\n                    lim._month = clamp(lim._month, 0, 11);\n                    lim._day = clamp(lim._day, 1, this._daysInMonth( lim._year, lim._month + 1 ));\n                }\n\n                this[data.name] = lim;\n            }, this));\n\n            // Should be equal, or min should be smaller\n            var valid = this._dateCmp(this._max, this._min) !== -1;\n\n            if (!valid) {\n                noLimits();\n            }\n        },\n\n        /**\n         * Checks if a date is between the valid range.\n         * Starts by checking if the date passed is valid. If not, will fallback to the 'today' date.\n         * Then checks if the all params are inside of the date range specified. If not, it will fallback to the nearest valid date (either Min or Max).\n         *\n         * @method _fitDateToRange\n         * @param  {Number} year  Year with 4 digits (yyyy)\n         * @param  {Number} month Month\n         * @param  {Number} day   Day\n         * @return {Array}       Array with the final processed date.\n         * @private\n         */\n        _fitDateToRange: function( date ) {\n            if ( !this._isValidDate( date ) ) {\n                date = dateishFromDate(new Date());\n            }\n\n            if (this._dateCmp(date, this._min) === -1) {\n                return Ink.extendObj({}, this._min);\n            } else if (this._dateCmp(date, this._max) === 1) {\n                return Ink.extendObj({}, this._max);\n            }\n\n            return Ink.extendObj({}, date);  // date is okay already, just copy it.\n        },\n\n        /**\n         * Checks whether a date is within the valid date range\n         * @method _dateWithinRange\n         * @param year\n         * @param month\n         * @param day\n         * @return {Boolean}\n         * @private\n         */\n        _dateWithinRange: function (date) {\n            if (!arguments.length) {\n                date = this;\n            }\n\n            return  (!this._dateAboveMax(date) &&\n                    (!this._dateBelowMin(date)));\n        },\n\n        _dateAboveMax: function (date) {\n            return this._dateCmp(date, this._max) === 1;\n        },\n\n        _dateBelowMin: function (date) {\n            return this._dateCmp(date, this._min) === -1;\n        },\n\n        _dateCmp: function (self, oth) {\n            return this._dateCmpUntil(self, oth, '_day');\n        },\n\n        /**\n         * _dateCmp with varied precision. You can compare down to the day field, or, just to the month.\n         * // the following two dates are considered equal because we asked\n         * // _dateCmpUntil to just check up to the years.\n         *\n         * _dateCmpUntil({_year: 2000, _month: 10}, {_year: 2000, _month: 11}, '_year') === 0\n         */\n        _dateCmpUntil: function (self, oth, depth) {\n            var props = ['_year', '_month', '_day'];\n            var i = -1;\n\n            do {\n                i++;\n                if      (self[props[i]] > oth[props[i]]) { return 1; }\n                else if (self[props[i]] < oth[props[i]]) { return -1; }\n            } while (props[i] !== depth &&\n                    self[props[i + 1]] !== undefined && oth[props[i + 1]] !== undefined);\n\n            return 0;\n        },\n\n        /**\n         * Sets the markup in the default view mode (showing the days).\n         * Also disables the previous and next buttons in case they don't meet the range requirements.\n         *\n         * @method _showDefaultView\n         * @private\n         */\n        _showDefaultView: function(){\n            this._yearSelector.style.display = 'none';\n            this._monthSelector.style.display = 'none';\n            this._monthPrev.childNodes[0].className = 'change_month_prev';\n            this._monthNext.childNodes[0].className = 'change_month_next';\n\n            if ( !this._getPrevMonth() ) {\n                this._monthPrev.childNodes[0].className = 'action_inactive';\n            }\n\n            if ( !this._getNextMonth() ) {\n                this._monthNext.childNodes[0].className = 'action_inactive';\n            }\n\n            this._monthContainer.style.display = 'block';\n        },\n\n        /**\n         * Updates the date shown on the datepicker\n         *\n         * @method _updateDate\n         * @private\n         */\n        _updateDate: function(){\n            var dataParsed;\n            if(!this._options.displayInSelect && this._element.value){\n                dataParsed = this._parseDate(this._element.value);\n            } else if (this._options.displayInSelect) {\n                dataParsed = {\n                    _year: this._options.yearField[this._options.yearField.selectedIndex].value,\n                    _month: this._options.monthField[this._options.monthField.selectedIndex].value - 1,\n                    _day: this._options.dayField[this._options.dayField.selectedIndex].value\n                };\n            }\n\n            if (dataParsed) {\n                dataParsed = this._fitDateToRange(dataParsed);\n                this._year = dataParsed._year;\n                this._month = dataParsed._month;\n                this._day = dataParsed._day;\n            }\n            this._setDate();\n            this._updateDescription();\n            this._renderMonth();\n        },\n\n        /**\n         * Updates the date description shown at the top of the datepicker\n         *\n         * EG \"12 de November\"\n         *\n         * @method  _updateDescription\n         * @private\n         */\n        _updateDescription: function(){\n            InkElement.setTextContent(this._monthChanger, this._options.month[this._month + 1]);\n            InkElement.setTextContent(this._ofText, this._options.ofText);\n            InkElement.setTextContent(this._yearChanger, this._year);\n        },\n\n        /**\n         * Renders the year selector view of the datepicker\n         *\n         * @method _showYearSelector\n         * @private\n         */\n        _showYearSelector: function(inc){\n            this._incrementViewingYear(inc);\n\n            var firstYear = this._year - (this._year % 10);\n            var thisYear = firstYear - 1;\n\n            InkElement.setHTML(this._yearSelector, '');\n            var yearUl = InkElement.create('ul');\n            this._yearSelector.appendChild(yearUl);\n\n            if (thisYear > this._min._year) {\n                var prevYearLi = InkElement.create('li');\n\n                prevYearLi.appendChild(InkElement.create('a', {\n                    href: '#year_prev',\n                    className: 'change_year_prev',\n                    setHTML: this._options.prevLinkText\n                }));\n\n                yearUl.appendChild(prevYearLi);\n            } else {\n                yearUl.appendChild(InkElement.create('li', { setHTML: '&nbsp;' }));\n            }\n\n            for (var i=1; i < 11; i++){\n                if (i % 4 === 0){\n                    yearUl = InkElement.create('ul');\n                    this._yearSelector.appendChild(yearUl);\n                }\n\n                thisYear = firstYear + i - 1;\n\n                yearUl.appendChild(this._getYearButton(thisYear));\n            }\n\n            if (thisYear < this._max._year) {\n                var nextYearLi = InkElement.create('li');\n\n                nextYearLi.appendChild(InkElement.create('a', {\n                    href: '#year_next',\n                    className: 'change_year_next',\n                    setHTML: this._options.nextLinkText\n                }));\n\n                yearUl.appendChild(nextYearLi);\n            } else {\n                yearUl.appendChild(InkElement.create('li', { setHTML: '&nbsp;' }));\n            }\n\n            this._monthPrev.childNodes[0].className = 'action_inactive';\n            this._monthNext.childNodes[0].className = 'action_inactive';\n            this._monthSelector.style.display = 'none';\n            this._monthContainer.style.display = 'none';\n            this._yearSelector.style.display = 'block';\n        },\n\n        /**\n         * For the year selector.\n         *\n         * Update this._year, to find the next decade or use nextValidDateFn to find it.\n         */\n        _incrementViewingYear: function (inc) {\n            if (!inc) { return; }\n\n            var year = +this._year + inc*10;\n            year = year - year % 10;\n            if ( year > this._max._year || year + 9 < this._min._year){\n                return;\n            }\n            this._year = +this._year + inc*10;\n        },\n\n        _getYearButton: function (thisYear) {\n            var className = '';\n\n            if (!this._acceptableYear({ _year: thisYear })) {\n                className = 'ink-calendar-off';\n            } else if (thisYear === this._year) {\n                className = 'ink-calendar-on';\n            }\n\n            var li = InkElement.create('li');\n\n            li.appendChild(InkElement.create('a', {\n                href: '#',\n                'data-cal-year': thisYear,\n                className: className,\n                setTextContent: thisYear\n            }));\n\n            return li;\n        },\n\n        /**\n         * Show the month selector (happens when you click a year, or the \"month\" link.\n         * @method _showMonthSelector\n         * @private\n         */\n        _showMonthSelector: function () {\n            this._yearSelector.style.display = 'none';\n            this._monthContainer.style.display = 'none';\n            this._monthPrev.childNodes[0].className = 'action_inactive';\n            this._monthNext.childNodes[0].className = 'action_inactive';\n            this._addMonthClassNames();\n            this._monthSelector.style.display = 'block';\n        },\n\n        /**\n         * This function returns the given date in the dateish format\n         *\n         * @method _parseDate\n         * @param {String} dateStr A date on a string.\n         * @private\n         */\n        _parseDate: function(dateStr){\n            var date = InkDate.set( this._options.format , dateStr );\n            if (date) {\n                return dateishFromDate(date);\n            }\n            return null;\n        },\n\n        /**\n         * Checks if a date is valid\n         *\n         * @method _isValidDate\n         * @param {Dateish} date\n         * @private\n         * @return {Boolean} True if the date is valid, false otherwise\n         */\n        _isValidDate: function(date){\n            var yearRegExp = /^\\d{4}$/;\n            var validOneOrTwo = /^\\d{1,2}$/;\n            return (\n                yearRegExp.test(date._year)     &&\n                validOneOrTwo.test(date._month) &&\n                validOneOrTwo.test(date._day)   &&\n                +date._month + 1 >= 1  &&\n                +date._month + 1 <= 12 &&\n                +date._day       >= 1  &&\n                +date._day       <= this._daysInMonth(date._year, date._month + 1)\n            );\n        },\n\n        /**\n         * Checks if a given date is an valid format.\n         *\n         * @method _isDate\n         * @param {String} format A date format.\n         * @param {String} dateStr A date on a string.\n         * @private\n         * @return {Boolean} True if the given date is valid according to the given format\n         */\n        _isDate: function(format, dateStr){\n            try {\n                if (typeof format === 'undefined'){\n                    return false;\n                }\n                var date = InkDate.set( format , dateStr );\n                if( date && this._isValidDate( dateishFromDate(date) )) {\n                    return true;\n                }\n            } catch (ex) {}\n\n            return false;\n        },\n\n        _acceptableDay: function (date) {\n            return this._acceptableDateComponent(date, 'validDayFn');\n        },\n\n        _acceptableMonth: function (date) {\n            return this._acceptableDateComponent(date, 'validMonthFn');\n        },\n\n        _acceptableYear: function (date) {\n            return this._acceptableDateComponent(date, 'validYearFn');\n        },\n\n        /** DRY base for the above 2 functions */\n        _acceptableDateComponent: function (date, userCb) {\n            if (this._options[userCb]) {\n                return this._callUserCallbackBool(this._options[userCb], date);\n            } else {\n                return this._dateWithinRange(date);\n            }\n        },\n\n        /**\n         * This method returns the date written with the format specified on the options\n         *\n         * @method _writeDateInFormat\n         * @private\n         * @return {String} Returns the current date of the object in the specified format\n         */\n        _writeDateInFormat:function(){\n            return InkDate.get( this._options.format , this.getDate());\n        },\n\n        /**\n         * This method allows the user to set the DatePicker's date on run-time.\n         *\n         * @method setDate\n         * @param {Date|String} dateString A Date object, or date string in yyyy-mm-dd format.\n         * @public\n         */\n        setDate: function( dateString ) {\n            if (dateString && typeof dateString.getDate === 'function') {\n                dateString = [ dateString.getFullYear(),\n                    dateString.getMonth() + 1, dateString.getDate() ].join('-');\n            }\n\n            if ( /\\d{4}-\\d{1,2}-\\d{1,2}/.test( dateString ) ) {\n                var auxDate = dateString.split( '-' );\n                this._year  = +auxDate[ 0 ];\n                this._month = +auxDate[ 1 ] - 1;\n                this._day   = +auxDate[ 2 ];\n            }\n\n            this._setDate( );\n        },\n\n        /**\n         * Gets the currently selected date as a JavaScript date.\n         *\n         * @method getDate\n         */\n        getDate: function () {\n            if (!this._day) {\n                throw 'Ink.UI.DatePicker: Still picking a date. Cannot getDate now!';\n            }\n            return new Date(this._year, this._month, this._day);\n        },\n\n        /**\n         * Sets the chosen date on the target input field\n         *\n         * @method _setDate\n         * @param {DOMElement} objClicked Clicked object inside the DatePicker's calendar.\n         * @private\n         */\n        _setDate : function( objClicked ) {\n            if (objClicked) {\n                var data = InkElement.data(objClicked);\n                this._day = (+data.calDay) || this._day;\n            }\n\n            var dt = this._fitDateToRange(this);\n\n            this._year = dt._year;\n            this._month = dt._month;\n            this._day = dt._day;\n\n            if(!this._options.displayInSelect){\n                this._element.value = this._writeDateInFormat();\n            } else {\n                this._options.dayField.value   = this._day;\n                this._options.monthField.value = this._month + 1;\n                this._options.yearField.value  = this._year;\n            }\n\n            if(this._options.onSetDate) {\n                this._options.onSetDate( this , { date : this.getDate() } );\n            }\n        },\n\n        /**\n         * Makes the necessary work to update the calendar\n         * when choosing a different month\n         *\n         * @method _updateCal\n         * @param {Number} inc Indicates previous or next month\n         * @private\n         */\n        _updateCal: function(inc){\n            if( typeof this._options.onMonthSelected === 'function' ){\n                this._options.onMonthSelected(this, {\n                    'year': this._year,\n                    'month' : this._month\n                });\n            }\n            if (inc && this._updateMonth(inc) === null) {\n                return;\n            }\n            this._renderMonth();\n        },\n\n        /**\n         * Function that returns the number of days on a given month on a given year\n         *\n         * @method _daysInMonth\n         * @param {Number} _y - year\n         * @param {Number} _m - month\n         * @private\n         * @return {Number} The number of days on a given month on a given year\n         */\n        _daysInMonth: function(_y,_m){\n            var exceptions = {\n                2: ((_y % 400 === 0) || (_y % 4 === 0 && _y % 100 !== 0)) ? 29 : 28,\n                4: 30,\n                6: 30,\n                9: 30,\n                11: 30\n            };\n\n            return exceptions[_m] || 31;\n        },\n\n\n        /**\n         * Updates the calendar when a different month is chosen\n         *\n         * @method _updateMonth\n         * @param {Number} incValue - indicates previous or next month\n         * @private\n         */\n        _updateMonth: function(incValue){\n            var date;\n            if (incValue > 0) {\n                date = this._getNextMonth();\n            } else if (incValue < 0) {\n                date = this._getPrevMonth();\n            }\n            if (!date) { return null; }\n            this._year = date._year;\n            this._month = date._month;\n            this._day = date._day;\n        },\n\n        /**\n         * Get the next month we can show.\n         */\n        _getNextMonth: function (date) {\n            return this._tryLeap( date, 'Month', 'next', function (d) {\n                    d._month += 1;\n                    if (d._month > 11) {\n                        d._month = 0;\n                        d._year += 1;\n                    }\n                    return d;\n                });\n        },\n\n        /**\n         * Get the previous month we can show.\n         */\n        _getPrevMonth: function (date) {\n            return this._tryLeap( date, 'Month', 'prev', function (d) {\n                    d._month -= 1;\n                    if (d._month < 0) {\n                        d._month = 11;\n                        d._year -= 1;\n                    }\n                    return d;\n                });\n        },\n\n        /**\n         * Get the next year we can show.\n         */\n        _getPrevYear: function (date) {\n            return this._tryLeap( date, 'Year', 'prev', function (d) {\n                    d._year -= 1;\n                    return d;\n                });\n        },\n\n        /**\n         * Get the next year we can show.\n         */\n        _getNextYear: function (date) {\n            return this._tryLeap( date, 'Year', 'next', function (d) {\n                    d._year += 1;\n                    return d;\n                });\n        },\n\n        /**\n         * DRY base for a function which tries to get the next or previous valid year or month.\n         *\n         * It checks if we can go forward by using _dateCmp with atomic\n         * precision (this means, {_year} for leaping years, and\n         * {_year, month} for leaping months), then it tries to get the\n         * result from the user-supplied callback (nextDateFn or prevDateFn),\n         * and when this is not present, advance the date forward using the\n         * `advancer` callback.\n         */\n        _tryLeap: function (date, atomName, directionName, advancer) {\n            date = date || { _year: this._year, _month: this._month, _day: this._day };\n\n            var maxOrMin = directionName === 'prev' ? '_min' : '_max';\n            var boundary = this[maxOrMin];\n\n            // Check if we're by the boundary of min/max year/month\n            if (this._dateCmpUntil(date, boundary, atomName) === 0) {\n                return null;  // We're already at the boundary. Bail.\n            }\n\n            var leapUserCb = this._options[directionName + 'ValidDateFn'];\n            if (leapUserCb) {\n                return this._callUserCallbackDate(leapUserCb, date);\n            } else {\n                date = advancer(date);\n            }\n\n            date = this._fitDateToRange(date);\n\n            return this['_acceptable' + atomName](date) ? date : null;\n        },\n\n        _getNextDecade: function (date) {\n            date = date || { _year: this._year, _month: this._month, _day: this._day };\n            var decade = this._getCurrentDecade(date);\n            if (decade + 10 > this._max._year) { return null; }\n            return decade + 10;\n        },\n\n        _getPrevDecade: function (date) {\n            date = date || { _year: this._year, _month: this._month, _day: this._day };\n            var decade = this._getCurrentDecade(date);\n            if (decade - 10 < this._min._year) { return null; }\n            return decade - 10;\n        },\n\n        /** Returns the decade given a date or year*/\n        _getCurrentDecade: function (year) {\n            year = year ? (year._year || year) : this._year;\n            return Math.floor(year / 10) * 10;  // Round to first place\n        },\n\n        _callUserCallbackBase: function (cb, date) {\n            return cb.call(this, date._year, date._month + 1, date._day);\n        },\n\n        _callUserCallbackBool: function (cb, date) {\n            return !!this._callUserCallbackBase(cb, date);\n        },\n\n        _callUserCallbackDate: function (cb, date) {\n            var ret = this._callUserCallbackBase(cb, date);\n            return ret ? dateishFromDate(ret) : null;\n        },\n\n        /**\n         * Key-value object that (for a given key) points to the correct parsing format for the DatePicker\n         * @property _dateParsers\n         * @type {Object}\n         * @readOnly\n         */\n        _dateParsers: {\n            'yyyy-mm-dd' : 'Y-m-d' ,\n            'yyyy/mm/dd' : 'Y/m/d' ,\n            'yy-mm-dd'   : 'y-m-d' ,\n            'yy/mm/dd'   : 'y/m/d' ,\n            'dd-mm-yyyy' : 'd-m-Y' ,\n            'dd/mm/yyyy' : 'd/m/Y' ,\n            'dd-mm-yy'   : 'd-m-y' ,\n            'dd/mm/yy'   : 'd/m/y' ,\n            'mm/dd/yyyy' : 'm/d/Y' ,\n            'mm-dd-yyyy' : 'm-d-Y'\n        },\n\n        /**\n         * Renders the current month\n         *\n         * @method _renderMonth\n         * @private\n         */\n        _renderMonth: function(){\n            var month = this._month;\n            var year = this._year;\n\n            this._showDefaultView();\n\n            InkElement.setHTML(this._monthContainer, '');\n\n            this._monthContainer.appendChild(\n                    this._getMonthCalendarHeader(this._options.startWeekDay));\n\n            this._monthContainer.appendChild(\n                    this._getDayButtons(year, month));\n        },\n\n        /**\n         * Figure out where the first day of a month lies\n         * in the first row of the calendar.\n         *\n         *      having options.startWeekDay === 0\n         *\n         *      Su Mo Tu We Th Fr Sa  \n         *                         1  <- The \"1\" is in the 7th day. return 6.\n         *       2  3  4  5  6  7  8  \n         *       9 10 11 12 13 14 15  \n         *      16 17 18 19 20 21 22  \n         *      23 24 25 26 27 28 29  \n         *      30 31\n         *\n         * This obviously changes according to the user option \"startWeekDay\"\n         **/\n        _getFirstDayIndex: function (year, month) {\n            var wDayFirst = (new Date( year , month , 1 )).getDay();  // Sunday=0\n            var startWeekDay = this._options.startWeekDay || 0;  // Sunday=0\n\n            var result = wDayFirst - startWeekDay;\n\n            result %= 7;\n\n            if (result < 0) {\n                result += 6;\n            }\n\n            return result;\n        },\n\n        _getDayButtons: function (year, month) {\n            var daysInMonth = this._daysInMonth(year, month + 1);\n\n            var ret = document.createDocumentFragment();\n\n            var ul = InkElement.create('ul');\n            ret.appendChild(ul);\n\n            var firstDayIndex = this._getFirstDayIndex(year, month);\n\n            // Add padding if the first day of the month is not monday.\n            for (var i = 0; i < firstDayIndex; i ++) {\n                ul.appendChild(InkElement.create('li', {\n                    className: 'ink-calendar-empty',\n                    setHTML: '&nbsp;'\n                }));\n            }\n\n            for (var day = 1; day <= daysInMonth; day++) {\n                if ((day - 1 + firstDayIndex) % 7 === 0){ // new week, new UL\n                    ul = InkElement.create('ul');\n                    ret.appendChild(ul);\n                }\n\n                ul.appendChild(this._getDayButton(year, month, day));\n            }\n            return ret;\n        },\n\n        /**\n         * Get the HTML markup for a single day in month view, given year, month, day.\n         *\n         * @method _getDayButtonHtml\n         * @private\n         */\n        _getDayButton: function (year, month, day) {\n            var attrs = {};\n            var date = dateishFromYMD(year, month, day);\n\n            if (!this._acceptableDay(date)) {\n                attrs.className = 'ink-calendar-off';\n            } else {\n                attrs['data-cal-day'] = day;\n\n                if (this._day && this._dateCmp(date, this) === 0) {\n                    attrs.className = 'ink-calendar-on';\n                }\n            }\n\n            attrs.setTextContent = day;\n\n            var dayButton = InkElement.create('li');\n            dayButton.appendChild(InkElement.create('a', attrs));\n            return dayButton;\n        },\n\n        /** Write the top bar of the calendar (M T W T F S S) */\n        _getMonthCalendarHeader: function (startWeekDay) {\n            var header = InkElement.create('ul', {\n                className: 'ink-calendar-header'\n            });\n\n            var wDay;\n            for(var i=0; i<7; i++){\n                wDay = (startWeekDay + i) % 7;\n                header.appendChild(InkElement.create('li', {\n                    setTextContent: this._options.wDay[wDay].substring(0, 1)\n                }));\n            }\n\n            return header;\n        },\n\n        /**\n         * This method adds class names to month buttons, to visually distinguish.\n         *\n         * @method _addMonthClassNames\n         * @param {DOMElement} parent DOMElement where all the months are.\n         * @private\n         */\n        _addMonthClassNames: function(parent){\n            InkArray.forEach(\n                (parent || this._monthSelector).getElementsByTagName('a'),\n                Ink.bindMethod(this, '_addMonthButtonClassNames'));\n        },\n\n        /**\n         * Add the ink-calendar-on className if the given button is the current month,\n         * otherwise add the ink-calendar-off className if the given button refers to\n         * an unacceptable month (given dateRange and validMonthFn)\n         */\n        _addMonthButtonClassNames: function (btn) {\n            var data = InkElement.data(btn);\n            if (!data.calMonth) { throw 'not a calendar month button!'; }\n\n            var month = +data.calMonth - 1;\n\n            if ( month === this._month ) {\n                Css.addClassName( btn, 'ink-calendar-on' );  // This month\n                Css.removeClassName( btn, 'ink-calendar-off' );\n            } else {\n                Css.removeClassName( btn, 'ink-calendar-on' );  // Not this month\n\n                var toDisable = !this._acceptableMonth({_year: this._year, _month: month});\n                Css.addRemoveClassName( btn, 'ink-calendar-off', toDisable);\n            }\n        },\n\n        /*\n         * // TODO implement this\n         * Prototype's method to allow the 'i18n files' to change all objects' language at once.\n         * @param {Object} options                  Object with the texts' configuration.\n         * @param {String} options.closeText        Text of the close anchor\n         * @param {String} options.cleanText        Text of the clean text anchor\n         * @param {String} options.prevLinkText     \"Previous\" link's text\n         * @param {String} options.nextLinkText     \"Next\" link's text\n         * @param {String} options.ofText           The text \"of\", present in 'May of 2013'\n         * @param {Object} options.month            An object with keys from 1 to 12 for the full months' names\n         * @param {Object} options.wDay             An object with keys from 0 to 6 for the full weekdays' names\n         * @public\n         */\n        lang: function( options ){\n            this._lang = options;\n        },\n\n        /**\n         * This calls the rendering of the selected month. (Deprecated: use show() instead)\n         *\n         */\n        showMonth: function(){\n            this._renderMonth();\n        },\n\n        /**\n         * Checks if the calendar screen is in 'select day' mode\n         * \n         * @method isMonthRendered\n         * @return {Boolean} True if the calendar screen is in 'select day' mode\n         * @public\n         */\n        isMonthRendered: function(){\n            var header = Selector.select('.ink-calendar-header', this._containerObject)[0];\n\n            return ((Css.getStyle(header.parentNode,'display') !== 'none') &&\n                    (Css.getStyle(header.parentNode.parentNode,'display') !== 'none') );\n        },\n\n        /**\n         * Destroys this datepicker, removing it from the page.\n         *\n         * @method destroy\n         * @public\n         **/\n        destroy: function () {\n            InkElement.unwrap(this._element);\n            InkElement.remove(this._wrapper);\n            InkElement.remove(this._containerObject);\n            Common.unregisterInstance.call(this);\n        }\n    };\n\n    Common.createUIComponent(DatePicker);\n\n    return DatePicker;\n});","/**\n * Dragging elements around\n * @module Ink.UI.Draggable_1\n * @version 1\n */\n \nInk.createModule(\"Ink.UI.Draggable\",\"1\",[\"Ink.Dom.Element_1\", \"Ink.Dom.Event_1\", \"Ink.Dom.Css_1\", \"Ink.Dom.Browser_1\", \"Ink.Dom.Selector_1\", \"Ink.UI.Common_1\"],function( InkElement, InkEvent, Css, Browser, Selector, Common) {\n    'use strict';\n\n    var x = 0,\n        y = 1;  // For accessing coords in [x, y] arrays\n    \n    // Get a value between two boundaries\n    function between (val, min, max) {\n        val = Math.min(val, max);\n        val = Math.max(val, min);\n        return val;\n    }\n\n    /**\n     * @class Ink.UI.Draggable\n     * @version 1\n     * @constructor\n     * @param {String|DOMElement}   target                      Target element.\n     * @param {Object}              [options]                   Optional object to configure the component.\n     * @param {String}              [options.constraint]        Movement constraint. None by default. Can be `vertical`, `horizontal`, or `both`.\n     * @param {String|DOMElement}   [options.constraintElm]     Constrain dragging to be within this element. None by default.\n     * @param {Number}              [options.top]               Limits to constrain draggable movement.\n     * @param {Number}              [options.right]             Limits to constrain draggable movement.\n     * @param {Number}              [options.bottom]            Limits to constrain draggable movement.\n     * @param {Number}              [options.left]              Limits to constrain draggable movement.\n     * @param {String|DOMElement}   [options.handle]            If specified, this element or CSS ID will be used as a handle for dragging.\n     * @param {Boolean}             [options.revert]            Flag to revert the draggable to the original position when dragging stops.\n     * @param {String}              [options.cursor]            Cursor type (CSS `cursor` value) used when the mouse is over the draggable object.\n     * @param {Number}              [options.zIndex]            Z-index applied to the draggable element while dragged.\n     * @param {Number}              [options.fps]               If set, throttles the drag effect to this number of frames per second.\n     * @param {DOMElement}          [options.droppableProxy]    If set, a shallow copy of this element will be moved around with transparent background.\n     * @param {String}              [options.mouseAnchor]       Anchor for the drag. Can be one of: 'left','center','right','top','center','bottom'.\n     * @param {String}              [options.dragClass]         Class to add when the draggable is being dragged. Defaults to drag.\n     * @param {Boolean}             [options.skipChildren=true] Whether you have to drag the actual element, or dragging one of the children is okay too.\n     * @param {Function}            [options.onStart]           Callback called when dragging starts.\n     * @param {Function}            [options.onEnd]             Callback called when dragging stops.\n     * @param {Function}            [options.onDrag]            Callback called while dragging, prior to position updates.\n     * @param {Function}            [options.onChange]          Callback called while dragging, after position updates.\n     *\n     * @sample Ink_UI_Draggable_1.html\n     */\n    function Draggable() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Draggable._name = 'Draggable_1';\n\n    Draggable._optionDefinition = {\n        constraint:         ['String', false],\n        constraintElm:      ['Element', false],\n        top:                ['Number', false],\n        right:              ['Number', false],\n        bottom:             ['Number', false],\n        left:               ['Number', false],\n        handle:             ['Element', false],\n        revert:             ['Boolean', false],\n        cursor:             ['String', 'move'],\n        zIndex:             ['Number', 9999],\n        fps:                ['Number', 0],\n        droppableProxy:     ['Element', false],\n        mouseAnchor:        ['String', undefined],\n        dragClass:          ['String', 'drag'],\n        skipChildren:       ['Boolean', true],  // Magic/More Magic\n        onStart:            ['Function', false],\n        onEnd:              ['Function', false],\n        onDrag:             ['Function', false],\n        onChange:           ['Function', false]\n    };\n\n    Draggable.prototype = {\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @param {String|DOMElement}   element     Element ID of the element or DOM Element.\n         * @param {Object}              [options]   Options object for configuration of the module.\n         * @private\n         */\n        _init: function() {\n            var o = this._options;\n            this.constraintElm = o.constraintElm && Common.elOrSelector(o.constraintElm);\n\n            this.handle             = false;\n            this.elmStartPosition   = false;\n            this.active             = false;\n            this.dragged            = false;\n            this.prevCoords         = false;\n            this.placeholder        = false;\n\n            this.position           = false;\n            this.zindex             = false;\n            this.firstDrag          = true;\n\n            if (o.fps) {\n                this.deltaMs = 1000 / o.fps;\n                this.lastRunAt = 0;\n            }\n\n            this.handlers = {};\n            this.handlers.start         = Ink.bindEvent(this._onStart,this);\n            this.handlers.dragFacade    = Ink.bindEvent(this._onDragFacade,this);\n            this.handlers.drag          = Ink.bindEvent(this._onDrag,this);\n            this.handlers.end           = Ink.bindEvent(this._onEnd,this);\n            this.handlers.selectStart   = function(event) {    InkEvent.stop(event);    return false;    };\n\n            // set handle\n            this.handle = (this._options.handle) ?\n                Common.elOrSelector(this._options.handle) :\n                this._element;\n\n            this.handle.style.cursor = o.cursor;\n\n            InkEvent.observe(this.handle, 'touchstart', this.handlers.start);\n            InkEvent.observe(this.handle, 'mousedown', this.handlers.start);\n\n            if (Browser.IE) {\n                InkEvent.observe(this._element, 'selectstart', this.handlers.selectStart);\n            }\n        },\n\n        /**\n         * Removes the ability of the element of being dragged\n         * \n         * @method destroy\n         * @public\n         */\n        destroy: function() {\n            InkEvent.stopObserving(this.handle, 'touchstart', this.handlers.start);\n            InkEvent.stopObserving(this.handle, 'mousedown', this.handlers.start);\n\n            if (Browser.IE) {\n                InkEvent.stopObserving(this._element, 'selectstart', this.handlers.selectStart);\n            }\n        },\n\n        /**\n         * Gets coordinates for a given event (with added page scroll)\n         * \n         * @method _getCoords\n         * @param {Object} e window.event object.\n         * @return {Array} Array where the first position is the x coordinate, the second is the y coordinate\n         * @private\n         */\n        _getCoords: function(e) {\n            var ps = [InkElement.scrollWidth(), InkElement.scrollHeight()];\n            return {\n                x: (e.touches ? e.touches[0].clientX : e.clientX) + ps[x],\n                y: (e.touches ? e.touches[0].clientY : e.clientY) + ps[y]\n            };\n        },\n\n        /**\n         * Clones src element's relevant properties to dst\n         * \n         * @method _cloneStyle\n         * @param {DOMElement} src Element from where we're getting the styles\n         * @param {DOMElement} dst Element where we're placing the styles.\n         * @private\n         */\n        _cloneStyle: function(src, dst) {\n            dst.className = src.className;\n            dst.style.borderWidth   = '0';\n            dst.style.padding       = '0';\n            dst.style.position      = 'absolute';\n            dst.style.width         = InkElement.elementWidth(src)        + 'px';\n            dst.style.height        = InkElement.elementHeight(src)    + 'px';\n            dst.style.left          = InkElement.elementLeft(src)        + 'px';\n            dst.style.top           = InkElement.elementTop(src)        + 'px';\n            dst.style.cssFloat      = Css.getStyle(src, 'float');\n            dst.style.display       = Css.getStyle(src, 'display');\n        },\n\n        /**\n         * onStart event handler\n         * \n         * @method _onStart\n         * @param {Object} e window.event object\n         * @return {Boolean|void} In some cases return false. Otherwise is void\n         * @private\n         */\n        _onStart: function(e) {\n            if (!this.active && InkEvent.isLeftClick(e) || typeof e.button === 'undefined') {\n\n                var tgtEl = InkEvent.element(e);\n                if (this._options.skipChildren && tgtEl !== this.handle) {    return;    }\n\n                InkEvent.stop(e);\n\n                Css.addClassName(this._element, this._options.dragClass);\n\n                this.elmStartPosition = [\n                    InkElement.elementLeft(this._element),\n                    InkElement.elementTop( this._element)\n                ];\n\n                var pos = [\n                    parseInt(Css.getStyle(this._element, 'left'), 10),\n                    parseInt(Css.getStyle(this._element, 'top'),  10)\n                ];\n\n                var dims = InkElement.elementDimensions(this._element);\n\n                this.originalPosition = [ pos[x] ? pos[x]: null, pos[y] ? pos[y] : null ];\n                this.delta = this._getCoords(e); // mouse coords at beginning of drag\n\n                this.active = true;\n                this.position = Css.getStyle(this._element, 'position');\n                this.zindex = Css.getStyle(this._element, 'zIndex');\n\n                var div = document.createElement('div');\n                div.style.position      = this.position;\n                div.style.width         = dims[x] + 'px';\n                div.style.height        = dims[y] + 'px';\n                div.style.marginTop     = Css.getStyle(this._element, 'margin-top');\n                div.style.marginBottom  = Css.getStyle(this._element, 'margin-bottom');\n                div.style.marginLeft    = Css.getStyle(this._element, 'margin-left');\n                div.style.marginRight   = Css.getStyle(this._element, 'margin-right');\n                div.style.borderWidth   = '0';\n                div.style.padding       = '0';\n                div.style.cssFloat      = Css.getStyle(this._element, 'float');\n                div.style.display       = Css.getStyle(this._element, 'display');\n                div.style.visibility    = 'hidden';\n\n                this.delta2 = [ this.delta.x - this.elmStartPosition[x], this.delta.y - this.elmStartPosition[y] ]; // diff between top-left corner of obj and mouse\n                if (this._options.mouseAnchor) {\n                    var parts = this._options.mouseAnchor.split(' ');\n                    var ad = [dims[x], dims[y]];    // starts with 'right bottom'\n                    if (parts[0] === 'left') {    ad[x] = 0;    } else if(parts[0] === 'center') {    ad[x] = parseInt(ad[x]/2, 10);    }\n                    if (parts[1] === 'top') {     ad[y] = 0;    } else if(parts[1] === 'center') {    ad[y] = parseInt(ad[y]/2, 10);    }\n                    this.applyDelta = [this.delta2[x] - ad[x], this.delta2[y] - ad[y]];\n                }\n\n                var dragHandlerName = this._options.fps ? 'dragFacade' : 'drag';\n\n                this.placeholder = div;\n\n                if (this._options.onStart) {        this._options.onStart(this._element, e);        }\n\n                if (this._options.droppableProxy) {    // create new transparent div to optimize DOM traversal during drag\n                    this.proxy = document.createElement('div');\n                    dims = [\n                        window.innerWidth     || document.documentElement.clientWidth   || document.body.clientWidth,\n                        window.innerHeight    || document.documentElement.clientHeight  || document.body.clientHeight\n                    ];\n                    var fs = this.proxy.style;\n                    fs.width            = dims[x] + 'px';\n                    fs.height           = dims[y] + 'px';\n                    fs.position         = 'fixed';\n                    fs.left             = '0';\n                    fs.top              = '0';\n                    fs.zIndex           = this._options.zindex + 1;\n                    fs.backgroundColor  = '#FF0000';\n                    Css.setOpacity(this.proxy, 0);\n\n                    var firstEl = document.body.firstChild;\n                    while (firstEl && firstEl.nodeType !== 1) {    firstEl = firstEl.nextSibling;    }\n                    document.body.insertBefore(this.proxy, firstEl);\n\n                    \n                    InkEvent.observe(this.proxy, 'mousemove', this.handlers[dragHandlerName]);\n                    InkEvent.observe(this.proxy, 'touchmove', this.handlers[dragHandlerName]);\n                }\n                else {\n                    InkEvent.observe(document, 'mousemove', this.handlers[dragHandlerName]);\n                }\n\n                this._element.style.position = 'absolute';\n                this._element.style.zIndex = this._options.zindex;\n                this._element.parentNode.insertBefore(this.placeholder, this._element);\n\n                this._onDrag(e);\n\n                InkEvent.observe(document, 'mouseup',      this.handlers.end);\n                InkEvent.observe(document, 'touchend',     this.handlers.end);\n\n                return false;\n            }\n        },\n\n        /**\n         * Function that gets the timestamp of the current run from time to time. (FPS)\n         * \n         * @method _onDragFacade\n         * @param {Object} window.event object.\n         * @private\n         */\n        _onDragFacade: function(e) {\n            var now = +new Date();\n            if (!this.lastRunAt || now > this.lastRunAt + this.deltaMs) {\n                this.lastRunAt = now;\n                this._onDrag(e);\n            }\n        },\n\n        /**\n         * Function that handles the dragging movement\n         * \n         * @method _onDrag\n         * @param {Object} window.event object.\n         * @private\n         */\n        _onDrag: function(e) {\n            if (this.active) {\n                InkEvent.stop(e);\n                this.dragged = true;\n                var mouseCoords = this._getCoords(e),\n                    mPosX       = mouseCoords.x,\n                    mPosY       = mouseCoords.y,\n                    o           = this._options,\n                    newX        = false,\n                    newY        = false;\n\n                if (this.prevCoords && mPosX !== this.prevCoords.x || mPosY !== this.prevCoords.y) {\n                    if (o.onDrag) {        o.onDrag(this._element, e);        }\n                    this.prevCoords = mouseCoords;\n\n                    newX = this.elmStartPosition[x] + mPosX - this.delta.x;\n                    newY = this.elmStartPosition[y] + mPosY - this.delta.y;\n\n                    var draggableSize = InkElement.elementDimensions(this._element);\n\n                    if (this.constraintElm) {\n                        var offset = InkElement.offset(this.constraintElm);\n                        var size = InkElement.elementDimensions(this.constraintElm);\n                        var constTop = offset[y] + (o.top || 0),\n                            constBottom = offset[y] + size[y] - (o.bottom || 0),\n                            constLeft = offset[x] + (o.left || 0),\n                            constRight = offset[x] + size[x] - (o.right || 0);\n\n                        newY = between(newY, constTop, constBottom - draggableSize[y]);\n                        newX = between(newX, constLeft, constRight - draggableSize[x]);\n                    } else if (o.constraint) {\n                        var right = o.right === false ? InkElement.pageWidth() - draggableSize[x] : o.right,\n                            left = o.left === false ? 0 : o.left,\n                            top = o.top === false ? 0 : o.top,\n                            bottom = o.bottom === false ? InkElement.pageHeight() - draggableSize[y] : o.bottom;\n                        if (o.constraint === 'horizontal' || o.constraint === 'both') {\n                            newX = between(newX, left, right);\n                        }\n                        if (o.constraint === 'vertical' || o.constraint === 'both') {\n                            newY = between(newY, top, bottom);\n                        }\n                    }\n\n                    var Droppable = Ink.getModule('Ink.UI.Droppable_1');\n                    if (this.firstDrag) {\n                        if (Droppable) {    Droppable.updateAll();    }\n                        /*this._element.style.position = 'absolute';\n                        this._element.style.zIndex = this._options.zindex;\n                        this._element.parentNode.insertBefore(this.placeholder, this._element);*/\n                        this.firstDrag = false;\n                    }\n\n                    if (newX) {        this._element.style.left = newX + 'px';        }\n                    if (newY) {        this._element.style.top  = newY + 'px';        }\n\n                    if (Droppable) {\n                        // apply applyDelta defined on drag init\n                        var mouseCoords2 = this._options.mouseAnchor ?\n                            {x: mPosX - this.applyDelta[x], y: mPosY - this.applyDelta[y]} :\n                            mouseCoords;\n                        Droppable.action(mouseCoords2, 'drag', e, this._element);\n                    }\n                    if (o.onChange) {    o.onChange(this);    }\n                }\n            }\n        },\n\n        /**\n         * Function that handles the end of the dragging process\n         * \n         * @method _onEnd\n         * @param {Object} window.event object.\n         * @private\n         */\n        _onEnd: function(e) {\n            InkEvent.stopObserving(document, 'mousemove', this.handlers.drag);\n            InkEvent.stopObserving(document, 'touchmove', this.handlers.drag);\n\n            if (this._options.fps) {\n                this._onDrag(e);\n            }\n\n            Css.removeClassName(this._element, this._options.dragClass);\n\n            if (this.active && this.dragged) {\n\n                if (this._options.droppableProxy) {    // remove transparent div...\n                    document.body.removeChild(this.proxy);\n                }\n\n                if (this.pt) {    // remove debugging element...\n                    InkElement.remove(this.pt);\n                    this.pt = undefined;\n                }\n\n                /*if (this._options.revert) {\n                    this.placeholder.parentNode.removeChild(this.placeholder);\n                }*/\n\n                if(this.placeholder) {\n                    InkElement.remove(this.placeholder);\n                }\n\n                if (this._options.revert) {\n                    this._element.style.position = this.position;\n                    if (this.zindex !== null) {\n                        this._element.style.zIndex = this.zindex;\n                    }\n                    else {\n                        this._element.style.zIndex = 'auto';\n                    } // restore default zindex of it had none\n\n                    this._element.style.left = (this.originalPosition[x]) ? this.originalPosition[x] + 'px' : '';\n                    this._element.style.top  = (this.originalPosition[y]) ? this.originalPosition[y] + 'px' : '';\n                }\n\n                if (this._options.onEnd) {\n                    this._options.onEnd(this._element, e);\n                }\n                \n                var Droppable = Ink.getModule('Ink.UI.Droppable_1');\n                if (Droppable) {\n                    Droppable.action(this._getCoords(e), 'drop', e, this._element);\n                }\n\n                this.position   = false;\n                this.zindex     = false;\n                this.firstDrag  = true;\n            }\n\n            this.active         = false;\n            this.dragged        = false;\n        }\n    };\n\n    Common.createUIComponent(Draggable);\n\n    return Draggable;\n\n});\n","/**\n * Off-canvas menu\n * @module Ink.UI.Drawer_1\n * @version 1\n */\n \nInk.createModule('Ink.UI.Drawer', '1', ['Ink.UI.Common_1', 'Ink.Dom.Loaded_1', 'Ink.Dom.Selector_1', 'Ink.Dom.Element_1', 'Ink.Dom.Event_1', 'Ink.Dom.Css_1'], function(Common, Loaded, Selector, Element, Event, Css) {\n    'use strict';\n\n    function elNotFound(el) {\n        Ink.warn( 'Ink.UI.Drawer_1: Could not find the \"' +\n            el + '\" element on this page. Please make sure it exists.' );\n    }\n\n    function Drawer(options) {\n        Common.BaseUIComponent.apply(this, [document.body, options]);\n    }\n\n    Drawer._name = 'Drawer_1';\n\n    Drawer._optionDefinition = {\n        parentSelector:     ['String', '.ink-drawer'],\n        leftDrawer:         ['String', '.left-drawer'],\n        leftTrigger:        ['String', '.left-drawer-trigger'],\n        rightDrawer:        ['String', '.right-drawer'],\n        rightTrigger:       ['String', '.right-drawer-trigger'],\n        contentDrawer:      ['String', '.content-drawer'],\n        closeOnContentClick: ['Boolean', true],\n        closeOnLinkClick:    ['Boolean', true],\n        mode:               ['String', 'push'],\n        sides:              ['String', 'both']\n    };\n\n    Drawer.prototype = {\n        /**\n         * Displays off-canvas content which can be triggered by clicking elements with the 'left-drawer-trigger' and 'right-drawer-trigger', respectively.\n         * The left drawer has the 'left-drawer' class, and the right drawer has the 'right-drawer' class. The content drawer (EG your `<div id=\"main\">`) must have the 'content-drawer' class. For more, see the example below, or try the sample.\n         * @class Ink.UI.Drawer_1\n         * @constructor\n         *\n         * @param {Object}      [options]                       Configuration options.\n         * @xparam {String}     [options.parentSelector]        The class you are using in your wrapper (in the example below, it's the `body` tag.)\n         * @xparam {String}     [options.leftDrawer]            Selector for the left drawer element. This element is placed outside the screen and shown when you click the `leftTrigger` element.\n         * @xparam {String}     [options.leftTrigger]           Selector for the left drawer trigger(s). When you click this trigger, the `leftDrawer` is shown.\n         * @xparam {String}     [options.rightDrawer]           Right drawer selector. (see `options.leftDrawer`)\n         * @xparam {String}     [options.rightTrigger]          Right trigger selector (see `options.leftTrigger`)\n         * @xparam {String}     [options.contentDrawer]         Selector for the content drawer.\n         * @param {Boolean}     [options.closeOnContentClick]   Flag to close the drawer when someone clicks on the `.contentDrawer`\n         * @param {String}      [options.mode]                  This can be 'push' or 'over'.\n         * @param {String}      [options.sides]                 Can be 'left', 'right', or 'both'. Controls what sides have a drawer.\n         *\n         * @example\n         * <body class=\"ink-drawer\">\n         *     <div class=\"left-drawer\">\n         *         Right drawer content...\n         *     </div>\n         *     <div class=\"right-drawer\">\n         *         Left drawer content...\n         *     </div>\n         *     <div id=\"main-content\" class=\"content-drawer ink-grid\">\n         *         <a class=\"left-drawer-trigger\" href=\"\">Open left drawer</a>\n         *         <a class=\"right-drawer-trigger\" href=\"\">Open right drawer</a>\n         *         Content...\n         *     </div>\n         * </body>\n         *\n         * <script>\n         *     Ink.requireModules(['Ink.UI.Drawer_1'], function (Drawer) {\n         *         new Drawer();\n         *     });\n         * </script>\n         */\n        _init: function () {\n            // make sure we have the required elements acording to the config options\n\n            this._contentDrawers = Ink.ss(this._options.contentDrawer);\n\n            this._leftDrawer = Ink.s(this._options.leftDrawer);\n            this._leftTriggers = Ink.ss(this._options.leftTrigger);\n\n            this._rightDrawer = Ink.s(this._options.rightDrawer);\n            this._rightTriggers = Ink.ss(this._options.rightTrigger);\n\n            // The body might not have it\n            Css.addClassName(document.body, 'ink-drawer');\n\n            if(this._contentDrawers.length === 0) {\n                throw new Error('Ink.UI.Drawer_1: Could not find any \"' +\n                    this._options.contentDrawer + '\" elements on this page. ' +\n                    'Please make sure you have at least one.' );\n            }\n\n            switch (this._options.sides) {\n                case 'both':\n                    this._triggers =\n                        this._options.leftTrigger + ', ' +\n                        this._options.rightTrigger + ', ' +\n                        this._options.contentDrawer;\n                break;\n\n                case 'left':\n                    this._triggers =\n                        this._options.leftTrigger + ', ' +\n                        this._options.contentDrawer;\n                break;\n\n                case 'right':\n                    this._triggers =\n                        this._options.rightTrigger + ', ' +\n                        this._options.contentDrawer;\n                break;\n            }\n\n            if (this._options.sides === 'left' || this._options.sides === 'both') {\n                if( !this._leftDrawer ){\n                    elNotFound(this._options.leftDrawer);\n                }\n\n                if(this._leftTriggers.length === 0){\n                    elNotFound(this._options.leftTrigger);\n                }\n            } else {\n                if( !this._rightDrawer ){\n                    elNotFound(this._options.rightDrawer);\n                }\n\n                if( this._rightTriggers.length === 0 ){\n                    elNotFound(this._options.rightTrigger);\n                }\n            }\n\n            this._isOpen = false;\n            this._direction = undefined;\n\n            this._handlers = {\n                click:     Ink.bindEvent(this._onClick, this),\n                afterTransition: Ink.bindEvent(this._afterTransition, this)\n            };\n            this._delay = 10;\n            this._addEvents();\n        },\n\n        /**\n         * Click event handler.\n         * Listens to the body's click event\n         *\n         * @method _onClick\n         * @private\n         **/\n        _onClick: function(ev){\n            var triggerClicked = Ink.bind(function (side) {\n                // When clicking on the trigger, the corresponding side is toggled.\n                if (this._isOpen) {\n                    this.close();\n                } else {\n                    this.open(side);\n                }\n                ev.preventDefault();\n            }, this);\n\n            if(Element.findUpwardsBySelector(ev.currentTarget,this._options.leftTrigger)){\n                // Clicked on the left trigger\n                triggerClicked('left');\n            } else if(Element.findUpwardsBySelector(ev.currentTarget,this._options.rightTrigger)){\n                triggerClicked('right');\n            } else if(Element.findUpwardsBySelector(ev.currentTarget,this._options.contentDrawer)){\n                // Clicked on the rest of the body\n                if(this._options.closeOnContentClick) {\n                    this.close();\n                }\n            } else if (this._options.closeOnLinkClick && Element.isLink(ev.target)) {\n                this.close();\n                // No preventDefault() here\n            }\n        },\n\n        _afterTransition: function(){\n            if(!this._isOpen){\n                if(this._direction === 'left') {\n                    Css.removeClassName(this._leftDrawer, 'show');\n                } else {\n                    Css.removeClassName(this._rightDrawer, 'show');\n                }\n            }\n        },\n\n        _addEvents: function(){\n            Event.on(document.body, 'click', this._triggers + ', a[href*=\"#\"]', this._handlers.click);\n        },\n\n        open: function(direction) {\n            this._isOpen = true;\n            this._direction = direction;\n\n            var open = direction === 'left' ?\n                this._leftDrawer :\n                this._rightDrawer;\n\n            Css.addClassName(open,'show');\n            setTimeout(Ink.bind(function(){\n                Css.addClassName(document.body, [this._options.mode, direction]);\n            },this), this._delay);\n        },\n\n        close: function() {\n            if (this._isOpen === false) { return; }\n            this._isOpen = false;\n            // TODO detect transitionEnd exists, otherwise don't rely on it\n            Event.one(document.body, 'transitionend oTransitionEnd webkitTransitionEnd', this._handlers.afterTransition);\n            Css.removeClassName(document.body, [this._options.mode, this._direction]);\n        }\n\n    };\n\n    Common.createUIComponent(Drawer);\n\n    return Drawer;\n});\n","/**\n * Dropdown menus\n *\n * @module Ink.UI.Dropdown_1\n * Use this UI module to achieve a dropdown menu.\n *\n * @version 1\n */\n\nInk.createModule('Ink.UI.Dropdown', '1', ['Ink.UI.Common_1', 'Ink.UI.Toggle_1', 'Ink.Dom.Event_1', 'Ink.Dom.Element_1'], function(Common, Toggle, InkEvent, InkElement) {\n    'use strict';\n\n    function Dropdown() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Dropdown._name = 'Dropdown_1';\n\n    Dropdown._optionDefinition = {\n        'target':           ['Element'],\n        'hoverOpen':        ['Number', null],\n        'dismissOnInsideClick': ['Boolean', false],\n        'dismissOnOutsideClick': ['Boolean', true],\n        'dismissAfter':     ['Number', null],\n        'onInsideClick':    ['Function', null],\n        'onOutsideClick':   ['Function', null],\n        'onOpen':           ['Function', null],\n        'onDismiss':        ['Function', null]\n    };\n\n    Dropdown.prototype = {\n        /**\n         * @class Ink.UI.Dropdown\n         *\n         * @constructor\n         * @param {DOMElement|String}   trigger         Trigger Element\n         * @param {Object}              options         Options Object\n         * @param {DOMElement|String}   options.target Target of the dropdown action.\n         *\n         * @sample Ink_UI_Dropdown_1.html\n         */\n        _init: function() {\n            this._toggle = new Toggle(this._element, {\n                target: this._options.target,\n                closeOnInsideClick: null,\n                closeOnClick: false,\n                onChangeState: Ink.bind(function (newState) {\n                    return this._openOrDismiss(newState, true, true);\n                }, this)\n            });\n\n            // Event where we set this._dismissTimeout and clear this._openTimeout\n            InkEvent.observeMulti([this._options.target, this._element],\n                'mouseout', Ink.bindMethod(this, '_onMouseOut'));\n\n            // Events to keep clearing this._dismissTimeout and set this._openTimeout\n            InkEvent.observeMulti([this._options.target, this._element],\n                'mouseover', Ink.bindMethod(this, '_onMouseOver'));\n\n            // to call dismissOnInsideClick and onInsideClick\n            InkEvent.observe(this._options.target, 'click', Ink.bindMethod(this, '_onInsideClick'));\n            // to call dismissOnOutsideClick and onOutsideClick\n            InkEvent.observe(document, 'click', Ink.bindMethod(this, '_onOutsideClick'));\n        },\n\n        /**\n         * Called when the mouse is over the toggler, or the dropdown.\n         *\n         * Deals with \"hoverOpen\" by setting the dropdown to open later. Also cancels \"dismissAfter\".\n         * @method _onMouseOver\n         * @private\n         **/\n        _onMouseOver: function () {\n            if (typeof this._options.hoverOpen === 'number' && this._toggle.getState() === false) {\n                clearTimeout(this._openTimeout);\n                this._openTimeout = setTimeout(\n                    Ink.bindMethod(this, 'open', true),\n                    this._options.hoverOpen * 1000);\n            }\n            if (typeof this._options.dismissAfter === 'number') {\n                clearTimeout(this._dismissTimeout);\n            }\n        },\n\n        /**\n         * Called when the mouse leaves either the toggler, or the dropdown.\n         *\n         * Deals with \"dismissAfter\" by setting the dropdown to be dismissed later. Also cancels \"hoverOpen\".\n         * @method _onMouseOut\n         * @private\n         **/\n        _onMouseOut: function () {\n            if (typeof this._options.dismissAfter === 'number' && this._toggle.getState() === true) {\n                clearTimeout(this._dismissTimeout);\n                this._dismissTimeout = setTimeout(\n                    Ink.bindMethod(this, 'dismiss', true),\n                    this._options.dismissAfter * 1000);\n            }\n            if (typeof this._options.hoverOpen === 'number') {\n                clearTimeout(this._openTimeout);\n            }\n        },\n\n        /**\n         * Handle clicks on the dropdown.\n         * @method _onInsideClick\n         * @private\n         */\n        _onInsideClick: function (event) {\n            var ret = this._handlerCall('onInsideClick', InkEvent.element(event));\n            if (ret === false) { return; }\n            if (this._options.dismissOnInsideClick) {\n                this.dismiss(true);\n            }\n        },\n\n        /**\n         * Handle clicks outside the dropdown.\n         * @method _onOutsideClick\n         * @private\n         */\n        _onOutsideClick: function (event) {\n            var target = InkEvent.element(event);\n            var foundElem = InkElement.findUpwardsHaving(target, Ink.bind(function (needle) {\n                return needle === this._element;\n            }, this));\n            var foundTarget = InkElement.findUpwardsHaving(target, Ink.bind(function (needle) {\n                return needle === this._options.target;\n            }, this));\n\n            if (!foundElem && !foundTarget) {\n                var ret = this._handlerCall('onOutsideClick', target);\n                if (ret === false) { return; }\n                if (this._options.dismissOnOutsideClick) {\n                    this.dismiss(true);\n                }\n            }\n        },\n\n        /**\n         * Closes the dropdown.\n         *\n         * @method dismiss\n         * @param [callHandler=false] call onDismiss handler\n         */\n        dismiss: function (callHandler, doNotInformToggle) {\n            this._openOrDismiss(false, callHandler, doNotInformToggle);\n        },\n\n        /**\n         * Opens the dropdown\n         *\n         * @method open\n         * @param [callHandler=false] call onOpen handler\n         */\n        open: function (callHandler, _doNotInformToggle) {\n            this._openOrDismiss(true, callHandler, _doNotInformToggle);\n        },\n\n        /**\n         * DRY'ing up open() and dismiss()\n         *\n         * @method _openOrDismiss\n         * @param [newState=false]\n         * @param [callHandler=false]\n         * @private\n         */\n        _openOrDismiss: function (newState, callHandler, _doNotInformToggle) {\n            if (this._toggle && this._toggle.getState() === newState) { return; }\n            if (callHandler) {\n                if (this._handlerCall(newState ? 'onOpen' : 'onDismiss') === false) {\n                    return false;  // canceled by event handler\n                }\n            }\n            if (!_doNotInformToggle) {\n                this._toggle.setState(newState);\n            }\n            clearTimeout(this._dismissTimeout);\n            clearTimeout(this._openTimeout);\n        },\n\n        /**\n         * call a method given by the user through the options\n         *\n         * @method _handlerCall\n         * @param handler {String} The handler name in this._options\n         * @param [args*] Arguments to pass to function\n         */\n        _handlerCall: function (handler/*, ... */) {\n            if (this._options[handler]) {\n                return this._options[handler].call(this, [].slice.call(arguments, 1));\n            }\n        }\n    };\n\n    Common.createUIComponent(Dropdown);\n\n    return Dropdown;\n});\n","/**\n * Drop elements around\n * @module Ink.UI.Droppable_1\n * @version 1\n */\n\nInk.createModule(\"Ink.UI.Droppable\",\"1\",[\"Ink.Dom.Element_1\", \"Ink.Dom.Event_1\", \"Ink.Dom.Css_1\", \"Ink.UI.Common_1\", \"Ink.Util.Array_1\", \"Ink.Dom.Selector_1\"], function( InkElement, InkEvent, Css, Common, InkArray, Selector) {\n    'use strict';\n\n    // Higher order functions\n    var hAddClassName = function (element) {\n        return function (className) {return Css.addClassName(element, className);};\n    };\n    var hRemoveClassName = function (element) {\n        return function (className) {return Css.removeClassName(element, className);};\n    };\n\n    /**\n     * @namespace Ink.UI.Droppable\n     * @version 1\n     * @static\n     */\n    var Droppable = {\n        /**\n         * Flag to activate debug mode\n         *\n         * @property debug\n         * @type {Boolean}\n         * @private\n         */\n        debug: false,\n\n        /**\n         * Array with the data of each element (`{element: ..., data: ..., options: ...}`)\n         * \n         * @property _droppables\n         * @type {Array}\n         * @private\n         */\n        _droppables: [],\n\n        /**\n         * Array of data for each draggable. (`{element: ..., data: ...}`)\n         *\n         * @property _draggables\n         * @type {Array}\n         * @private\n         */\n        _draggables: [],\n\n        /**\n         * Makes an element droppable.\n         * This method adds it to the stack of droppable elements.\n         * Can consider it a constructor of droppable elements, but where no Droppable object is returned.\n         *\n         * The onHover, onDrop, and onDropOut options below can be:\n         *\n         * - 'move', 'copy': Move or copy the draggable element into this droppable.\n         * - 'revert': Make the draggable go back to where it came from.\n         * - A function (draggableElement, droppableElement), defining what you want to do in this case.\n         *\n         * @method add\n         * @param {String|DOMElement}   element                 Target element\n         * @param {Object}              [options]               Options object\n         * @param {String}              [options.hoverClass]    Classname(s) applied when an acceptable draggable element is hovering the element\n         * @param {String}              [options.accept]        Selector for choosing draggables which can be dropped in this droppable.\n         * @param {Function}            [options.onHover]       Called when an acceptable element is hovering the droppable (see above for string options).\n         * @param {Function|String}     [options.onDrop]        Called when an acceptable element is dropped (see above for string options). \n         * @param {Function|String}     [options.onDropOut]     Called when a droppable is dropped outside this droppable (see above for string options).\n         * @public\n         *\n         * @sample Ink_UI_Droppable_1.html\n         *\n         */\n        add: function(element, options) {\n            element = Common.elOrSelector(element, 'Droppable.add target element');\n\n            var opt = Ink.extendObj({\n                hoverClass:     options.hoverclass /* old name */ || false,\n                accept:         false,\n                onHover:        false,\n                onDrop:         false,\n                onDropOut:      false\n            }, options || {}, InkElement.data(element));\n            \n            if (typeof opt.hoverClass === 'string') {\n                opt.hoverClass = opt.hoverClass.split(/\\s+/);\n            }\n            \n            function cleanStyle(draggable) {\n                draggable.style.position = 'inherit';\n            }\n            var that = this;\n            var namedEventHandlers = {\n                move: function (draggable, droppable/*, event*/) {\n                    cleanStyle(draggable);\n                    droppable.appendChild(draggable);\n                },\n                copy: function (draggable, droppable/*, event*/) {\n                    cleanStyle(draggable);\n                    droppable.appendChild(draggable.cloneNode(true));\n                },\n                revert: function (draggable/*, droppable, event*/) {\n                    that._findDraggable(draggable).originalParent.appendChild(draggable);\n                    cleanStyle(draggable);\n                }\n            };\n            var name;\n\n            if (typeof opt.onHover === 'string') {\n                name = opt.onHover;\n                opt.onHover = namedEventHandlers[name];\n                if (opt.onHover === undefined) {\n                    throw new Error('Unknown hover event handler: ' + name);\n                }\n            }\n            if (typeof opt.onDrop === 'string') {\n                name = opt.onDrop;\n                opt.onDrop = namedEventHandlers[name];\n                if (opt.onDrop === undefined) {\n                    throw new Error('Unknown drop event handler: ' + name);\n                }\n            }\n            if (typeof opt.onDropOut === 'string') {\n                name = opt.onDropOut;\n                opt.onDropOut = namedEventHandlers[name];\n                if (opt.onDropOut === undefined) {\n                    throw new Error('Unknown dropOut event handler: ' + name);\n                }\n            }\n\n            var elementData = {\n                element: element,\n                data: {},\n                options: opt\n            };\n            this._droppables.push(elementData);\n            this._update(elementData);\n        },\n        \n        /**\n         * Finds droppable data about `element`. this data is added in `.add`\n         *\n         * @method _findData\n         * @param {DOMElement} element  Needle\n         * @return {object}             Droppable data of the element\n         * @private\n         */\n        _findData: function (element) {\n            var elms = this._droppables;\n            for (var i = 0, len = elms.length; i < len; i++) {\n                if (elms[i].element === element) {\n                    return elms[i];\n                }\n            }\n        },\n        /**\n         * Finds draggable data about `element`\n         *\n         * @method _findDraggable\n         * @param {DOMElement} element  Needle\n         * @return {Object}             Draggable data queried\n         * @private\n         */\n        _findDraggable: function (element) {\n            var elms = this._draggables;\n            for (var i = 0, len = elms.length; i < len; i++) {\n                if (elms[i].element === element) {\n                    return elms[i];\n                }\n            }\n        },\n\n        /**\n         * Invoke every time a drag starts\n         * \n         * @method updateAll\n         * @private\n         */\n        updateAll: function() {\n            InkArray.each(this._droppables, Droppable._update);\n        },\n\n        /**\n         * Updates location and size of droppable element\n         * \n         * @method update\n         * @param {String|DOMElement} element Target element\n         * @public\n         */\n        update: function(element) {\n            this._update(this._findData(element));\n        },\n\n        _update: function(elementData) {\n            var data = elementData.data;\n            var element = elementData.element;\n            data.left   = InkElement.offsetLeft(element);\n            data.top    = InkElement.offsetTop( element);\n            data.right  = data.left + InkElement.elementWidth( element);\n            data.bottom = data.top  + InkElement.elementHeight(element);\n        },\n\n        /**\n         * Removes an element from the droppable stack and removes the droppable behavior\n         * \n         * @method remove\n         * @param {String|DOMElement} elOrSelector  Droppable element to disable.\n         * @return {Boolean} Whether the object was found and deleted\n         * @public\n         */\n        remove: function(el) {\n            el = Common.elOrSelector(el);\n            var len = this._droppables.length;\n            for (var i = 0; i < len; i++) {\n                if (this._droppables[i].element === el) {\n                    this._droppables.splice(i, 1);\n                    break;\n                }\n            }\n            return len !== this._droppables.length;\n        },\n\n        /**\n         * Executes an action on a droppable\n         * \n         * @method action\n         * @param {Object} coords       Coordinates where the action happened\n         * @param {String} type         Type of action. 'drag' or 'drop'.\n         * @param {Object} ev           Event object\n         * @param {Object} draggable    Draggable element\n         * @private\n         */\n        action: function(coords, type, ev, draggable) {\n            // check all droppable elements\n            InkArray.each(this._droppables, Ink.bind(function(elementData) {\n                var data = elementData.data;\n                var opt = elementData.options;\n                var element = elementData.element;\n\n                if (opt.accept && !Selector.matches(opt.accept, [draggable]).length) {\n                    return;\n                }\n\n                if (type === 'drag' && !this._findDraggable(draggable)) {\n                    this._draggables.push({\n                        element: draggable,\n                        originalParent: draggable.parentNode\n                    });\n                }\n\n                // check if our draggable is over our droppable\n                if (coords.x >= data.left && coords.x <= data.right &&\n                        coords.y >= data.top && coords.y <= data.bottom) {\n                    // INSIDE\n                    if (type === 'drag') {\n                        if (opt.hoverClass) {\n                            InkArray.each(opt.hoverClass,\n                                hAddClassName(element));\n                        }\n                        if (opt.onHover) {\n                            opt.onHover(draggable, element);\n                        }\n                    } else if (type === 'drop') {\n                        if (opt.hoverClass) {\n                            InkArray.each(opt.hoverClass,\n                                hRemoveClassName(element));\n                        }\n                        if (opt.onDrop) {\n                            opt.onDrop(draggable, element, ev);\n                        }\n                    }\n                } else {\n                    // OUTSIDE\n\n                    if (type === 'drag' && opt.hoverClass) {\n                        InkArray.each(opt.hoverClass, hRemoveClassName(element));\n                    } else if (type === 'drop') {\n                        if(opt.onDropOut){\n                            opt.onDropOut(draggable, element, ev);\n                        }\n                    }\n                }\n            }, this));\n        }\n    };\n\n    return Droppable;\n});\n","/**\n * Form Validation\n * @module Ink.UI.FormValidator_1\n * @version 1\n **/\n\nInk.createModule('Ink.UI.FormValidator', '1', ['Ink.Dom.Element_1', 'Ink.Dom.Css_1','Ink.Util.Validator_1','Ink.Dom.Selector_1'], function( InkElement, Css, InkValidator , Selector) {\n    'use strict';\n\n    function elementsWithSameName(elm) {\n        if (!elm.name) { return []; }\n        if (!elm.form) {\n            return Selector.select('name=\"' + elm.name + '\"');\n        }\n        var ret = elm.form[elm.name];\n        if(typeof(ret.length) === 'undefined') {\n            ret = [ret];\n        }\n        return ret;\n    }\n    /**\n     * @namespace Ink.UI.FormValidator\n     * @version 1\n     */\n    var FormValidator = {\n\n        /**\n         * Specifies the version of the component\n         *\n         * @property version\n         * @type {String}\n         * @readOnly\n         * @public\n         */\n        version: '1',\n\n        /**\n         * Available flags to use in the validation process.\n         * The keys are the 'rules', and their values are objects with the key 'msg', determining\n         * what is the error message.\n         *\n         * @property _flagMap\n         * @type {Object}\n         * @readOnly\n         * @private\n         */\n        _flagMap: {\n            //'ink-fv-required': {msg: 'Campo obrigat&oacute;rio'},\n            'ink-fv-required': {msg: 'Required field'},\n            //'ink-fv-email': {msg: 'E-mail inv&aacute;lido'},\n            'ink-fv-email': {msg: 'Invalid e-mail address'},\n            //'ink-fv-url': {msg: 'URL inv&aacute;lido'},\n            'ink-fv-url': {msg: 'Invalid URL'},\n            //'ink-fv-number': {msg: 'N&uacute;mero inv&aacute;lido'},\n            'ink-fv-number': {msg: 'Invalid number'},\n            //'ink-fv-phone_pt': {msg: 'N&uacute;mero de telefone inv&aacute;lido'},\n            'ink-fv-phone_pt': {msg: 'Invalid phone number'},\n            //'ink-fv-phone_cv': {msg: 'N&uacute;mero de telefone inv&aacute;lido'},\n            'ink-fv-phone_cv': {msg: 'Invalid phone number'},\n            //'ink-fv-phone_mz': {msg: 'N&uacute;mero de telefone inv&aacute;lido'},\n            'ink-fv-phone_mz': {msg: 'Invalid phone number'},\n            //'ink-fv-phone_ao': {msg: 'N&uacute;mero de telefone inv&aacute;lido'},\n            'ink-fv-phone_ao': {msg: 'Invalid phone number'},\n            //'ink-fv-date': {msg: 'Data inv&aacute;lida'},\n            'ink-fv-date': {msg: 'Invalid date'},\n            //'ink-fv-confirm': {msg: 'Confirma&ccedil;&atilde;o inv&aacute;lida'},\n            'ink-fv-confirm': {msg: 'Confirmation does not match'},\n            'ink-fv-custom': {msg: ''}\n        },\n\n        /**\n         * This property holds all form elements for later validation\n         *\n         * @property elements\n         * @type {Object}\n         * @public\n         */\n        elements: {},\n\n        /**\n         * This property holds the objects needed to cross-check for the 'confirm' rule\n         *\n         * @property confirmElms\n         * @type {Object}\n         * @public\n         */\n        confirmElms: {},\n\n        /**\n         * This property holds the previous elements in the confirmElms property, but with a\n         * true/false specifying if it has the class ink-fv-confirm.\n         *\n         * @property hasConfirm\n         * @type {Object}\n         */\n        hasConfirm: {},\n\n        /**\n         * Defined class name to use in error messages label\n         *\n         * @property _errorClassName\n         * @type {String}\n         * @readOnly\n         * @private\n         */\n        _errorClassName: 'tip error',\n\n        /**\n         * @property _errorValidationClassName\n         * @type {String}\n         * @readOnly\n         * @private\n         */\n        _errorValidationClassName: 'validaton',\n\n        /**\n         * @property _errorTypeWarningClassName\n         * @type {String}\n         * @readOnly\n         * @private\n         */\n        _errorTypeWarningClassName: 'warning',\n\n        /**\n         * @property _errorTypeErrorClassName\n         * @type {String}\n         * @readOnly\n         * @private\n         */\n        _errorTypeErrorClassName: 'error',\n\n        /**\n         * Checks if a form is valid\n         * \n         * @method validate\n         * @param {DOMElement|String}   elm                     DOM form element or form id\n         * @param {Object}              options                 Configuration options\n         * @param {Function}            [options.onSuccess]     Callback to run when form is valid\n         * @param {Function}            [options.onError]       Callback to run when form is not valid\n         * @param {Array}               [options.customFlag]    Custom flags to use to validate form fields\n         * @public\n         * @return {Boolean} Whether the form is deemed valid or not.\n         *\n         * @sample Ink_UI_FormValidator_1.html\n         */\n        validate: function(elm, options) {\n            this._free();\n\n            options = Ink.extendObj({\n                onSuccess: false,\n                onError: false,\n                customFlag: false,\n                confirmGroup: []\n            }, options || {});\n\n            if(typeof(elm) === 'string') {\n                elm = document.getElementById(elm);\n            }\n            if(elm === null){\n                return false;\n            }\n            this.element = elm;\n\n            if(typeof(this.element.id) === 'undefined' || this.element.id === null || this.element.id === '') {\n                // generate a random ID\n                // TODO ugly and potentially problematic, and you know Murphy's law.\n                this.element.id = 'ink-fv_randomid_'+(Math.round(Math.random() * 99999));\n            }\n\n            this.custom = options.customFlag;\n\n            this.confirmGroup = options.confirmGroup;\n\n            var fail = this._validateElements();\n\n            if(fail.length > 0) {\n                if(options.onError) {\n                    options.onError(fail);\n                } else {\n                    this._showError(elm, fail);\n                }\n                return false;\n            } else {\n                if(!options.onError) {\n                    this._clearError(elm);\n                }\n                this._clearCache();\n                if(options.onSuccess) {\n                    options.onSuccess();\n                }\n                return true;\n            }\n\n        },\n\n        /**\n         * Resets previously generated validation errors\n         * \n         * @method reset\n         * @public\n         */\n        reset: function()\n        {\n            this._clearError();\n            this._clearCache();\n        },\n\n        /**\n         * Cleans the object\n         * \n         * @method _free\n         * @private\n         */\n        _free: function()\n        {\n            this.element = null;\n            //this.elements = [];\n            this.custom = false;\n            this.confirmGroup = false;\n        },\n\n        /**\n         * Cleans the properties responsible for caching\n         * \n         * @method _clearCache\n         * @private\n         */\n        _clearCache: function()\n        {\n            this.element = null;\n            this.elements = [];\n            this.custom = false;\n            this.confirmGroup = false;\n        },\n\n        /**\n         * Gets the form elements and stores them in the caching properties\n         * \n         * @method _getElements\n         * @private\n         */\n        _getElements: function()\n        {\n            //this.elements = [];\n            // if(typeof(this.elements[this.element.id]) !== 'undefined') {\n            //     return;\n            // }\n\n            var elements = this.elements[this.element.id] = [];\n            this.confirmElms[this.element.id] = [];\n            //console.log(this.element);\n            //console.log(this.element.elements);\n            var formElms = Selector.select(':input', this.element);\n            var curElm = false;\n            for(var i=0, totalElm = formElms.length; i < totalElm; i++) {\n                curElm = formElms[i];\n                var type = (curElm.getAttribute('type') + '').toLowerCase();\n\n                if (type === 'radio' || type === 'checkbox') {\n                    if(elements.length === 0 ||\n                            (\n                             curElm.getAttribute('type') !== elements[elements.length - 1].getAttribute('type') &&\n                            curElm.getAttribute('name') !== elements[elements.length - 1].getAttribute('name')\n                            )) {\n                        for(var flag in this._flagMap) {\n                            if(Css.hasClassName(curElm, flag)) {\n                                elements.push(curElm);\n                                break;\n                            }\n                        }\n                    }\n                } else {\n                    for(var flag2 in this._flagMap) {\n                        if(Css.hasClassName(curElm, flag2) && flag2 !== 'ink-fv-confirm') {\n                            /*if(flag2 == 'ink-fv-confirm') {\n                                this.confirmElms[this.element.id].push(curElm);\n                                this.hasConfirm[this.element.id] = true;\n                            }*/\n                            elements.push(curElm);\n                            break;\n                        }\n                    }\n\n                    if(Css.hasClassName(curElm, 'ink-fv-confirm')) {\n                        this.confirmElms[this.element.id].push(curElm);\n                        this.hasConfirm[this.element.id] = true;\n                    }\n\n                }\n            }\n        },\n\n        /**\n         * Runs the validation for each element\n         * \n         * @method _validateElements\n         * @private\n         */\n        _validateElements: function() {\n            var oGroups;\n            this._getElements();\n            if(this.hasConfirm[this.element.id] === true) {\n                oGroups = this._makeConfirmGroups();\n            }\n\n            var errors = [];\n\n            var curElm = false;\n            var customErrors = false;\n            var inArray;\n            for(var i=0, totalElm = this.elements[this.element.id].length; i < totalElm; i++) {\n                inArray = false;\n                curElm = this.elements[this.element.id][i];\n\n                if(!curElm.disabled) {\n                    for(var flag in this._flagMap) {\n                        if(Css.hasClassName(curElm, flag)) {\n                            if(flag !== 'ink-fv-custom' && flag !== 'ink-fv-confirm') {\n                                if(!this._isValid(curElm, flag)) {\n                                    if(!inArray) {\n                                        errors.push({elm: curElm, errors:[flag]});\n                                        inArray = true;\n                                    } else {\n                                        errors[(errors.length - 1)].errors.push(flag);\n                                    }\n                                }\n                            } else if(flag !== 'ink-fv-confirm'){\n                                customErrors = this._isCustomValid(curElm);\n                                if(customErrors.length > 0) {\n                                    errors.push({elm: curElm, errors:[flag], custom: customErrors});\n                                }\n                            } else if(flag === 'ink-fv-confirm'){\n                                continue;\n                            }\n                        }\n                    }\n                }\n            }\n            errors = this._validateConfirmGroups(oGroups, errors);\n            //console.log(InkDumper.returnDump(errors));\n            return errors;\n        },\n\n        /**\n         * Runs the 'confirm' validation for each group of elements\n         * \n         * @method _validateConfirmGroups\n         * @param {Array} oGroups Array/Object that contains the group of confirm objects\n         * @param {Array} errors Array that will store the errors\n         * @private\n         * @return {Array} Array of errors that was passed as 2nd parameter (either changed, or not, depending if errors were found).\n         */\n        _validateConfirmGroups: function(oGroups, errors) {\n            //console.log(oGroups);\n            var curGroup = false;\n            for(var i in oGroups) if (oGroups.hasOwnProperty(i)) {\n                curGroup = oGroups[i];\n                if(curGroup.length === 2) {\n                    if(curGroup[0].value !== curGroup[1].value) {\n                        errors.push({elm:curGroup[1], errors:['ink-fv-confirm']});\n                    }\n                }\n            }\n            return errors;\n        },\n\n        /**\n         * Creates the groups of 'confirm' objects\n         * \n         * @method _makeConfirmGroups\n         * @private\n         * @return {Array|Boolean} Returns the array of confirm elements or false on error.\n         */\n        _makeConfirmGroups: function()\n        {\n            var oGroups;\n            if(this.confirmGroup && this.confirmGroup.length > 0) {\n                oGroups = {};\n                var curElm = false;\n                var curGroup = false;\n                //this.confirmElms[this.element.id];\n                for(var i=0, total=this.confirmElms[this.element.id].length; i < total; i++) {\n                    curElm = this.confirmElms[this.element.id][i];\n                    for(var j=0, totalG=this.confirmGroup.length; j < totalG; j++) {\n                        curGroup =  this.confirmGroup[j];\n                        if(Css.hasClassName(curElm, curGroup)) {\n                            if(typeof(oGroups[curGroup]) === 'undefined') {\n                                oGroups[curGroup] = [curElm];\n                            } else {\n                                oGroups[curGroup].push(curElm);\n                            }\n                        }\n                    }\n                }\n                return oGroups;\n            } else {\n                if(this.confirmElms[this.element.id].length === 2) {\n                    oGroups = {\n                        \"ink-fv-confirm\": [\n                            this.confirmElms[this.element.id][0],\n                            this.confirmElms[this.element.id][1]\n                        ]\n                    };\n                }\n                return oGroups;\n            }\n            return false;\n        },\n\n        /**\n         * Validates an element with a custom validation\n         * \n         * @method _isCustomValid\n         * @param {DOMElemenmt} elm Element to be validated\n         * @private\n         * @return {Array} Array of errors. If no errors are found, results in an empty array.\n         */\n        _isCustomValid: function(elm)\n        {\n            var customErrors = [];\n            var curFlag = false;\n            for(var i=0, tCustom = this.custom.length; i < tCustom; i++) {\n                curFlag = this.custom[i];\n                if(Css.hasClassName(elm, curFlag.flag)) {\n                    if(!curFlag.callback(elm, curFlag.msg)) {\n                        customErrors.push({flag: curFlag.flag, msg: curFlag.msg});\n                    }\n                }\n            }\n            return customErrors;\n        },\n\n        /**\n         * Runs the normal validation functions for a specific element\n         * \n         * @method _isValid\n         * @param {DOMElement} elm DOMElement that will be validated\n         * @param {String} fieldType Rule to be validated. This must be one of the keys present in the _flagMap property.\n         * @private\n         * @return {Boolean} The result of the validation.\n         */\n        _isValid: function(elm, fieldType) {\n            var nodeName = elm.nodeName.toLowerCase();\n            var inputType = (elm.getAttribute('type') || '').toLowerCase();\n            var value = this._trim(elm.value);\n\n            // When we're analyzing emails, telephones, etc, and the field is\n            // empty, we check if it is required. If not required, it's valid.\n            if (fieldType !== 'ink-fv-required' &&\n                    inputType !== 'checkbox' && inputType !== 'radio' &&\n                    value === '') {\n                return !Css.hasClassName(elm, 'ink-fv-required');\n            }\n\n            switch(fieldType) {\n                case 'ink-fv-required':\n                    if(nodeName === 'select') {\n                        if(elm.selectedIndex > 0) {\n                            return true;\n                        } else {\n                            return false;\n                        }\n                    }\n                    if(inputType !== 'checkbox' && inputType !== 'radio' &&\n                            value !== '') {\n                        return true;  // A input type=text,email,etc.\n                    } else if(inputType === 'checkbox' || inputType === 'radio') {\n                        var aFormRadios = elementsWithSameName(elm);\n                        var isChecked = false;\n                        // check if any input of the radio is checked\n                        for(var i=0, totalRadio = aFormRadios.length; i < totalRadio; i++) {\n                            if(aFormRadios[i].checked === true) {\n                                isChecked = true;\n                                break;\n                            }\n                        }\n                        return isChecked;\n                    }\n                    return false;\n\n                case 'ink-fv-email':\n                    return InkValidator.mail(elm.value);\n\n                case 'ink-fv-url':\n                    return InkValidator.url(elm.value);\n\n                case 'ink-fv-number':\n                    return !isNaN(Number(elm.value)) && isFinite(Number(elm.value));\n\n                case 'ink-fv-phone_pt':\n                    return InkValidator.isPTPhone(elm.value);\n\n                case 'ink-fv-phone_cv':\n                    return InkValidator.isCVPhone(elm.value);\n\n                case 'ink-fv-phone_ao':\n                    return InkValidator.isAOPhone(elm.value);\n\n                case 'ink-fv-phone_mz':\n                    return InkValidator.isMZPhone(elm.value);\n\n                case 'ink-fv-date':\n                    var Element = Ink.getModule('Ink.Dom.Element',1);\n                    var dataset = Element.data( elm );\n                    var validFormat = 'yyyy-mm-dd';\n\n                    if( Css.hasClassName(elm, 'ink-datepicker') && ('format' in dataset) ){\n                        validFormat = dataset.format;\n                    } else if( ('validFormat' in dataset) ){\n                        validFormat = dataset.validFormat;\n                    }\n\n                    if( !(validFormat in InkValidator._dateParsers ) ){\n                        var validValues = [];\n                        for( var val in InkValidator._dateParsers ){\n                            if (InkValidator._dateParsers.hasOwnProperty(val)) {\n                                validValues.push(val);\n                            }\n                        }\n                        throw new Error(\n                            'The attribute data-valid-format must be one of ' +\n                            'the following values: ' + validValues.join(', '));\n                    }\n                    \n                    return InkValidator.isDate( validFormat, elm.value );\n                case 'ink-fv-custom':\n                    break;\n            }\n\n            return false;\n        },\n\n        /**\n         * Makes the necessary changes to the markup to show the errors of a given element\n         * \n         * @method _showError\n         * @param {DOMElement} formElm The form element to be changed to show the errors\n         * @param {Array} aFail An array with the errors found.\n         * @private\n         */\n        _showError: function(formElm, aFail) {\n            this._clearError(formElm);\n\n            //ink-warning-field\n\n            //console.log(aFail);\n            var curElm = false;\n            for(var i=0, tFail = aFail.length; i < tFail; i++) {\n                curElm = aFail[i].elm;\n                if (curElm) {\n                    this._showAnErrorOnElement(curElm, aFail[i]);\n                }\n            }\n        },\n\n        _showAnErrorOnElement: function (curElm, error) {\n            /* jshint noempty:false */\n\n            var controlGroupElm = InkElement.findUpwardsByClass(\n                    curElm, 'control-group');\n            var controlElm = InkElement.findUpwardsByClass(\n                    curElm, 'control');\n\n            var errorClasses = [\n                this._errorClassName,\n                this._errorTypeClassName].join(' ');\n\n            var errorMsg = InkElement.create('p', {\n                className: errorClasses\n            });\n\n            if(error.errors[0] !== 'ink-fv-custom') {\n                errorMsg.innerHTML = this._flagMap[error.errors[0]].msg;\n            } else {\n                errorMsg.innerHTML = error.custom[0].msg;\n            }\n\n            var target = (controlElm || controlGroupElm);\n            if (target) {\n                target.appendChild(errorMsg);\n            } else {\n                InkElement.insertAfter(errorMsg, curElm);\n            }\n\n            if (controlElm) {\n                if(error.errors[0] === 'ink-fv-required') {\n                    Css.addClassName(controlGroupElm, 'validation error');\n                } else {\n                    Css.addClassName(controlGroupElm, 'validation warning');\n                }\n            }\n        },\n\n        /**\n         * Clears the error of a given element. Normally executed before any validation, for all elements, as a reset.\n         * \n         * @method _clearErrors\n         * @param {DOMElement} formElm Form element to be cleared.\n         * @private\n         */\n        _clearError: function(formElm) {\n            //return;\n            var aErrorLabel = formElm.getElementsByTagName('p');\n\n            var curElm;\n            var control;\n\n            for(var i = (aErrorLabel.length - 1); i >= 0; i--) {\n                curElm = aErrorLabel[i];\n                if(Css.hasClassName(curElm, this._errorClassName)) {\n                    control = InkElement.findUpwardsBySelector(curElm, '.control-group');\n                    if (control) {\n                        Css.removeClassName(control, ['validation', 'error', 'warning']);\n                    }\n\n                    if(Css.hasClassName(curElm, this._errorClassName, true /*both*/)) {\n                        InkElement.remove(curElm);\n                    }\n                }\n            }\n\n            var aErrorLabel2 = formElm.getElementsByTagName('ul');\n            for(i = (aErrorLabel2.length - 1); i >= 0; i--) {\n                curElm = aErrorLabel2[i];\n                if(Css.hasClassName(curElm, 'control-group')) {\n                    Css.removeClassName(curElm, 'validation error');\n                }\n            }\n        },\n\n        /**\n         * Removes unnecessary spaces to the left or right of a string\n         * \n         * @method _trim\n         * @param {String} stri String to be trimmed\n         * @private\n         * @return {String|undefined} String trimmed.\n         */\n        _trim: function(str)\n        {\n            if(typeof(str) === 'string')\n            {\n                return str.replace(/^\\s+|\\s+$|\\n+$/g, '');\n            }\n        }\n    };\n\n    return FormValidator;\n\n});","/**\n * Form Validation\n * @module Ink.UI.FormValidator_2\n * @version 2\n */\n\nInk.createModule('Ink.UI.FormValidator', '2', [ 'Ink.UI.Common_1','Ink.Dom.Element_1','Ink.Dom.Event_1','Ink.Dom.Selector_1','Ink.Dom.Css_1','Ink.Util.Array_1','Ink.Util.I18n_1','Ink.Util.Validator_1'], function( Common, Element, Event, Selector, Css, InkArray, I18n, InkValidator ) {\n    'use strict';\n\n    /**\n     * Validation Functions to be used\n     *\n     * Some functions are a port from PHP, others are the 'best' solutions available\n     *\n     * @class FormValidator.validationFunctions\n     * @static\n     */\n    var validationFunctions = {\n\n        /**\n         * Checks if a value is defined and not empty\n         * @method required\n         * @return {Boolean}       True case is defined, false if it's empty or not defined.\n         */\n        'required': function( value ){\n            return ( (typeof value !== 'undefined') && ( !(/^\\s*$/).test(value) ) );\n        },\n\n        /**\n         * Checks if a value has a minimum length\n         *\n         * @method min_length\n         * @param  {String|Number}  minSize Minimum number of characters.\n         * @return {Boolean}                True if the length of value is equal or bigger than the minimum chars defined. False if not.\n         */\n        'min_length': function( value, minSize ){\n            return ( (typeof value === 'string') && ( value.length >= parseInt(minSize,10) ) );\n        },\n\n        /**\n         * Checks if a value has a maximum length\n         *\n         * @method max_length\n         * @param  {String|Number}  maxSize Maximum number of characters.\n         * @return {Boolean}         True if the length of value is equal or smaller than the maximum chars defined. False if not.\n         */\n        'max_length': function( value, maxSize ){\n            return ( (typeof value === 'string') && ( value.length <= parseInt(maxSize,10) ) );\n        },\n\n        /**\n         * Checks if a value has an exact length\n         *\n         * @method exact_length\n         * @param  {String|Number}  exactSize   Exact number of characters.\n         * @return {Boolean}                    True if the length of value is equal to the size defined. False if not.\n         */\n        'exact_length': function( value, exactSize ){\n            return ( (typeof value === 'string') && ( value.length === parseInt(exactSize,10) ) );\n        },\n\n        /**\n         * Checks if a value is a valid email address\n         *\n         * @method email\n         * @return {Boolean}         True if the value is a valid email address. False if not.\n         */\n        'email': function( value ){\n            return ( ( typeof value === 'string' ) && InkValidator.mail( value ) );\n        },\n\n        /**\n         * Checks if a value has a valid URL\n         *\n         * @method url\n         * @param  {Boolean} fullCheck  Flag to validate a full url (with the protocol).\n         * @return {Boolean}            True if the URL is considered valid. False if not.\n         */\n        'url': function( value, fullCheck ){\n            fullCheck = fullCheck || false;\n            return ( (typeof value === 'string') && InkValidator.url( value, fullCheck ) );\n        },\n\n        /**\n         * Checks if a value is a valid IP. Supports ipv4 and ipv6\n         *\n         * @method ip\n         * @param  {String} ipType Type of IP to be validated. The values are: ipv4, ipv6. By default is ipv4.\n         * @return {Boolean}         True if the value is a valid IP address. False if not.\n         */\n        'ip': function( value, ipType ){\n            if( typeof value !== 'string' ){\n                return false;\n            }\n\n            return InkValidator.isIP(value, ipType);\n        },\n\n        /**\n         * Checks if a value is a valid phone number.\n         * Supports several countries, based in the Ink.Util.Validator class.\n         *\n         * @method phone\n         * @param  {String} phoneType Country's initials to specify the type of phone number to be validated. Ex: 'AO'.\n         * @return {Boolean}         True if it's a valid phone number. False if not.\n         */\n        'phone': function( value, phoneType ){\n            if( typeof value !== 'string' ){\n                return false;\n            }\n\n            var countryCode = phoneType ? phoneType.toUpperCase() : '';\n\n            return InkValidator['is' + countryCode + 'Phone'](value);\n        },\n\n        /**\n         * Checks if a value is a valid credit card.\n         *\n         * @method credit_card\n         * @param  {String} cardType Type of credit card to be validated. The card types available are in the Ink.Util.Validator class.\n         * @return {Boolean}         True if the value is a valid credit card number. False if not.\n         */\n        'credit_card': function( value, cardType ){\n            if( typeof value !== 'string' ){\n                return false;\n            }\n\n            return InkValidator.isCreditCard( value, cardType || 'default' );\n        },\n\n        /**\n         * Checks if a value is a valid date.\n         *\n         * @method date\n         * @param  {String} format Specific format of the date.\n         * @return {Boolean}         True if the value is a valid date. False if not.\n         */\n        'date': function( value, format ){\n            return ( (typeof value === 'string' ) && InkValidator.isDate(format, value) );\n        },\n\n        /**\n         * Checks if a value only contains alphabetical values.\n         *\n         * @method alpha\n         * @param  {Boolean} supportSpaces  Allow whitespace\n         * @return {Boolean}                True if the value is alphabetical-only. False if not.\n         */\n        'alpha': function( value, supportSpaces ){\n            return InkValidator.ascii(value, {singleLineWhitespace: supportSpaces});\n        },\n\n        /*\n         * Checks if a value contains only printable BMP unicode characters\n         * Optionally allow punctuation and whitespace\n         *\n         * @method text\n         * @return {Boolean}        Whether the value only contains printable text characters\n         **/\n        'text': function (value, whitespace, punctuation) {\n            return InkValidator.unicode(value, {\n                singleLineWhitespace: whitespace,\n                unicodePunctuation: punctuation});\n        },\n\n        /*\n         * Checks if a value contains only printable latin-1 text characters.\n         * Optionally allow punctuation and whitespace.\n         *\n         * @method text\n         * @return {Boolean}        Whether the value only contains printable text characters\n         **/\n        'latin': function (value, punctuation, whitespace) {\n            if ( typeof value !== 'string') { return false; }\n            return InkValidator.latin1(value, {latin1Punctuation: punctuation, singleLineWhitespace: whitespace});\n        },\n\n        /**\n         * Checks if a value contains only alphabetical or numerical characters.\n         *\n         * @method alpha_numeric\n         * @return {Boolean}         True if the value is a valid alphanumerical. False if not.\n         */\n        'alpha_numeric': function( value ){\n            return InkValidator.ascii(value, {numbers: true});\n        },\n\n        /**\n         * Checks if a value contains only alphabetical, dash or underscore characteres.\n         *\n         * @method alpha_dash\n         * @return {Boolean}         True if the value is a valid. False if not.\n         */\n        'alpha_dash': function( value ){\n            return InkValidator.ascii(value, {dash: true, underscore: true});\n        },\n\n        /**\n         * Checks if a value is a single digit.\n         *\n         * @method digit\n         * @return {Boolean}         True if the value is a valid digit. False if not.\n         */\n        'digit': function( value ){\n            return ((typeof value === 'string') && /^[0-9]{1}$/.test(value));\n        },\n\n        /**\n         * Checks if a value is a valid integer.\n         *\n         * @method integer\n         * @param  {String} positive Flag that specifies if the integer is must be positive (unsigned).\n         * @return {Boolean}         True if the value is a valid integer. False if not.\n         */\n        'integer': function( value, positive ){\n            return InkValidator.number(value, {\n                negative: !positive,\n                decimalPlaces: 0\n            });\n        },\n\n        /**\n         * Checks if a value is a valid decimal number.\n         *\n         * @method decimal\n         * @param  {String} decimalSeparator Character that splits the integer part from the decimal one. By default is '.'.\n         * @param  {String} [decimalPlaces] Maximum number of digits that the decimal part must have.\n         * @param  {String} [leftDigits] Maximum number of digits that the integer part must have, when provided.\n         * @return {Boolean}         True if the value is a valid decimal number. False if not.\n         */\n        'decimal': function( value, decimalSeparator, decimalPlaces, leftDigits ){\n            return InkValidator.number(value, {\n                decimalSep: decimalSeparator || '.',\n                decimalPlaces: +decimalPlaces || null,\n                maxDigits: +leftDigits\n            });\n        },\n\n        /**\n         * Checks if a value is a numeric value.\n         *\n         * @method numeric\n         * @param  {String} decimalSeparator    Checks if it's a valid decimal. Otherwise checks if it's a valid integer.\n         * @param  {String} [decimalPlaces]     Maximum number of digits the decimal part must have.\n         * @param  {String} [leftDigits]        Maximum number of digits the integer part must have, when provided.\n         * @return {Boolean}         True if the value is numeric. False if not.\n         */\n        'numeric': function( value, decimalSeparator, decimalPlaces, leftDigits ){\n            decimalSeparator = decimalSeparator || '.';\n            if( value.indexOf(decimalSeparator) !== -1  ){\n                return validationFunctions.decimal( value, decimalSeparator, decimalPlaces, leftDigits );\n            } else {\n                return validationFunctions.integer( value );\n            }\n        },\n\n        /**\n         * Checks if a value is in a specific range of values.\n         * The parameters after the first one are used to specify the range, and are similar in function to python's range() function.\n         *\n         * @method range\n         * @param  {String} minValue        Left limit of the range.\n         * @param  {String} maxValue        Right limit of the range.\n         * @param  {String} [multipleOf]    In case you want numbers that are only multiples of another number.\n         * @return {Boolean}                True if the value is within the range. False if not.\n         */\n        'range': function( value, minValue, maxValue, multipleOf ){\n            value = +value;\n            minValue = +minValue;\n            maxValue = +maxValue;\n\n            if (isNaN(value) || isNaN(minValue) || isNaN(maxValue)) {\n                return false;\n            }\n\n            if( value < minValue || value > maxValue ){\n                return false;\n            }\n\n            if (multipleOf) {\n                return (value - minValue) % multipleOf === 0;\n            } else {\n                return true;\n            }\n        },\n\n        /**\n         * Checks if a value is a valid color.\n         *\n         * @method color\n         * @return {Boolean}         True if the value is a valid color. False if not.\n         */\n        'color': function( value ){\n            return InkValidator.isColor(value);\n        },\n\n        /**\n         * Checks if a value matches the value of a different field.\n         *\n         * @method matches\n         * @param  {String} fieldToCompare  Name or ID of the field to compare.\n         * @return {Boolean}         True if the values match. False if not.\n         */\n        'matches': function( value, fieldToCompare ){\n            return ( value === this.getFormElements()[fieldToCompare][0].getValue() );\n        }\n\n    };\n\n    /**\n     * Error messages for the validation functions above\n     * @private\n     * @static\n     */\n    var validationMessages = new I18n({\n        en_US: {\n            'formvalidator.required' : 'The {field} filling is mandatory',\n            'formvalidator.min_length': 'The {field} must have a minimum size of {param1} characters',\n            'formvalidator.max_length': 'The {field} must have a maximum size of {param1} characters',\n            'formvalidator.exact_length': 'The {field} must have an exact size of {param1} characters',\n            'formvalidator.email': 'The {field} must have a valid e-mail address',\n            'formvalidator.url': 'The {field} must have a valid URL',\n            'formvalidator.ip': 'The {field} does not contain a valid {param1} IP address',\n            'formvalidator.phone': 'The {field} does not contain a valid {param1} phone number',\n            'formvalidator.credit_card': 'The {field} does not contain a valid {param1} credit card',\n            'formvalidator.date': 'The {field} should contain a date in the {param1} format',\n            'formvalidator.alpha': 'The {field} should only contain letters',\n            'formvalidator.text': 'The {field} should only contain alphabetic characters',\n            'formvalidator.latin': 'The {field} should only contain alphabetic characters',\n            'formvalidator.alpha_numeric': 'The {field} should only contain letters or numbers',\n            'formvalidator.alpha_dash': 'The {field} should only contain letters or dashes',\n            'formvalidator.digit': 'The {field} should only contain a digit',\n            'formvalidator.integer': 'The {field} should only contain an integer',\n            'formvalidator.decimal': 'The {field} should contain a valid decimal number',\n            'formvalidator.numeric': 'The {field} should contain a number',\n            'formvalidator.range': 'The {field} should contain a number between {param1} and {param2}',\n            'formvalidator.color': 'The {field} should contain a valid color',\n            'formvalidator.matches': 'The {field} should match the field {param1}',\n            'formvalidator.validation_function_not_found': 'The rule {rule} has not been defined'\n        },\n        pt_PT: {\n            'formvalidator.required' : 'Preencher {field}  obrigatrio',\n            'formvalidator.min_length': '{field} deve ter no mnimo {param1} caracteres',\n            'formvalidator.max_length': '{field} tem um tamanho mximo de {param1} caracteres',\n            'formvalidator.exact_length': '{field} devia ter exactamente {param1} caracteres',\n            'formvalidator.email': '{field} deve ser um e-mail vlido',\n            'formvalidator.url': 'O {field} deve ser um URL vlido',\n            'formvalidator.ip': '{field} no tem um endereo IP {param1} vlido',\n            'formvalidator.phone': '{field} deve ser preenchido com um nmero de telefone {param1} vlido.',\n            'formvalidator.credit_card': '{field} no tem um carto de crdito {param1} vlido',\n            'formvalidator.date': '{field} deve conter uma data no formato {param1}',\n            'formvalidator.alpha': 'O campo {field} deve conter apenas caracteres alfabticos',\n            'formvalidator.text': 'O campo {field} deve conter apenas caracteres alfabticos',\n            'formvalidator.latin': 'O campo {field} deve conter apenas caracteres alfabticos',\n            'formvalidator.alpha_numeric': '{field} deve conter apenas letras e nmeros',\n            'formvalidator.alpha_dash': '{field} deve conter apenas letras e traos',\n            'formvalidator.digit': '{field} destina-se a ser preenchido com apenas um dgito',\n            'formvalidator.integer': '{field} deve conter um nmero inteiro',\n            'formvalidator.decimal': '{field} deve conter um nmero vlido',\n            'formvalidator.numeric': '{field} deve conter um nmero vlido',\n            'formvalidator.range': '{field} deve conter um nmero entre {param1} e {param2}',\n            'formvalidator.color': '{field} deve conter uma cor vlida',\n            'formvalidator.matches': '{field} deve corresponder ao campo {param1}',\n            'formvalidator.validation_function_not_found': '[A regra {rule} no foi definida]'\n        }\n    }, 'en_US');\n\n    /**\n     * A FormElement represents a single form element to be validated.\n     *\n     * It is constructed with a DOM form element, and options.\n     *\n     * This class contains methods to parse rules and apply them to its element,\n     * and also formats the error messages to be displayed in case of an error.\n     *\n     * You don't normally call \"new FormElement\" yourself. This is done\n     * internally.\n     *\n     * @class FormValidator.FormElement\n     * @constructor\n     * @param  {DOMElement} element DOM Element\n     * @param  {Object} options Object with configuration options\n     * @param  {String} [options.label] Label for this element. It is used in the error message. If not specified, the text in the `label` tag in the control-group is used.\n     * @param  {String} [options.rules] Rules string to be parsed.\n     * @param  {FormValidator} options.form FormValidator instance.\n     */\n    function FormElement(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    FormElement._name = 'FormElement_1';\n\n    FormElement._optionDefinition = {\n        label: ['String', null],\n        rules: ['String', null], // The rules to apply\n        form: ['Object']\n    };\n\n    /**\n     * FormElement's prototype\n     */\n    FormElement.prototype = {\n        _init: function () {\n            this._errors = {};\n            this._rules = {};\n            this._value = null;\n\n            if (this._options.label === null) {\n                this._options.label = this._getLabel();\n            }\n        },\n\n        /**\n         * Function to get the label that identifies the field.\n         * If it can't find one, it will use the name or the id\n         * (depending on what is defined)\n         *\n         * @method _getLabel\n         * @return {String} Label to be used in the error messages\n         * @private\n         */\n        _getLabel: function(){\n            var label = Element.findUpwardsBySelector(this._element,'.control-group label');\n\n            if( label ){\n                return Element.textContent(label);\n            } else {\n                return this._element.name || this._element.id || '';\n            }\n        },\n\n        /**\n         * Function to parse a rules' string.\n         * Ex: required|number|max_length[30]\n         *\n         * @method _parseRules\n         * @param  {String} rules String with the rules\n         * @private\n         */\n        _parseRules: function( rules ){\n            this._rules = {};\n            rules = rules.split(\"|\");\n            var i, rulesLength = rules.length, rule, params, paramStartPos ;\n            if( rulesLength > 0 ){\n                for( i = 0; i < rulesLength; i++ ){\n                    rule = rules[i];\n                    if( !rule ){\n                        continue;\n                    }\n\n                    if( ( paramStartPos = rule.indexOf('[') ) !== -1 ){\n                        params = rule.substr( paramStartPos+1 );\n                        params = params.split(']');\n                        params = params[0];\n                        params = params.split(',');\n                        for (var p = 0, len = params.length; p < len; p++) {\n                            params[p] =\n                                params[p] === 'true' ? true :\n                                params[p] === 'false' ? false :\n                                params[p];\n                        }\n                        params.splice(0,0,this.getValue());\n\n                        rule = rule.substr(0,paramStartPos);\n\n                        this._rules[rule] = params;\n                    } else {\n                        this._rules[rule] = [this.getValue()];\n                    }\n                }\n            }\n        },\n\n        /**\n         * Function to add an error to the FormElement's 'errors' object.\n         * It basically receives the rule where the error occurred, the parameters passed to it (if any)\n         * and the error message.\n         * Then it replaces some tokens in the message for a more 'custom' reading\n         *\n         * @method _addError\n         * @param  {String|null} rule    Rule that failed, or null if no rule was found.\n         * @private\n         * @static\n         */\n        _addError: function(rule){\n            var params = this._rules[rule] || [];\n\n            var paramObj = {\n                field: this._options.label,\n                value: this.getValue()\n            };\n\n            for( var i = 1; i < params.length; i++ ){\n                paramObj['param' + i] = params[i];\n            }\n\n            var i18nKey = 'formvalidator.' + rule;\n\n            this._errors[rule] = validationMessages.text(i18nKey, paramObj);\n\n            if (this._errors[rule] === i18nKey) {\n                this._errors[rule] = 'Validation message not found';\n            }\n        },\n\n        /**\n         * Gets an element's value\n         *\n         * @method getValue\n         * @return {mixed} The DOM Element's value\n         * @public\n         */\n        getValue: function(){\n            // TODO this is already implemented in FormSerialize.\n\n            switch(this._element.nodeName.toLowerCase()){\n                case 'select':\n                    return Ink.s('option:selected',this._element).value;\n                case 'textarea':\n                    return this._element.value;\n                case 'input':\n                    if( \"type\" in this._element ){\n                        if( (this._element.type === 'radio') || (this._element.type === 'checkbox') ){\n                            if( this._element.checked ){\n                                return this._element.value;\n                            }\n                        } else if( this._element.type !== 'file' ){\n                            return this._element.value;\n                        }\n                    } else {\n                        return this._element.value;\n                    }\n                    return;\n                default:\n                    return this._element.innerHTML;\n            }\n        },\n\n        /**\n         * Gets the constructed errors' object.\n         *\n         * @method getErrors\n         * @return {Object} Errors' object\n         * @public\n         */\n        getErrors: function(){\n            return this._errors;\n        },\n\n        /**\n         * Gets the DOM element related to the instance.\n         *\n         * @method getElement\n         * @return {Object} DOM Element\n         * @public\n         */\n        getElement: function(){\n            return this._element;\n        },\n\n        /**\n         * Gets other elements in the same form.\n         *\n         * @method getFormElements\n         * @return {Object} A mapping of keys to other elements in this form.\n         * @public\n         */\n        getFormElements: function () {\n            return this._options.form._formElements;\n        },\n\n        /**\n         * Validates the element based on the rules defined.\n         * It parses the rules defined in the _options.rules property.\n         *\n         * @method validate\n         * @return {Boolean} True if every rule was valid. False if one fails.\n         * @public\n         */\n        validate: function(){\n            this._errors = {};\n\n            if( \"rules\" in this._options || 1){\n                this._parseRules( this._options.rules );\n            }\n            \n            if( (\"required\" in this._rules) || (this.getValue() !== '') ){\n                for(var rule in this._rules) {\n                    if (this._rules.hasOwnProperty(rule)) {\n                        if( (typeof validationFunctions[rule] === 'function') ){\n                            if( validationFunctions[rule].apply(this, this._rules[rule] ) === false ){\n\n                                this._addError( rule );\n                                return false;\n\n                            }\n\n                        } else {\n                            Ink.warn('Rule \"' + rule + '\" not found. Used in element:', this._element);\n                            this._addError( null );\n                            return false;\n                        }\n                    }\n                }\n            }\n\n            return true;\n\n        }\n    };\n\n    Common.createUIComponent(FormElement);\n\n\n    /**\n     * @class FormValidator_2\n     * @constructor\n     * @param {String|DOMElement}   selector                        Either a CSS Selector string, or the form's DOMElement\n     * @param {Object}              [options]                       Options object, containing the following options:\n     * @param {String}              [options.eventTrigger]          Event that will trigger the validation. Defaults to 'submit'.\n     * @param {Boolean}             [options.neverSubmit]           Flag to cancel the submit event. Use this to avoid submitting the form.\n     * @param {Selector}            [options.searchFor]             Selector containing the validation data-attributes. Defaults to 'input, select, textarea, .control-group'.\n     * @param {Function}            [options.beforeValidation]      Callback to be executed before validating the form\n     * @param {Function}            [options.onError]               Validation error callback\n     * @param {Function}            [options.onSuccess]             Validation success callback\n     *\n     * @sample Ink_UI_FormValidator_2.html\n     */\n    function FormValidator(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    FormValidator._name = 'FormValidator_1';\n\n    FormValidator._optionDefinition = {\n        eventTrigger: ['String', 'submit'],\n        neverSubmit: ['Boolean', 'false'],\n        searchFor: ['String', 'input, select, textarea, .control-group'],\n        beforeValidation: ['Function', undefined],\n        onError: ['Function', undefined],\n        onSuccess: ['Function', undefined]\n    };\n\n    /**\n     * Sets or modifies validation functions\n     *\n     * @method setRule\n     * @param {String}   name         Name of the function. E.g. 'required'\n     * @param {String}   errorMessage Error message to be displayed in case of returning false. E.g. 'Oops, you passed {param1} as parameter1, lorem ipsum dolor...'\n     * @param {Function} cb           Function to be executed when calling this rule\n     * @public\n     * @static\n     */\n    FormValidator.setRule = function( name, errorMessage, cb ){\n        validationFunctions[ name ] = cb;\n        if (validationMessages.getKey('formvalidator.' + name) !== errorMessage) {\n            var langObj = {}; langObj['formvalidator.' + name] = errorMessage;\n            var dictObj = {}; dictObj[validationMessages.lang()] = langObj;\n            validationMessages.append(dictObj);\n        }\n    };\n\n    /**\n     * Gets the i18n object in charge of the error messages\n     *\n     * @method getI18n\n     * @static\n     * @return {Ink.Util.I18n} The i18n object the FormValidator is using.\n     */\n    FormValidator.getI18n = function () {\n        return validationMessages;\n    };\n\n    /**\n     * Sets the I18n object for validation error messages\n     *\n     * @method setI18n\n     * @static\n     * @param {Ink.Util.I18n} i18n  The I18n object.\n     */\n    FormValidator.setI18n = function (i18n) {\n        validationMessages = i18n;\n    };\n\n   /**\n     * Add to the I18n dictionary.\n     * See `Ink.Util.I18n.append()` documentation.\n     *\n     * @method appendI18n\n     * @static\n     */\n    FormValidator.appendI18n = function () {\n        validationMessages.append.apply(validationMessages, [].slice.call(arguments));\n    };\n\n    /**\n     * Sets the language of the error messages.\n     * pt_PT and en_US are available, but you can add new languages by using append()\n     *\n     * See the `Ink.Util.I18n.lang()` setter\n     *\n     * @method setLanguage\n     * @static\n     * @param language  The language to set i18n to.\n     */\n    FormValidator.setLanguage = function (language) {\n        validationMessages.lang(language);\n    };\n\n    /**\n     * Method used to get the existing defined validation functions\n     *\n     * @method getRules\n     * @return {Object} Object with the rules defined\n     * @public\n     * @static\n     */\n    FormValidator.getRules = function(){\n        return validationFunctions;\n    };\n\n    FormValidator.prototype = {\n        _init: function(){\n            /**\n             * DOMElement of the form being validated\n             *\n             * @property _rootElement\n             * @type {DOMElement}\n             */\n            this._rootElement = this._element;\n\n            /**\n             * Object that will gather the form elements by name\n             *\n             * @property _formElements\n             * @type {Object}\n             */\n            this._formElements = {};\n\n            /**\n             * Error message DOMElements\n             * \n             * @property _errorMessages\n             */\n            this._errorMessages = [];\n\n            /**\n             * Array of elements marked with validation errors\n             *\n             * @property _markedErrorElements\n             */\n            this._markedErrorElements = [];\n\n            // Sets an event listener for a specific event in the form, if defined.\n            // By default is the 'submit' event.\n            if( typeof this._options.eventTrigger === 'string' ){\n                Event.observe(\n                    this._rootElement,\n                    this._options.eventTrigger,\n                    Ink.bindEvent(this.validate,this) );\n            }\n\n        },\n\n        /**\n         * Searches for the elements in the form.\n         * This method is based in the this._options.searchFor configuration.\n         *\n         * @method getElements\n         * @return {Object} An object with the elements in the form, indexed by name/id\n         * @public\n         */\n        getElements: function(){\n            this._formElements = {};\n            var formElements = Selector.select( this._options.searchFor, this._rootElement );\n            if( formElements.length ){\n                var i, element;\n                for( i=0; i<formElements.length; i+=1 ){\n                    element = formElements[i];\n\n                    var dataAttrs = Element.data( element );\n\n                    if( !(\"rules\" in dataAttrs) ){\n                        continue;\n                    }\n\n                    var options = {\n                        form: this\n                    };\n\n                    var key;\n                    if( (\"name\" in element) && element.name ){\n                        key = element.name;\n                    } else if( (\"id\" in element) && element.id ){\n                        key = element.id;\n                    } else {\n                        key = 'element_' + Math.floor(Math.random()*100);\n                        element.id = key;\n                    }\n\n                    if( !(key in this._formElements) ){\n                        this._formElements[key] = [];\n                    }\n\n                    this._formElements[key].push( new FormElement( element, options ) );\n                }\n            }\n\n            return this._formElements;\n        },\n\n        /**\n         * Validates every registered FormElement \n         * This method looks inside the this._formElements object for validation targets.\n         * Also, based on the this._options.beforeValidation, this._options.onError, and this._options.onSuccess, this callbacks are executed when defined.\n         *\n         * @method validate\n         * @param  {Event} event    Window.event object\n         * @return {Boolean} Whether the form is considered valid\n         * @public\n         */\n        validate: function( event ) {\n\n            if(this._options.neverSubmit+'' === 'true' && event) {\n                Event.stopDefault(event);\n            }\n\n            if( typeof this._options.beforeValidation === 'function' ){\n                this._options.beforeValidation();\n            }\n\n            InkArray.each( this._markedErrorElements, function (errorElement) {\n                Css.removeClassName(errorElement,  ['validation', 'error']);\n            });\n            InkArray.each( this._errorMessages, Element.remove);\n\n            this.getElements();\n            var errorElements = [];\n\n            for( var key in this._formElements ){\n                if( this._formElements.hasOwnProperty(key) ){\n                    for( var counter = 0; counter < this._formElements[key].length; counter+=1 ){\n                        if( !this._formElements[key][counter].validate() ) {\n                            errorElements.push(this._formElements[key][counter]);\n                        }\n                    }\n                }\n            }\n            \n            if( errorElements.length === 0 ){\n                if( typeof this._options.onSuccess === 'function' ){\n                    this._options.onSuccess();\n                }\n\n                // [3.0.0] remove this, it's a little backwards compat quirk\n                if(event && this._options.cancelEventOnSuccess + '' === 'true') {\n                    Event.stopDefault(event);\n                    return false;\n                }\n\n                return true;\n            } else {\n\n                if(event) {\n                    Event.stopDefault(event);\n                }\n\n                if( typeof this._options.onError === 'function' ){\n                    this._options.onError( errorElements );\n                }\n                this._errorMessages = [];\n                this._markedErrorElements = [];\n\n                InkArray.each( errorElements, Ink.bind(function( formElement ){\n                    var controlGroupElement;\n                    var controlElement;\n                    if( Css.hasClassName(formElement.getElement(),'control-group') ){\n                        controlGroupElement = formElement.getElement();\n                        controlElement = Ink.s('.control',formElement.getElement());\n                    } else {\n                        controlGroupElement = Element.findUpwardsByClass(formElement.getElement(),'control-group');\n                        controlElement = Element.findUpwardsByClass(formElement.getElement(),'control');\n                    }\n\n                    if(controlGroupElement) {\n                        Css.addClassName( controlGroupElement, ['validation', 'error'] );\n                        this._markedErrorElements.push(controlGroupElement);\n                    }\n\n                    var paragraph = document.createElement('p');\n                    Css.addClassName(paragraph,'tip');\n                    if (controlElement || controlGroupElement) {\n                        (controlElement || controlGroupElement).appendChild(paragraph);\n                    } else {\n                        Element.insertAfter(paragraph, formElement.getElement());\n                    }\n\n                    var errors = formElement.getErrors();\n                    var errorArr = [];\n                    for (var k in errors) {\n                        if (errors.hasOwnProperty(k)) {\n                            errorArr.push(errors[k]);\n                        }\n                    }\n                    paragraph.innerHTML = errorArr.join('<br/>');\n                    this._errorMessages.push(paragraph);\n                }, this));\n                return false;\n            }\n        }\n    };\n\n    Common.createUIComponent(FormValidator);\n\n    /**\n     * Returns the FormValidator's Object\n     */\n    return FormValidator;\n\n});\n","/**\n * Responsive image loading\n * @module Ink.UI.ImageQuery_1\n * @version 1\n */\n \nInk.createModule('Ink.UI.ImageQuery', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Element_1','Ink.Util.Array_1'], function(Common, Event, Element, InkArray ) {\n    'use strict';\n\n    /**\n     * @class Ink.UI.ImageQuery\n     * @constructor\n     * @version 1\n     *\n     * @param {String|DOMElement}   selector                    Selector or element\n     * @param {Object}              [options]                   Options object\n     * @param {String|Function}     [options.src]               String or Callback function (that returns a string) with the path to be used to get the images.\n     * @param {String|Function}     [options.retina]            String or Callback function (that returns a string) with the path to be used to get RETINA specific images.\n     * @param {Array}               [options.queries]           Array of queries\n     * @param {String}              [options.queries.label]     Label of the query. Ex. 'small'\n     * @param {Number}              [options.queries.width]     Min-width to use this query\n     * @param {Function}            [options.onLoad]            Date format string\n     *\n     * @sample Ink_UI_ImageQuery_1.html\n     */\n    function ImageQuery() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    ImageQuery._name = 'ImageQuery_1';\n\n\tImageQuery._optionDefinition = {\n\t\tsrc: ['String'],\n\t\tretina: ['String', undefined],\n\t\tqueries: ['Object'],\n\t\tonLoad: ['Function', null]\n\t};\n\n    ImageQuery.prototype = {\n\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function(){\n            // /**\n            //  * Get elements, create more ImageQueries if selector finds more than one\n            //  *\n            //  * [improvement] This is a useful pattern. More UI modules could use it.\n            //  */\n            // this._element = Common.elsOrSelector(selector, 'Ink.UI.ImageQuery', /*required=*/true);\n\n            // // In case we have several elements\n            // for (var i = 1 /* start from second element*/; i < this._element.length; i++) {\n            //     new ImageQuery(this._element[i], options);\n            // }\n\n            // this._element = this._element[0];\n            /**\n             * Determining the original basename (with the querystring) of the file.\n             */\n            var pos;\n            if( (pos=this._element.src.lastIndexOf('?')) !== -1 ){\n                var search = this._element.src.substr(pos);\n                this._filename = this._element.src.replace(search,'').split('/').pop()+search;\n            } else {\n                this._filename = this._element.src.split('/').pop();\n            }\n\n            if (!this._options.queries) { this._options.queries = []; }\n\n            // Sort queries by width, in descendant order.\n            this._options.queries = InkArray.sortMulti(this._options.queries, 'width').reverse();\n\n            if( typeof this._options.onLoad === 'function' ){\n                Event.observe(this._element, 'onload', Ink.bindEvent(this._onLoad, this));\n            }\n\n            // Imediate call to apply the right images based on the current viewport\n            this._onResize();\n\n            Event.observe(window, 'resize', Event.throttle(Ink.bindMethod(this, '_onResize'), 400));\n        },\n\n        /**\n         * Handles the resize event (as specified in the _init function)\n         *\n         * @method _onResize\n         * @private\n         */\n        _onResize: function(){\n            if( !this._options.queries.length ){\n                return;\n            }\n\n            var current = this._findCurrentQuery();\n\n            /**\n             * Choosing the right src. The rule is:\n             *\n             *   \"If there is specifically defined in the query object, use that. Otherwise uses the global src.\"\n             *\n             * The above rule applies to a retina src.\n             */\n            var src = current.src || this._options.src;\n\n            if ( window.devicePixelRatio > 1 && (this._options.retina !== undefined) ) {\n                src = current.retina || this._options.retina;\n            }\n\n            /**\n             * Injects the file variable for usage in the 'templating system' below\n             */\n            current.file = this._filename;\n\n            /**\n             * Since we allow the src to be a callback, let's run it and get the results.\n             * For the inside, we're passing the element (img) being processed and the object of the selected query.\n             */\n            if( typeof src === 'function' ){\n                src = src.apply(this,[this._element,current]);\n                if( typeof src !== 'string' ){\n                    throw '[ImageQuery] :: \"src\" callback does not return a string';\n                }\n            }\n\n            /**\n             * Replace the values of the existing properties on the query object (except src and retina) in the\n             * defined src and/or retina.\n             */\n            src = src.replace(/{:(.*?)}/g, function(_, prop) {\n                return current[prop];\n            });\n\n            this._element.src = src;\n\n            // Removes the injected file property\n            delete current.file;\n        },\n\n        /**\n         * Queries are in a descendant order. We want to find the query with the highest width that fits the viewport, therefore the first one.\n         */\n        _findCurrentQuery: function () {\n            /**\n             * Gets viewport width\n             */\n            var viewportWidth = window.innerWidth ||\n                document.documentElement.clientWidth ||\n                document.body.clientWidth;\n\n            var queries = this._options.queries;\n            var last = queries.length - 1;\n\n            for( var query=0; query < last; query+=1 ){\n                if (queries[query].width <= viewportWidth){\n                    return queries[query];\n                }\n            }\n\n            return queries[last];\n        },\n\n        /**\n         * Handles the element loading (img onload) event\n         *\n         * @method _onLoad\n         * @private\n         */\n        _onLoad: function(){\n\n            /**\n             * Since we allow a callback for this let's run it.\n             */\n            this._options.onLoad.call(this);\n        }\n\n    };\n\n\tCommon.createUIComponent(ImageQuery);\n\n    return ImageQuery;\n\n});\n","/**\n * Delays content loading\n * @module Ink.UI.LazyLoad_1\n * @version 1\n */\n\nInk.createModule('Ink.UI.LazyLoad', '1', ['Ink.UI.Common_1', 'Ink.Dom.Event_1', 'Ink.Dom.Element_1'], function(Common, InkEvent, InkElement) {\n'use strict';\n\nfunction LazyLoad() {\n    Common.BaseUIComponent.apply(this, arguments);\n}\n\nLazyLoad._name = 'LazyLoad_1';\n\nLazyLoad._optionDefinition = {\n    item: ['String', '.lazyload-item'],\n    placeholder: ['String', null],\n    source: ['String', 'data-src'],\n    destination: ['String', 'src'],\n    delay: ['Number', 100],\n    delta: ['Number', 0],\n    image: ['Boolean', true],\n    scrollElement: ['Element', window],\n    touchEvents: ['Boolean', true],\n    onInsideViewport: ['Function', false],\n    onAfterAttributeChange: ['Function', false],\n    autoInit: ['Boolean', true]\n};\n\nLazyLoad.prototype = {\n    /**\n     * Stops the browser from loading a barrage of content at once.\n     *\n     * This delays the loading of images and other content until the corresponding elements are visible in the browser viewport.\n     * This was created to load images later, but can be also used for widgets which are slow to load and are only useful when on screen.\n     *\n     * This works through copying the `src` attribute into `data-src`, and placing a `placeholder` string in the `src` attribute. Then, when the element is on screen, the `data-src` attribute is copied back to `src` and the content starts loading. You can use the options below to change what attributes are involved in the exchange.\n     *\n     * You can also provide your `onInsideViewport` callback and use it to start widgets which need javascript, such as an interactive map or an animation.\n     *\n     * @class Ink.UI.LazyLoad_1\n     * @constructor\n     *\n     * @param rootElement {String|DOMElement} The element which contains the lazily-loaded items.\n     * @param {Object}      [options]                           Options object, containing:\n     * @param {String}      [options.item]                      Item selector. Defaults to '.lazyload-item'.\n     * @param {String}      [options.placeholder]               Placeholder value for items which are not 'visible', in case they don't already have a value set.\n     * @param {String}      [options.source]                    Source attribute. When an item is 'visible', use this attribute's value to set its destination attribute. Defaults to 'data-src'.\n     * @param {String}      [options.destination]               Destination attribute. Attribute to change when the element is 'visible'. Defaults to 'src'. \n     * @param {Number}      [options.delay]                     Milliseconds to wait before trying to load items. Defaults to 100.\n     * @param {Number}      [options.delta]                     Offset distance in pixels. Determines how far the top of an item must be from the viewport be considered 'visible'. Negative values shrink the considered 'visible' viewport while positive values enlarge it. Defaults to 0.\n     * @param {Boolean}     [options.image]                     Set to false to make this component do nothing to any elements and just give you the onInsideViewport callback.\n     * @param {DOMElement}  [options.scrollElement]             (advanced) What element is to be listened for the scroll event. Defaults to document.window.\n     * @param {Boolean}     [options.touchEvents]               Subscribe to touch events in addition to scroll events. Useful in mobile safari because 'scroll' events aren't frequent enough. Defaults to true.\n     * @param {Function}    [options.onInsideViewport]          Callback function for when an `item` is 'visible'. Receives an object containing the item's element as an argument.\n     * @param {Function}    [options.onAfterAttributeChange]    (advanced) Callback function when an item's attribute changes. Receives an object containing the item's element as an argument.\n     * @param {Boolean}     [options.autoInit]                  (advanced) Set to false if you want to start LazyLoad yourself with `reload()`. Defaults to true.\n     *\n     * @sample Ink_UI_LazyLoad_1.html\n     */\n    _init: function() {\n        this._rootElm = this._element;\n\n        this._aData = [];\n        this._hasEvents = false;\n   \n        if(this._options.autoInit) {\n            this._activate();\n        }\n    },\n\n    _activate: function() \n    {\n        this._getData();\n        if(!this._hasEvents) {\n            this._addEvents(); \n        }\n        this._onScrollThrottled();\n    },\n\n    _getData: function()\n    {\n        var aElms = Ink.ss(this._options.item);\n        var attr = null;\n        for(var i=0, t=aElms.length; i < t; i++) {\n            if (this._options.placeholder != null && !InkElement.hasAttribute(aElms[i], this._options.destination)) {\n                aElms[i].setAttribute(this._options.destination, this._options.placeholder);\n            }\n            attr = aElms[i].getAttribute(this._options.source);\n            if(attr !== null || !this._options.image) {\n                this._aData.push({elm: aElms[i], original: attr});\n            }\n        }\n    },\n\n    _addEvents: function() \n    {\n        this._onScrollThrottled = InkEvent.throttle(Ink.bindEvent(this._onScroll, this), this._options.delay);\n        if('ontouchmove' in document.documentElement && this._options.touchEvents) {\n            InkEvent.observe(document.documentElement, 'touchmove', this._onScrollThrottled);\n        }\n        InkEvent.observe(this._options.scrollElement, 'scroll', this._onScrollThrottled);\n        this._hasEvents = true;\n    },\n\n    _removeEvents: function() {\n        if('ontouchmove' in document.documentElement && this._options.touchEvents) {\n            InkEvent.stopObserving(document.documentElement, 'touchmove', this._onScrollThrottled);\n        }\n        InkEvent.stopObserving(this._options.scrollElement, 'scroll', this._onScrollThrottled);\n        this._hasEvents = false;\n    }, \n\n    _onScroll: function() {\n        var curElm;\n\n        for(var i=0; i < this._aData.length; i++) {\n            curElm = this._aData[i];\n\n            if(InkElement.inViewport(curElm.elm, { partial: true, margin: this._options.delta })) {\n                this._elInViewport(curElm);\n                if (this._options.image) {\n                    /* [todo] a seemingly unrelated option creates a branch? Some of this belongs in another module. */\n                    this._aData.splice(i, 1);\n                    i -= 1;\n                }\n            }\n        }\n\n        if (this._aData.length === 0) {\n            this._removeEvents();\n        }\n    },\n\n    /**\n     * Called when an element is detected inside the viewport\n     *\n     * @method _elInViewport\n     * @param {LazyLoadInternalElementData} curElm\n     * @private\n     **/\n    _elInViewport: function (curElm) {\n        this._userCallback('onInsideViewport', { element: curElm.elm });\n\n        if(this._options.image) {\n            curElm.elm.setAttribute(this._options.destination, curElm.original);\n            curElm.elm.removeAttribute(this._options.source);\n        }\n\n        this._userCallback('onAfterAttributeChange', { element: curElm.elm });\n    },\n\n    /**\n     * Call a callback if it exists and its `typeof` is `\"function\"`.\n     * @method _userCallback\n     * @param name {String} Callback name in this._options.\n     * @private\n     **/\n    _userCallback: function (name) {\n        if (typeof this._options[name] === 'function') {\n            this._options[name].apply(this, [].slice.call(arguments, 1));\n        }\n    },\n\n    /**\n     * Load or reload the component.\n     * Adding the 'scroll' event listener if necessary and checks if anything needs to be loaded now.\n     *\n     * You can use this to manually invoke the loading logic without user action. \n     *\n     * @method reload\n     * @public\n     */\n    reload: function() {\n        this._activate(); \n    },\n\n    /**\n     * Destroy this component\n     * @method destroy\n     * @public\n     **/\n    destroy: function() {\n        if(this._hasEvents) {\n            this._removeEvents();\n        }\n        Common.destroyComponent.call(this);\n    }\n};\n\nCommon.createUIComponent(LazyLoad);\n\nreturn LazyLoad;\n\n});\n","/**\n * Modal dialog prompts\n * @module Ink.UI.Modal_1\n * @version 1\n */\nInk.createModule('Ink.UI.Modal', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1','Ink.Util.Array_1'], function(Common, Event, Css, InkElement, Selector, InkArray ) {\n    'use strict';\n\n    var opacitySupported = (function (div) {\n        div.style.opacity = 'invalid';\n        return div.style.opacity !== 'invalid';\n    }(InkElement.create('div', {style: 'opacity: 1'})));\n\n    /**\n     * @class Ink.UI.Modal\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector                        Element or ID\n     * @param {Object}              [options]                       Options object, containing:\n     * @param {String}              [options.width]                 Default/Initial width. Ex: '600px'\n     * @param {String}              [options.height]                Default/Initial height. Ex: '400px'\n     * @param {String}              [options.shadeClass]            Custom class to be added to the div.ink-shade\n     * @param {String}              [options.modalClass]            Custom class to be added to the div.ink-modal\n     * @param {String}              [options.trigger]               CSS Selector for target elements that will trigger the Modal.\n     * @param {Boolean}             [options.autoDisplay]           Displays the Modal automatically when constructed.\n     * @param {String}              [options.markup]                Markup to be placed in the Modal when created\n     * @param {Function}            [options.onShow]                Callback function to run when the Modal is opened.\n     * @param {Function}            [options.onDismiss]             Callback function to run when the Modal is closed. Return `false` to cancel dismissing the Modal.\n     * @param {Boolean}             [options.closeOnClick]          Flag to close the modal when clicking outside of it.\n     * @param {Boolean}             [options.closeOnEscape]         Determines if the Modal should close when \"Esc\" key is pressed. Defaults to true.\n     * @param {Boolean}             [options.responsive]            Determines if the Modal should behave responsively (adapt to smaller viewports).\n     * @param {String}              [options.triggerEvent]          (advanced) Trigger's event to be listened. Defaults to 'click'.\n     *\n     * @sample Ink_UI_Modal_1.html\n     */\n\n    function upName(dimension) {\n        // omg IE\n        var firstCharacter = dimension.match(/^./)[0];\n        return firstCharacter.toUpperCase() + dimension.replace(/^./, '');\n    }\n    function maxName(dimension) {\n        return 'max' + upName(dimension);\n    }\n\n    var openModals = [];\n\n    function Modal() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Modal._name = 'Modal_1';\n\n    Modal._optionDefinition = {\n        /**\n         * Width, height and markup really optional, as they can be obtained by the element\n         */\n        width:        ['String', undefined],\n        height:       ['String', undefined],\n\n        /**\n         * To add extra classes\n         */\n        shadeClass:   ['String', undefined],\n        modalClass:   ['String', undefined],\n\n        /**\n         * Optional trigger properties\n         */\n        trigger:      ['String', undefined],\n        triggerEvent: ['String', 'click'],\n        autoDisplay:  ['Boolean', true],\n\n        /**\n         * Remaining options\n         */\n        markup:       ['String', undefined],\n        onShow:       ['Function', undefined],\n        onDismiss:    ['Function', undefined],\n        closeOnClick: ['Boolean', false],\n        closeOnEscape: ['Boolean', true],\n        responsive:    ['Boolean', true]\n    };\n\n    Modal.prototype = {\n        _init: function () {\n            this._handlers = {\n                click:   Ink.bindEvent(this._onShadeClick, this),\n                keyDown: Ink.bindEvent(this._onKeyDown, this),\n                resize:  Ink.bindEvent(this._onResize, this)\n            };\n\n            this._wasDismissed = false;\n\n            /**\n             * Modal Markup\n             */\n            if( this._element ){\n                this._markupMode = Css.hasClassName(this._element,'ink-modal'); // Check if the full modal comes from the markup\n            } else {\n                this._markupMode = false;\n            }\n\n            if( !this._markupMode ){\n                this._modalShadow      = document.createElement('div');\n                this._modalShadowStyle = this._modalShadow.style;\n\n                this._modalDiv         = document.createElement('div');\n                this._modalDivStyle    = this._modalDiv.style;\n\n                if( !!this._element ){\n                    this._options.markup = this._element.innerHTML;\n                }\n\n                /**\n                 * Not in full markup mode, let's set the classes and css configurations\n                 */\n                Css.addClassName( this._modalShadow,'ink-shade' );\n                Css.addClassName( this._modalDiv,'ink-modal ink-space' );\n\n                /**\n                 * Applying the main css styles\n                 */\n                // this._modalDivStyle.position = 'absolute';\n                this._modalShadow.appendChild( this._modalDiv);\n                document.body.appendChild( this._modalShadow );\n            } else {\n                this._modalDiv         = this._element;\n                this._modalDivStyle    = this._modalDiv.style;\n                this._modalShadow      = this._modalDiv.parentNode;\n                this._modalShadowStyle = this._modalShadow.style;\n\n                this._contentContainer = Selector.select(\".modal-body\", this._modalDiv)[0];\n                if( !this._contentContainer){\n                    throw new Error('Ink.UI.Modal: Missing div with class \"modal-body\"');\n                }\n\n                this._options.markup = this._contentContainer.innerHTML;\n            }\n\n            if( !this._markupMode ){\n                this.setContentMarkup(this._options.markup);\n            }\n\n            if( typeof this._options.shadeClass === 'string' ){\n                Css.addClassName(this._modalShadow, this._options.shadeClass);\n            }\n\n            if( typeof this._options.modalClass === 'string' ){\n                Css.addClassName(this._modalDiv, this._options.modalClass);\n            }\n\n            if( this._options.trigger ) {\n                var triggerElements = Common.elsOrSelector(this._options.trigger, '');\n                Event.observeMulti(triggerElements, this._options.triggerEvent, Ink.bindEvent(this.open, this));\n            } else if ( this._options.autoDisplay.toString() === \"true\" ) {\n                this.open();\n            }\n        },\n\n        /**\n         * Responsible for repositioning the modal\n         * \n         * @method _reposition\n         * @private\n         */\n        _reposition: function(){\n            this._modalDivStyle.marginTop = (-InkElement.elementHeight(this._modalDiv)/2) + 'px';\n            this._modalDivStyle.marginLeft = (-InkElement.elementWidth(this._modalDiv)/2) + 'px';\n        },\n\n        /**\n         * Responsible for resizing the modal\n         * \n         * @method _onResize\n         * @param {Boolean|Event} runNow Its executed in the begining to resize/reposition accordingly to the viewport. But usually it's an event object.\n         * @private\n         */\n        _onResize: function( runNow ){\n            if( typeof runNow === 'boolean' ){\n                this._timeoutResizeFunction.call(this);\n            } else if( !this._resizeTimeout && (runNow && typeof runNow === 'object') ){\n                this._resizeTimeout = setTimeout(Ink.bind(this._timeoutResizeFunction, this),250);\n            }\n        },\n\n        /**\n         * Timeout Resize Function\n         * \n         * @method _timeoutResizeFunction\n         * @private\n         */\n        _timeoutResizeFunction: function(){\n            /**\n             * Getting the current viewport size\n             */\n            var isPercentage = {\n                width: ('' + this._options.width).indexOf('%') !== -1,\n                height: ('' + this._options.height).indexOf('%') !== -1\n            };\n            var currentViewport = {\n                height: InkElement.viewportHeight(),\n                width: InkElement.viewportWidth()\n            };\n\n            InkArray.forEach(['height', 'width'], Ink.bind(function (dimension) {\n                // Not used for percentage measurements\n                if (isPercentage[dimension]) { return; }\n\n                if (currentViewport[dimension] > this.originalStatus[dimension]) {\n                    this._modalDivStyle[dimension] = this._modalDivStyle[maxName(dimension)];\n                } else {\n                    this._modalDivStyle[dimension] = Math.round(currentViewport[dimension] * 0.9) + 'px';\n                }\n            }, this));\n\n            this._resizeContainer();\n            this._reposition();\n            this._resizeTimeout = undefined;\n        },\n\n        /**\n         * Handle clicks on the shade element.\n         * \n         * @method _onShadeClick\n         * @param {Event} ev\n         * @private\n         */\n        _onShadeClick: function(ev) {\n            var tgtEl = Event.element(ev);\n\n            if (Css.hasClassName(tgtEl, 'ink-close') || Css.hasClassName(tgtEl, 'ink-dismiss') || \n                InkElement.findUpwardsBySelector(tgtEl, '.ink-close,.ink-dismiss') ||\n                (\n                    this._options.closeOnClick &&\n                    (!InkElement.descendantOf(this._shadeElement, tgtEl) || (tgtEl === this._shadeElement))\n                )\n            ) {\n                var alertsInTheModal = Selector.select('.ink-alert', this._shadeElement),\n                    alertsLength = alertsInTheModal.length;\n                for( var i = 0; i < alertsLength; i++ ){\n                    if( InkElement.descendantOf(alertsInTheModal[i], tgtEl) ){\n                        return;\n                    }\n                }\n\n                this.dismiss();\n\n                // Only stop the event if this dismisses this modal\n                if (this._wasDismissed) {\n                    Event.stop(ev);\n                }\n            }\n        },\n\n        /**\n         * Responsible for handling the escape key pressing.\n         *\n         * @method _onKeyDown\n         * @param  {Event} ev\n         * @private\n         */\n        _onKeyDown: function(ev) {\n            if (ev.keyCode !== 27 || this._wasDismissed) { return; }\n            if (this._options.closeOnEscape.toString() === 'true' &&\n                    openModals[openModals.length - 1] === this) {\n                this.dismiss();\n                if (this._wasDismissed) {\n                    Event.stop(ev);\n                }\n            }\n        },\n\n        /**\n         * Responsible for setting the size of the modal (and position) based on the viewport.\n         * \n         * @method _resizeContainer\n         * @private\n         */\n        _resizeContainer: function() {\n            var containerHeight = InkElement.elementHeight(this._modalDiv);\n\n            this._modalHeader = Selector.select('.modal-header',this._modalDiv)[0];\n            if( this._modalHeader ){\n                containerHeight -= InkElement.elementHeight(this._modalHeader);\n            }\n\n            this._modalFooter = Selector.select('.modal-footer',this._modalDiv)[0];\n            if( this._modalFooter ){\n                containerHeight -= InkElement.elementHeight(this._modalFooter);\n            }\n\n            this._contentContainer.style.height = containerHeight + 'px';\n            if( containerHeight !== InkElement.elementHeight(this._contentContainer) ){\n                this._contentContainer.style.height = ~~(containerHeight - (InkElement.elementHeight(this._contentContainer) - containerHeight)) + 'px';\n            }\n\n            if( this._markupMode ){ return; }\n        },\n\n        /**************\n         * PUBLIC API *\n         **************/\n\n        /**\n         * Opens this Modal. \n         * Use this if you created the modal with `autoOpen: false`\n         * to open the modal when you want to.\n         * @method open \n         * @param {Event} [event] (internal) In case its fired by the internal trigger.\n         */\n        open: function(event) {\n\n            if( event ){ Event.stop(event); }\n\n            var elem = (document.compatMode === \"CSS1Compat\") ?  document.documentElement : document.body;\n\n            this._resizeTimeout    = null;\n\n            Css.addClassName( this._modalShadow,'ink-shade' );\n            this._modalShadowStyle.display = this._modalDivStyle.display = 'block';\n            setTimeout(Ink.bind(function() {\n                Css.addClassName( this._modalShadow, 'visible' );\n                Css.addClassName( this._modalDiv, 'visible' );\n            }, this), 100);\n\n            /**\n             * Fallback to the old one\n             */\n            this._contentElement = this._modalDiv;\n            this._shadeElement   = this._modalShadow;\n\n            if( !this._markupMode ){\n                /**\n                 * Setting the content of the modal\n                 */\n                this.setContentMarkup( this._options.markup );\n            }\n\n            /**\n             * If any size has been user-defined, let's set them as max-width and max-height\n             */\n\n            var isPercentage = {\n                width: ('' + this._options.width).indexOf('%') !== -1,\n                height: ('' + this._options.height).indexOf('%') !== -1\n            };\n\n            InkArray.forEach(['width', 'height'], Ink.bind(function (dimension) {\n                if (this._options[dimension] !== undefined) {\n                    this._modalDivStyle[dimension] = this._options[dimension];\n                    if (!isPercentage[dimension]) {\n                        this._modalDivStyle[maxName(dimension)] =\n                            InkElement['element' + upName(dimension)](this._modalDiv) + 'px';\n                    }\n                } else {\n                    this._modalDivStyle[maxName(dimension)] = InkElement['element' + upName(dimension)](this._modalDiv) + 'px';\n                }\n\n                if (isPercentage[dimension] && parseInt(elem['client' + maxName(dimension)], 10) <= parseInt(this._modalDivStyle[dimension], 10) ) {\n                    this._modalDivStyle[dimension] = Math.round(parseInt(elem['client' + maxName(dimension)], 10) * 0.9) + 'px';\n                }\n            }, this));\n\n            this.originalStatus = {\n                viewportHeight:     InkElement.elementHeight(elem),\n                viewportWidth:      InkElement.elementWidth(elem),\n                height:             InkElement.elementHeight(this._modalDiv),\n                width:              InkElement.elementWidth(this._modalDiv)\n            };\n\n            /**\n             * Let's 'resize' it:\n             */\n            if( this._options.responsive.toString() === 'true' ) {\n                this._onResize(true);\n                Event.observe( window,'resize',this._handlers.resize );\n            } else {\n                this._resizeContainer();\n                this._reposition();\n            }\n\n            if (this._options.onShow) {\n                this._options.onShow(this);\n            }\n\n            // subscribe events\n            Event.observe(this._shadeElement, 'click', this._handlers.click);\n            if (this._options.closeOnEscape.toString() === 'true') {\n                Event.observe(document, 'keydown', this._handlers.keyDown);\n            }\n\n            this._wasDismissed = false;\n            openModals.push(this);\n\n            Css.addClassName(document.documentElement, 'ink-modal-open');\n        },\n\n        /**\n         * Closes the modal\n         * \n         * @method dismiss\n         * @public\n         */\n        dismiss: function() {\n            if (this._wasDismissed) { /* Already dismissed. WTF IE. */ return; }\n\n            if (this._options.onDismiss) {\n                var ret = this._options.onDismiss(this);\n                if (ret === false) { return; }\n            }\n\n            this._wasDismissed = true;\n\n            if( this._options.responsive ){\n                Event.stopObserving(window, 'resize', this._handlers.resize);\n            }\n\n            // this._modalShadow.parentNode.removeChild(this._modalShadow);\n\n            if( !this._markupMode ){\n                this._modalShadow.parentNode.removeChild(this._modalShadow);\n                this.destroy();\n            } else {\n                Css.removeClassName( this._modalDiv, 'visible' );\n                Css.removeClassName( this._modalShadow, 'visible' );\n\n                this._waitForFade(this._modalShadow, Ink.bind(function () {\n                    this._modalShadowStyle.display = 'none';\n                }, this));\n            }\n\n            openModals = InkArray.remove(openModals, InkArray.keyValue(this, openModals), 1);\n\n            if (openModals.length === 0) {  // Document level stuff now there are no modals in play.\n                var htmlEl = document.documentElement;\n\n                // Remove the class from the HTML element.\n                Css.removeClassName(htmlEl, 'ink-modal-open');\n            }\n        },\n\n        /**\n         * Utility function to listen to the onTransmissionEnd event, or wait using setTimeouts\n         *\n         * Specific to this._element\n         */\n        _waitForFade: function (elem, callback) {\n            if (!opacitySupported) { return callback(); }\n\n            var transitionEndEventNames = [\n                'transitionEnd', 'oTransitionEnd', 'webkitTransitionEnd'];\n            var classicName;\n            var evName;\n            for (var i = 0, len = transitionEndEventNames.length; i < len; i++) {\n                evName = transitionEndEventNames[i];\n                classicName = 'on' + evName.toLowerCase();\n                if (classicName in elem) {\n                    Event.observeOnce(elem, evName, callback);\n                    return;\n                }\n            }\n            var fadeChecker = function () {\n                if( +Css.getStyle(elem, 'opacity') > 0 ){\n                    setTimeout(fadeChecker, 250);\n                } else {\n                    callback();\n                }\n            };\n            setTimeout(fadeChecker, 500);\n        },\n\n        /**\n         * Removes the modal from the DOM\n         * \n         * @method destroy\n         * @public\n         */\n        destroy: function() {\n            Common.unregisterInstance(this._instanceId);\n        },\n\n        /**\n         * Returns the content DOM element\n         * \n         * @method getContentElement\n         * @return {DOMElement} Modal main cointainer.\n         * @public\n         */\n        getContentElement: function() {\n            return this._contentContainer;\n        },\n\n        /**\n         * Replaces the content markup\n         * \n         * @method setContentMarkup\n         * @param {String} contentMarkup\n         * @public\n         */\n        setContentMarkup: function(contentMarkup) {\n            if( !this._markupMode ){\n                this._modalDiv.innerHTML = [contentMarkup].join('');\n                this._contentContainer = Selector.select(\".modal-body\",this._modalDiv);\n                if( !this._contentContainer.length ){\n                    // throw 'Missing div with class \"modal-body\"';\n                    var tempHeader = Selector.select(\".modal-header\",this._modalDiv);\n                    var tempFooter = Selector.select(\".modal-footer\",this._modalDiv);\n\n                    InkArray.each(tempHeader, InkElement.remove);\n                    InkArray.each(tempFooter, InkElement.remove);\n\n                    var body = document.createElement('div');\n                    Css.addClassName(body,'modal-body');\n                    body.innerHTML = this._modalDiv.innerHTML;\n                    this._modalDiv.innerHTML = '';\n\n                    var toAdd = tempHeader.concat([body]).concat(tempFooter);\n                    InkArray.each(toAdd, Ink.bindMethod(this._modalDiv, 'appendChild'));\n\n                    this._contentContainer = Selector.select(\".modal-body\",this._modalDiv);\n                }\n                this._contentContainer = this._contentContainer[0];\n            } else {\n                this._contentContainer.innerHTML = contentMarkup;\n            }\n            this._contentElement = this._modalDiv;\n            this._resizeContainer();\n        }\n\n    };\n\n    Common.createUIComponent(Modal, { elementIsOptional: true });\n\n    return Modal;\n\n});\n","/**\n * Pagination elements\n * @module Ink.UI.Pagination_1\n * @version 1\n */\n \nInk.createModule('Ink.UI.Pagination', '1',\n    ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1'],\n    function(Common, Event, Css, Element, Selector ) {\n    'use strict';\n\n    /**\n     * Function to create the pagination anchors\n     *\n     * @method genAel\n     * @private\n     * @param  {String} inner HTML to be placed inside the anchor.\n     * @return {DOMElement}  Anchor created\n     */\n    var genAEl = function(inner, index, options) {\n        var aEl = document.createElement('a');\n        aEl.setAttribute('href', '#');\n        if (typeof index === 'number') {\n            aEl.setAttribute('data-index', index);\n        }\n        if(options && options.wrapText) {\n            var spanEl = document.createElement('span');\n            aEl.appendChild(spanEl);\n            spanEl.innerHTML = inner;\n        } else {\n            aEl.innerHTML = inner;\n        }\n        return aEl;\n    };\n\n    /**\n     * @class Ink.UI.Pagination\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector                    Selector or element\n     * @param {Object}              options                     Options\n     * @param {Number}              [options.size]              Number of pages.\n     * @param {Number}              [options.totalItemCount]    Total numeber of items to display\n     * @param {Number}              [options.itemsPerPage]      Number of items per page.\n     * @param {Number}              [options.maxSize]           If passed, only shows at most maxSize items. displays also first|prev page and next page|last buttons\n     * @param {Number}              [options.start]             Start page. defaults to 1\n     * @param {Boolean}             [options.sideButtons=true]  Whether to show the first, last, previous, next, previousPage and lastPage buttons. Do not use together with maxSize.\n     * @param {String}              [options.firstLabel]        Text for the first page button. Defaults to 'First'.\n     * @param {String}              [options.lastLabel]         Text for the last page button. Defaults to 'Last'.\n     * @param {String}              [options.previousLabel]     Text for the previous button. Defaults to 'Previous'-\n     * @param {String}              [options.nextLabel]         Text for the next button. Defaults to 'Next'\n     * @param {String}              [options.previousPageLabel] Text for the previous page button. Defaults to 'Previous {Items per page}'.\n     * @param {String}              [options.nextPageLabel]     Text for the next page button. Defaults to 'Next {Items per page}'.\n     * @param {Function}            [options.onChange]          Callback to be called when a page changes. Called with `(thisPaginator, newPageNumber)`.\n     * @param {String}              [options.hashParameter]     Parameter to use on setHash. Defaults to 'page'.\n     * @param {String}              [options.parentTag]         HTML Tag used as the parent node.\n     * @param {String}              [options.childTag]          HTML Tag used as the child nodes.\n     * @param {String}              [options.wrapperClass]      CSS Class used in the wrapper element\n     * @param {String}              [options.paginationClass]   CSS Class used in the pagination element\n     * @param {String}              [options.activeClass]       CSS Class used to mark page as active\n     * @param {String}              [options.disabledClass]     CSS Class used to mark page as disabled\n     * @param {String}              [options.hideClass]         CSS Class used to hide elements\n     * @param {String}              [options.previousClass]     CSS Class used in the previous element\n     * @param {String}              [options.previousPageClass] CSS Class used in the previous page element\n     * @param {String}              [options.nextClass]         CSS Class used in the next element\n     * @param {String}              [options.nextPageClass]     CSS Class used in the next page element\n     * @param {Function}            [options.numberFormatter]   Number formatter function. Receives a 0-indexed number and returns the text for the numbered page button.\n     *\n     * @sample Ink_UI_Pagination_1.html\n     */\n    function Pagination() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Pagination._name = 'Pagination_1';\n\n    Pagination._optionDefinition = {\n        size:              ['Integer', null],\n        totalItemCount:    ['Integer', null],\n        itemsPerPage:      ['Integer', null],\n        maxSize:           ['Integer', null],\n        start:             ['Integer', 1],\n        sideButtons:       ['Boolean', 1 /* actually `true` but we want to see if user is using the default or not. */],\n        // TODO add pagination-type which accepts color strings, \"chevron\" and \"dotted\". Basically classes to add to the UL.\n        firstLabel:        ['String', 'First'],\n        lastLabel:         ['String', 'Last'],\n        previousLabel:     ['String', 'Previous'],\n        nextLabel:         ['String', 'Next'],\n        previousPageLabel: ['String', null],\n        nextPageLabel:     ['String', null],\n        onChange:          ['Function', undefined],\n        hashParameter:     ['String', 'page'],\n        parentTag:         ['String', 'ul'],\n        childTag:          ['String', 'li'],\n        wrapperClass:      ['String', 'ink-navigation'],\n        paginationClass:   ['String', 'pagination'],\n        activeClass:       ['String', 'active'],\n        disabledClass:     ['String', 'disabled'],\n        hideClass:         ['String', 'hide-all'],\n        previousClass:     ['String', 'previous'],\n        previousPageClass: ['String', 'previousPage'],\n        nextClass:         ['String', 'next'],\n        nextPageClass:     ['String', 'nextPage'],\n\n        numberFormatter: ['Function', function(i) { return i + 1; }]\n    };\n\n    Pagination.prototype = {\n        /**\n         * Init function called by the constructor\n         *\n         * @method _init\n         * @private\n         */\n        _init: function() {\n            if (!this._options.previousPageLabel) {\n                this._options.previousPageLabel = this._options.previousLabel + ' ' + this._options.maxSize;\n            }\n\n            if (!this._options.nextPageLabel) {\n                this._options.nextPageLabel = this._options.nextLabel + ' ' + this._options.maxSize;\n            }\n\n            this._handlers = {\n                click: Ink.bindEvent(this._onClick,this)\n            };\n\n            if (Common.isInteger(this._options.totalItemCount) && Common.isInteger(this._options.itemsPerPage)) {\n                this._size = this._calculateSize(this._options.totalItemCount, this._options.itemsPerPage);\n            } else if (Common.isInteger(this._options.size)) {\n                this._size = this._options.size;\n            } else {\n                Ink.error('Ink.UI.Pagination: Please supply a size option or totalItemCount and itemsPerPage options.');\n                this._size = 0;\n            }\n\n            this._current = this._options.start - 1;\n            this._itemLiEls = [];\n\n            // generate and apply DOM\n            this._generateMarkup(this._element);\n\n            this._updateItems();\n\n            // subscribe events\n            this._observe();\n        },\n\n        /**\n         * Responsible for setting listener in the 'click' event of the Pagination element.\n         *\n         * @method _observe\n         * @private\n         */\n        _observe: function() {\n            Event.observeDelegated(this._element, 'click', '.' + this._options.paginationClass + ' > ' + this._options.childTag, this._handlers.click);\n        },\n\n        /**\n         * Calculate how many pages are necessary for `count` items, and `itemsPerPage` items per page.\n         *\n         * @method _calculateSize\n         * @param count\n         * @param itemsPerPage\n         * @private\n         **/\n        _calculateSize: function (count, itemsPerPage) {\n            return Math.ceil(count / itemsPerPage);\n        },\n        /**\n         * Updates the markup everytime there's a change in the Pagination object.\n         *\n         * @method _updateItems\n         * @private\n         */\n        _updateItems: function() {\n            var liEls = this._itemLiEls;\n\n            var isSimpleToggle = this._size === liEls.length;\n\n            var i, f, liEl;\n\n            if (isSimpleToggle) {\n                // just toggle active class\n                for (i = 0, f = this._size; i < f; ++i) {\n                    Css.setClassName(liEls[i], this._options.activeClass, i === this._current);\n                }\n            }\n            else {\n                // remove old items\n                for (i = liEls.length - 1; i >= 0; --i) {\n                    this._ulEl.removeChild(liEls[i]);\n                }\n\n                // add new items\n                liEls = [];\n                for (i = 0, f = this._size; i < f; ++i) {\n                    liEl = document.createElement(this._options.childTag);\n                    liEl.appendChild( genAEl( this._options.numberFormatter(i), i) );\n                    // add \"active\" class if this is the active element.\n                    Css.setClassName(liEl, this._options.activeClass, i === this._current);\n                    if (this._nextEl) {\n                        this._ulEl.insertBefore(liEl, this._nextEl);\n                    } else {\n                        this._ulEl.appendChild(liEl);\n                    }\n\n                    liEls.push(liEl);\n                }\n                this._itemLiEls = liEls;\n            }\n\n            if (this._options.maxSize) {\n                // toggle visible items\n                var page = Math.floor( this._current / this._options.maxSize );\n                var pi = this._options.maxSize * page;\n                var pf = pi + this._options.maxSize - 1;\n\n                for (i = 0, f = this._size; i < f; ++i) {\n                    liEl = liEls[i];\n                    Css.setClassName(liEl, this._options.hideClass, i < pi || i > pf);\n                }\n\n                this._pageStart = pi;\n                this._pageEnd = pf;\n                this._page = page;\n\n                Css.setClassName(this._prevPageEl, this._options.disabledClass, !this.hasPreviousPage());\n                Css.setClassName(this._nextPageEl, this._options.disabledClass, !this.hasNextPage());\n\n                Css.setClassName(this._firstEl, this._options.disabledClass, this.isFirst());\n                Css.setClassName(this._lastEl, this._options.disabledClass, this.isLast());\n            }\n\n            // update prev and next\n            if (this._prevEl) {\n                Css.setClassName(this._prevEl, this._options.disabledClass, !this.hasPrevious());\n            }\n            if (this._nextEl) {\n                Css.setClassName(this._nextEl, this._options.disabledClass, !this.hasNext());\n            }\n        },\n\n        /**\n         * Returns the top element for the gallery DOM representation\n         *\n         * @method _generateMarkup\n         * @param {DOMElement} el\n         * @private\n         */\n        _generateMarkup: function(el) {\n            Css.addClassName(el, 'ink-navigation');\n\n            var ulEl = Ink.s('.' + this._options.paginationClass, el);\n            var hasUlAlready = false;\n\n            if( !ulEl ){\n                ulEl = document.createElement(this._options.parentTag);\n                Css.addClassName(ulEl, this._options.paginationClass);\n            } else {\n                hasUlAlready = true;\n            }\n\n            var isChevron = Css.hasClassName(ulEl, 'chevron');\n            var isDotted = Css.hasClassName(ulEl, 'dotted');\n\n            // Creates <li> elements for firstPage, nextPage, first, last, etc.\n            var createLiEl = Ink.bind(function (name, options) {\n                var liEl = document.createElement(this._options.childTag);\n                var aEl = genAEl(this._options[name + 'Label'], undefined, { wrapText: options && options.wrapText });\n                Css.addClassName(liEl, this._options[name + 'Class']);\n                liEl.appendChild(aEl);\n                ulEl.appendChild(liEl);\n                return liEl;\n            }, this);\n\n            if (!isDotted && this._options.maxSize) {\n                this._firstEl = createLiEl('first');\n                this._prevPageEl = createLiEl('previousPage');\n            }\n\n            // When we're dotted, the default for sideButtons is `false`. When we're note, it's `true`.\n            // Since the default is actually \"1\", we do a === true check when we're dotted, and a truthish check when we're not.\n            if ((isDotted && this._options.sideButtons === true) || (!isDotted && this._options.sideButtons)) {\n                this._prevEl = createLiEl('previous', { wrapText: isChevron });\n                this._nextEl = createLiEl('next', { wrapText: isChevron });\n            }\n\n            if (!isDotted && this._options.maxSize) {\n                this._nextPageEl = createLiEl('nextPage');\n                this._lastEl = createLiEl('last');\n            }\n\n            if( !hasUlAlready ){\n                el.appendChild(ulEl);\n            }\n\n            this._ulEl = ulEl;\n        },\n\n        /**\n         * Click handler\n         *\n         * @method _onClick\n         * @param {Event} ev\n         * @private\n         */\n        _onClick: function(ev) {\n            Event.stop(ev);\n\n            var liEl = Event.element(ev);\n            if ( Css.hasClassName(liEl, this._options.activeClass) ||\n                 Css.hasClassName(liEl, this._options.disabledClass) ) { return; }\n\n            var isPrev = Css.hasClassName(liEl, this._options.previousClass);\n            var isNext = Css.hasClassName(liEl, this._options.nextClass);\n            var isPrevPage = Css.hasClassName(liEl, this._options.previousPageClass);\n            var isNextPage = Css.hasClassName(liEl, this._options.nextPageClass);\n            var isFirst = Css.hasClassName(liEl, this._options.firstClass);\n            var isLast = Css.hasClassName(liEl, this._options.lastClass);\n\n            if (isFirst) {\n                this.setCurrent(0);\n            }\n            else if (isLast) {\n                this.setCurrent(this._size - 1);\n            }\n            else if (isPrevPage || isNextPage) {\n                this.setCurrent( (isPrevPage ? -1 : 1) * this._options.maxSize, true /* relative */);\n            }\n            else if (isPrev || isNext) {\n                this.setCurrent(isPrev ? -1 : 1, true /* relative */);\n            }\n            else {\n                var aElem = Selector.select('[data-index]', liEl)[0];\n                var nr = aElem && parseInt( aElem.getAttribute('data-index'), 10);\n                this.setCurrent(nr);\n            }\n        },\n\n\n        /**\n         * Allows you to subscribe to the onChange event\n         *\n         * @method setOnChange\n         * @param cb {Function} Callback called with `(thisPaginator, newPageNumber)`.\n         */\n        setOnChange: function (onChange) {\n            if (onChange !== undefined && typeof onChange !== 'function') {\n                throw new TypeError('onChange option must be a function!');\n            }\n            this._options.onChange = onChange;\n        },\n\n        /**************\n         * PUBLIC API *\n         **************/\n\n        /**\n         * Sets the number of pages\n         *\n         * @method setSize\n         * @param {Number} sz number of pages\n         * @public\n         */\n        setSize: function(sz) {\n            if (!Common.isInteger(sz)) {\n                throw new TypeError('1st argument must be an integer number!');\n            }\n\n            this._size = sz;\n            this._updateItems();\n            this._current = 0;\n        },\n\n        /**\n         * Sets the number of pages, then call setSize().\n         *\n         * @param setSizeInItems\n         * @param {Number} totalItems       Total number of items\n         * @param {Number} itemsPerPage     Items per page\n         */\n        setSizeInItems: function (totalItems, itemsPerPage) {\n            var pageNumber = Math.ceil(totalItems / itemsPerPage);\n            this.setSize(pageNumber);\n        },\n\n        /**\n         * Sets the current page.\n         *\n         * @method setCurrent\n         * @param {Number} nr           Sets the current page to given number.\n         * @param {Boolean} isRelative  Flag to change the position from absolute to relative.\n         * @public\n         */\n        setCurrent: function(nr, isRelative) {\n            if (!Common.isInteger(nr)) {\n                throw new TypeError('1st argument must be an integer number!');\n            }\n\n            if (isRelative) {\n                nr += this._current;\n            }\n\n            if (nr > this._size - 1) {\n                nr = this._size - 1;\n            }\n\n            if (nr < 0) {\n                nr = 0;\n            }\n\n            this._current = nr;\n            this._updateItems();\n\n            if (this._options.onChange) {\n                this._options.onChange(this, nr);\n            }\n\n            /*if (this._options.setHash) {\n                var o = {};\n                o[this._options.hashParameter] = nr;\n                Common.setHash(o);\n            }*/  // undocumented option, removing\n        },\n\n        /**\n         * Gets the number of pages\n         *\n         * @method getSize\n         * @return {Number} Number of pages\n         * @public\n         */\n        getSize: function() {\n            return this._size;\n        },\n\n        /**\n         * Gets the current page index\n         *\n         * @method getCurrent\n         * @return {Number} Current page\n         * @public\n         */\n        getCurrent: function() {\n            return this._current;\n        },\n\n        /**\n         * Checks if it's at the first page\n         *\n         * @method isFirst\n         * @return {Boolean} True if at first page\n         * @public\n         */\n        isFirst: function() {\n            return this._current === 0;\n        },\n\n        /**\n         * Checks if it's on the last page\n         *\n         * @method isLast\n         * @return {Boolean} True if at last page\n         * @public\n         */\n        isLast: function() {\n            return this._current === this._size - 1;\n        },\n\n        /**\n         * Checks if it has previous pages\n         *\n         * @method hasPrevious\n         * @return {Boolean} True if has prior pages\n         * @public\n         */\n        hasPrevious: function() {\n            return this._current > 0;\n        },\n\n        /**\n         * Checks if it has next pages\n         *\n         * @method hasNext\n         * @return {Boolean} True if has pages ahead\n         * @public\n         */\n        hasNext: function() {\n            return this._current < this._size - 1;\n        },\n\n        /**\n         * Checks if it has a previous set of pages\n         *\n         * @method hasPreviousPage\n         * @return {Boolean} Returns true iif has prior set of page(s)\n         * @public\n         */\n        hasPreviousPage: function() {\n            return this._options.maxSize && this._current > this._options.maxSize - 1;\n        },\n\n        /**\n         * Checks if it has a next set of pages\n         *\n         * @method hasNextPage\n         * @return {Boolean} Returns true iif has set of page(s) ahead\n         * @public\n         */\n        hasNextPage: function() {\n            return this._options.maxSize && this._size - this._current >= this._options.maxSize + 1;\n        },\n\n        /**\n         * Unregisters the component and removes its markup\n         *\n         * @method destroy\n         * @public\n         */\n        destroy: Common.destroyComponent\n    };\n\n    Common.createUIComponent(Pagination);\n\n    return Pagination;\n\n});","/**\n * Animated progress bars\n * @module Ink.UI.ProgressBar_1\n * @version 1\n */\n\nInk.createModule('Ink.UI.ProgressBar', '1', ['Ink.UI.Common_1', 'Ink.Dom.Selector_1'], function( Common, Selector ) {\n    'use strict';\n\n    /**\n     * Associated to a .ink-progress-bar element, it provides a setValue() method to change the element's value.\n     * \n     * @class Ink.UI.ProgressBar\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector                Element or selector\n     * @param {Object}              [options]               Options object\n     * @param {Number}              [options.startValue]    Percentage of the bar that is filled. Ranges between 0 and 100. Default: 0\n     * @param {Function}            [options.onStart]       Callback called when a change of value is started\n     * @param {Function}            [options.onEnd]         Callback called when a change of value ends\n     *\n     * @sample Ink_UI_ProgressBar_1.html\n     */\n    function ProgressBar(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    ProgressBar._name = 'ProgressBar_1';\n\n    ProgressBar._optionDefinition = {\n        startValue: ['Number', 0],\n        onStart: ['Function', function () {}],\n        onEnd: ['Function', function () {}]\n    };\n\n    ProgressBar.prototype = {\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function(){\n            this._value = this._options.startValue;\n            this._elementBar = Selector.select('.bar',this._element);\n            if( this._elementBar.length < 1 ){\n                throw new Error('[Ink.UI.ProgressBar] :: Bar element not found');\n            }\n            this._elementBar = this._elementBar[0];\n\n            this.setValue( this._options.startValue );\n        },\n\n        /**\n         * Sets the value of the Progressbar\n         * \n         * @method setValue\n         * @param {Number} newValue Numeric value, between 0 and 100, that represents the percentage of the bar.\n         * @public\n         */\n        setValue: function( newValue ){\n            this._options.onStart.call(this, this._value);\n\n            newValue = parseInt(newValue,10);\n            if( isNaN(newValue) || (newValue < 0) ){\n                newValue = 0;\n            } else if( newValue>100 ){\n                newValue = 100;\n            }\n            this._value = newValue;\n            this._elementBar.style.width = this._value + '%';\n\n            this._options.onEnd.call(this, this._value);\n        }\n    };\n\n    Common.createUIComponent(ProgressBar);\n\n    return ProgressBar;\n\n});\n","/**\n * Scroll to content\n * @module Ink.UI.SmoothScroller_1\n * @version 1\n */\nInk.createModule('Ink.UI.SmoothScroller', '1', ['Ink.UI.Common_1', 'Ink.Dom.Event_1', 'Ink.Dom.Element_1', 'Ink.Dom.Selector_1','Ink.Dom.Css_1'], function(Common, Event, InkElement, Selector, Css) {\n    'use strict';\n\n    var requestAnimationFrame =\n        window.requestAnimationFrame ||\n        function (cb) { return setTimeout(cb, 10); };\n\n    var cancelAnimationFrame =\n        window.cancelAnimationFrame ||\n        function (id) { clearTimeout(id); };\n\n    /**\n     * @namespace SmoothScroller\n     * @version 1\n     * @static\n     *\n     * SmoothScroller is a component which replaces the default scroll-to behaviour of `<a>` tags which refer to IDs on the page.\n     *\n     * For example, when you have this:\n     *\n     *          <a href=\"#todo\">Todo</a>\n     *              [...]\n     *          <section id=\"todo\">\n     *              [...]\n     *\n     * You can click the `<a>` and the page will scroll until the section you pointed to.\n     *\n     * When you use SmoothScroller, instead of immediately scrolling to the element, you get a smooth motion.\n     *\n     * Also, you can define the data-margin option if you have a `position:fixed` top menu ruining the behaviour.\n     *\n     * @example\n     *\n     */\n    var SmoothScroller = {\n\n        /**\n         * The default scrolling speed. Higher is slower. Defaults to 10.\n         *\n         * @property speed\n         * @type {Number}\n         * @default 10\n         * @static\n         */\n        speed: 10,\n\n        /**\n         * Change the URL hash (location.hash) when done scrolling? Defaults to true.\n         *\n         * @property changeHash\n         * @default true\n         * @type {Boolean}\n         * @static\n         */\n        changeHash: true,\n\n        /**\n         * The default top margin.\n         * Use this when you want the scroll motion to stop before it reaches its destination, for example when you want to add some breathing space or have a position:fixed top bar in front of your content.\n         *\n         * @property margin\n         * @default 0\n         * @type {Number}\n         * @static\n         */\n        margin: 0,\n\n\n        /**\n         * Moves the scrollbar to the target element. This is the function\n         * which animates the scroll position bit by bit. It calls itself in\n         * the end through requestAnimationFrame\n         *\n         * @method scroll\n         * @param  {Number} d Y coordinate value to stop\n         * @private\n         * @static\n         */\n        scroll: function(d, options) {\n            var a = Math.round(InkElement.scrollHeight());\n\n            var endPos = Math.round(d - options.margin);\n\n            if (endPos > a) {\n                a += Math.ceil((endPos - a) / options.speed);\n            } else {\n                a = a + (endPos - a) / options.speed;\n            }\n\n            cancelAnimationFrame(SmoothScroller.interval);\n\n            if (!((a) === endPos || SmoothScroller.offsetTop === a)) {\n                SmoothScroller.interval = requestAnimationFrame(\n                    Ink.bindMethod(SmoothScroller, 'scroll', d, options), document.body);\n            } else {\n                SmoothScroller.onDone(options);\n            }\n\n            window.scrollTo(0, a);\n            SmoothScroller.offsetTop = a;\n        },\n\n\n        /**\n         * Has smooth scrolling applied to relevant elements upon page load.\n         * Listens to the click event on the document.\n         * Anything which matches the selector will be considered a \"link\" by SmoothScroller and handled as such.\n         *\n         * When a link is clicked, it is checked for several options:\n         * - `data-margin=\"0\"` - A margin in pixels -- useful when you have a position:fixed top bar.\n         * - `data-speed=\"10\"` - Inverse speed of the scrolling motion. Smaller is faster.\n         * - `data-change-hash=\"true\"` - Change the URL hash (location.hash) when done scrolling.\n         *\n         * @method init\n         * @param [selector='a.scrollableLink,a.ink-smooth-scroll'] {String} Selector string for finding links with smooth scrolling enabled.\n         * @static\n         * @sample Ink_UI_SmoothScroller_1.html\n         */\n        init: function(selector) {\n            Event.on(document, 'click', selector || 'a.scrollableLink, a.ink-smooth-scroll', SmoothScroller.onClick);\n        },\n\n        // Deprecated. Kept around just in case someone is still calling this.\n        render: function() {},\n\n        /**\n         * Handles clicks on link elements\n         *\n         * @method onClick\n         * @private\n         * @static\n         */\n        onClick: function(event) {\n            var link = event.currentTarget;\n\n            var thisDocument =    (location + '').replace(/#.*?$/, '');\n            var linkedDocument = (link.href + '').replace(/#.*?$/, '');\n\n            if (linkedDocument !== thisDocument) {\n                return; // It's an external link.\n            }\n\n            var hash = link.getAttribute('data-hash') || (link.getAttribute('href') || '')\n                .replace(/^.*?#/, '');\n\n            if(hash) {\n                event.preventDefault();\n                var activeLiSelector = 'ul > li.active > ' + selector;\n\n                var selector = 'a[name=\"' + hash + '\"],#' + hash;\n                var elm = Ink.s(selector);\n                var activeLi = Ink.s(activeLiSelector);\n                activeLi = activeLi && activeLi.parentNode;\n\n                if (elm) {\n                    if (!Css.hasClassName(link.parentNode, 'active')) {\n                        if (activeLi) {\n                            Css.removeClassName(activeLi, 'active');\n                        }\n                        Css.addClassName(link.parentNode, 'active');\n                    }\n\n                    var options = Common.options('SmoothScroller link options', {\n                        margin: ['Number', SmoothScroller.margin],\n                        speed: ['Number', SmoothScroller.speed],\n                        changeHash: ['Boolean', SmoothScroller.changeHash]\n                    }, {}, link);\n\n                    SmoothScroller.hash = hash;\n                    \n                    SmoothScroller.scroll(InkElement.offsetTop(elm), options);\n                }\n            }\n        },\n\n        /**\n         * Called when the scroll movement is done. Updates browser address.\n         *\n         * @method onDone\n         * @param {Object} options Options object from the element.\n         * @private\n         */\n        onDone: function (options) {\n            if (options.changeHash === true) {\n                window.location.hash = SmoothScroller.hash;\n            }\n\n            SmoothScroller.hash = SmoothScroller.offsetTop = null;\n        }\n    };\n\n    return SmoothScroller;\n\n});\n","/**\n * Sortable lists\n * @module Ink.UI.SortableList_1\n * @version 1\n */\n\nInk.createModule('Ink.UI.SortableList', '1', ['Ink.UI.Common_1','Ink.Dom.Css_1','Ink.Dom.Event_1','Ink.Dom.Element_1','Ink.Dom.Selector_1'], function( Common, Css, Events, Element, Selector ) {\n    'use strict';\n    var hasTouch = (('ontouchstart' in window) ||       // html5 browsers\n                    (navigator.maxTouchPoints > 0) ||   // future IE\n                    (navigator.msMaxTouchPoints > 0));\n\n    /**\n     * Adds sortable behaviour to any list.\n     * \n     * @class Ink.UI.SortableList\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector\n     * @param {String}              [options.placeholderClass]          CSS class added to the \"ghost\" element being dragged around. Defaults to 'placeholder'.\n     * @param {String}              [options.draggedClass]              CSS class added to the original element being dragged around. Defaults to 'hide-all'.\n     * @param {String}              [options.draggingClass]             CSS class added to the html element when the user is dragging. Defaults to 'dragging'.\n     * @param {String}              [options.dragSelector]              CSS selector for the drag enabled nodes. Defaults to 'li'.\n     * @param {String}              [options.handleSelector]            CSS selector for the drag handle. If present, you can only drag nodes by this selector.\n     * @param {String}              [options.moveSelector]              CSS selector to validate a node move. If present, you can only move nodes inside this selector.\n     * @param {Boolean}             [options.swap]                      Flag to swap dragged element and target element instead of reordering it.\n     * @param {Boolean}             [options.cancelMouseOut]            Flag to cancel draggin if mouse leaves the container element.\n     * @param {Function}            [options.onDrop]                    Callback to be executed after dropping an element. Receives { droppedElement: DOMElement } as an argument.\n     *\n     * @sample Ink_UI_SortableList_1.html\n     */\n    function SortableList() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    SortableList._name = 'SortableList_1';\n\n    SortableList._optionDefinition = {\n        'placeholderClass': ['String', 'placeholder'],\n        'draggedClass': ['String', 'hide-all'],\n        'draggingClass': ['String', 'dragging'],\n        'dragSelector': ['String', 'li'],\n        'dragObject': ['String', null], // Deprecated. Use handleSelector instead.\n        'handleSelector': ['String', null],\n        'moveSelector': ['String', false],\n        'swap': ['Boolean', false],\n        'cancelMouseOut': ['Boolean', false],\n        'onDrop': ['Function', function(){}]\n    };\n\n    SortableList.prototype = {\n        /**\n         * Init function called by the constructor.\n         * \n         * @method _init\n         * @private\n         */\n        _init: function() {\n            if (this._options.dragObject != null) {\n                // [3.0.0] Remove this deprecation notice and stop providing backwards compatibility\n                Ink.warn('Ink.UI.SortableList: options.dragObject is now deprecated. ' +\n                        'Please use options.handleSelector instead.');\n                this._options.handleSelector =\n                    this._options.handleSelector || this._options.dragObject;\n            }\n\n            this._handlers = {\n                down: Ink.bind(this._onDown, this),\n                move: Ink.bind(this._onMove, this),\n                up:   Ink.bind(this._onUp, this)\n            };\n\n            this._isMoving = false;\n\n            this._down = hasTouch ? 'touchstart mousedown' : 'mousedown';\n            this._move = hasTouch ? 'touchmove mousemove' : 'mousemove';\n            this._up   = hasTouch ? 'touchend mouseup' : 'mouseup';\n\n            this._observe();\n        },\n\n        /**\n         * Sets the event handlers.\n         * \n         * @method _observe\n         * @private\n         */\n        _observe: function() {\n            Events.on(this._element, this._down, this._options.dragSelector, this._handlers.down);\n            Events.on(this._element, this._move, this._options.dragSelector, this._handlers.move);\n            if(this._options.cancelMouseOut) {\n                Events.on(this._element, 'mouseleave', Ink.bind(this.stopMoving, this));\n            }\n            Events.on(document.documentElement, this._up, this._handlers.up);\n        },\n\n        /**\n         * Mousedown or touchstart handler\n         * \n         * @method _onDown\n         * @param {Event} ev\n         * @private\n         */\n        _onDown: function(ev) {\n            if (this._isMoving || this._placeholder) { return; }\n            if(this._options.handleSelector && !Selector.matchesSelector(ev.target, this._options.handleSelector)) { return; }\n            var tgtEl = ev.currentTarget;\n            this._isMoving = tgtEl;\n            this._placeholder = tgtEl.cloneNode(true);\n            this._movePlaceholder(tgtEl);\n            this._addMovingClasses();\n            return false;\n        },\n\n        /**\n         * Mousemove or touchmove handler\n         * \n         * @method _onMove\n         * @param {Event} ev\n         * @private\n         */\n        _onMove: function(ev) {\n            var target = ev.currentTarget;\n\n            // Touch events give you the element where the finger touched first,\n            // not the element under it like mouse events.\n            if (ev.type === 'touchmove') {\n                var touch = ev.touches[0];\n                target = document.elementFromPoint(touch.clientX, touch.clientY);\n                target = Element.findUpwardsBySelector(target, this._options.dragSelector);\n            }\n\n            this.validateMove(target);\n            ev.preventDefault();\n        },\n\n        /**\n         * Mouseup or touchend handler\n         * \n         * @method _onUp\n         * @param {Event} ev\n         * @private\n         */\n        _onUp: function(ev) {\n            if (!this._isMoving || !this._placeholder) { return; }\n            if (ev.currentTarget === this._isMoving) { return; }\n            if (ev.currentTarget === this._placeholder) { return; }\n            Element.insertBefore(this._isMoving, this._placeholder);\n            this.stopMoving();\n            this._options.onDrop.call(this, { droppedElement: ev.currentTarget });\n            return false;\n        },\n\n        /**\n         * Adds the CSS classes to interactive elements\n         * \n         * @method _addMovingClasses\n         * @private\n         */\n        _addMovingClasses: function(){\n            Css.addClassName(this._placeholder, this._options.placeholderClass);\n            Css.addClassName(this._isMoving, this._options.draggedClass);\n            Css.addClassName(document.documentElement, this._options.draggingClass);\n        },\n\n        /**\n         * Removes the CSS classes from interactive elements\n         * \n         * @method _removeMovingClasses\n         * @private\n         */\n        _removeMovingClasses: function(){\n            if(this._isMoving) { Css.removeClassName(this._isMoving, this._options.draggedClass); }\n            if(this._placeholder) { Css.removeClassName(this._placeholder, this._options.placeholderClass); }\n            Css.removeClassName(document.documentElement, this._options.draggingClass);\n        },\n\n        /**\n         * Moves the placeholder element relative to the target element\n         * \n         * @method _movePlaceholder\n         * @param {Element} target_position\n         * @private\n         */\n        _movePlaceholder: function(target){\n            var placeholder = this._placeholder,\n                target_position,\n                placeholder_position,\n                from_top,\n                from_left;\n            if(!placeholder) {\n                Element.insertAfter(placeholder, target);\n            } else if(this._options.swap){\n                Element.insertAfter(placeholder, target);\n                Element.insertBefore(target, this._isMoving);\n                Element.insertBefore(this._isMoving, placeholder);\n            } else {\n                target_position = Element.offset(target);\n                placeholder_position = Element.offset(this._placeholder);\n                from_top = target_position[1] > placeholder_position[1];\n                from_left = target_position[0] > placeholder_position[0];\n                if( ( from_top && from_left ) || ( !from_top && !from_left ) ) {\n                    Element.insertBefore(placeholder, target);\n                } else {\n                    Element.insertAfter(placeholder, target);\n                }\n                Element.insertBefore(this._isMoving, placeholder);\n            }\n        },\n\n        /**************\n         * PUBLIC API *\n         **************/\n\n        /**\n         * Unregisters the component and removes its markup\n         * \n         * @method destroy\n         * @public\n         */\n        destroy: Common.destroyComponent,\n\n        /**\n         * Visually stops moving. \n         * Removes the placeholder as well as the styling classes.\n         * \n         * @method _movePlaceholder\n         * @public\n         */\n        stopMoving: function(){\n            this._removeMovingClasses();\n            Element.remove(this._placeholder);\n            this._placeholder = false;\n            this._isMoving = false;\n        },\n\n        /**\n         * Validate a move.\n         * This method is used by the move handler\n         * \n         * @method _movePlaceholder\n         * @param {Element} elem\n         * @public\n         */\n        validateMove: function(elem){\n            if (!elem || !this._isMoving || !this._placeholder) { return; }\n            if (elem === this._placeholder) { return; }\n            if (elem === this._isMoving) { return; }\n            if(!this._options.moveSelector || Selector.matchesSelector(elem, this._options.moveSelector)){\n                this._movePlaceholder(elem);\n            } else {\n                this.stopMoving();  \n            }\n        }\n\n    };\n\n    Common.createUIComponent(SortableList);\n\n    return SortableList;\n});","/**\n * Highlight elements as you scroll\n * @module Ink.UI.Spy_1\n * @version 1\n */\nInk.createModule('Ink.UI.Spy', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1'], function(Common, Event, Css, Element, Selector ) {\n    'use strict';\n\n    // Maps a spy target (EG a menu with links inside) to spied instances.\n    var spyTargets = [\n        // [target, [spied, spied, spied...]], ...\n    ];\n\n    function targetIndex(target) {\n        for (var i = 0, len = spyTargets.length; i < len; i++) {\n            if (spyTargets[i][0] === target) {\n                return i;\n            }\n        }\n        return null;\n    }\n\n    function addSpied(spied, target) {\n        var index = targetIndex(target);\n\n        if (index === null) {\n            spyTargets.push([target, [spied]]);\n        } else {\n            spyTargets[index][1].push(spied);\n        }\n    }\n\n    var observingOnScroll = false;\n    function observeOnScroll() {\n        if (!observingOnScroll) {\n            observingOnScroll = true;\n            Event.observe(document, 'scroll', Event.throttle(onScroll, 300));\n        }\n    }\n\n    function onScroll() {\n        for (var i = 0, len = spyTargets.length; i < len; i++) {\n            onScrollForTarget(spyTargets[i][0], spyTargets[i][1]);\n        }\n    }\n\n    function onScrollForTarget(target, spied) {\n        var activeEl = findActiveElement(spied);\n\n        // This selector finds li's to deactivate\n        var toDeactivate = Selector.select('li.active', target);\n        for (var i = 0, total = toDeactivate.length; i < total; i++) {\n            Css.removeClassName(toDeactivate[i], 'active');\n        }\n\n        if (activeEl === null) {\n            return;\n        }\n\n        // The link which should be activated has a \"href\" ending with \"#\" + name or id of the element\n        var menuLinkSelector = 'a[href$=\"#' + (activeEl.name || activeEl.id) + '\"]';\n\n        var toActivate = Selector.select(menuLinkSelector, target);\n        for (i = 0, total = toActivate.length; i < total; i++) {\n            Css.addClassName(Element.findUpwardsByTag(toActivate[i], 'li'), 'active');\n        }\n    }\n\n    function findActiveElement(spied) {\n        /* \n         * Find the element above the top of the screen, but closest to it.\n         *          _____ \n         *         |_____| element 1  (active element)\n         *\n         *      ------------------------ \n         *     |    _____               |\n         *     |   |     |  element 2   |\n         *     |   |     |              |\n         *     |   |_____|              |\n         *      ------- Viewport ------- \n         */\n\n        // Remember that getBoundingClientRect returns coordinates\n        // relative to the top left corner of the screen.\n        //\n        // So checking if it's < 0 is used to tell if\n        // the element is above the top of the screen.\n        var closest = -Infinity;\n        var closestIndex;\n        var bBox;\n        for( var i = 0, total = spied.length; i < total; i++ ){\n            bBox = spied[i].getBoundingClientRect();\n            if (bBox.top <= 0 && bBox.top > closest) {\n                closest = bBox.top;\n                closestIndex = i;\n            }\n        }\n        if (closestIndex === undefined) {\n            return null;\n        } else {\n            return spied[closestIndex];\n        }\n    }\n\n    /**\n     * Spy is an UI component which tells the user which section is currently visible.\n     * Spy can be used to highlight a menu item for the section which is visible to the user.\n     * You need two things: A menu element (which contains your links inside `li` tags), and an element containing your section's content.\n\t * The links must be inside `li` tags. These will get the 'active' class, to signal which item is currently visible. In your CSS you need to add styling for this class.\n     * To use Ink.UI.Spy for more than one section, loop through your sections (as you see in the sample below), or just load `autoload.js` and set add the `data-spy=\"true\"` attribute to your sections.\n     * The currently visible element's corresponding link in the menu gets the 'visible' class added to it.\n     *\n     * @class Ink.UI.Spy\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement} selector\n     * @param {Object} [options] Options\n     * @param {DOMElement|String}     options.target          Target menu where the spy will highlight the right option.\n     *\n     * @sample Ink_UI_Spy_1.html\n     */\n    function Spy(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Spy._name = 'Spy_1';\n\n    Spy._optionDefinition = {\n        target: ['Element', undefined],\n        activeClass: ['String', 'active'] // [todo] Spy#_options.activeClass\n    };\n\n    Spy.prototype = {\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function() {\n            addSpied(this._element, this._options.target);\n            observeOnScroll();\n            onScroll();\n        }\n    };\n\n    Common.createUIComponent(Spy);\n\n    return Spy;\n\n});\n","/**\n * Stacking items in columns\n * @module Ink.UI.Stacker_1\n * @version 1\n **/\n\nInk.createModule('Ink.UI.Stacker', 1, ['Ink.UI.Common_1', 'Ink.Dom.Event_1', 'Ink.Dom.Element_1'], function(Common, InkEvent, InkElement) {\n    'use strict';\n\nfunction Stacker() {\n    Common.BaseUIComponent.apply(this, arguments);\n}\n\nStacker._name = 'Stacker_1';\n\nStacker._optionDefinition = {\n    column: ['String', '.stacker-column'],\n    item: ['String', '.stacker-item'],\n\n    // [3.0.0] review this when we have info about our breakpoints from the CSS\n    customBreakPoints: ['Object', null], // Must be: {xlarge: {max: 9999, min: 1281, cols: 5}, large:{max:1280, min:1001, cols:4} medium:{max:1000, min:801,cols:3}, ...etc..}\n    largeMax: ['Number', Number.MAX_VALUE],\n    largeMin: ['Number', 961],\n    mediumMax: ['Number', 960],\n    mediumMin: ['Number', 651],\n    smallMax: ['Number', 650],\n    smallMin: ['Number', 0],\n\n    largeCols: ['Integer', 3],\n    mediumCols: ['Integer', 2],\n    smallCols: ['Integer', 1],\n\n    isOrdered: ['Boolean', true],\n    onRunCallback: ['Function', null],\n    onResizeCallback: ['Function', null],\n    onAPIReloadCallback: ['Function', null]\n};\n\nStacker.prototype = {\n    /**\n     * This module combines several stacks of items together, in smaller screen sizes.\n     *\n     * The purpose is to have several stacks of items which may have different heights and as such cannot be used because of `float: left` quirks.\n     *\n     * For example, when you have three different columns of information:\n     *\n     *     [col. A: 1] [col. B: 1] [col. C: 1]\n     *     [col. B: 2] [col. C: 2] [col. C: 2]\n     *\n     * and the screen resizes and you need a layout of 2 columns, Stacker reorders the stacks so that you get:\n     *\n     *     [col. A: 1] [col. B: 1]\n     *     [col. C: 1] [col. A: 2]\n     *     [col. B: 2] [col. C: 2]\n     * \n     * Note: If you just want to use a different amount of columns for your items in several viewports, but these items are guaranteed to have a fixed height, don't use this module. Use the `small-*`, `medium-*` and `large-*` classes instead.\n     *\n     * @class Ink.UI.Stacker_1\n     *\n     * @constructor\n     * @param {DOMElement|String}   [container]                                     Element which contains the stacks (identified by the options.column selector)\n     * @param {Object}              [options]                                       Options object.\n     * @param {String}              [options.column]                                Selector for the the columns inside the container element. Defaults to '.stacker-column'.\n     * @param {String}              [options.item]                                  Selector for the items in your stack. Defaults to '.stacker-item'.\n     * @param {Object}              [options.customBreakPoints]                     Options for each breakpoint name. Use this if you have more breakpoints than Ink by default (`large`, `medium`, `small`)\n     * @param {Object}              [options.customBreakpoints.BREAKPOINT_NAME]     Custom breakpoints object.\n     * @param {String}              options.customBreakpoints.BREAKPOINT_NAME.max   Maximum screen size as seen in your media query\n     * @param {String}              options.customBreakpoints.BREAKPOINT_NAME.min   Minimum screen size as seen in your media query\n     * @param {String}              options.customBreakpoints.BREAKPOINT_NAME.cols  Column count for this size.\n     * @param {Number}              [options.largeMax]                              Upper bound of `large` breakpoint\n     * @param {Number}              [options.largeMin]                              Lower bound of `large` breakpoint. Defaults to 961.\n     * @param {Number}              [options.mediumMax]                             Upper bound of `medium` breakpoint. Defaults to 960.\n     * @param {Number}              [options.mediumMin]                             Lower bound of `medium` breakpoint. Defaults to 651.\n     * @param {Number}              [options.smallMax]                              Upper bound of `small` breakpoint. Defaults to 650.\n     * @param {Number}              [options.smallMin]                              Lower bound of `small` breakpoint\n     *\n     * @param {Integer}             [options.largeCols]                             Number of columns in the `large` viewport. Defaults to 3.\n     * @param {Integer}             [options.mediumCols]                            Number of columns in the `medium` viewport. Defaults to 2.\n     * @param {Integer}             [options.smallCols]                             Number of columns in the `small` viewport. Defaults to 1.\n     *\n     * @param {Boolean}             [options.isOrdered]                             When false, doesn't reorder stacks when combining them.\n     * @param {Function}            [options.onRunCallback]                         Called when instantiated.\n     * @param {Function}            [options.onResizeCallback]                      Called when the window resizes.\n     * @param {Function}            [options.onAPIReloadCallback]                   Called when the reload function executes.\n     *\n     * @sample Ink_UI_Stacker_1.html\n     **/\n    _init: function() {\n        this._aList = []; \n\n        this._curLayout = 'large';\n\n        // [todo] is this needed?\n        this._runFirstTime = false;\n\n        this._getPageItemsToList();\n\n        if(this._canApplyLayoutChange() || !this._runFirstTime) {\n            this._runFirstTime = true;\n            this._applyLayoutChange();\n            if(typeof(this._options.onRunCallback) === 'function') {\n                this._options.onRunCallback(this._curLayout);\n            }\n        }\n        this._addEvents();\n    },\n\n    /**\n     * Adds an item to the end of your stacks.\n     * Call `reloadItems()` when you are done adding items.\n     * @method addItem\n     * @param {DOMElement} item     Element\n     **/\n    addItem: function(item) {\n        this._aList.push(item);\n    },\n\n    /**\n     * Updates the layout of your items.\n     * Call this method after adding items or changing their dimensions. This method is automatically called when the window resizes.\n     *\n     * @method reloadItems\n     **/\n    reloadItems: function() {\n        this._applyLayoutChange();\n        if(typeof(this._options.onAPIReloadCallback) === 'function') {\n            this._options.onAPIReloadCallback(this._curLayout);\n        }\n    },\n\n    _addEvents: function() {\n        InkEvent.observe(window, 'resize', Ink.bindEvent(this._onResize, this));\n    },\n\n    _onResize: function() {\n        if(this._canApplyLayoutChange()) {\n            this._removeDomItems();\n            this._applyLayoutChange();\n            if(typeof(this._options.onResizeCallback) === 'function') {\n                this._options.onResizeCallback(this._curLayout);\n            }\n        }\n    },\n\n    _setCurLayout: function() {\n        var viewportWidth = InkElement.viewportWidth();\n        if(this._options.customBreakpoints && typeof(this._options.customBreakPoints) === 'object') {\n            for(var prop in this._options.customBreakPoints) {\n                if(this._options.customBreakPoints.hasOwnProperty(prop)) {\n                    if(viewportWidth >= Number(this._options.customBreakPoints[prop].min) && viewportWidth <= Number(this._options.customBreakPoints[prop].max) && this._curLayout !== prop) {\n                        this._curLayout = prop;\n                        return;\n                    } \n                }\n            }\n        } else {\n            if(viewportWidth <= Number(this._options.largeMax) && viewportWidth >= Number(this._options.largeMin) && this._curLayout !== 'large') {\n                this._curLayout = 'large';\n            } else if(viewportWidth >= Number(this._options.mediumMin) && viewportWidth <= Number(this._options.mediumMax) && this._curLayout !== 'medium') {\n                this._curLayout = 'medium';\n            } else if(viewportWidth >= Number(this._options.smallMin) && viewportWidth <= Number(this._options.smallMax) && this._curLayout !== 'small') {\n                this._curLayout = 'small';\n            }\n        }\n    },\n\n    _getColumnsToShow: function() {\n        if(this._options.customBreakPoints && typeof(this._options.customBreakPoints) === 'object') {\n            return Number(this._options.customBreakPoints[this._curLayout].cols);\n        } else {\n            return Number(this._options[this._curLayout+'Cols']);\n        }\n    },\n\n    _canApplyLayoutChange: function() {\n        var curLayout = this._curLayout;\n        this._setCurLayout();\n        if(curLayout !== this._curLayout) {\n            return true;\n        }\n        return false;\n    },\n\n    _getPageItemsToList: function() {\n        this._aColumn = Ink.ss(this._options.column, this._element);\n        var totalCols = this._aColumn.length;\n        var index = 0;\n        if(totalCols > 0) {\n            for(var i=0; i < this._aColumn.length; i++) {\n                var aItems = Ink.ss(this._options.item, this._aColumn[i]);\n                for(var j=0; j < aItems.length; j++) {\n                    if(this._options.isOrdered) {\n                        index = i + (j * totalCols);\n                    }\n                    this._aList[index] = aItems[j];\n                    if(!this._options.isOrdered) {\n                        index++;\n                    }\n                    //aItems[j].style.height = (100 + (Math.random() * 100))+'px';\n                    aItems[j].parentNode.removeChild(aItems[j]);\n                }\n            }\n            if(this._aList.length > 0 && this._options.isOrdered) {\n                var aNewList = [];\n                for(var ii=0; ii < this._aList.length; ii++) {\n                    if(typeof(this._aList[ii]) !== 'undefined') {\n                        aNewList.push(this._aList[ii]);\n                    }\n                }\n                this._aList = aNewList;\n            }\n        }\n    }, \n\n    _removeDomItems: function() {\n        var totalCols = this._aColumn.length;\n        if(totalCols > 0) {\n            for(var i=0; i < totalCols; i++) {\n                var aItems = Ink.ss(this._options.item, this._aColumn[i]);\n                for(var j=aItems.length - 1; j >= 0; j--) {\n                    aItems[j].parentNode.removeChild(aItems[j]);\n                }\n            }\n        }\n    },\n\n    _applyLayoutChange: function() {\n        var totalCols = this._getColumnsToShow();\n        var totalItems = this._aList.length;\n        var index = 0;\n        var countCol = 0;\n        if(totalCols > 0) {\n            while(countCol < totalCols) {\n                this._aColumn[countCol].appendChild(this._aList[index]);\n                index++;\n                countCol++;\n                if(index === totalItems) {\n                    return;\n                }\n                if(countCol === totalCols) {\n                    countCol = 0;\n                }\n            }\n        }\n    }\n};\n\nCommon.createUIComponent(Stacker);\n\nreturn Stacker;\n\n});\n","/**\n * Stick elements to the viewport\n * @module Ink.UI.Sticky_1\n * @version 1\n */\nInk.createModule('Ink.UI.Sticky', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Element_1','Ink.Dom.Css_1'], function(Common, Event, Element, Css) {\n    'use strict';\n\n    /**\n     * Ink.UI.Sticky makes an element \"stick\" to the screen and stay in the same place as the user scrolls. To use it, just select an element as you create the Sticky. As you scroll past it, it will stick to the top of the screen.\n     * The `activateInLayouts` option controls in what layouts this behaviour happens. By default, it is disabled for the `small` and `tiny` layouts. Pass a comma-separated string to choose just the layouts you need. You can use the `offsetTop` option if you want it to keep some distance from the top of the screen. To avoid it going under the footer of your page, pass a selector to your footer as the `bottomElement` option.\n     *\n     * @class Ink.UI.Sticky\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector                    Element or selector\n     * @param {Object}              [options] Options           Options object.\n     * @param {Number}              [options.offsetBottom]      Number of pixels of distance from the bottomElement. Defaults to 0.\n     * @param {Number}              [options.offsetTop]         Number of pixels of distance from the topElement. Defaults to 0.\n     * @param {Boolean}             [options.inlineDimensions]  Set to false to disable setting inline CSS dimensions. Use this if you want to use CSS to define your own dimensions. Defaults to true.\n     * @param {Boolean}             [options.inlinePosition]    Set to false to disable setting inline CSS positions. Use this if you want to use CSS to define your own positioning. Defaults to true.\n     * @param {String}              [options.wrapperClass]      CSS class for the wrapper element. Defaults to 'ink-sticky-wrapper'.\n     * @param {String}              [options.stickyClass]       CSS class to stick the element to the screen. Defaults to 'ink-sticky-stuck'.\n     * @param {String}              [options.topElement]        CSS Selector that specifies a top element with which the component could collide.\n     * @param {String}              [options.bottomElement]     CSS Selector that specifies a bottom element with which the component could collide.\n     * @param {Array|String}        [options.activateInLayouts] Layouts in which the sticky behaviour is present. Pass an array or comma-separated string. Defaults to 'tiny,small,medium,large,xlarge'.\n     *\n     * @sample Ink_UI_Sticky_1.html\n     */\n    function Sticky(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Sticky._name = 'Sticky_1';\n\n    Sticky._optionDefinition = {\n        offsetBottom: ['Integer', 0],\n        offsetTop: ['Integer', 0],\n        topElement: ['Element', null],\n        wrapperClass: ['String', 'ink-sticky-wrapper'],\n        stickyClass: ['String', 'ink-sticky-stuck'],\n        inlineDimensions: ['Boolean', true],\n        inlinePosition: ['Boolean', true],\n        bottomElement: ['Element', null],\n        activateInLayouts: ['String', 'tiny,small,medium,large,xlarge']\n    };\n\n    Sticky.prototype = {\n\n        /**\n         * Init function called by the constructor\n         *\n         * @method _init\n         * @private\n         */\n        _init: function() {\n            // Because String#indexOf is compatible with lt IE8 but not Array#indexOf\n            this._options.activateInLayouts = this._options.activateInLayouts.toString();\n\n            this._dims = null;  // force a recalculation of the dimensions later\n\n            this._options.offsetTop = parseInt(this._options.offsetTop, 10) || 0;\n            this._options.offsetBottom = parseInt(this._options.offsetBottom, 10) || 0;\n\n            if (this._options.topElement) {\n                this._options.topElement = Common.elOrSelector(this._options.topElement, 'Top Element');\n            }\n            if (this._options.bottomElement) {\n                this._options.bottomElement = Common.elOrSelector(this._options.bottomElement, 'Sticky bottom Element');\n            }\n\n            this._wrapper = Element.create('div', { className: this._options.wrapperClass });\n            Element.wrap(this._element, this._wrapper);\n\n            var scrollTarget = document.addEventListener ? document : window;\n            this._onScroll = Ink.bind(Event.throttle(this._onScroll, 33), this);  // Because this is called directly.\n            Event.observe( scrollTarget, 'scroll', this._onScroll );\n            Event.observe( window, 'resize', Ink.bindEvent(Event.throttle(this._onResize, 100), this) );\n            this._onScroll();\n        },\n\n        /**\n         * Returns whether the sticky is disabled in the current view\n         *\n         * @method isDisabledInLayout\n         * @private\n         */\n        _isDisabledInLayout: function () {\n            var currentLayout = Common.currentLayout();\n            if (!currentLayout) { return false; }\n            return this._options.activateInLayouts.indexOf(currentLayout) === -1;\n        },\n\n        /**\n         * Scroll handler.\n         *\n         * @method _onScroll\n         * @private\n         */\n        _onScroll: function(){\n            var dims = this._getDims();\n            var scrollHeight = Element.scrollHeight();\n\n            var unstick = this._isDisabledInLayout() ||\n                scrollHeight <= dims.top - this._options.offsetTop ||\n                (this._options.topElement && this._options.topElement.getBoundingClientRect().bottom + this._options.offsetTop > 0);\n\n            if( unstick ) {\n                // We're on top, no sticking. position:static is the \"normal\" position.\n                this._unstick();\n                return;\n            }\n\n            // If we stick it now, what will be its boundingClientRect.bottom ?\n            var bottomOfSticky = this._options.offsetTop + dims.height + Element.scrollHeight();\n            var maxBottomOfSticky = document.body.scrollHeight;\n\n            if (this._options.bottomElement) {\n                maxBottomOfSticky =\n                    this._options.bottomElement.getBoundingClientRect().top +\n                    Element.scrollHeight();\n            }\n\n            maxBottomOfSticky -= this._options.offsetBottom;\n\n            if ( bottomOfSticky < maxBottomOfSticky ) {\n                // Stick to screen!\n                this._stickTo('screen');\n            } else {\n                // Stick to bottom\n                this._stickTo('bottom');\n            }\n        },\n\n        /**\n         * Have the sticky stick nowhere, to the screen, or to the bottom.\n         *\n         * @method _stickTo\n         * @private\n         */\n        _stickTo: function (where) {\n            var style = this._element.style;\n            var dims = this._getDims();\n\n            Css.addClassName(this._element, this._options.stickyClass);\n            this._wrapper.style.height = dims.height + 'px';\n\n            this._inlineDimensions(dims.height + 'px', dims.width + 'px');\n\n            if (this._options.inlinePosition === false) {\n                return;\n            }\n\n            style.left = dims.left + 'px';\n\n            if (where === 'screen') {\n                style.bottom = null;\n                style.top = this._options.offsetTop + 'px';\n            } else if (where === 'bottom') {\n                // Distance between bottom of sticky and bottom of document\n                var bottom = this._getBottomOffset();\n\n                // Distance between bottom of viewport and bottom of document\n                var bottomOfViewport = Element.scrollHeight() + Element.viewportHeight();\n                var toBottomOfDocument = Element.pageHeight() - bottomOfViewport;\n\n                style.bottom = bottom - toBottomOfDocument + 'px';\n                style.top = 'auto';\n            }\n        },\n\n        /**\n         * \"unstick\" the sticky from the screen or bottom of the document\n         * @method _unstick\n         * @private\n         */\n        _unstick: function () {\n            Css.removeClassName(this._element, this._options.stickyClass);\n            // deinline dimensions of our root element\n            this._inlineDimensions(null, null);\n\n            // deinline the position of our root element\n            if (this._options.inlinePosition) {\n                this._element.style.left = null;\n                this._element.style.top = null;\n                this._element.style.bottom = null;\n            }\n\n            // deinline dimensions of wrapper\n            this._wrapper.style.height = null;\n            this._wrapper.style.width = null;\n\n            // Break the \"getDims\" cache\n            this._dims = null;\n        },\n\n        /**\n         * Resize handler\n         *\n         * @method _onResize\n         * @private\n         */\n        _onResize: function(){\n            this._dims = null;  // Blow the cache so _getDims recalculates\n            this._onScroll();\n        },\n\n        /**\n         * Recalculate the \"dims\" cache, or get it.\n         *\n         * The \"dims\" cache is to be set to null when the element is liable to have changed dimensions\n         *\n         * (eg: on resize)\n         *\n         **/\n        _getDims: function () {\n            if (this._dims !== null) { return this._dims; }\n\n            var style = this._element.style;\n\n            // We unstick the sticky so we can measure.\n            var oldPosition = style.position;\n            var oldWidth = style.width;\n\n            style.position = 'static'; // [todo] this should be a class toggle\n            style.width = null;\n\n            var dimensionsInStatic = Element.outerDimensions(this._element);\n            var rect = this._wrapper.getBoundingClientRect();\n            this._dims = {\n                height: dimensionsInStatic[1],\n                width: dimensionsInStatic[0],\n                left: rect.left + Element.scrollWidth(),\n                top: rect.top + Element.scrollHeight()\n            };\n\n            style.position = oldPosition;\n            style.width = oldWidth;\n\n            return this._dims;\n        },\n\n        /**\n         * Set style.height and style.width, but not if options.inlineDimensions === false\n         *\n         * @method _inlineDimensions\n         * @private\n         */\n        _inlineDimensions: function (height, width) {\n            if (this._options.inlineDimensions) {\n                this._element.style.height = height;\n                this._element.style.width = width;\n            }\n        },\n\n        /**\n         * Get the distance between the bottom of the element and the bottom of the page\n         *\n         * @method _getBottomOffset\n         * @private\n         */\n        _getBottomOffset: function () {\n            var bottom = this._options.offsetBottom;\n            if (this._options.bottomElement) {\n                bottom += Element.pageHeight() -\n                    Element.offsetTop(this._options.bottomElement);\n            }\n            return bottom;\n        }\n    };\n\n    Common.createUIComponent(Sticky);\n\n    return Sticky;\n\n});\n","/**\n * Swipe gestures\n * @module Ink.UI.Swipe_1\n * @version 1\n */\nInk.createModule('Ink.UI.Swipe', '1', ['Ink.Dom.Event_1', 'Ink.Dom.Element_1', 'Ink.UI.Common_1'], function(InkEvent, InkElement, Common) {\n    'use strict';\n\n    /**\n     * Subscribe swipe gestures.\n     *\n     * Supports filtering swipes be any combination of the criteria supported in the options.\n     *\n     * -----\n     *\n     * Arguments received by the callbacks\n     * -----------------------------------\n     *\n     * The `onStart`, `onMove`, and `onEnd` options receive as argument an object containing:\n     *\n     *   - `event`: the DOMEvent object\n     *   - `element`: the target element\n     *   - `Instance`: the `Ink.UI.Swipe_1` instance\n     *   - `position`: `Array` with `[x, y]` coordinates of current position\n     *   - `dt`: Time passed between now and the first event (onMove only)\n     *   - `gesture`: an Array containing [x,y] coordinates of every touchmove event received (only if options.storeGesture is enabled) (onEnd only)\n     *   - `time`: an Array containing all the `dt` values for every touchmove event (onEnd only)\n     *   - `overallMovement`: X and Y distance traveled by the touch movement (`[x, y]`) (onEnd only)\n     *   - `overallTime`: total time passed (onEnd only)\n     *\n     * @class Ink.UI.Swipe\n     * @constructor\n     * @param {String|DOMElement}   el                      Element or Selector\n     * @param {Object}              options                 Options Object\n     * @param {Function}            [options.onEnd]         Callback function for the `touchend` event. Gets all the gesture information, and is filtered by min/max Dist and Duration options (see below)\n     * @param {Function}            [options.onStart]       Callback function for `touchstart` event.\n     * @param {Function}            [options.onMove]        Callback function for every `touchmove` event. Gets current gesture information.\n     * @param {Number}              [options.minDist]       Minimum allowed distance, in pixels.\n     * @param {Number}              [options.maxDist]       Maximum allowed distance, in pixels.\n     * @param {Number}              [options.minDuration]   Minimum allowed duration, in seconds.\n     * @param {Number}              [options.maxDuration]   Maximum allowed duration, in seconds.\n     * @param {String}              [options.axis]          If either 'x' or 'y' is passed, only swipes where the dominant axis is the given one trigger the callback\n     * @param {String}              [options.storeGesture]  If to store gesture information and provide it to the callback. Defaults to true.\n     * @param {String}              [options.stopEvents]    Flag to stop (default and propagation) of the received events. Defaults to true.\n     *\n     *\n     * @sample Ink_UI_Swipe_1.html\n     */\n    function Swipe() {\n        if (typeof arguments[1] === 'function') {\n            arguments[1] = { onEnd: arguments[1] };\n        }\n\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Swipe._name = 'Swipe_1';\n\n    Swipe._optionDefinition = {\n        onEnd:          ['Function', undefined],\n        onStart:        ['Function', undefined],\n        onMove:         ['Function', undefined],\n        minDist:        ['Number',   undefined],      // in pixels\n        maxDist:        ['Number',   undefined],\n        minDuration:    ['Number',   undefined],      // in seconds\n        maxDuration:    ['Number',   undefined],\n        axis:           ['String',   undefined],       // x | y\n        storeGesture:   ['Boolean',  false],\n        stopEvents:     ['Boolean',  true]\n    };\n\n    Swipe.prototype = {\n        _supported: ('ontouchstart' in document.documentElement),\n\n        _init: function() {\n            this._handlers = {\n                down: Ink.bindEvent(this._onDown, this),\n                move: Ink.bindEvent(this._onMove, this),\n                up:   Ink.bindEvent(this._onUp, this)\n            };\n\n            var db = document.body;\n            InkEvent.observe(db, 'touchstart', this._handlers.down);\n            if (this._options.storeGesture || this._options.onMove) {\n                InkEvent.observe(db, 'touchmove', this._handlers.move);\n            }\n            InkEvent.observe(db, 'touchend', this._handlers.up);\n            this._isOn = false;\n        },\n\n        _isMeOrParent: function(el, parentEl) {\n            if (!el) {return;}\n            do {\n                if (el === parentEl) { return true; }\n                el = el.parentNode;\n            } while (el);\n            return false;\n        },\n\n        _pushGesture: function (coords, dt) {\n            if (this._options.storeGesture) {\n                this._gesture.push(coords);\n                this._time.push(dt);\n            }\n        },\n\n        _onDown: function(event) {\n            if (event.changedTouches.length !== 1) { return; }\n            if (!this._isMeOrParent(event.target, this._element)) { return; }\n\n            if( this._options.stopEvents === true ){\n                InkEvent.stop(event);\n            }\n            event = event.changedTouches[0];\n            this._isOn = true;\n            this._target = event.target;\n\n            this._t0 = +new Date();\n            this._p0 = [event.pageX, event.pageY];\n\n            if (this._options.storeGesture) {\n                this._gesture = [];\n                this._time    = [];\n            }\n\n            this._pushGesture(this._p0, 0);\n\n            if (this._options.onStart) {\n                this._options.onStart({\n                    event: event,\n                    element: this._element,\n                    instance: this,\n                    position: this._p0,\n                    dt: 0\n                });\n            }\n        },\n\n        _onMove: function(event) {\n            if (!this._isOn || event.changedTouches.length !== 1) { return; }\n            if( this._options.stopEvents === true ) {\n                InkEvent.stop(event);\n            }\n\n            event = event.changedTouches[0];\n            var t1 = +new Date();\n            var dt = (t1 - this._t0);\n\n            var gesture = [event.pageX, event.pageY];\n\n            this._pushGesture(gesture, dt);\n\n            if (this._options.onMove) {\n                this._options.onMove({\n                    event: event,\n                    element: this._element,\n                    instance: this,\n                    position: gesture,\n                    dt: dt\n                });\n            }\n        },\n\n        _onUp: function(event) {\n            if (!this._isOn || event.changedTouches.length !== 1) { return; }\n\n            if( this._options.stopEvents === true ){\n                InkEvent.stop(event);\n            }\n            event = event.changedTouches[0];   // TODO SHOULD CHECK IT IS THE SAME TOUCH\n            this._isOn = false;\n\n            var t1 = +new Date();\n            var p1 = [event.pageX, event.pageY];\n            var dt = (t1 - this._t0);\n            var dr = [\n                p1[0] - this._p0[0],\n                p1[1] - this._p0[1]\n            ];\n            var dist = Math.sqrt(dr[0]*dr[0] + dr[1]*dr[1]);\n            var axis = Math.abs(dr[0]) > Math.abs(dr[1]) ? 'x' : 'y';\n\n            var o = this._options;\n            if (o.minDist     && dist <   o.minDist) {     return; }\n            if (o.maxDist     && dist >   o.maxDist) {     return; }\n            if (o.minDuration && dt   <   o.minDuration) { return; }\n            if (o.maxDuration && dt   >   o.maxDuration) { return; }\n            if (o.axis        && axis !== o.axis)    {     return; }\n\n            if (this._options.onEnd) {\n                this._options.onEnd({\n                    event: event,\n                    element: this._element,\n                    instance: this,\n                    gesture: this._gesture,\n                    time: this._time,\n                    axis: axis,\n                    overallMovement: dr,\n                    overallTime: dt\n                });\n            }\n        }\n    };\n\n    Common.createUIComponent(Swipe);\n\n    return Swipe;\n});\n","/**\n * Sort and paginate tabular data\n * @module Ink.UI.Table_1\n * @version 1\n */\nInk.createModule('Ink.UI.Table', '1', ['Ink.Util.Url_1','Ink.UI.Pagination_1','Ink.Net.Ajax_1','Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1','Ink.Util.Array_1','Ink.Util.String_1', 'Ink.Util.Json_1'], function(InkUrl,Pagination, Ajax, Common, Event, Css, Element, Selector, InkArray, InkString, Json) {\n    'use strict';\n\n    var rNumber = /\\d/g;\n    // Turn into a number, if we can. For sorting data which could be numeric or not.\n    function maybeTurnIntoNumber(value) {\n        if( !isNaN(value) && rNumber.test(value) ){\n            return parseInt(value, 10);\n        } else if( !isNaN(value) ){\n            return parseFloat(value);\n        }\n        return value;\n    }\n    function cmp (a, b) {\n        if( a === b ){\n            return 0;\n        }\n        return ( ( a > b ) ? 1 : -1 );\n    }\n    // cmp function for comparing data which might be a number.\n    function numberishEnabledCmp (a, b) {\n        var aValue = maybeTurnIntoNumber(Element.textContent(a));\n        var bValue = maybeTurnIntoNumber(Element.textContent(b));\n\n        return cmp(aValue, bValue);\n    }\n    // Object.keys polyfill\n    function keys(obj) {\n        if (typeof Object.keys !== 'undefined') {\n            return Object.keys(obj);\n        }\n        var ret = [];\n        for (var k in obj) if (obj.hasOwnProperty(k)) {\n            ret.push(k);\n        }\n        return ret;\n    }\n\n    /**\n     * The Table component transforms the native/DOM table element into a sortable, paginated component.\n     * You can use this component to display data from a JSON endpoint, or from table rows in the DOM. Displaying from the DOM is more practical, but sometimes you don't want to load everything at once (if you have a HUGE table). In those cases, you should configure Ink.UI.Table to get data from JSON endpoint.\n     * To enable sorting, just set the `data-sortable` attribute of your table headers (they must be in the `thead` of the table) to \"true\". To enable pagination, you should pass either an `Ink.UI.Pagination` instance or a selector to create the Ink.UI.Pagination element on.\n     *\n     * @class Ink.UI.Table\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector\n     * @param {Object}              [options] Options\n     * @param {Number}              [options.pageSize]                      Number of rows per page. Omit to avoid paginating.\n     * @param {String}              [options.endpoint]                      Endpoint to get the records via AJAX. Omit if you don't want to do AJAX\n     * @param {Function}            [options.createEndpointUrl]             Callback to customise what URL the AJAX endpoint is at. Receives three arguments: base (the \"endpoint\" option), sort (`{ order: 'asc' or 'desc', field: fieldname }`) and page ({ page: page number, size: items per page })\n     * @param {Function}            [options.getDataFromEndPoint]           Callback to allow the user to retrieve the data himself given an URL.  Must accept two arguments: `url` and `callback`. This `callback` will take as a single argument a JavaScript object.\n     * @param {Function}            [options.processJSONRows]               Retrieve an array of rows from the data which came from AJAX.\n     * @param {Function}            [options.processJSONHeaders]            Get an object with all the headers' names as keys, and a { label, sortable } object as value.  Example: `{col1: {label: \"Column 1\"}, col2: {label: \"Column 2\", sortable: true}`.  Takes a single argument, the JSON response.\n     * @param {Function}            [options.processJSONRow]                Process a row object before it gets on the table.\n     * @param {Function}            [options.processJSONField]              Process the field data before putting it on the table.  You can return HTML, a DOM element, or a string here.  Arguments you receive: `(column, fieldData, rowIndex)`.\n     * @param {Function}            [options.processJSONField.FIELD_NAME]   The same as processJSONField, but for a particular field.\n     * @param {Function}            [options.processJSONTotalRows]          A callback where you have a chance to say how many rows are in the dataset (not only on this page) you have on the collection. You get as an argument the JSON response.\n     * @param {Function}            [options.getSortKey]                    A function taking a `{ columnIndex, columnName, data, element }` object and returning a value which serves as a sort key for the sorting operation. For example, if you want to sort by a `data-sort-key` atribute, set `getSortKey` to: function (cell) { return cell.element.getAttribute('data-sort-key'); }\n     * @param {Function}            [options.getSortKey.FIELD_NAME]         Same as `options.getSortKey`, but for a particular field.\n     * @param {Object}              [options.tdClassNames]                  An object mapping each field to what classes it gets.  Example: `{ name: \"large-10\", isBoss: \"hide-small\" }`\n     * @param {Mixed}               [options.pagination]                    Pagination instance, element or selector.\n     * @param {Object}              [options.paginationOptions]             Override the options with which we instantiate the Ink.UI.Pagination.\n     * @param {Boolean}             [options.allowResetSorting]             Allow sort order to be set to \"none\" in addition to \"ascending\" and \"descending\"\n     * @param {String|Array}        [options.visibleFields]                 Set of fields which get shown on the table\n     *\n     * @sample Ink_UI_Table_1.html\n     */\n    function Table(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Table._name = 'Table_1';\n\n    // Most processJSON* functions can just default to this.\n    function sameSame(obj) { return obj; }\n\n    Table._optionDefinition = {\n        pageSize: ['Integer', null],\n        caretUpClass: ['String', 'fa fa-caret-up'],\n        caretDownClass: ['String', 'fa fa-caret-down'],\n        endpoint: ['String', null],\n        createEndpointUrl: ['Function', null /* default func uses above option */],\n        getDataFromEndPoint: ['Function', null /* by default use plain ajax for JSON */],\n        processJSONRows: ['Function', sameSame],\n        processJSONRow: ['Function', sameSame],\n        processJSONField: ['Function', sameSame],\n        processJSONHeaders: ['Function', function (dt) { return dt.fields; }],\n        processJSONTotalRows: ['Function', function (dt) { return dt.length || dt.totalRows; }],\n        getSortKey: ['Function', null],\n        pagination: ['Element', null],\n        allowResetSorting: ['Boolean', false],\n        visibleFields: ['String', null],\n        tdClassNames: ['Object', {}],\n        paginationOptions: ['Object', null]\n    };\n\n    Table.prototype = {\n        _validate: function () {\n            if( this._element.nodeName.toLowerCase() !== 'table' ){\n                throw new Error('[Ink.UI.Table] :: The element is not a table');\n            }\n        },\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function(){\n            /**\n             * Checking if it's in markup mode or endpoint mode\n             */\n            this._markupMode = !this._options.endpoint;\n\n            if( this._options.visibleFields ){\n                this._options.visibleFields = this._options.visibleFields.toString().split(/[, ]+/g);\n            }\n\n            this._thead = this._element.tHead || this._element.createTHead();\n            this._headers = Selector.select('th', this._thead);\n\n            /**\n             * Initializing variables\n             */\n            this._handlers = {\n                thClick: null\n            };\n            this._originalFields = [\n                // field headers from the DOM\n            ];\n            this._sortableFields = {\n                // Identifies which columns are sorted and how.\n                // columnIndex: 'none'|'asc'|'desc'\n            };\n            this._originalData = this._data = [];\n            this._pagination = null;\n            this._totalRows = 0;\n\n            this._handlers.thClick = Event.observeDelegated(this._element, 'click',\n                    'thead th[data-sortable=\"true\"]',\n                    Ink.bindMethod(this, '_onThClick'));\n\n            /**\n             * If not is in markup mode, we have to do the initial request\n             * to get the first data and the headers\n             */\n            if( !this._markupMode ) {\n                /* Endpoint mode */\n                this._getData(  );\n            } else /* Markup mode */ {\n                this._resetSortOrder();\n                this._addHeadersClasses();\n\n                /**\n                 * Getting the table's data\n                 */\n                this._data = Selector.select('tbody tr', this._element);\n                this._originalData = this._data.slice(0);\n\n                this._totalRows = this._data.length;\n\n                /**\n                 * Set pagination if options tell us to\n                 */\n                this._setPagination();\n            }\n        },\n\n        /**\n         * Add the classes in this._options.tdClassNames to our table headers.\n         * @method _addHeadersClasses\n         * @private\n         */\n        _addHeadersClasses: function () {\n            var headerLabel;\n            var classNames;\n            for (var i = 0, len = this._headers.length; i < len; i++) {\n                headerLabel = Element.textContent(this._headers[i]);\n                classNames = this._options.tdClassNames[headerLabel];\n                // TODO do not find header labels this way. But how?\n                if (classNames) {\n                    Css.addClassName(this._headers[i], classNames);\n                }\n            }\n        },\n\n        /**\n         * Click handler. This will mainly handle the sorting (when you click in the headers)\n         * \n         * @method _onThClick\n         * @param {Event} event Event obj\n         * @private\n         */\n        _onThClick: function( event ){\n            var tgtEl = Event.element(event),\n                paginated = this._options.pageSize !== undefined;\n\n            Event.stop(event);\n\n            var index = InkArray.keyValue(tgtEl, this._headers, true);\n            var sortable = index !== false && this._sortableFields[index] !== undefined;\n\n            if( !sortable ){\n                return;\n            }\n\n            if( !this._markupMode && paginated ){\n                this._invertSortOrder(index, false);\n            } else {\n                if ( (this._sortableFields[index] === 'desc') && this._options.allowResetSorting ) {\n                    this._setSortOrderOfColumn(index, null);\n                    this._data = this._originalData.slice(0);\n                } else {\n                    this._invertSortOrder(index, true);\n                }\n\n                var tbody = Selector.select('tbody',this._element)[0];\n                Common.cleanChildren(tbody);\n                InkArray.each(this._data, Ink.bindMethod(tbody, 'appendChild'));\n\n                if (this._pagination) {\n                    this._pagination.setCurrent(0);\n                    this._paginate(1);\n                }\n            }\n        },\n\n        _invertSortOrder: function (index, sortAndReverse) {\n            var isAscending = this._sortableFields[index] === 'asc';\n\n            for (var i = 0, len = this._headers.length; i < len; i++) {\n                this._setSortOrderOfColumn(i, null);\n            }\n\n            if (sortAndReverse) {\n                this._sort(index);\n                if (isAscending) {\n                    this._data.reverse();\n                }\n            }\n\n            this._setSortOrderOfColumn(index, !isAscending);\n        },\n\n        _setSortOrderOfColumn: function(index, up) {\n            var header = this._headers[index];\n            var caretHtml = [''];\n            var order = 'none';\n\n            if (up === true) {\n                caretHtml = ['<i class=\"', this._options.caretUpClass, '\"></i>'];\n                order = 'asc';\n            } else if (up === false) {\n                caretHtml = ['<i class=\"', this._options.caretDownClass, '\"></i>'];\n                order = 'desc';\n            }\n\n            this._sortableFields[index] = order;\n            header.innerHTML = Element.textContent(header) + caretHtml.join('');\n        },\n\n        /**\n         * Applies and/or changes the CSS classes in order to show the right columns\n         * \n         * @method _paginate\n         * @param {Number} page Current page\n         * @private\n         */\n        _paginate: function( page ){\n            if (!this._pagination) { return; }\n\n            var pageSize = this._options.pageSize;\n\n            // Hide everything except the items between these indices\n            var firstIndex = (page - 1) * pageSize;\n            var lastIndex = firstIndex + pageSize;\n\n            InkArray.each(this._data, function(item, index){\n                if (index >= firstIndex && index < lastIndex) {\n                    Css.removeClassName(item,'hide-all');\n                } else {\n                    Css.addClassName(item,'hide-all');\n                }\n            });\n\n        },\n\n        /* register fields into this._originalFields, whether they come from JSON or a table.\n         * @method _registerFieldNames\n         * @private\n         * @param [names] The field names in an array\n         **/\n        _registerFieldNames: function (names) {\n            this._originalFields = [];\n\n            InkArray.forEach(names, Ink.bind(function (field) {\n                if( !this._fieldIsVisible(field) ){\n                    return;  // The user deems this not to be necessary to see.\n                }\n                this._originalFields.push(field);\n            }, this));\n        },\n\n        _fieldIsVisible: function (field) {\n            return !this._options.visibleFields ||\n                (this._options.visibleFields.indexOf(field) !== -1);\n        },\n\n        /**\n         * Sorts by a specific column.\n         * \n         * @method _sort\n         * @param {Number} index Column number (starting at 0)\n         * @private\n         */\n        _sort: function( index ){\n            // TODO this is THE worst way to declare field names. Incompatible with i18n and a lot of other things.\n            var fieldName = Element.textContent(this._headers[index]);\n            var keyFunction = this._options.getSortKey;\n\n            if (keyFunction) {\n                keyFunction =\n                    typeof keyFunction[fieldName] === 'function' ?\n                        keyFunction[fieldName] :\n                    typeof keyFunction === 'function' ?\n                        keyFunction :\n                        null;\n            }\n\n            var self = this;\n\n            this._data.sort(function (trA, trB) {\n                var elementA = Ink.ss('td', trA)[index];\n                var elementB = Ink.ss('td', trB)[index];\n                if (keyFunction) {\n                    return cmp(userKey(elementA), userKey(elementB));\n                } else {\n                    return numberishEnabledCmp(elementA, elementB, index);\n                }\n            });\n\n            function userKey(element) {\n                return keyFunction.call(self, {\n                    columnIndex: index,\n                    columnName: fieldName,\n                    data: Element.textContent(element),\n                    element: element\n                });\n            }\n        },\n\n        /**\n         * Assembles the headers markup\n         *\n         * @method _createHeadersFromJson\n         * @param  {Object} headers Key-value object that contains the fields as keys, their configuration (label and sorting ability) as value\n         * @private\n         */\n        _createHeadersFromJson: function( headers ){\n            this._registerFieldNames(keys(headers));\n\n            if (this._thead.children.length) { return; }\n\n            var tr = this._thead.insertRow(0);\n            var th;\n\n            for (var i = 0, len = headers.length; i < len; i++) {\n                if (this._fieldIsVisible(headers[i])) {\n                    th = Element.create('th');\n                    th = this._createSingleHeaderFromJson(headers[i], th);\n                    tr.appendChild(th);\n                    this._headers.push(th);\n                }\n            }\n        },\n\n        _createSingleHeaderFromJson: function (header, th) {\n            if (header.sortable) {\n                th.setAttribute('data-sortable','true');\n            }\n\n            if (header.label){\n                Element.setTextContent(th, header.label);\n            }\n\n            return th;\n        },\n\n        /**\n         * Reset the sort order as marked on the table headers to \"none\"\n         *\n         * @method _resetSortOrder\n         * @private\n         */\n        _resetSortOrder: function(){\n            /**\n             * Setting the sortable columns and its event listeners\n             */\n            for (var i = 0, len = this._headers.length; i < len; i++) {\n                var dataset = Element.data( this._headers[i] );\n                if (dataset.sortable && dataset.sortable.toString() === 'true') {\n                    this._sortableFields[i] = 'none';\n                }\n            }\n        },\n\n        /**\n         * This method gets the rows from AJAX and places them as <tr> and <td>\n         *\n         * @method _createRowsFromJSON\n         * @param  {Object} rows Array of objects with the data to be showed\n         * @private\n         */\n        _createRowsFromJSON: function( rows ){\n            var tbody = Selector.select('tbody',this._element)[0];\n\n            if( !tbody ){\n                tbody = document.createElement('tbody');\n                this._element.appendChild( tbody );\n            } else {\n                Element.setHTML(tbody, '');\n            }\n\n            this._data = [];\n            var row;\n\n            for (var trIndex in rows) {\n                if (rows.hasOwnProperty(trIndex)) {\n                    row = this._options.processJSONRow(rows[trIndex]);\n                    this._createSingleRowFromJson(tbody, row, trIndex);\n                }\n            }\n\n            this._originalData = this._data.slice(0);\n        },\n\n        _createSingleRowFromJson: function (tbody, row, rowIndex) {\n            var tr = document.createElement('tr');\n            tbody.appendChild( tr );\n            for( var field in row ){\n                if (row.hasOwnProperty(field)) {\n                    this._createFieldFromJson(tr, row[field], field, rowIndex);\n                }\n            }\n            this._data.push(tr);\n        },\n\n        _createFieldFromJson: function (tr, fieldData, fieldName, rowIndex) {\n            if (!this._fieldIsVisible(fieldName)) { return; }\n\n            var processor =\n                this._options.processJSONField[fieldName] ||  // per-field callback\n                this._options.processJSONField;  // generic callback\n\n            var result;\n            if (typeof processor === 'function') {\n                result = processor(fieldData, fieldName, rowIndex);\n            } else {\n                result = fieldData;\n            }\n            var elm = this._elOrFieldData(result);\n\n            var className = this._options.tdClassNames[fieldName];\n            if (className) {\n                Css.addClassName(elm, className);\n            }\n\n            tr.appendChild(elm);\n        },\n\n        _elOrFieldData: function (processed) {\n            if (Common.isDOMElement(processed)) {\n                return processed;\n            }\n\n            var isString = typeof processed === 'string';\n            var isNumber = typeof processed === 'number';\n            var elm = Element.create('td');\n\n            if (isString && /^\\s*?</.test(processed)) {\n                Element.setHTML(elm, processed);\n            } else if (isString || isNumber) {\n                Element.setTextContent(elm, processed);\n            } else {\n                throw new Error('Ink.UI.Table Unknown result from processJSONField: ' + processed);\n            }\n\n            return elm;\n        },\n\n        /**\n         * Sets the AJAX endpoint.\n         * Useful to change the endpoint in runtime.\n         *\n         * @method setEndpoint\n         * @public\n         * @param {String} endpoint New endpoint\n         */\n        setEndpoint: function( endpoint, currentPage ){\n            if( !this._markupMode ){\n                this._options.endpoint = endpoint;\n                if (this._pagination) {\n                    this._pagination.setCurrent((!!currentPage) ? parseInt(currentPage,10) : 0 );\n                }\n            }\n        },\n\n        /**\n         * Sets the instance's pagination, if necessary.\n         *\n         * Precondition: this._totalRows needs to be known.\n         *\n         * @method _setPagination\n         * @private\n         */\n        _setPagination: function(){\n            /* If user doesn't say they want pagination, bail. */\n            if( this._options.pageSize == null ){ return; }\n\n            /**\n             * Fetch pagination from options. Can be a selector string, an element or a Pagination instance.\n             */\n            var paginationEl = this._options.pagination;\n\n            if ( paginationEl instanceof Pagination ) {\n                this._pagination = paginationEl;\n                return;\n            }\n\n            if (!paginationEl) {\n                paginationEl = Element.create('nav', {\n                    className: 'ink-navigation',\n                    insertAfter: this._element\n                });\n                Element.create('ul', {\n                    className: 'pagination',\n                    insertBottom: paginationEl\n                });\n            }\n\n            var paginationOptions = Ink.extendObj({\n                totalItemCount: this._totalRows,\n                itemsPerPage: this._options.pageSize,\n                onChange: Ink.bind(function (_, pageNo) {\n                    this._paginate(pageNo + 1);\n                }, this)\n            }, this._options.paginationOptions || {});\n\n            this._pagination = new Pagination(paginationEl, paginationOptions);\n\n            this._paginate(1);\n        },\n\n        /**\n         * Method to choose which is the best way to get the data based on the endpoint:\n         *     - AJAX\n         *     - JSONP\n         *\n         * @method _getData\n         * @private\n         */\n        _getData: function( ){\n            var sortOrder = this._getSortOrder() || null;\n            var page = null;\n\n            if (this._pagination) {\n                page = {\n                    size: this._options.pageSize,\n                    page: this._pagination.getCurrent() + 1\n                };\n            }\n\n            this._getDataViaAjax( this._getUrl( sortOrder, page) );\n        },\n\n        /**\n         * Return an object describing sort order { field: [field name] ,\n         * order: [\"asc\" or \"desc\"] }, or null if there is no sorting\n         * going on.\n         * @method _getSortOrder\n         * @private\n         */\n        _getSortOrder: function () {\n            var index;\n            for (index in this._sortableFields) if (this._sortableFields.hasOwnProperty(index)) {\n                if( this._sortableFields[index] !== 'none' ){\n                    break;\n                }\n            }\n            if (!index) {\n                return null; // no sorting going on\n            }\n            return {\n                field: this._originalFields[index],\n                order: this._sortableFields[index]\n            };\n        },\n\n        _getUrl: function (sort, page) {\n            var urlCreator = this._options.createEndpointUrl ||\n                function (endpoint, sort, page\n                        /* TODO implement filters too */) {\n                    endpoint = InkUrl.parseUrl(endpoint);\n                    endpoint.query = endpoint.query || {};\n\n                    if (sort) {\n                        endpoint.query.sortOrder = sort.order;\n                        endpoint.query.sortField = sort.field;\n                    }\n\n                    if (page) {\n                        endpoint.query['rows_per_page'] = page.size;\n                        endpoint.query['page'] = page.page;\n                    }\n\n                    return InkUrl.format(endpoint);\n                };\n\n            var ret = urlCreator(this._options.endpoint, sort, page);\n\n            if (typeof ret !== 'string') {\n                throw new TypeError('Ink.UI.Table_1: ' +\n                    'createEndpointUrl did not return a string!');\n            }\n\n            return ret;\n        },\n\n        /**\n         * Gets the data via AJAX and calls this._onAjaxSuccess with the response.\n         * \n         * Will call options.getDataFromEndpoint( Uri, callback ) if available.\n         *\n         * @param  endpointUri Endpoint to get data from, after processing.\n         */\n        _getDataViaAjax: function( endpointUri ){\n            var success = Ink.bind(function( JSONData ){\n                this._onAjaxSuccess( JSONData );\n            }, this);\n\n            if (!this._options.getDataFromEndpoint) {\n                new Ajax( endpointUri, {\n                    method: 'GET',\n                    contentType: 'application/json',\n                    sanitizeJSON: true,\n                    onSuccess: Ink.bind(function( response ){\n                        if( response.status === 200 ){\n                            success(Json.parse(response.responseText));\n                        }\n                    }, this)\n                });\n            } else {\n                this._options.getDataFromEndpoint( endpointUri, success );\n            }\n        },\n\n        _onAjaxSuccess: function (jsonResponse) {\n            var paginated = this._options.pageSize != null;\n            var rows = this._options.processJSONRows(jsonResponse);\n            this._headers = Selector.select('th', this._thead);\n\n            // If headers not in DOM, get from JSON\n            if( this._headers.length === 0 ) {\n                var headers = this._options.processJSONHeaders(\n                    jsonResponse);\n                if (!headers || !headers.length || !headers[0]) {\n                    throw new Error('Ink.UI.Table: processJSONHeaders option must return an array of objects!');\n                }\n                this._createHeadersFromJson( headers );\n                this._resetSortOrder();\n                this._addHeadersClasses();\n            }\n\n            this._createRowsFromJSON( rows );\n\n            this._totalRows = this._rowLength = rows.length;\n\n            if( paginated ){\n                this._totalRows = this._options.processJSONTotalRows(jsonResponse);\n                this._setPagination( );\n            }\n        }\n    };\n\n    Common.createUIComponent(Table);\n\n    return Table;\n\n});\n","/**\n * Display tabbed content\n * @module Ink.UI.Tabs_1\n * @version 1\n */\nInk.createModule('Ink.UI.Tabs', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1'], function(Common, Event, Css, Element, Selector) {\n    'use strict';\n\n    /**\n     * The Tabs Component offers a simple way to build a tab-separated layout, allowing you to offer multiple content in the same space with intuitive navigation.\n     * This component requires your markup to have:\n     * - A container element (this is what you call the Ink.UI.Tabs constructor on), containing everything.\n     * - An element with the `tabs-nav` class, to contain links.\n     * - Your links with `href=\"#ID_OF_SECTION\"`\n     * - Your sections with the corresponding `id` attributes and the `tabs-content` class.\n     * - The content for each section.\n     *\n     * When the user clicks in the links inside `tabs-nav`, the tab with the corresponding ID is then activated. The active tab when the tab component is initialized has its hash in the browser URL. If there is no hash, then the `active` option kicks in. Otherwise, Tabs will fall back to showing the tab corresponding to the first link.\n     * You can disable some (or all) tabs by passing an array for the `disabled` option.\n     *\n     * @class Ink.UI.Tabs\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector\n     * @param {Object}              [options]                       Options\n     * @param {Boolean}             [options.preventUrlChange]      Flag that determines if follows the link on click or stops the event\n     * @param {String}              [options.active]                ID of the tab to activate on creation\n     * @param {Array}               [options.disabled]              IDs of the tabs that will be disabled on creation\n     * @param {Function}            [options.onBeforeChange]        Callback to be executed before changing tabs\n     * @param {Function}            [options.onChange]              Callback to be executed after changing tabs\n     * \n     * @param {String}              [options.menuSelector='.tabs-nav'] Selector to find the menu element\n     * @param {String}              [options.contentSelector='.tabs-content'] Selector to find the menu element\n     * @param {String}              [options.tabSelector='.tabs-tab'] Selector to find the menu element\n     *\n     * @param {Boolean}             [options.triggerEventsOnLoad]   Trigger the above events when the page is loaded.\n     *\n     * @sample Ink_UI_Tabs_1.html\n     */\n    function Tabs() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Tabs._name = 'Tabs_1';\n\n    Tabs._optionDefinition = {\n        preventUrlChange:   ['Boolean', false],\n        active:             ['String', undefined],\n        disabled:           ['Object', []],\n        onBeforeChange:     ['Function', undefined],\n        onChange:           ['Function', undefined],\n        menuSelector:       ['String', '.tabs-nav'],\n        contentSelector:    ['String', '.tabs-content'],\n        tabSelector:        ['String', '.tabs-tab'],\n        triggerEventsOnLoad:['Boolean', true]\n    };\n\n    Tabs.prototype = {\n\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function() {\n            this._handlers = {\n                resize: Ink.bindEvent(Event.throttle(this._onResize, 100),this)\n            };\n\n            this._menu = Selector.select(this._options.menuSelector, this._element)[0];\n\n            if (!this._menu) {\n                Ink.warn('Ink.UI.Tabs: An element selected by \".tabs-nav\" needs to exist inside the element!');\n                return;\n            }\n\n            //initialization of the tabs, hides all content before setting the active tab\n            this._initializeDom();\n\n            // subscribe events\n            this._observe();\n\n            //sets the first active tab\n            this._setFirstActive();\n\n            this._handlers.resize();\n        },\n\n        /**\n         * Initialization of the tabs, hides all content before setting the active tab\n         * \n         * @method _initializeDom\n         * @private\n         */\n        _initializeDom: function(){\n            var contentTabs = Selector.select(this._options.contentSelector, this._element);\n\n            for(var i = 0; i < contentTabs.length; i++){\n                Css.addClassName(contentTabs[i], 'hide-all');\n            }\n        },\n\n        /**\n         * Subscribe events\n         * \n         * @method _observe\n         * @private\n         */\n        _observe: function() {\n            Event.on(this._menu, 'click', 'a', Ink.bindMethod(this, '_onTabClickedGeneric'));\n            Event.observe(window, 'resize', this._handlers.resize);\n        },\n\n        /**\n         * Run at instantiation, to determine which is the first active tab\n         * fallsback from window.location.href to options.active to the first not disabled tab\n         * \n         * @method _setFirstActive\n         * @private\n         */\n        _setFirstActive: function() {\n            var hash = window.location.hash;\n\n            var activeMenuLink = this._findLinkByHref(hash) ||\n                                 (this._options.active && this._findLinkByHref(this._options.active)) ||\n                                 Selector.select('.active a', this._menu)[0] ||\n                                 Selector.select('a', this._menu)[0];\n\n            if (activeMenuLink) {\n                this._changeTab(activeMenuLink, this._options.triggerEventsOnLoad);\n            }\n        },\n\n        /**\n         * Changes to the desired tab\n         * \n         * @method _changeTab\n         * @param {DOMElement} link             anchor linking to the content container\n         * @param {boolean}    runCallbacks     defines if the callbacks should be run or not\n         * @private\n         */\n        _changeTab: function(link, runCallbacks){\n            if(runCallbacks && typeof this._options.onBeforeChange !== 'undefined'){\n                this._options.onBeforeChange(this);\n            }\n\n            var selector = link.getAttribute('href');\n\n            var activeTabs = Selector.select('> li.active', this._menu);\n\n            for (var i = 0, len = activeTabs.length; i < len; i++) {\n                if (activeTabs[i] !== link) {\n                    Css.removeClassName(activeTabs[i], 'active');\n                }\n            }\n\n            if (this._activeMenuTab) {\n                Css.removeClassName(this._activeMenuTab, 'active');\n                Css.removeClassName(this._activeSection, 'active');\n                Css.addClassName(this._activeSection, 'hide-all');\n            }\n\n            this._activeMenuLink = link;\n            this._activeMenuTab = this._activeMenuLink.parentNode;\n            this._activeSection = Selector.select(selector.substr(selector.indexOf('#')), this._element)[0];\n\n            if (!this._activeSection) {\n                this._activeMenuLink = this._activeMenuTab = this._activeSection = null;\n                return;\n            }\n\n            Css.addClassName(this._activeMenuTab, 'active');\n            Css.addClassName(this._activeSection, 'active');\n            Css.removeClassName(this._activeSection, 'hide-all');\n\n            if(runCallbacks && typeof(this._options.onChange) !== 'undefined'){\n                this._options.onChange(this);\n            }\n        },\n\n        /**\n         * Generic Tab clicked handler.\n         * Just calls _onTabClicked or _onDisabledTabClicked\n         *\n         * @private\n         **/\n        _onTabClickedGeneric: function (event) {\n            event.preventDefault();\n            if (!Css.hasClassName(event.currentTarget, 'ink-disabled')) {\n                this._onTabClicked(event.currentTarget);\n            }\n        },\n\n        /**\n         * Tab clicked handler\n         * \n         * @method _onTabClicked\n         * @param {Event} ev\n         * @private\n         */\n        _onTabClicked: function(tabElm) {\n            var href = tabElm.getAttribute('href');\n            href = href.substr(href.indexOf('#'));\n\n            if (!href || Ink.i(this._dehashify(href)) === null) {\n                return;\n            }\n\n            if (!this._options.preventUrlChange) {\n                window.location.hash = href;\n            }\n\n            if (tabElm === this._activeMenuLink) {\n                return;\n            }\n            this.changeTab(tabElm);\n        },\n\n        /**\n         * Resize handler\n         * \n         * @method _onResize\n         * @private\n         */\n        _onResize: function(){\n            var currentLayout = Common.currentLayout();\n            if(currentLayout === this._lastLayout){\n                return;\n            }\n\n            // wtf\n            var smallLayout =\n                currentLayout === Common.Layouts.TINY ||\n                currentLayout === Common.Layouts.SMALL ||\n                currentLayout === Common.Layouts.MEDIUM;\n\n            if(smallLayout){\n                Css.removeClassName(this._menu, 'menu');\n                Css.removeClassName(this._menu, 'horizontal');\n                // Css.addClassName(this._menu, 'pills');\n            } else {\n                Css.addClassName(this._menu, 'menu');\n                Css.addClassName(this._menu, 'horizontal');\n                // Css.removeClassName(this._menu, 'pills');\n            }\n            this._lastLayout = currentLayout;\n        },\n\n        /*****************\n         * Aux Functions *\n         *****************/\n\n        /**\n         * Allows the hash to be passed with or without the cardinal sign\n         * \n         * @method _hashify\n         * @param {String} hash     the string to be hashified\n         * @return {String} Resulting hash\n         * @private\n         */\n        _hashify: function(hash){\n            if(!hash){\n                return \"\";\n            }\n            return hash.indexOf('#') === 0? hash : '#' + hash;\n        },\n\n        /**\n         * Removes the cardinal sign from the beginning of a string\n         **/\n        _dehashify: function(hash) {\n            if (!hash) { return ''; }\n            return ('' + hash).replace(/^#/, '');\n        },\n\n        /**\n         * Returns the anchor with the desired href\n         * \n         * @method _findLinkBuHref\n         * @param {String} href     the href to be found on the returned link\n         * @return {String|undefined} [description]\n         * @private\n         */\n        _findLinkByHref: function(href){\n            // If it's null or undefined, the following checks fail.\n            if (!href) { return null; }\n\n            // If it's a node, it could be a link or a section.\n            if (href.nodeType === 1) {\n                if (Element.isAncestorOf(href, this._element)) { return null; }  // Element is outside the tabs element.\n\n                var links = Selector.select('a', this._menu);\n                var id = href.getAttribute('id');\n\n                for (var i = 0, len = links.length; i < len; i++) {\n                    if (links[i] === href || Element.isAncestorOf(href, links[i])) {\n                        return links[i];  // We got a link\n                    } else if (id && id === this._dehashify(links[i].getAttribute('href'))) {\n                        return links[i];  // We got a section\n                    }\n                }\n\n                return null;\n            }\n\n            // Else, it's a string. It could start with \"#\" or without it.\n            href = this._hashify(href);\n            // Find a link which has a href ending with...\n            return Selector.select('a[href$=\"' + href + '\"]', this._menu)[0] || null;\n        },\n\n        /**************\n         * PUBLIC API *\n         **************/\n\n        /**\n         * Changes the active tab\n         *\n         * Pass a selector/element identifying what tab you want\n         * \n         * @method changeTab\n         * @param {String|DOMElement} selector      Selector of the desired tab or the link that links to it\n         * @public\n         */\n        changeTab: function(selector) {\n            selector = this._findLinkByHref(selector);\n\n            if(!selector || Css.hasClassName(selector, 'ink-disabled')){\n                return;\n            }\n\n            this._changeTab(selector, true);\n        },\n\n        /**\n         * Disables the desired tag\n         * \n         * @method disable\n         * @param {String|DOMElement} selector      the id of the desired tab or the link that links to it\n         * @public\n         */\n        disable: function(selector){\n            Css.addClassName(this._findLinkByHref(selector), 'ink-disabled');\n        },\n\n        /**\n         * Enables the desired tag\n         * \n         * @method enable\n         * @param {String|DOMElement} selector      The id of the desired tab or the link that links to it\n         * @public\n         */\n        enable: function(selector){\n            Css.removeClassName(this._findLinkByHref(selector), 'ink-disabled');\n        },\n\n        /***********\n         * Getters *\n         ***********/\n\n        /**\n         * Returns the active tab id\n         * \n         * @method activeTab\n         * @return {String} ID of the active section (use activeSection() instead to get the element).\n         * @public\n         */\n        activeTab: function(){\n            return this._activeSection.getAttribute('id');\n        },\n\n        /**\n         *\n         * Returns the parent of the currently active menu link.\n         *\n         * This is useful if you want to have `li` elements wrapping your links\n         * and want to access the currently visible one.\n         *\n         * (This method is deprecated)\n         * @method activeMenuTab\n         * @deprecated\n         * @return {DOMElement|null} Active menu LI, or `null` if there is none.\n         * @public\n         */\n        activeMenuTab: function(){\n            // [3.1.0] remove this\n            Ink.warn('Ink.UI.Tabs.activeMenuTab() is deprecated');\n            return this._activeMenuTab;\n        },\n\n        /**\n         * Gets the currently active Menu link (the links which the user clicks on to change tabs)\n         * \n         * @method activeMenuLink\n         * @return {DOMElement|null} Active menu link, or `null` if there is none.\n         * @public\n         */\n        activeMenuLink: function(){\n            return this._activeMenuLink;\n        },\n\n        /**\n         * Gets the currently active section\n         *\n         * (Each section contains content for a tab, and must have an `id` attribute)\n         * \n         * @method activeContentTab\n         * @return {DOMElement|null} Active section, or `null` if there is none.\n         * @public\n         */\n        activeSection: function(){\n            return this._activeSection;\n        },\n\n        activeContentTab: function () {\n            // [3.1.0] remove this\n            Ink.warn('Ink.UI.Tabs.activeContentTab() is deprecated. Use activeSection instead.');\n            return this._activeSection();\n        },\n\n        /**\n         * Unregisters the component and removes its markup\n         * \n         * @method destroy\n         * @public\n         */\n        destroy: Common.destroyComponent\n    };\n\n    Common.createUIComponent(Tabs);\n\n    return Tabs;\n\n});\n","/*\n * Tagging input element\n * @module Ink.UI.TagField_1\n * @version 1\n */\nInk.createModule(\"Ink.UI.TagField\",\"1\",[\"Ink.Dom.Element_1\", \"Ink.Dom.Event_1\", \"Ink.Dom.Css_1\", \"Ink.Dom.Browser_1\", \"Ink.UI.Droppable_1\", \"Ink.Util.Array_1\", \"Ink.Dom.Selector_1\", \"Ink.UI.Common_1\"],function( InkElement, InkEvent, Css, Browser, Droppable, InkArray, Selector, Common) {\n    'use strict';\n\n    var enterKey = 13;\n    var backspaceKey = 8;\n    var isTruthy = function (val) {return !!val;};\n\n    /**\n     * Use this class to have a field where a user can input several tags into a single text field. A good example is allowing the user to describe a blog post or a picture through tags, for later searching.\n     *\n     * The markup is as follows:\n     *\n     *           <input class=\"ink-tagfield\" type=\"text\" value=\"initial,value\">\n     *\n     * By applying this UI class to the above input, you get a tag field with the tags \"initial\" and \"value\". The class preserves the original input element. It remains hidden and is updated with new tag information dynamically, so regular HTML form logic still applies.\n     *\n     * Below \"input\" refers to the current value of the input tag (updated as the user enters text, of course), and \"output\" refers to the value which this class writes back to said input tag.\n     *\n     * @class Ink.UI.TagField\n     * @version 1\n     * @constructor\n     * @param {String|DOMElement}   element                         Selector or DOM Input Element.\n     * @param {Object}              [options]                       Options object\n     * @param {String|Array}        [options.tags]                  Initial tags in the input\n     * @param {Boolean}             [options.allowRepeated]         Flag to allow user to input several tags. Defaults to true.\n     * @param {RegExp}              [options.separator]             Split the input by this RegExp. Defaults to /[,;(space)]+/g (spaces, commas and semicolons)\n     * @param {String}              [options.outSeparator]          Use this string to separate each tag from the next in the output. Defaults to ','.\n     * @param {Boolean}             [options.autoSplit]             Flag to activate tag creation when the user types a separator. Defaults to true.\n     * @param {Integer}             [options.maxTags]               Maximum number of tags allowed. Set to -1 for no limit. Defaults to -1.\n     * @example\n     */\n    function TagField() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    TagField._name = 'TagField_1';\n\n    TagField._optionDefinition = {\n        tags: ['String', []],\n        tagQuery: ['Object', null],\n        tagQueryAsync: ['Object', null],\n        allowRepeated: ['Boolean', false],\n        maxTags: ['Integer', -1],\n        outSeparator: ['String', ','],\n        separator: ['String', /[,; ]+/g],\n        autoSplit: ['Boolean', true]\n    };\n\n    TagField.prototype = {\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function() {\n            var o = this._options;\n            if (typeof o.separator === 'string') {\n                o.separator = new RegExp(o.separator, 'g');\n            }\n\n            if (typeof o.tags === 'string') {\n                // coerce to array using the separator\n                o.tags = this._readInput(o.tags);\n            }\n\n            Css.addClassName(this._element, 'hide-all');\n\n            this._viewElm = InkElement.create('div', {\n                className: 'ink-tagfield',\n                insertAfter: this._element\n            });\n\n            this._input = InkElement.create('input', {\n                type: 'text',\n                className: 'new-tag-input',\n                insertBottom: this._viewElm\n            });\n\n            var tags = [].concat(o.tags, this._tagsFromMarkup(this._element));\n\n            this._tags = [];\n\n            InkArray.each(tags, Ink.bindMethod(this, '_addTag'));\n\n            InkEvent.observe(this._input, 'keyup', Ink.bindEvent(this._onKeyUp, this));\n            InkEvent.observe(this._input, 'change', Ink.bindEvent(this._onKeyUp, this));\n            InkEvent.observe(this._input, 'keydown', Ink.bindEvent(this._onKeyDown, this));\n            InkEvent.observe(this._input, 'blur', Ink.bindEvent(this._onBlur, this));\n            InkEvent.observe(this._viewElm, 'click', Ink.bindEvent(this._refocus, this));\n        },\n\n        destroy: function () {\n            InkElement.remove(this._viewElm);\n            Css.removeClassName(this._element, 'hide-all');\n        },\n\n        _tagsFromMarkup: function (element) {\n            var tagname = element.tagName.toLowerCase();\n            if (tagname === 'input') {\n                return this._readInput(element.value);\n            } else if (tagname === 'select') {\n                return InkArray.map(element.getElementsByTagName('option'), function (option) {\n                    return InkElement.textContent(option);\n                });\n            } else {\n                throw new Error('Cannot read tags from a ' + tagname + ' tag. Unknown tag');\n            }\n        },\n\n        _tagsToMarkup: function (tags, element) {\n            var tagname = element.tagName.toLowerCase();\n            if (tagname === 'input') {\n                if (this._options.separator) {\n                    element.value = tags.join(this._options.outSeparator);\n                }\n            } else if (tagname === 'select') {\n                element.innerHTML = '';\n                InkArray.each(tags, function (tag) {\n                    var opt = InkElement.create('option', {selected: 'selected'});\n                    InkElement.setTextContent(opt, tag);\n                    element.appendChild(opt);\n                });\n            } else {\n                throw new Error('TagField: Cannot read tags from a ' + tagname + ' tag. Unknown tag');\n            }\n        },\n\n        _addTag: function (tag) {\n            if (this._options.maxTags !== -1 &&\n                    this._tags.length >= this._options.maxTags) {\n                return;\n            }\n            if ((!this._options.allowRepeated &&\n                    InkArray.inArray(tag, this._tags, tag)) || !tag) {\n                return false;\n            }\n            var elm = InkElement.create('span', {\n                className: 'ink-tag',\n                setTextContent: tag + ' '\n            });\n\n            var remove = InkElement.create('span', {\n                className: 'remove fa fa-times',\n                insertBottom: elm\n            });\n            InkEvent.observe(remove, 'click', Ink.bindEvent(this._removeTag, this, null));\n\n            var spc = document.createTextNode(' ');\n\n            this._tags.push(tag);\n            this._viewElm.insertBefore(elm, this._input);\n            this._viewElm.insertBefore(spc, this._input);\n            this._tagsToMarkup(this._tags, this._element);\n        },\n\n        _readInput: function (text) {\n            if (this._options.separator) {\n                return InkArray.filter(text.split(this._options.separator), isTruthy);\n            } else {\n                return [text];\n            }\n        },\n\n        _onKeyUp: function () {  // TODO control input box size\n            if (!this._options.autoSplit) {\n                return;\n            }\n            var split = this._input.value.split(this._options.separator);\n            if (split.length <= 1) {\n                return;\n            }\n            var last = split[split.length - 1];\n            split = split.splice(0, split.length - 1);\n            split = InkArray.filter(split, isTruthy);\n            \n            InkArray.each(split, Ink.bind(this._addTag, this));\n            this._input.value = last;\n        },\n\n        _onKeyDown: function (event) {\n            if (event.which === enterKey) {\n                return this._onEnterKeyDown(event);\n            } else if (event.which === backspaceKey) {\n                return this._onBackspaceKeyDown();\n            } else if (this._removeConfirm) {\n                // user pressed another key, cancel removal from a backspace key\n                this._unsetRemovingVisual(this._tags.length - 1);\n            }\n        },\n\n        /**\n         * When the user presses backspace twice on the empty input, we delete the last tag on the field.\n         * @method onBackspaceKeyDown\n         * @private\n         */\n        _onBackspaceKeyDown: function () {\n            if (this._input.value) { return; }\n\n            if (this._removeConfirm) {\n                this._unsetRemovingVisual(this._tags.length - 1);\n                this._removeTag(this._tags.length - 1);\n                this._removeConfirm = null;\n            } else {\n                this._setRemovingVisual(this._tags.length - 1);\n            }\n        },\n\n        _onEnterKeyDown: function (event) {\n            var tag = this._input.value;\n            if (tag) {\n                this._addTag(tag);\n                this._input.value = '';\n            }\n            InkEvent.stopDefault(event);\n        },\n\n        _onBlur: function () {\n            this._addTag(this._input.value);\n            this._input.value = '';\n        },\n\n        /* For when the user presses backspace.\n         * Set the style of the tag so that it seems like it's going to be removed\n         * if they press backspace again. */\n        _setRemovingVisual: function (tagIndex) {\n            var elm = this._viewElm.children[tagIndex];\n            if (!elm) { return; }\n\n            Css.addClassName(elm, 'tag-deleting');\n\n            this._removeRemovingVisualTimeout = setTimeout(Ink.bindMethod(this, '_unsetRemovingVisual', tagIndex), 4000);\n            InkEvent.observe(this._input, 'blur', Ink.bindMethod(this, '_unsetRemovingVisual', tagIndex));\n            this._removeConfirm = true;\n        },\n        _unsetRemovingVisual: function (tagIndex) {\n            var elm = this._viewElm.children[tagIndex];\n            if (elm) {\n                Css.removeClassName(elm, 'tag-deleting');\n                clearTimeout(this._removeRemovingVisualTimeout);\n            }\n            this._removeConfirm = null;\n        },\n\n        _removeTag: function (event) {\n            var index;\n            if (typeof event === 'object') {  // click event on close button\n                var elm = InkEvent.element(event).parentNode;\n                index = InkElement.parentIndexOf(this._viewElm, elm);\n            } else if (typeof event === 'number') {  // manual removal\n                index = event;\n            }\n            this._tags = InkArray.remove(this._tags, index, 1);\n            InkElement.remove(this._viewElm.children[index]);\n            this._tagsToMarkup(this._tags, this._element);\n        },\n\n        _refocus: function (event) {\n            this._input.focus();\n            InkEvent.stop(event);\n            return false;\n        }\n    };\n\n    Common.createUIComponent(TagField);\n\n    return TagField;\n});\n","/**\n * Toggle the visibility of elements.\n * @module Ink.UI.Toggle_1\n * @version 1\n */\n\n Ink.createModule('Ink.UI.Toggle', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1','Ink.Util.Array_1'], function(Common, InkEvent, Css, InkElement, Selector, InkArray ) {\n    'use strict';\n\n    /**\n     *\n     * You need two elements to use Toggle: the `trigger` element, and the `target` element (or elements). The default behaviour is to toggle the `target`(s) when you click the `trigger`.\n     *\n     * The toggle has a state. It is either \"on\" or \"off\". It works by switching between the CSS classes in `classNameOn` and `classNameOff` according to the current state.\n     *\n     * When you initialize the Toggle, it will check if the targets are visible to figure out what the initial state is. You can force the toggle to consider itself turned \"on\" or \"off\" by setting the `initialState` option to `true` or `false`, respectively.\n     *\n     * You can get the current state of the Toggle by calling `getState`, or by checking if your `trigger` element has the \"active\" class.\n     * The state can be changed through JavaScript. Just call  `setState(true)` \n     * to turn the Toggle on (or `setState(false)` to turn it off).\n     *\n     * @class Ink.UI.Toggle\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement} selector  Trigger element. By clicking this, the target (or targets) are triggered.\n     * @param {Object} [options] Options object, containing:\n     *\n     * @param {String}              options.target                  CSS Selector that specifies the elements that this component will toggle\n     * @param {String}              [options.classNameOn]           CSS class to toggle when on. Defaults to 'show-all'.\n     * @param {String}              [options.classNameOff]          CSS class to toggle when off. Defaults to 'hide-all'.\n     * @param {String}              [options.triggerEvent]          Event that will trigger the toggling. Defaults to 'click'.\n     * @param {Boolean}             [options.closeOnClick]          Flag to toggle the targe off when clicking outside the toggled content. Defaults to true.\n     * @param {String}              [options.closeOnInsideClick]    Toggle off when a child element matching this selector is clicked. Set to null to deactivate the check. Defaults to 'a[href]'.\n     * @param {Boolean}             [options.initialState]          Flag to define initial state. false: off, true: on, null: markup. Defaults to null.\n     * @param {Function}            [options.onChangeState]         Callback when the toggle state changes. Return `false` to cancel the event.\n     *\n     * @sample Ink_UI_Toggle_1_constructor.html\n     */\n    function Toggle(){\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    Toggle._name = 'Toggle_1';\n\n    Toggle._optionDefinition = {\n        target:         ['Elements'],\n        triggerEvent:   ['String', 'click'],\n        closeOnClick:   ['Boolean', true],\n        isAccordion:    ['Boolean', false],\n        initialState:   ['Boolean', null],  // May be true, false, or null to be what it is right now\n        classNameOn:    ['String', 'show-all'],\n        classNameOff:   ['String', 'hide-all'],\n        closeOnInsideClick: ['String', 'a[href]'],  // closes the toggle when a target is clicked and it is a link\n        onChangeState:  ['Function', null]\n    };\n\n    Toggle.prototype = {\n\n        /**\n         * Init function called by the constructor\n         * \n         * @method _init\n         * @private\n         */\n        _init: function(){\n            var i, len;\n\n            this._targets = Common.elsOrSelector(this._options.target);\n\n            // Boolean option handling\n            this._options.closeOnClick = this._options.closeOnClick.toString() === 'true';\n            // Actually a throolean\n            if (this._options.initialState !== null){\n                this._options.initialState = this._options.initialState.toString() === 'true';\n            } else {\n                this._options.initialState = Css.getStyle(this._targets[0], 'display') !== 'none';\n            }\n\n            if (this._options.classNameOn !== 'show-all' || this._options.classNameOff !== 'hide-all') {\n                for (i = 0, len = this._targets.length; i < len; i++) {\n                    Css.removeClassName(this._targets[i], 'show-all');\n                    Css.removeClassName(this._targets[i], 'hide-all');\n                }\n            }\n\n            this._accordion = ( Css.hasClassName(this._element.parentNode,'accordion') || Css.hasClassName(this._targets[0].parentNode,'accordion') );\n\n            this._firstTime = true;\n\n            this._bindEvents();\n\n            if (this._options.initialState !== null) {\n                this.setState(this._options.initialState, true);\n            } else {\n                // Add initial classes matching the current \"display\" of the object.\n                var state = Css.getStyle(this._targets[0], 'display') !== 'none';\n                this.setState(state, true);\n            }\n            // Aditionally, remove any inline \"display\" style.\n            for (i = 0, len = this._targets.length; i < len; i++) {\n                if (this._targets[i].style.display) {\n                    this._targets[i].style.display = '';  // becomes default\n                }\n            }\n\n            this._element.setAttribute('data-is-toggle-trigger', 'true');\n        },\n\n        /**\n         * @method _bindEvents\n         * @private\n         */\n        _bindEvents: function () {\n            if ( this._options.triggerEvent ) {\n                InkEvent.observe(\n                    this._element,\n                    this._options.triggerEvent,\n                    Ink.bind(this._onTriggerEvent, this));\n            }\n            if( this._options.closeOnClick ){\n                InkEvent.observe( document, 'click', Ink.bind(this._onOutsideClick, this));\n            }\n            if( this._options.closeOnInsideClick && this._options.closeOnInsideClick !== 'false') {\n                var sel = this._options.closeOnInsideClick;\n                if (sel.toString() === 'true') {\n                    sel = '*';\n                }\n                InkEvent.observeMulti(this._targets, 'click', Ink.bind(function (e) {\n                    if ( InkElement.findUpwardsBySelector(InkEvent.element(e), sel) ) {\n                        this.setState(false, true);\n                    }\n                }, this));\n            }\n        },\n\n        /**\n         * Event handler. It's responsible for handling the `triggerEvent` as defined in the options.\n         *\n         * This will trigger the toggle.\n         * \n         * @method _onTriggerEvent\n         * @param {Event} event\n         * @private\n         */\n        _onTriggerEvent: function( event ){\n            // When the togglee is a child of the toggler, we get the togglee's events here. We have to check that this event is for us.\n            var target = InkEvent.element(event);\n\n            var isAncestorOfClickedElement = InkArray.some(this._targets, function (thisOne) {\n                return thisOne === target || InkElement.isAncestorOf(thisOne, target);\n            });\n\n            if (isAncestorOfClickedElement) {\n                return;\n            }\n\n            if (this._accordion) {\n                this._updateAccordion();\n            }\n\n            var has = this.getState();\n            this.setState(!has, true);\n            if (!has && this._firstTime) {\n                this._firstTime = false;\n            }\n\n            InkEvent.stopDefault(event);\n        },\n\n        /**\n         * Be compatible with accordions\n         *\n         * @method _updateAccordion\n         **/\n        _updateAccordion: function () {\n            var elms, accordionElement;\n            if( Css.hasClassName(this._targets[0].parentNode,'accordion') ){\n                accordionElement = this._targets[0].parentNode;\n            } else {\n                accordionElement = this._targets[0].parentNode.parentNode;\n            }\n            elms = Selector.select('.toggle, .ink-toggle',accordionElement);\n            for(var i=0; i<elms.length; i+=1 ){\n                var dataset = InkElement.data( elms[i] ),\n                    targetElm = Selector.select( dataset.target,accordionElement );\n\n                if( (targetElm.length > 0) && (targetElm[0] !== this._targets[0]) ){\n                    targetElm[0].style.display = 'none';\n                }\n            }\n        },\n\n        /**\n         * Click handler. Will handle clicks outside the toggle component.\n         * \n         * @method _onOutsideClick\n         * @param {Event} event\n         * @private\n         */\n        _onOutsideClick: function( event ){\n            var tgtEl = InkEvent.element(event),\n                shades;\n\n            if (InkElement.findUpwardsBySelector(tgtEl, '[data-is-toggle-trigger=\"true\"]')) return;\n\n            var ancestorOfTargets = InkArray.some(this._targets, function (target) {\n                return InkElement.isAncestorOf(target, tgtEl) || target === tgtEl;\n            });\n\n            if( (this._element === tgtEl) || InkElement.isAncestorOf(this._element, tgtEl) || ancestorOfTargets) {\n                return;\n            } else if( (shades = Ink.ss('.ink-shade')).length ) {\n                var shadesLength = shades.length;\n\n                for( var i = 0; i < shadesLength; i++ ){\n                    if( InkElement.isAncestorOf(shades[i],tgtEl) && InkElement.isAncestorOf(shades[i],this._element) ){\n                        return;\n                    }\n                }\n            }\n\n            this.setState(false, true);  // dismiss\n        },\n\n        /**\n         * Sets the state of the toggle. (on/off)\n         *\n         * @method setState\n         * @param newState {Boolean} New state (on/off)\n         */\n        setState: function (on, callHandler) {\n            if (on === this.getState()) { return; }\n            if (callHandler && typeof this._options.onChangeState === 'function') {\n                var ret = this._options.onChangeState(on);\n                if (ret === false) { return false; } //  Canceled by the event handler\n            }\n            for (var i = 0, len = this._targets.length; i < len; i++) {\n                Css.addRemoveClassName(this._targets[i], this._options.classNameOn, on);\n                Css.addRemoveClassName(this._targets[i], this._options.classNameOff, !on);\n            }\n            Css.addRemoveClassName(this._element, 'active', on);\n        },\n\n        /**\n         * Gets the state of the toggle. (on/off)\n         *\n         * @method getState\n         *\n         * @return {Boolean} whether the toggle is toggled on.\n         */\n        getState: function () {\n            return Css.hasClassName(this._element, 'active');\n        }\n    };\n\n    Common.createUIComponent(Toggle);\n\n    return Toggle;\n});\n","/**\n * Content Tooltips\n * @module Ink.UI.Tooltip_1\n * @version 1\n */\nInk.createModule('Ink.UI.Tooltip', '1', ['Ink.UI.Common_1', 'Ink.Dom.Event_1', 'Ink.Dom.Element_1', 'Ink.Dom.Selector_1', 'Ink.Util.Array_1', 'Ink.Dom.Css_1', 'Ink.Dom.Browser_1'], function (Common, InkEvent, InkElement, Selector, InkArray, Css) {\n    'use strict';\n\n    /**\n     * Tooltips are useful as a means to display information about functionality while avoiding clutter.\n     *\n     * Tooltips show up when you hover elements which \"have\" tooltips.\n     *\n     * This class will \"give\" a tooltip to many elements, selected by its first argument (`target`). This is contrary to the other UI modules in Ink, which are created once per element.\n     *\n     * You can define options either through the second argument of the Tooltip constructor, or as data-attributes in each `target` element. Options set through data-attributes all start with \"data-tip\", and override options passed into the Tooltip constructor.\n     *\n     * @class Ink.UI.Tooltip\n     * @constructor\n     *\n     * @param {DOMElement|String}   target                  Target element or selector of elements, to display the tooltips on.\n     * @param {Object}              [options]               Options object\n     * @param {String}              [options.text]          Text content for the tooltip.\n     * @param {String}              [options.html]          HTML for the tooltip. Same as above, but won't escape HTML.\n     * @param {String}              [options.where]         Positioning for the tooltip. Options are 'up', 'down', 'left', 'right', 'mousemove' (follows the cursor), and 'mousefix' (stays fixed). Defaults to 'up'.\n     *     \n     * @param {String}              [options.color]         Color of the tooltip. Options are red, orange, blue, green and black. Default is white.\n     * @param {Number}              [options.fade]          Number of seconds to fade in/out. Defaults to 0.3.\n     * @param {Boolean}             [options.forever]       Flag to prevent the tooltip from being erased when the mouse hovers away from the target.\n     * @param {Number}              [options.timeout]       Number of seconds the tooltip will stay open. Useful together with options.forever. Defaults to 0.\n     * @param {Number}              [options.delay]         Time the tooltip waits until it is displayed. Useful to avoid getting the attention of the user unnecessarily\n     * @param {DOMElement|Selector} [options.template]      Element or selector containing HTML to be cloned into the tooltips. Can be a hidden element, because CSS `display` is set to `block`.\n     * @param {String}              [options.templatefield] Selector within the template element to choose where the text is inserted into the tooltip. Useful when a wrapper DIV is required.\n     * @param {Number}              [options.left]          Spacing from the target to the tooltip, when `where` is `mousemove` or `mousefix`. Defaults to 10.\n     * @param {Number}              [options.top]           Spacing from the target to the tooltip, when `where` is `mousemove` or `mousefix`. Defaults to 10.\n     * @param {Number}              [options.spacing]       Spacing between the tooltip and the target element, when `where` is not `mousemove` or `mousefix`. Defaults to 8.\n     * \n     * @sample Ink_UI_Tooltip_1.html\n     */\n    function Tooltip(element, options) {\n        this._init(element, options || {});\n    }\n\n    function EachTooltip(root, elm) {\n        this._init(root, elm);\n    }\n\n    var transitionDurationName,\n        transitionPropertyName,\n        transitionTimingFunctionName;\n    (function () {  // Feature detection\n        var test = document.createElement('DIV');\n        var names = ['transition', 'oTransition', 'msTransition', 'mozTransition',\n            'webkitTransition'];\n        for (var i = 0; i < names.length; i++) {\n            if (typeof test.style[names[i] + 'Duration'] !== 'undefined') {\n                transitionDurationName = names[i] + 'Duration';\n                transitionPropertyName = names[i] + 'Property';\n                transitionTimingFunctionName = names[i] + 'TimingFunction';\n                break;\n            }\n        }\n    }());\n\n    // Body or documentElement\n    var bodies = document.getElementsByTagName('body');\n    var body = bodies.length ? bodies[0] : document.documentElement;\n\n    Tooltip.prototype = {\n        _init: function(element, options) {\n            var elements;\n\n            this.options = Ink.extendObj({\n                    where: 'up',\n                    zIndex: 10000,\n                    left: 10,\n                    top: 10,\n                    spacing: 8,\n                    forever: 0,\n                    color: '',\n                    timeout: 0,\n                    delay: 0,\n                    template: null,\n                    templatefield: null,\n                    fade: 0.3,\n                    text: ''\n                }, options || {});\n\n            if (typeof element === 'string') {\n                elements = Selector.select(element);\n            } else if (typeof element === 'object') {\n                elements = [element];\n            } else {\n                throw 'Element expected';\n            }\n\n            this.tooltips = [];\n\n            for (var i = 0, len = elements.length; i < len; i++) {\n                this.tooltips[i] = new EachTooltip(this, elements[i]);\n            }\n        },\n        /**\n         * Destroys the tooltips created by this instance\n         *\n         * @method destroy\n         */\n        destroy: function () {\n            InkArray.each(this.tooltips, function (tooltip) {\n                tooltip._destroy();\n            });\n            this.tooltips = null;\n            this.options = null;\n        }\n    };\n\n    EachTooltip.prototype = {\n        _oppositeDirections: {\n            left: 'right',\n            right: 'left',\n            up: 'down',\n            down: 'up'\n        },\n        _init: function(root, elm) {\n            InkEvent.observe(elm, 'mouseover', Ink.bindEvent(this._onMouseOver, this));\n            InkEvent.observe(elm, 'mouseout', Ink.bindEvent(this._onMouseOut, this));\n            InkEvent.observe(elm, 'mousemove', Ink.bindEvent(this._onMouseMove, this));\n\n            this.root = root;\n            this.element = elm;\n            this._delayTimeout = null;\n            this.tooltip = null;\n\n            Common.registerInstance(this, this.element);\n        },\n        _makeTooltip: function (mousePosition) {\n            if (!this._getOpt('text') &&\n                    !this._getOpt('html') &&\n                    !InkElement.hasAttribute(this.element, 'title')) {\n                return false;\n            }\n\n            var tooltip = this._createTooltipElement();\n\n            if (this.tooltip) {\n                this._removeTooltip();\n            }\n\n            this.tooltip = tooltip;\n\n            this._fadeInTooltipElement(tooltip);\n            this._placeTooltipElement(tooltip, mousePosition);\n\n            InkEvent.observe(tooltip, 'mouseover', Ink.bindEvent(this._onTooltipMouseOver, this));\n\n            var timeout = this._getFloatOpt('timeout');\n            if (timeout) {\n                setTimeout(Ink.bind(function () {\n                    if (this.tooltip === tooltip) {\n                        this._removeTooltip();\n                    }\n                }, this), timeout * 1000);\n            }\n        },\n        _createTooltipElement: function () {\n            var template = this._getOpt('template'),  // User template instead of our HTML\n                templatefield = this._getOpt('templatefield'),\n                \n                tooltip,  // The element we float\n                field;  // Element where we write our message. Child or same as the above\n\n            if (template) {  // The user told us of a template to use. We copy it.\n                var temp = document.createElement('DIV');\n                temp.innerHTML = Common.elOrSelector(template, 'options.template').outerHTML;\n                tooltip = temp.firstChild;\n                \n                if (templatefield) {\n                    field = Selector.select(templatefield, tooltip);\n                    if (field) {\n                        field = field[0];\n                    } else {\n                        throw 'options.templatefield must be a valid selector within options.template';\n                    }\n                } else {\n                    field = tooltip;  // Assume same element if user did not specify a field\n                }\n            } else {  // We create the default structure\n                tooltip = document.createElement('DIV');\n                Css.addClassName(tooltip, 'ink-tooltip');\n                Css.addClassName(tooltip, this._getOpt('color'));\n\n                field = document.createElement('DIV');\n                Css.addClassName(field, 'content');\n\n                tooltip.appendChild(field);\n            }\n            \n            if (this._getOpt('html')) {\n                field.innerHTML = this._getOpt('html');\n            } else if (this._getOpt('text')) {\n                InkElement.setTextContent(field, this._getOpt('text'));\n            } else {\n                InkElement.setTextContent(field, this.element.getAttribute('title'));\n            }\n            tooltip.style.display = 'block';\n            tooltip.style.position = 'absolute';\n            tooltip.style.zIndex = this._getIntOpt('zIndex');\n\n            return tooltip;\n        },\n        _fadeInTooltipElement: function (tooltip) {\n            var fadeTime = this._getFloatOpt('fade');\n            if (transitionDurationName && fadeTime) {\n                tooltip.style.opacity = '0';\n                tooltip.style[transitionDurationName] = fadeTime + 's';\n                tooltip.style[transitionPropertyName] = 'opacity';\n                tooltip.style[transitionTimingFunctionName] = 'ease-in-out';\n                setTimeout(function () {\n                    tooltip.style.opacity = '1';\n                }, 0); // Wait a tick\n            }\n        },\n        _placeTooltipElement: function (tooltip, mousePosition) {\n            var where = this._getOpt('where');\n\n            if (where === 'mousemove' || where === 'mousefix') {\n                var mPos = mousePosition;\n                this._setPos(mPos[0], mPos[1]);\n                body.appendChild(tooltip);\n            } else if (where.match(/(up|down|left|right)/)) {\n                body.appendChild(tooltip);\n                var targetElementPos = InkElement.offset(this.element);\n                var tleft = targetElementPos[0],\n                    ttop = targetElementPos[1];\n\n                var centerh = (InkElement.elementWidth(this.element) / 2) - (InkElement.elementWidth(tooltip) / 2),\n                    centerv = (InkElement.elementHeight(this.element) / 2) - (InkElement.elementHeight(tooltip) / 2);\n                var spacing = this._getIntOpt('spacing');\n\n                var tooltipDims = InkElement.elementDimensions(tooltip);\n                var elementDims = InkElement.elementDimensions(this.element);\n\n                var maxX = InkElement.scrollWidth() + InkElement.viewportWidth();\n                var maxY = InkElement.scrollHeight() + InkElement.viewportHeight();\n                \n                where = this._getWhereValueInsideViewport(where, {\n                    left: tleft - tooltipDims[0],\n                    right: tleft + tooltipDims[0],\n                    top: ttop + tooltipDims[1],\n                    bottom: ttop + tooltipDims[1]\n                }, {\n                    right: maxX,\n                    bottom: maxY\n                });\n                \n                if (where === 'up') {\n                    ttop -= tooltipDims[1];\n                    ttop -= spacing;\n                    tleft += centerh;\n                } else if (where === 'down') {\n                    ttop += elementDims[1];\n                    ttop += spacing;\n                    tleft += centerh;\n                } else if (where === 'left') {\n                    tleft -= tooltipDims[0];\n                    tleft -= spacing;\n                    ttop += centerv;\n                } else if (where === 'right') {\n                    tleft += elementDims[0];\n                    tleft += spacing;\n                    ttop += centerv;\n                }\n                \n                var arrow = null;\n                if (where.match(/(up|down|left|right)/)) {\n                    arrow = document.createElement('SPAN');\n                    Css.addClassName(arrow, 'arrow');\n                    Css.addClassName(arrow, this._oppositeDirections[where]);\n                    tooltip.appendChild(arrow);\n                }\n\n                var tooltipLeft = tleft;\n                var tooltipTop = ttop;\n\n                var toBottom = (tooltipTop + tooltipDims[1]) - maxY;\n                var toRight = (tooltipLeft + tooltipDims[0]) - maxX;\n                var toLeft = 0 - tooltipLeft;\n                var toTop = 0 - tooltipTop;\n\n                if (toBottom > 0) {\n                    if (arrow) { arrow.style.top = (tooltipDims[1] / 2) + toBottom + 'px'; }\n                    tooltipTop -= toBottom;\n                } else if (toTop > 0) {\n                    if (arrow) { arrow.style.top = (tooltipDims[1] / 2) - toTop + 'px'; }\n                    tooltipTop += toTop;\n                } else if (toRight > 0) {\n                    if (arrow) { arrow.style.left = (tooltipDims[0] / 2) + toRight + 'px'; }\n                    tooltipLeft -= toRight;\n                } else if (toLeft > 0) {\n                    if (arrow) { arrow.style.left = (tooltipDims[0] / 2) - toLeft + 'px'; }\n                    tooltipLeft += toLeft;\n                }\n\n                tooltip.style.left = tooltipLeft + 'px';\n                tooltip.style.top = tooltipTop + 'px';\n            }\n        },\n\n        /**\n         * Get a value for \"where\" (left/right/up/down) which doesn't put the\n         * tooltip off the screen\n         *\n         * @method _getWhereValueInsideViewport\n         * @param where {String} \"where\" value which was given by the user and we might change\n         * @param bbox {BoundingBox} A bounding box like what you get from getBoundingClientRect ({top, bottom, left, right}) with pixel positions from the top left corner of the viewport.\n         * @param viewport {BoundingBox} Bounding box for the viewport. \"top\" and \"left\" are omitted because these coordinates are relative to the top-left corner of the viewport so they are zero.\n         *\n         * @TODO: we can't use getBoundingClientRect in this case because it returns {0,0,0,0} on our uncreated tooltip.\n         */\n        _getWhereValueInsideViewport: function (where, bbox, viewport) {\n            if (where === 'left' && bbox.left < 0) {\n                return 'right';\n            } else if (where === 'right' && bbox.right > viewport.right) {\n                return 'left';\n            } else if (where === 'up' && bbox.top < 0) {\n                return 'down';\n            } else if (where === 'down' && bbox.bottom > viewport.bottom) {\n                return 'up';\n            }\n\n            return where;\n        },\n        _removeTooltip: function() {\n            var tooltip = this.tooltip;\n            if (!tooltip) {return;}\n\n            var remove = Ink.bind(InkElement.remove, {}, tooltip);\n\n            if (this._getOpt('where') !== 'mousemove' && transitionDurationName) {\n                tooltip.style.opacity = 0;\n                // remove() will operate on correct tooltip, although this.tooltip === null then\n                setTimeout(remove, this._getFloatOpt('fade') * 1000);\n            } else {\n                remove();\n            }\n            this.tooltip = null;\n        },\n        _getOpt: function (option) {\n            var dataAttrVal = InkElement.data(this.element)[InkElement._camelCase('tip-' + option)];\n            if (dataAttrVal /* either null or \"\" may signify the absense of this attribute*/) {\n                return dataAttrVal;\n            }\n            var instanceOption = this.root.options[option];\n            if (typeof instanceOption !== 'undefined') {\n                return instanceOption;\n            }\n        },\n        _getIntOpt: function (option) {\n            return parseInt(this._getOpt(option), 10);\n        },\n        _getFloatOpt: function (option) {\n            return parseFloat(this._getOpt(option), 10);\n        },\n        _destroy: function () {\n            if (this.tooltip) {\n                InkElement.remove(this.tooltip);\n            }\n            this.root = null;  // Cyclic reference = memory leaks\n            this.element = null;\n            this.tooltip = null;\n        },\n        _onMouseOver: function(e) {\n            // on IE < 10 you can't access the mouse event not even a tick after it fired\n            var mousePosition = this._getMousePosition(e);\n            var delay = this._getFloatOpt('delay');\n            if (delay) {\n                this._delayTimeout = setTimeout(Ink.bind(function () {\n                    if (!this.tooltip) {\n                        this._makeTooltip(mousePosition);\n                    }\n                    this._delayTimeout = null;\n                }, this), delay * 1000);\n            } else {\n                this._makeTooltip(mousePosition);\n            }\n        },\n        _onMouseMove: function(e) {\n            if (this._getOpt('where') === 'mousemove' && this.tooltip) {\n                var mPos = this._getMousePosition(e);\n                this._setPos(mPos[0], mPos[1]);\n            }\n        },\n        _onMouseOut: function () {\n            if (!this._getIntOpt('forever')) {\n                this._removeTooltip();\n            }\n            if (this._delayTimeout) {\n                clearTimeout(this._delayTimeout);\n                this._delayTimeout = null;\n            }\n        },\n        _onTooltipMouseOver: function () {\n            if (this.tooltip) {  // If tooltip is already being removed, this has no effect\n                this._removeTooltip();\n            }\n        },\n        _setPos: function(left, top) {\n            left += this._getIntOpt('left');\n            top += this._getIntOpt('top');\n            var pageDims = this._getPageXY();\n            if (this.tooltip) {\n                var elmDims = [InkElement.elementWidth(this.tooltip), InkElement.elementHeight(this.tooltip)];\n                var scrollDim = this._getScroll();\n\n                if((elmDims[0] + left - scrollDim[0]) >= (pageDims[0] - 20)) {\n                    left = (left - elmDims[0] - this._getIntOpt('left') - 10);\n                }\n                if((elmDims[1] + top - scrollDim[1]) >= (pageDims[1] - 20)) {\n                    top = (top - elmDims[1] - this._getIntOpt('top') - 10);\n                }\n\n                this.tooltip.style.left = left + 'px';\n                this.tooltip.style.top = top + 'px';\n            }\n        },\n        _getPageXY: function() {\n            var cWidth = 0;\n            var cHeight = 0;\n            if( typeof( window.innerWidth ) === 'number' ) {\n                cWidth = window.innerWidth;\n                cHeight = window.innerHeight;\n            } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {\n                cWidth = document.documentElement.clientWidth;\n                cHeight = document.documentElement.clientHeight;\n            } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {\n                cWidth = document.body.clientWidth;\n                cHeight = document.body.clientHeight;\n            }\n            return [parseInt(cWidth, 10), parseInt(cHeight, 10)];\n        },\n        _getScroll: function() {\n            var dd = document.documentElement, db = document.body;\n            if (dd && (dd.scrollLeft || dd.scrollTop)) {\n                return [dd.scrollLeft, dd.scrollTop];\n            } else if (db) {\n                return [db.scrollLeft, db.scrollTop];\n            } else {\n                return [0, 0];\n            }\n        },\n        _getMousePosition: function(e) {\n            return [parseInt(InkEvent.pointerX(e), 10), parseInt(InkEvent.pointerY(e), 10)];\n        }\n    };\n\n    return Tooltip;\n});\n","/**\n * Elements in a tree structure\n * @module Ink.UI.TreeView_1\n * @version 1\n */\nInk.createModule('Ink.UI.TreeView', '1', ['Ink.UI.Common_1','Ink.Dom.Event_1','Ink.Dom.Css_1','Ink.Dom.Element_1','Ink.Dom.Selector_1','Ink.Util.Array_1'], function(Common, Event, Css, Element, Selector, InkArray ) {\n    'use strict';\n\n\n    /**\n     * Shows elements in a tree structure which can be expanded and contracted.\n     * A TreeView is built with \"node\"s and \"children\". \"node\"s are `li` tags, and \"children\" are `ul` tags.\n     * You can build your TreeView out of a regular UL and  LI element structure which you already use to display lists with several levels.\n     * If you want a node to be open when the TreeView is built, just add the data-open=\"true\" attribute to it.\n     * \n     * @class Ink.UI.TreeView\n     * @constructor\n     * @version 1\n     * @param {String|DOMElement}   selector                    Element or selector.\n     * @param {String}              [options]                   Options object, containing:\n     * @param {String}              [options.node]              Selector for the nodes. Defaults to 'li'.\n     * @param {String}              [options.children]          Selector for the children. Defaults to 'ul'.\n     * @param {String}              [options.parentClass]       CSS classes to be added to parent nodes. Defaults to 'parent'.\n     * @param {String}              [options.openClass]         CSS classes to be added to the icon when a parent is open. Defaults to 'fa fa-minus-circle'.\n     * @param {String}              [options.closedClass]       CSS classes to be added to the icon when a parent is closed. Defaults to 'fa fa-plus-circle'.\n     * @param {String}              [options.hideClass]         CSS Class to toggle visibility of the children. Defaults to 'hide-all'.\n     * @param {String}              [options.iconTag]           The name of icon tag. The component tries to find a tag with that name as a direct child of the node. If it doesn't find it, it creates it. Defaults to 'i'.\n     * @param {Boolean}             [options.stopDefault]       Flag to stops the default behavior of the click handler. Defaults to true.\n     * @example\n     *      <ul class=\"ink-tree-view\">\n     *        <li data-open=\"true\"><a href=\"#\">root</a>\n     *          <ul>\n     *            <li><a href=\"#\">child 1</a></li>\n     *            <li><a href=\"#\">child 2</a>\n     *              <ul>\n     *                <li><a href=\"#\">grandchild 2a</a></li>\n     *                <li><a href=\"#\">grandchild 2b</a>\n     *                  <ul>\n     *                    <li><a href=\"#\">grandgrandchild 1bA</a></li>\n     *                    <li><a href=\"#\">grandgrandchild 1bB</a></li>\n     *                  </ul>\n     *                </li>\n     *              </ul>\n     *            </li>\n     *            <li><a href=\"#\">child 3</a></li>\n     *          </ul>\n     *        </li>\n     *      </ul>\n     *      <script>\n     *          Ink.requireModules( ['Ink.Dom.Selector_1','Ink.UI.TreeView_1'], function( Selector, TreeView ){\n     *              var treeViewElement = Ink.s('.ink-tree-view');\n     *              var treeViewObj = new TreeView( treeViewElement );\n     *          });\n     *      </script>\n     * \n     * @sample Ink_UI_TreeView_1.html\n     */\n    function TreeView() {\n        Common.BaseUIComponent.apply(this, arguments);\n    }\n\n    TreeView._name = 'TreeView_1';\n\n    TreeView._optionDefinition = {\n        'node':   ['String', 'li'],\n        // [3.0.1] Deprecate this terrible, terrible name\n        'child':  ['String',null],\n        'children':  ['String','ul'],\n        'parentClass': ['String','parent'],\n        'openNodeClass': ['String', 'open'],\n        'openClass': ['String','fa fa-minus-circle'],\n        'closedClass': ['String','fa fa-plus-circle'],\n        'hideClass': ['String','hide-all'],\n        'iconTag': ['String', 'i'],\n        'stopDefault' : ['Boolean', true]\n    };\n\n    TreeView.prototype = {\n        /**\n         * Init function called by the constructor. Sets the necessary event handlers.\n         * \n         * @method _init\n         * @private\n         */\n        _init: function(){\n            if (this._options.child) {\n                Ink.warn('Ink.UI.TreeView: options.child is being renamed to options.children.');\n                this._options.children = this._options.child;\n            }\n\n            this._handlers = {\n                click: Ink.bindEvent(this._onClick,this)\n            };\n\n            Event.on(this._element, 'click', this._options.node, this._handlers.click);\n\n            InkArray.each(Ink.ss(this._options.node, this._element), Ink.bind(function(item){\n                if( this.isParent(item) ) {\n                    Css.addClassName(item, this._options.parentClass);\n\n                    var isOpen = this.isOpen(item);\n                    if( !this._getIcon(item) ){\n                        Element.create(this._options.iconTag, { insertTop: item });\n                    }\n\n                    this._setNodeOpen(item, isOpen);\n                }\n            },this));\n        },\n\n        _getIcon: function (node) {\n            return Ink.s('> ' + this._options.iconTag, node);\n        },\n\n        /**\n         * Checks if a node is open.\n         *\n         * @method isOpen\n         * @param {DOMElement} node  The tree node to check\n         **/\n        isOpen: function (node) {\n            if (!this._getChild(node)) {\n                throw new Error('not a node!');\n            }\n\n            return Element.data(node).open === 'true' ||\n                Css.hasClassName(node, this._options.openNodeClass);\n        },\n\n        /**\n         * Checks if a node is a parent.\n         *\n         * @method isParent\n         * @param {DOMElement} node     Node to check\n         **/\n        isParent: function (node) {\n            return Css.hasClassName(node, this._options.parentClass) ||\n                this._getChild(node) != null;\n        },\n\n        _setNodeOpen: function (node, beOpen) {\n            var child = this._getChild(node);\n            if (child) {\n                Css.setClassName(child, this._options.hideClass, !beOpen);\n                var icon = this._getIcon(node);\n\n                node.setAttribute('data-open', beOpen);\n\n                /*\n                 * Don't refactor this to\n                 *\n                 * setClassName(el, className, status); setClassName(el, className, !status);\n                 *\n                 * because it won't work with multiple classes.\n                 *\n                 * Doing:\n                 * setClassName(el, 'fa fa-whatever', true);setClassName(el, 'fa fa-whatever-else', false);\n                 *\n                 * will remove 'fa' although it is a class we want.\n                 */\n\n                var toAdd = beOpen ? this._options.openClass : this._options.closedClass;\n                var toRemove = beOpen ? this._options.closedClass : this._options.openClass;\n                Css.removeClassName(icon, toRemove);\n                Css.addClassName(icon, toAdd);\n\n                Css.setClassName(node, this._options.openNodeClass, beOpen);\n            } else {\n                Ink.error('Ink.UI.TreeView: node', node, 'is not a node!');\n            }\n        },\n\n        /**\n         * Opens one of the tree nodes\n         *\n         * Make sure you pass the node's DOMElement\n         * @method open\n         * @param {DOMElement} node     The node you wish to open.\n         **/\n        open: function (node) {\n            this._setNodeOpen(node, true);\n        },\n\n        /**\n         * Closes one of the tree nodes\n         *\n         * Make sure you pass the node's DOMElement\n         * @method close\n         * @param {DOMElement} node     The node you wish to close.\n         **/\n        close: function (node) {\n            this._setNodeOpen(node, false);\n        },\n\n        /**\n         * Toggles a node state\n         *\n         * @method toggle\n         * @param {DOMElement} node     The node to toggle.\n         **/\n        toggle: function (node) {\n            if (this.isOpen(node)) {\n                this.close(node);\n            } else {\n                this.open(node);\n            }\n        },\n\n        _getChild: function (node) {\n            return Selector.select(this._options.children, node)[0] || null;\n        },\n\n        /**\n         * Handles the click event (as specified in the _init function).\n         * \n         * @method _onClick\n         * @param {Event} event\n         * @private\n         */\n        _onClick: function(ev){\n            /**\n             * Summary:\n             * If the clicked element is a \"node\" as defined in the options, will check if it has any \"child\".\n             * If so, will toggle its state and stop the event's default behavior if the stopDefault option is true.\n             **/\n\n            if (!this.isParent(ev.currentTarget) ||\n                    Selector.matchesSelector(ev.target, this._options.node) ||\n                    Selector.matchesSelector(ev.target, this._options.children)) {\n                return;\n            }\n\n            if (this._options.stopDefault){\n                ev.preventDefault();\n            }\n\n            this.toggle(ev.currentTarget);\n        }\n    };\n\n    Common.createUIComponent(TreeView);\n\n    return TreeView;\n});\n","Ink.createModule('Ink.UI.Upload', '1', [\n    'Ink.Dom.Event_1',\n    'Ink.Dom.Element_1',\n    'Ink.Dom.Browser_1',\n    'Ink.UI.Common_1'\n], function(Event, Element, Browser, Common) {\n    'use strict';\n\n    var DirectoryReader = function(options) {\n        this.init(options);\n    };\n\n    DirectoryReader.prototype = {\n        init: function(options) {\n            this._options = Ink.extendObj({\n                entry:      undefined,\n                maxDepth:   10\n            }, options || {});\n\n            try {\n                this._read();\n            } catch(e) {\n                Ink.error(e);\n            }\n        },\n\n\n        _read: function() {\n            if(!this._options.entry) {\n                Ink.error('You must specify the entry!');\n                return;\n            }\n\n            try {\n                this._readDirectories();\n            } catch(e) {\n                Ink.error(e);\n            }\n        },\n\n\n        _readDirectories: function() {\n            var entries         = [],\n                running         = false,\n                maxDepth        = 0;\n\n            /* TODO return as tree because much better well */\n            var _readEntries = Ink.bind(function(currentEntry) {\n                var dir     = currentEntry.createReader();\n                    running = true;\n\n                dir.readEntries(Ink.bind(function(res) {\n                    if(res.length > 0) {\n                        for(var i = 0, len = res.length; i<len; i++) {\n                            entries.push(res[i]);\n                            if(!res[i].isDirectory) {\n                                continue;\n                            }\n                            maxDepth = this.clearArray(res[i].fullPath.split('/'));\n                            maxDepth.shift();\n                            maxDepth = maxDepth.length;\n                            if(maxDepth <= this._options.maxDepth) {\n                                _readEntries(res[i]);\n                            }\n                        }\n                        if(this._stopActivityTimeout) {\n                            clearTimeout(this._stopActivityTimeout);\n                        }\n                        this._stopActivityTimeout = setTimeout(function() {\n                            running = false;\n                        }, 250);\n                    }\n                    if(!res.length) {\n                        running = false;\n                    }\n                }, this), Ink.bind(function(err) {\n                    this._options.readError(err, currentEntry);\n                }, this));\n            }, this);\n\n            _readEntries(this._options.entry);\n\n            var activity;\n            var checkActivity = function() {\n                if(running) {\n                    return false;\n                }\n                clearInterval(activity);\n                if(this._options.readComplete && typeof this._options.readComplete === 'function') {\n                    this._options.readComplete(entries);\n                }\n                return true;\n            };\n\n            activity = setInterval(Ink.bind(checkActivity, this), 250);\n        },\n\n\n        clearArray: function(arr) {\n            for(var i = arr.length - 1; i>=0; i--) {\n                if(typeof(arr[i]) === 'undefined' || arr[i] === null || arr[i] === '') {\n                    arr.splice(i, 1);\n                }\n            }\n            return arr;\n        }\n    };\n\n    var Queue = {\n        lists:  [],\n        items:  [],\n\n\n        /**\n         * Create new queue list\n         * @function create\n         * @public\n         * @param {String} list name\n         * @param {Function} function to iterate on items\n         * @return {Object} list id\n        */\n        create: function(name) {\n            var id;\n                name = String(name);\n            this.lists.push({name: name});\n            id = this.lists.length - 1;\n            return id;\n        },\n\n\n        getItems: function(parentId) {\n            if(!parentId) {\n                return this.items;\n            }\n            var items = [];\n            for(var i = 0, len = this.items.length; i<len; i++) {\n                if(this.items[i].parentId === parentId) {\n                    items.push(this.items[i]);\n                }\n            }\n\n            return items;\n        },\n\n\n        /**\n         * Delete list\n         * @function purge\n         * @public\n         * @param {String} List name\n         * @return {Object} removed list\n        */\n        purge: function(id, keepList) {\n            if(typeof(id) !== 'number' || isNaN(Number(id))) {\n                return false;\n            }\n            try {\n                for(var i = this.items.length; i>=0; i--) {\n                    if(this.items[i] && id === this.items[i].parentId) {\n                        this.remove(this.items[i].parentId, this.items[i].pid);\n                    }\n                }\n                if(!keepList) {\n                    this.lists.splice(id, 1);\n                }\n                return true;\n            } catch(e) {\n                Ink.error('Purge: invalid id');\n                return false;\n            }\n        },\n\n\n        /**\n         * add an item to a list\n         * @function add\n         * @public\n         * @param {String} name\n         * @param {Object} item\n         * @return {Number} pid\n        */\n        add: function(parentId, item, priority) {\n            if(!this.lists[parentId]) {\n                return false;\n            }\n            if(typeof(item) !== 'object') {\n                item = String(item);\n            }\n\n            var pid = parseInt(Math.round(Math.random() * 100000) + \"\" + Math.round(Math.random() * 100000), 10);\n            priority    = priority || 0;\n\n            this.items.push({parentId: parentId, item: item, priority: priority || 0, pid: pid});\n            return pid;\n        },\n\n\n        /**\n         * View list\n         * @function view\n         * @public\n         * @param {Number} list id\n         * @param {Number} process id\n         * @return {Object} item\n        */\n        view: function(parentId, pid) {\n            var id = this._searchByPid(parentId, pid);\n            if(id === false) {\n                return false;\n            }\n            return this.items[id];\n        },\n\n\n        /**\n         * Remove an item\n         * @function remove\n         * @public\n         * @param {Object} item\n         * @return {Object|Boolean} removed item or false if not found\n        */\n        remove: function(parentId, pid) {\n            try {\n                var id = this._searchByPid(parentId, pid);\n                if(id === false) {\n                    return false;\n                }\n                this.items.splice(id, 1);\n                return true;\n            } catch(e) {\n                Ink.error('Remove: invalid id');\n                return false;\n            }\n        },\n\n        _searchByPid: function(parentId, pid) {\n            if(!parentId && typeof(parentId) === 'boolean' || !pid) {\n                return false;\n            }\n\n            parentId    = parseInt(parentId, 10);\n            pid         = parseInt(pid, 10);\n\n            if(isNaN(parentId) || isNaN(pid)) {\n                return false;\n            }\n\n            for(var i = 0, len = this.items.length; i<len; i++) {\n                if(this.items[i].parentId === parentId && this.items[i].pid === pid) {\n                    return i;\n                }\n            }\n            return false;\n        }\n    };\n\n    var UI = function(Upload) {\n        this.Upload = Upload;\n        this.init();\n    };\n\n    UI.prototype = {\n        init: function() {\n            this._fileButton = this.Upload._options.fileButton;\n            this._dropzone = this.Upload._options.dropzone;\n            this._setDropEvent();\n            this._setFileButton();\n        },\n\n\n        _setDropEvent: function() {\n            var dropzones = this._dropzone;\n            if (!dropzones) { return; }\n\n            for(var i = 0, len = dropzones.length; i<len; i++) {\n                dropzones[i].ondrop        = Ink.bindEvent(this.Upload._dropEventHandler, this.Upload);\n                dropzones[i].ondragleave   = Ink.bindEvent(this._onDragLeave, this);\n                dropzones[i].ondragend     = Ink.bindEvent(this._onDragEndEventHandler, this);\n                dropzones[i].ondragdrop    = Ink.bindEvent(this._onDragEndEventHandler, this);\n                dropzones[i].ondragenter   = Ink.bindEvent(this._onDragEnterHandler, this);\n                dropzones[i].ondragover    = Ink.bindEvent(this._onDragOverHandler, this);\n            }\n        },\n\n\n        _onDragEnterHandler: function(ev) {\n            if(ev && ev.stopPropagation) {\n                ev.stopPropagation();\n            }\n            if(ev && ev.preventDefault) {\n                ev.preventDefault();\n            }\n            if(ev) {\n                ev.returnValue = false;\n            }\n\n            this.Upload.publish('DragEnter', ev);\n            return false;\n        },\n\n\n        _onDragOverHandler: function(ev) {\n            if(!ev) {\n                return false;\n            }\n            ev.preventDefault();\n            ev.stopPropagation();\n            ev.returnValue = false;\n            return true;\n        },\n\n\n        _onDragLeave: function(ev) {\n            return this.Upload.publish('DragLeave', ev);\n        },\n\n\n        _onDragEndEventHandler: function(ev) {\n            return this.Upload.publish('DragEnd', ev);\n        },\n\n\n        _setFileButton: function() {\n            var btns = this._fileButton;\n            if (!btns) { return; }\n            Event.observeMulti(btns, 'change', Ink.bindEvent(this._fileChangeHandler, this));\n        },\n\n\n        _fileChangeHandler: function(ev) {\n            var btn = Event.element(ev);\n            var files = btn.files;\n            var form = Element.findUpwardsByTag(btn, 'form');\n\n            if(!files || !window.FormData || !('withCredentials' in new XMLHttpRequest())) {\n                form.parentNode.submit();\n                return false;\n            }\n            this.Upload._addFilesToQueue(files);\n            btn.value = \"\";\n        }\n    };\n\n\n\n\n\n\n    var Upload = function(options) {\n        this.Queue = Queue;\n        this.init(options);\n        this._events = {};\n    };\n\n    Upload.prototype = {\n        //_events: {},\n        \n        /**\n         * This component is used to enable HTML5 upload on forms easily. It\n         * evens out differences between browsers which support HTML5 upload,\n         * and supports chunked uploads and directory tree uploads.\n         *\n         * Choose a drop zone and/or a file input. When the user drops the file\n         * on the drop zone element, or chooses it using the file input,\n         * Ink.UI.Upload takes care of uploading it through AJAX POST.\n         *\n         * The name given to the file in the POST request's data is chosen\n         * through the `fileFormName` option.\n         *\n         * On the server side, you will receive a POST with a Content-type of\n         * `multipart/form-data` or `x-www-form/urlencoded` if `useChunks`\n         * is `true`.\n         *\n         * @class Ink.UI.Upload_1\n         * @constructor\n         *\n         * @param options {Object} Options hash, containing:\n         * @param [options.dropzone] {Element} Element where the user can drop files onto.\n         * @param [options.fileButton] {Element} An `input[type=\"file\"]` for the user to choose a file using a native dialog.\n         * @param [options.fileFormName='Ink_Filelist'] The name of the file in the POST request.\n         * @param [options.endpoint=window.location] The URL where we're POSTing the files to. Defaults to the current location, like a HTML form.\n         * @param [options.maxFileSize] Maximum file size in bytes. Defaults to 300mb.\n         * @param [INVALID_FILE_NAME] A regular expression to invalidate file names. For example, set this to `/\\.png$/` if you don't want files with the \".png\" extension. Remember that file extensions are just hints!\n         * @param [options.extraData] Add more data to your POST request. Each key in this hash gets added to the form data sent to the server.\n         * TODO chunk options, also write a bit above about chunking and the serverside of chunking.\n         * TODO directory options, also write a bit above about directories and the server end of directories.\n         */\n        init: function(options) {\n            if (typeof options === 'string') {\n                options = Element.data(Common.elOrSelector(options, '1st argument'));\n            }\n            this._options = Ink.extendObj({\n                dropzone:           undefined,\n                fileButton:         undefined,\n                fileFormName:       'Ink_Filelist',  // TODO default to fileButton's [name] if available.\n                endpoint:           '',\n                maxFilesize:        300 << 20, //300mb\n                INVALID_FILE_NAME:  undefined,\n                extraData:          {},\n                // Chunks\n                useChunks:          false,\n                chunkSize:          4194304,  // 4MB\n                minSizeToUseChunks: 20971520, // 20mb\n                endpointChunk:      '',  // Where to send chunk data.\n                endpointChunkCommit:'',  // Where to send the \"chunk transaction\" commit.\n                // Directory trees\n                foldersEnabled:     false,\n                directoryMaxDepth:  10\n            }, options || {});\n\n            this._queueId           = Queue.create('Ink_UPLOAD');\n            this._queueRunning      = false;\n            this._folders           = {};\n\n\n            if(this._options.dropzone) {\n                this._options.dropzone =\n                    Common.elsOrSelector(this._options.dropzone, 'Ink.UI.Upload - dropzone');\n            }\n\n            if(this._options.fileButton) {\n                this._options.fileButton =\n                    Common.elsOrSelector(this._options.fileButton, 'Ink.UI.Upload - fileButton');\n            }\n\n            if(!this._options.dropzone && !this._options.fileButton) {\n                throw new TypeError(\n                    'Ink.UI.Upload: Specify a fileButton or a Dropzone!');\n            }\n\n            new UI(this);\n        },\n\n\n        _supportChunks: function(size) {\n            return this._options.useChunks &&\n                    'Blob' in window &&\n                    (new Blob()).slice &&\n                    size > this._options.minSizeToUseChunks;\n        },\n\n\n        _dropEventHandler: function(ev) {\n            Event.stop(ev);\n\n            this.publish('DropComplete', ev.dataTransfer);\n\n            var data = ev.dataTransfer;\n\n            if(!data || !data.files || !data.files.length) {\n                return false;\n            }\n\n            this._files = data.files;\n            this._files = Array.prototype.slice.call(this._files || [], 0);\n\n            // check if webkitGetAsEntry exists on first item\n            if(data.items && data.items[0] && data.items[0].webkitGetAsEntry) {\n                if(!this._options.foldersEnabled) {\n                    return setTimeout(Ink.bind(this._addFilesToQueue, this, this._files), 0);\n                }\n                var entry, folders = [];\n                for(var i = ev.dataTransfer.items.length-1; i>=0; i--) {\n                    entry = ev.dataTransfer.items[i].webkitGetAsEntry();\n                    if(entry && entry.isDirectory) {\n                        folders.push(entry);\n                        this._files[i].isDirectory = true;\n                        this._files.splice(i, 1);\n                    }\n                }\n                // starting callback hell\n                this._addFolderToQueue(folders, Ink.bind(function() {\n                    setTimeout(Ink.bind(this._addFilesToQueue, this, this._files), 0);\n                }, this));\n            } else {\n                setTimeout(Ink.bind(this._addFilesToQueue, this, this._files), 0);\n            }\n\n            return true;\n        },\n\n\n        _addFolderToQueue: function(folders, cb) {\n            var files = [], invalidFolders = {};\n\n            if(!folders || !folders.length) {\n                cb();\n                return files;\n            }\n\n            var getFiles = function(entries) {\n                var files = [];\n                for(var i = 0, len = entries.length; i<len; i++) {\n                    if(entries[i].isFile) {\n                        files.push(entries[i]);\n                    }\n                }\n                return files;\n            };\n\n            var convertToFile = function(cb, index) {\n                var fullPath;\n                index = index || 0;\n                if(!this._files[index]) {\n                    cb();\n                    return files;\n                }\n                if(this._files[index].constructor.name.toLowerCase() !== 'fileentry') {\n                    return convertToFile.apply(this, [cb, ++index]);\n                }\n                this._files[index].file(Ink.bind(function(res) {\n                    fullPath = this._files[index].fullPath; // bug\n                    this._files[index]              = res;\n                    this._files[index].hasParent    = true;\n\n                    // if browser don't have it natively, set it\n                    if(!this._files[index].fullPath) {\n                        this._files[index].fullPath = fullPath;\n                    }\n                    convertToFile.apply(this, [cb, ++index]);\n                }, this), Ink.bind(function() {\n                    this._files.splice(index, 1);\n                    convertToFile.apply(this, [cb, index]);\n                }, this));\n            };\n\n            var getSubDirs = Ink.bind(function(index) {\n                if(!folders[index]) {\n                    this._files = this._files.concat(files);\n                    convertToFile.call(this, cb);\n                    return false;\n                }\n\n                new DirectoryReader({\n                    entry:      folders[index],\n                    maxDepth:   this._options.directoryMaxDepth,\n                    readComplete: Ink.bind(function(entries) {\n                        files = files.concat(getFiles(entries));\n                        // adding root dirs\n                        if(!folders[index] || folders[index].fullPath in this._folders) {\n                            return;\n                        }\n\n                        this._folders[folders[index].fullPath] = {\n                            items:      entries,\n                            files:      files,\n                            length:     entries.length,\n                            created:    false,\n                            root:       true\n                        };\n\n                        // adding sub dirs\n                        for(var i = 0, len = entries.length; i<len; i++) {\n                            if(entries[i].isFile) {\n                                continue;\n                            }\n                            if(entries[i].fullPath in invalidFolders) {\n                                delete invalidFolders[entries[i].fullPath];\n                                continue;\n                            }\n                            this._folders[entries[i].fullPath] = {\n                                created:    false,\n                                root:       false\n                            };\n                        }\n                        getSubDirs(++index);\n                    }, this),\n                    readError: Ink.bind(function(err, dir) {\n                        invalidFolders[dir.fullPath] = {};\n                        invalidFolders[dir.fullPath].error = err;\n                    }, this)\n                });\n            }, this);\n\n            getSubDirs(0);\n            return files;\n        },\n\n\n        _addFilesToQueue: function(files) {\n            var file, fileID, o;\n            for(var i = 0, len = files.length; i<len; i++) {\n                file = files[i];\n\n                if(!file.isDirectory) {\n                    // dirty hack to allow 0B files avoiding folders on GECKO\n                    if(file === null || (!file.type && file.size % 4096 === 0 && (!Browser.CHROME || !this._options.foldersEnabled))) {\n                        this.publish('InvalidFile', file, 'size');\n                        continue;\n                    }\n                }\n\n                if(file.size > this._options.maxFilesize) {\n                    this.publish('MaxSizeFailure', file, this._options.maxFilesize);\n                    continue;\n                }\n\n                fileID = parseInt(Math.round(Math.random() * 100000) + \"\" + Math.round(Math.random() * 100000), 10);\n                o = { id: i, data: file, fileID: fileID, directory: file.isDirectory };\n                Queue.add(this._queueId, o);\n\n                this.publish('FileAddedToQueue', o);\n            }\n            this._processQueue(true);\n            this._files = [];\n        },\n\n\n        _processQueue: function(internalUpload) {\n            if(this._queueRunning) {\n                return false;\n            }\n\n            this.running = 0;\n            var max = 1, i = 0, items,\n                queueLen = Queue.items.length;\n            this._queueRunning = true;\n\n            this.interval = setInterval(Ink.bind(function() {\n                if(Queue.items.length === i && this.running === 0) {\n                    Queue.purge(this._queueId, true);\n                    this._queueRunning = false;\n                    clearInterval(this.interval);\n                    this.publish('QueueEnd', this._queueId, queueLen);\n                }\n\n                items = Queue.getItems(this._queueId);\n\n                if(this.running < max && items[i]) {\n                    if(!items[i].canceled) {\n                        _doRequest.call(this, items[i].pid, items[i].item.data, items[i].item.fileID, items[i].item.directory, internalUpload);\n                        this.running++;\n                        i++;\n                    } else {\n                        var j = i;\n                        while(items[j] && items[j].canceled) {\n                            i++;\n                            j++;\n                        }\n                    }\n                    return true;\n                }\n                return false;\n            }, this), 100);\n\n\n            var _doRequest = function(pid, data, fileID, directory, internalUpload) {\n                var o = {\n                    file:   data,\n                    fileID: fileID,\n                    cb: Ink.bind(function() {\n                        this.running--;\n                    }, this)\n                };\n                if(internalUpload) {\n                    if(directory) {\n                        // do magic\n                        o.cb();\n                    } else {\n                        this._upload(o);\n                    }\n                }\n            };\n\n            return true;\n        },\n\n\n        _upload: function(o) {\n            var file = o.file,\n                xhr = new XMLHttpRequest(),\n                fileID = o.fileID;\n\n            this.publish('BeforeUpload', file, this._options.extraData, fileID, xhr, this._supportChunks(file.size));\n\n            var forceAbort = function(showError) {\n                if(o.cb && typeof(o.cb === 'function')) {\n                    o.cb();\n                }\n\n                this.publish('OnProgress', {\n                    length: file.size,\n                    lengthComputable: true,\n                    loaded: file.size,\n                    total: file.size\n                }, file, fileID);\n                this.publish('EndUpload', file, fileID, (showError ? { error: true } : true));\n                this.publish('InvalidFile', file, 'name');\n                xhr.abort();\n            };\n\n            if(this._options.INVALID_FILE_NAME && this._options.INVALID_FILE_NAME instanceof RegExp) {\n                if(this._options.INVALID_FILE_NAME.test(o.file.name)) {\n                    forceAbort.call(this);\n                    return;\n                }\n            }\n\n            // If file was renamed, abort it\n            // FU OPERA: Opera always return lastModified date as null\n            if(!file.lastModifiedDate && !Ink.Dom.Browser.OPERA) {\n                forceAbort.call(this, true);\n                return;\n            }\n\n            xhr.upload.onprogress = Ink.bind(this.publish, this, 'OnProgress', file, fileID);\n\n            var endpoint, method;\n            if(this._supportChunks(file.size)) {\n                if(file.size <= file.chunk_offset) {\n                    endpoint = this._options.endpointChunkCommit;\n                    method = 'POST';\n                } else {\n                    endpoint = this._options.endpointChunk;\n                    if(file.chunk_upload_id) {\n                        endpoint += '?upload_id=' + file.chunk_upload_id;\n                    }\n                    if(file.chunk_offset) {\n                        endpoint += '&offset=' + file.chunk_offset;\n                    }\n                    method = 'PUT';\n                }\n            } else {\n                endpoint = this._options.endpoint;\n                method = 'POST';\n            }\n\n            xhr.open(method, endpoint, true);\n            xhr.withCredentials = true;\n            xhr.setRequestHeader(\"x-requested-with\", \"XMLHttpRequest\");\n            if(this._supportChunks(file.size)) {\n                xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n            }\n\n            var fd = new FormData(),\n                blob;\n\n            if(\"Blob\" in window && typeof Blob === 'function') {\n                blob = new Blob([file], { type: file.type });\n                if(this._supportChunks(file.size)) {\n                    file.chunk_offset = file.chunk_offset || 0;\n                    blob = blob.slice(file.chunk_offset, file.chunk_offset + this._options.chunkSize);\n                } else {\n                    fd.append(this._options.fileFormName, blob, file.name);\n                }\n            } else {\n                fd.append(this._options.fileFormName, file);\n            }\n\n            if(!this._supportChunks(file.size)) {\n                for(var k in this._options.extraData) {\n                    if(this._options.extraData.hasOwnProperty(k)) {\n                        fd.append(k, this._options.extraData[k]);\n                    }\n                }\n            } else {\n                fd.append('upload_id', file.chunk_upload_id);\n                fd.append('path', file.upload_path);\n            }\n\n            if(!file.hasParent) {\n                if(!this._supportChunks(file.size)) {\n                    xhr.send(fd);\n                } else {\n                    if(file.size <= file.chunk_offset) {\n                        xhr.send('upload_id=' + file.chunk_upload_id + '&path=' + file.upload_path + '/' + file.name);\n                    } else {\n                        xhr.send(blob);\n                    }\n                }\n            } else {\n                this.publish('cbCreateFolder', file.parentID, file.fullPath, this._options.extraData, this._folders, file.rootPath, Ink.bind(function() {\n                    if(!this._supportChunks(file.size)) {\n                        xhr.send(fd);\n                    } else {\n                        if(file.size <= file.chunk_offset) {\n                            xhr.send('upload_id=' + file.chunk_upload_id + '&path=' + file.upload_path + '/' + file.name);\n                        } else {\n                            xhr.send(blob);\n                        }\n                    }\n                }, this));\n            }\n\n\n            xhr.onload = Ink.bindEvent(function() {\n                /* jshint boss:true */\n                if(this._supportChunks(file.size) && file.size > file.chunk_offset) {\n                    if(xhr.response) {\n                        var response = JSON.parse(xhr.response);\n\n                        // check expected offset\n                        var invalidOffset = file.chunk_offset && response.offset !== (file.chunk_offset + this._options.chunkSize) && file.size !== response.offset;\n                        if(invalidOffset) {\n                            if(o.cb) {\n                                o.cb();\n                            }\n                            this.publish('ErrorUpload', file, fileID);\n                        } else {\n                            file.chunk_upload_id = response.upload_id;\n                            file.chunk_offset = response.offset;\n                            file.chunk_expires = response.expires;\n                            this._upload(o);\n                        }\n                    } else {\n                        if(o.cb) {\n                            o.cb();\n                        }\n                        this.publish('ErrorUpload', file, fileID);\n                    }\n                    return (xhr = null);\n                }\n\n                if(o.cb) {\n                    o.cb();\n                }\n\n                if(xhr.responseText && xhr['status'] < 400) {\n                    this.publish('EndUpload', file, fileID, xhr.responseText);\n                } else {\n                    this.publish('ErrorUpload', file, fileID);\n                }\n                return (xhr = null);\n            }, this);\n\n\n            xhr.onerror = Ink.bindEvent(function() {\n                if(o.cb) {\n                    o.cb();\n                }\n                this.publish('ErrorUpload', file, fileID);\n            }, this);\n\n            xhr.onabort = Ink.bindEvent(function() {\n                if(o.cb) {\n                    o.cb();\n                }\n                this.publish('AbortUpload', file, fileID, {\n                    abortAll: Ink.bind(this.abortAll, this),\n                    abortOne: Ink.bind(this.abortOne, this)\n                });\n            }, this);\n        },\n\n\n        abortAll: function() {\n            if(!this._queueRunning) {\n                return false;\n            }\n            clearInterval(this.interval);\n            this._queueRunning = false;\n            Queue.purge(this._queueId, true);\n            return true;\n        },\n\n        abortOne: function(id, cb) {\n            var items = Queue.getItems(0),\n                o;\n            for(var i = 0, len = items.length; i<len; i++) {\n                if(items[i].item.fileID === id) {\n                    o = {\n                        id:         items[i].item.fileID,\n                        name:       items[i].item.data.name,\n                        size:       items[i].item.data.size,\n                        hasParent:  items[i].item.data.hasParent\n                    };\n                    Queue.remove(0, items[i].pid);\n                    if(cb) {\n                        cb(o);\n                    }\n                    return true;\n                }\n            }\n            return false;\n        },\n\n\n        subscribe: function(eventName, fn) {\n            if(!this._events[eventName]) {\n                this._events[eventName] = [];\n            }\n            this._events[eventName].push(fn);\n            return this._events[eventName];\n        },\n\n\n        publish: function(eventName) {\n            var events = this._events[eventName],\n                args = Array.prototype.slice.call(arguments || [], 0);\n\n            if(!events) {\n                return;\n            }\n\n            for(var i = 0, len = events.length; i<len; i++) {\n                try {\n                    events[i].apply(this, args.splice(1, args.length));\n                } catch(err) {\n                    Ink.error(eventName + \": \" + err);\n                }\n            }\n        }\n    };\n\n    return Upload;\n});\n","/**\n * Array Utilities\n * @module Ink.Util.Array_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Array', '1', [], function() {\n\n    'use strict';\n\n    var arrayProto = Array.prototype;\n\n    /**\n     * @namespace Ink.Util.Array_1\n     */\n\n    var InkArray = {\n\n        /**\n         * Checks if a value is an array\n         *\n         * @method isArray\n         * @param testedObject {Mixed} The object we want to check\n         **/\n        isArray: Array.isArray || function (testedObject) {\n            return {}.toString.call(testedObject) === '[object Array]';\n        },\n\n        /**\n         * Loops through an array, grouping similar items together.\n         * @method groupBy\n         * @param arr {Array} The input array.\n         * @param [options] {Object} options object, containing:\n         * @param [options.key] {Function} A function which computes the group key by which the items are grouped.\n         * @param [options.pairs] {Boolean} Set to `true` if you want to output an array of `[key, [group...]]` pairs instead of an array of groups.\n         * @return {Array} An array of arrays of chunks.\n         *\n         * @example\n         *\n         *        InkArray.groupBy([1, 1, 2, 2, 3, 1])  // -> [ [1, 1], [2, 2], [3], [1] ]\n         *        InkArray.groupBy([1.1, 1.2, 2.1], { key: Math.floor })  // -> [ [1.1, 1.2], [2.1] ]\n         *        InkArray.groupBy([1.1, 1.2, 2.1], { key: Math.floor, pairs: true })  // -> [ [1, [1.1, 1.2]], [2, [2.1]] ]\n         *\n         **/\n        groupBy: function (arr, options) {\n            options = options || {};\n            var ret = [];\n            var latestGroup;\n            function eq(a, b) {\n                return outKey(a) === outKey(b);\n            }\n            function outKey(item) {\n                if (typeof options.key === 'function') {\n                    return options.key(item);\n                } else {\n                    return item;\n                }\n            }\n\n            for (var i = 0, len = arr.length; i < len; i++) {\n                latestGroup = [arr[i]];\n\n                // Chunkin'\n                while ((i + 1 < len) && eq(arr[i], arr[i + 1])) {\n                    latestGroup.push(arr[i + 1]);\n                    i++;\n                }\n\n                if (options.pairs) {\n                    ret.push([outKey(arr[i]), latestGroup]);\n                } else {\n                    ret.push(latestGroup);\n                }\n            }\n            return ret;\n        },\n\n        /**\n         * Replacement for Array.prototype.reduce.\n         *\n         * Produces a single result from a list of values by calling an \"aggregator\" function.\n         *\n         * Falls back to Array.prototype.reduce if available.\n         *\n         * @method reduce\n         * @param array {Array} Input array to be reduced.\n         * @param callback {Function} `function (previousValue, currentValue, index, all) { return {Mixed} }` to execute for each value.\n         * @param initial {Mixed} Object used as the first argument to the first call of `callback`\n         *\n         * @example\n         *          var sum = InkArray.reduce([1, 2, 3], function (a, b) { return a + b; });  // -> 6\n         */\n        reduce: function (array, callback, initial) {\n            if (arrayProto.reduce) {\n                return arrayProto.reduce.apply(array, [].slice.call(arguments, 1));\n            }\n\n            // From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#Polyfill\n            var t = Object( array ), len = t.length >>> 0, k = 0, value;\n            if ( arguments.length >= 3 ) {\n                value = initial;\n            } else {\n                while ( k < len && !(k in t) ) k++;\n                if ( k >= len )\n                    throw new TypeError('Reduce of empty array with no initial value');\n                value = t[ k++ ];\n            }\n            for ( ; k < len ; k++ ) {\n                if ( k in t ) {\n                    value = callback( value, t[k], k, t );\n                }\n            }\n            return value;\n        },\n\n        /**\n         * Checks if a value exists in array\n         *\n         * @method inArray\n         * @public\n         * @static\n         * @param {Mixed} value     Value to check\n         * @param {Array} arr       Array to search in\n         * @return {Boolean}        True if value exists in the array\n         * @sample Ink_Util_Array_inArray.html\n         */\n        inArray: function(value, arr) {\n            if (typeof arr === 'object') {\n                for (var i = 0, f = arr.length; i < f; ++i) {\n                    if (arr[i] === value) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Sorts an array of objects by an object property\n         *\n         * @method sortMulti\n         * @param {Array}           arr         Array of objects to sort\n         * @param {String}  key         Property to sort by\n         * @return {Array|Boolean}      False if it's not an array, returns a sorted array if it's an array.\n         * @public\n         * @static\n         * @sample Ink_Util_Array_sortMulti.html\n         */\n        sortMulti: function(arr, key) {\n            if (typeof arr === 'undefined' || arr.constructor !== Array) { return false; }\n            if (typeof key !== 'string') { return arr.sort(); }\n            if (arr.length > 0) {\n                if (typeof(arr[0][key]) === 'undefined') { return false; }\n                arr.sort(function(a, b){\n                    var x = a[key];\n                    var y = b[key];\n                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));\n                });\n            }\n            return arr;\n        },\n\n        /**\n         * Gets the indexes of a value in an array\n         *\n         * @method keyValue\n         * @param   {String}      value     Value to search for.\n         * @param   {Array}       arr       Array to run the search in.\n         * @param   {Boolean}     [first]   Flag to stop the search at the first match. It also returns an index number instead of an array of indexes.\n         * @return  {Boolean|Number|Array}  False for no matches. Array of matches or first match index.\n         * @public\n         * @static\n         * @sample Ink_Util_Array_keyValue.html\n         */\n        keyValue: function(value, arr, first) {\n            if (typeof value !== 'undefined' && typeof arr === 'object' && this.inArray(value, arr)) {\n                var aKeys = [];\n                for (var i = 0, f = arr.length; i < f; ++i) {\n                    if (arr[i] === value) {\n                        if (typeof first !== 'undefined' && first === true) {\n                            return i;\n                        } else {\n                            aKeys.push(i);\n                        }\n                    }\n                }\n                return aKeys;\n            }\n            return false;\n        },\n\n        /**\n         * Shuffles an array.\n         *\n         * @method shuffle\n         * @param   {Array}       arr    Array to shuffle\n         * @return  {Array|Boolean}      Shuffled Array or false if not an array.\n         * @public\n         * @static\n         * @sample Ink_Util_Array_shuffle.html\n         */\n        shuffle: function(arr) {\n            if (typeof(arr) !== 'undefined' && arr.constructor !== Array) { return false; }\n            var total   = arr.length,\n                tmp1    = false,\n                rnd     = false;\n\n            while (total--) {\n                rnd        = Math.floor(Math.random() * (total + 1));\n                tmp1       = arr[total];\n                arr[total] = arr[rnd];\n                arr[rnd]   = tmp1;\n            }\n            return arr;\n        },\n\n        /**\n         * Runs a function through each of the elements of an array\n         *\n         * @method forEach\n         * @param   {Array}     arr     The array to be cycled/iterated\n         * @param   {Function}  cb      The function receives as arguments the value, index and array.\n         * @return  {Array}             Iterated array.\n         * @public\n         * @static\n         * @sample Ink_Util_Array_forEach.html\n         */\n        forEach: function(array, callback, context) {\n            if (arrayProto.forEach) {\n                return arrayProto.forEach.call(array, callback, context);\n            }\n            for (var i = 0, len = array.length >>> 0; i < len; i++) {\n                callback.call(context, array[i], i, array);\n            }\n        },\n\n        /**\n         * Alias for backwards compatibility. See forEach\n         *\n         * @method each\n         */\n        each: function () {\n            InkArray.forEach.apply(InkArray, [].slice.call(arguments));\n        },\n\n        /**\n         * Runs a function for each item in the array.\n         * That function will receive each item as an argument and its return value will change the corresponding array item.\n         * @method map\n         * @param {Array}       array       The array to map over\n         * @param {Function}    map         The map function. Will take `(item, index, array)` as arguments and `this` will be the `context` argument.\n         * @param {Object}      [context]   Object to be `this` in the map function.\n         *\n         * @sample Ink_Util_Array_map.html\n         */\n        map: function (array, callback, context) {\n            if (arrayProto.map) {\n                return arrayProto.map.call(array, callback, context);\n            }\n            var mapped = new Array(len);\n            for (var i = 0, len = array.length >>> 0; i < len; i++) {\n                mapped[i] = callback.call(context, array[i], i, array);\n            }\n            return mapped;\n        },\n\n        /**\n         * Filters an array based on a truth test.\n         * This method runs a test function on all the array values and returns a new array with all the values that pass the test.\n         * @method filter\n         * @param {Array}       array       The array to filter\n         * @param {Function}    test        A test function taking `(item, index, array)`\n         * @param {Object}      [context]   Object to be `this` in the test function.\n         * @return {Array}                  Returns the filtered array\n         *\n         * @sample Ink_Util_Array_filter.html\n         */\n        filter: function (array, test, context) {\n            if (arrayProto.filter) {\n                return arrayProto.filter.call(array, test, context);\n            }\n            var filtered = [],\n                val = null;\n            for (var i = 0, len = array.length; i < len; i++) {\n                val = array[i]; // it might be mutated\n                if (test.call(context, val, i, array)) {\n                    filtered.push(val);\n                }\n            }\n            return filtered;\n        },\n\n        /**\n         * Checks if some element in the array passes a truth test\n         *\n         * @method some\n         * @param   {Array}       arr       The array to iterate through\n         * @param   {Function}    cb        The callback to be called on the array's elements. It receives the value, the index and the array as arguments.\n         * @param   {Object}      context   Object of the callback function\n         * @return  {Boolean}               True if the callback returns true at any point, false otherwise\n         * @public\n         * @static\n         * @sample Ink_Util_Array_some.html\n         */\n        some: function(arr, cb, context){\n\n            if (arr === null){\n                throw new TypeError('First argument is invalid.');\n            }\n\n            var t = Object(arr);\n            var len = t.length >>> 0;\n            if (typeof cb !== \"function\"){ throw new TypeError('Second argument must be a function.'); }\n\n            for (var i = 0; i < len; i++) {\n                if (i in t && cb.call(context, t[i], i, t)){ return true; }\n            }\n\n            return false;\n        },\n\n        /**\n         * Compares the values of two arrays and return the matches\n         *\n         * @method intersect\n         * @param   {Array}   arr1      First array\n         * @param   {Array}   arr2      Second array\n         * @return  {Array}             Empty array if one of the arrays is false (or do not intersect) | Array with the intersected values\n         * @public\n         * @static\n         * @sample Ink_Util_Array_intersect.html\n         */\n        intersect: function(arr1, arr2) {\n            if (!arr1 || !arr2 || arr1 instanceof Array === false || arr2 instanceof Array === false) {\n                return [];\n            }\n\n            var shared = [];\n            for (var i = 0, I = arr1.length; i<I; ++i) {\n                for (var j = 0, J = arr2.length; j < J; ++j) {\n                    if (arr1[i] === arr2[j]) {\n                        shared.push(arr1[i]);\n                    }\n                }\n            }\n\n            return shared;\n        },\n\n        /**\n         * Converts an array-like object to an array\n         *\n         * @method convert\n         * @param   {Array}   arr   Array to be converted\n         * @return  {Array}         Array resulting of the conversion\n         * @public\n         * @static\n         * @sample Ink_Util_Array_convert.html\n         */\n        convert: function(arr) {\n            return arrayProto.slice.call(arr || [], 0);\n        },\n\n        /**\n         * Removes duplicated values in an array.\n         *\n         * @method unique\n         * @param {Array}   arr   Array to filter\n         * @return {Array}        Array with only unique values\n         * @public\n         * @static\n         */\n        unique: function(arr){\n            if(!Array.prototype.lastIndexOf){ //IE8 slower alternative\n                var newArr = [];\n\n                InkArray.forEach(InkArray.convert(arr), function(i){\n                    if(!InkArray.inArray(i,newArr)){\n                        newArr.push(i);\n                    }\n                });\n                return newArr;\n            }//else\n            return InkArray.filter(InkArray.convert(arr), function (e, i, arr) {\n                            return arr.lastIndexOf(e) === i;\n                        });\n        },\n\n        /**\n         * Simulates python's range(start, stop, step) function.\n         *\n         * Creates a list with numbers counting from start until stop, using a for loop.\n         *.\n         * The optional step argument defines how to step ahead. You can pass a negative number to count backwards (see the examples below).\n         *\n         * @method range\n         * @param {Number} start    The array's first element.\n         * @param {Number} stop     Stop counting before this number.\n         * @param {Number} [step=1] Interval between numbers. You can use a negative number to count backwards.\n         *\n         * @sample Ink_Util_Array_1_range.html\n         **/\n        range: function range(a, b, step) {\n            // From: https://github.com/mcandre/node-range\n            if (!step) {\n                step = 1;\n            }\n\n            var r = [];\n            var x;\n\n            if (step > 0) {\n                for (x = a; x < b; x += step) {\n                    r.push(x);\n                }\n            } else {\n                for (x = a; x > b; x += step) {\n                    r.push(x);\n                }\n            }\n\n            return r;\n        },\n\n        /**\n         * Inserts a value on a specified index\n         *\n         * @method insert\n         * @param {Array}   arr     Array where the value will be inserted\n         * @param {Number}  idx     Index of the array where the value should be inserted\n         * @param {Mixed}   value   Value to be inserted\n         * @public\n         * @static\n         * @sample Ink_Util_Array_insert.html\n         */\n        insert: function(arr, idx, value) {\n            arr.splice(idx, 0, value);\n        },\n\n        /**\n         * Removes a range of values from the array\n         *\n         * @method remove\n         * @param   {Array}     arr     Array where the value will be removed\n         * @param   {Number}    from    Index of the array where the removal will start removing.\n         * @param   {Number}    rLen    Number of items to be removed from the index onwards.\n         * @return  {Array}             An array with the remaining values\n         * @public\n         * @static\n         * @sample Ink_Util_Array_remove.html\n         */\n        remove: function(arr, from, rLen){\n            var output = [];\n\n            for(var i = 0, iLen = arr.length; i < iLen; i++){\n                if(i >= from && i < from + rLen){\n                    continue;\n                }\n\n                output.push(arr[i]);\n            }\n\n            return output;\n        }\n    };\n\n    return InkArray;\n\n});\n","/**\n * Binary Packing algorithm implementation\n * @module Ink.Util.BinPack_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.BinPack', '1', [], function() {\n\n    'use strict';\n\n    /*jshint boss:true */\n\n    // https://github.com/jakesgordon/bin-packing/\n\n    /*\n        Copyright (c) 2011, 2012, 2013 Jake Gordon and contributors\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the \"Software\"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.\n    */\n\n\n\n    var Packer = function(w, h) {\n        this.init(w, h);\n    };\n\n    Packer.prototype = {\n\n        init: function(w, h) {\n            this.root = { x: 0, y: 0, w: w, h: h };\n        },\n\n        fit: function(blocks) {\n            var n, node, block;\n            for (n = 0; n < blocks.length; ++n) {\n                block = blocks[n];\n                if (node = this.findNode(this.root, block.w, block.h)) {\n                    block.fit = this.splitNode(node, block.w, block.h);\n                }\n            }\n        },\n\n        findNode: function(root, w, h) {\n            if (root.used) {\n                return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);\n            }\n            else if ((w <= root.w) && (h <= root.h)) {\n                return root;\n            }\n            else {\n                return null;\n            }\n        },\n\n        splitNode: function(node, w, h) {\n            node.used = true;\n            node.down  = { x: node.x,     y: node.y + h, w: node.w,     h: node.h - h };\n            node.right = { x: node.x + w, y: node.y,     w: node.w - w, h: h          };\n            return node;\n        }\n\n    };\n\n\n\n    var GrowingPacker = function() {};\n\n    GrowingPacker.prototype = {\n\n        fit: function(blocks) {\n            var n, node, block, len = blocks.length;\n            var w = len > 0 ? blocks[0].w : 0;\n            var h = len > 0 ? blocks[0].h : 0;\n            this.root = { x: 0, y: 0, w: w, h: h };\n            for (n = 0; n < len ; n++) {\n                block = blocks[n];\n                if (node = this.findNode(this.root, block.w, block.h)) {\n                    block.fit = this.splitNode(node, block.w, block.h);\n                }\n                else {\n                    block.fit = this.growNode(block.w, block.h);\n                }\n            }\n        },\n\n        findNode: function(root, w, h) {\n            if (root.used) {\n                return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);\n            }\n            else if ((w <= root.w) && (h <= root.h)) {\n                return root;\n            }\n            else {\n                return null;\n            }\n        },\n\n        splitNode: function(node, w, h) {\n            node.used = true;\n            node.down  = { x: node.x,     y: node.y + h, w: node.w,     h: node.h - h };\n            node.right = { x: node.x + w, y: node.y,     w: node.w - w, h: h          };\n            return node;\n        },\n\n        growNode: function(w, h) {\n            var canGrowDown  = (w <= this.root.w);\n            var canGrowRight = (h <= this.root.h);\n\n            var shouldGrowRight = canGrowRight && (this.root.h >= (this.root.w + w)); // attempt to keep square-ish by growing right when height is much greater than width\n            var shouldGrowDown  = canGrowDown  && (this.root.w >= (this.root.h + h)); // attempt to keep square-ish by growing down  when width  is much greater than height\n\n            if (shouldGrowRight) {\n                return this.growRight(w, h);\n            }\n            else if (shouldGrowDown) {\n                return this.growDown(w, h);\n            }\n            else if (canGrowRight) {\n                return this.growRight(w, h);\n            }\n            else if (canGrowDown) {\n                return this.growDown(w, h);\n            }\n            else {\n                return null; // need to ensure sensible root starting size to avoid this happening\n            }\n        },\n\n        growRight: function(w, h) {\n            this.root = {\n                used: true,\n                x: 0,\n                y: 0,\n                w: this.root.w + w,\n                h: this.root.h,\n                down: this.root,\n                right: { x: this.root.w, y: 0, w: w, h: this.root.h }\n            };\n            var node;\n            if (node = this.findNode(this.root, w, h)) {\n                return this.splitNode(node, w, h);\n            }\n            else {\n                return null;\n            }\n        },\n\n        growDown: function(w, h) {\n            this.root = {\n                used: true,\n                x: 0,\n                y: 0,\n                w: this.root.w,\n                h: this.root.h + h,\n                down:  { x: 0, y: this.root.h, w: this.root.w, h: h },\n                right: this.root\n            };\n            var node;\n            if (node = this.findNode(this.root, w, h)) {\n                return this.splitNode(node, w, h);\n            }\n            else {\n                return null;\n            }\n        }\n\n    };\n\n\n\n    var sorts = {\n        random:  function() { return Math.random() - 0.5; },\n        w:       function(a, b) { return b.w - a.w; },\n        h:       function(a, b) { return b.h - a.h; },\n        a:       function(a, b) { return b.area - a.area; },\n        max:     function(a, b) { return Math.max(b.w, b.h) - Math.max(a.w, a.h); },\n        min:     function(a, b) { return Math.min(b.w, b.h) - Math.min(a.w, a.h); },\n        height:  function(a, b) { return sorts.msort(a, b, ['h', 'w']);               },\n        width:   function(a, b) { return sorts.msort(a, b, ['w', 'h']);               },\n        area:    function(a, b) { return sorts.msort(a, b, ['a', 'h', 'w']);          },\n        maxside: function(a, b) { return sorts.msort(a, b, ['max', 'min', 'h', 'w']); },\n        msort:   function(a, b, criteria) { /* sort by multiple criteria */\n            var diff, n;\n            for (n = 0; n < criteria.length; ++n) {\n                diff = sorts[ criteria[n] ](a, b);\n                if (diff !== 0) {\n                    return diff;\n                }\n            }\n            return 0;\n        }\n    };\n\n\n\n    // end of Jake's code\n\n\n\n    // aux, used to display blocks in unfitted property\n    var toString = function() {\n      return [this.w, ' x ', this.h].join('');\n    };\n\n\n\n    /**\n     * Binary Packing algorithm implementation\n     *\n     * Based on the work of Jake Gordon\n     *\n     * see https://github.com/jakesgordon/bin-packing/\n     *\n     * @namespace Ink.Util.BinPack\n     * @version 1\n     * @static\n     */\n    var BinPack = {\n\n        /**\n        * @method binPack\n        * @param {Object}       o               Options\n        * @param {Array}        o.blocks        Array of items with width and height integer attributes.\n        * @param {Array}        [o.dimensions]  Flag to fix container dimensions\n        * @param {String}       [o.sorter]      Sorting function. One of: random, height, width, area, maxside\n        * @return {Object}                      Returns an object containing container dimensions, filled ratio, fitted blocks, unfitted blocks and all blocks\n        * @static\n        */\n        binPack: function(o) {\n            var i, f, bl;\n\n\n\n            // calculate area if not there already\n            for (i = 0, f = o.blocks.length; i < f; ++i) {\n                bl = o.blocks[i];\n                if (! ('area' in bl) ) {\n                    bl.area = bl.w * bl.h;\n                }\n            }\n\n\n\n            // apply algorithm\n            var packer = o.dimensions ? new Packer(o.dimensions[0], o.dimensions[1]) : new GrowingPacker();\n\n            if (!o.sorter) { o.sorter = 'maxside'; }\n\n            o.blocks.sort( sorts[ o.sorter ] );\n\n            packer.fit(o.blocks);\n\n            var dims2 = [packer.root.w, packer.root.h];\n\n\n\n            // layout is done here, generating report data...\n            var fitted   = [];\n            var unfitted = [];\n\n            for (i = 0, f = o.blocks.length; i < f; ++i) {\n                bl = o.blocks[i];\n                if (bl.fit) {\n                    fitted.push(bl);\n                }\n                else {\n                    bl.toString = toString; // TO AID SERIALIZATION\n                    unfitted.push(bl);\n                }\n            }\n\n            var area = dims2[0] * dims2[1];\n            var fit = 0;\n            for (i = 0, f = fitted.length; i < f; ++i) {\n                bl = fitted[i];\n                fit += bl.area;\n            }\n\n            return {\n                dimensions: dims2,\n                filled:     fit / area,\n                blocks:     o.blocks,\n                fitted:     fitted,\n                unfitted:   unfitted\n            };\n        }\n    };\n\n\n\n    return BinPack;\n\n});","/**\n * Cookie Utilities\n * @module Ink.Util.Cookie_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Cookie', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.Cookie_1\n     */\n    var Cookie = {\n\n        /**\n         * Gets an object with the current page cookies.\n         *\n         * @method get\n         * @param   {String}          name      The cookie name.\n         * @return  {String|Object}             If the name is specified, it returns the value of that key. Otherwise it returns the full cookie object\n         * @public\n         * @static\n         * @sample Ink_Util_Cookie_get.html\n         */\n        get: function(name)\n        {\n            var cookie = document.cookie || false;\n\n            var _Cookie = {};\n            if(cookie) {\n                cookie = cookie.replace(new RegExp(\"; \", \"g\"), ';');\n                var aCookie = cookie.split(';');\n                var aItem = [];\n                if(aCookie.length > 0) {\n                    for(var i=0; i < aCookie.length; i++) {\n                        aItem = aCookie[i].split('=');\n                        if(aItem.length === 2) {\n                            _Cookie[aItem[0]] = decodeURIComponent(aItem[1]);\n                        }\n                        aItem = [];\n                    }\n                }\n            }\n            if(name) {\n                if(typeof(_Cookie[name]) !== 'undefined') {\n                    return _Cookie[name];\n                } else {\n                    return null;\n                }\n            }\n            return _Cookie;\n        },\n\n        /**\n         * Sets a cookie.\n         *\n         * @method set\n         * @param {String}      name        Cookie name.\n         * @param {String}      value       Cookie value.\n         * @param {Number}      [expires]   Number of seconds the cookie will be valid for.\n         * @param {String}      [path]      Path for the cookie. Defaults to '/'.\n         * @param {String}      [domain]    Domain for the cookie. Defaults to current hostname.\n         * @param {Boolean}     [secure]    Flag for secure. Default 'false'.\n         * @public\n         * @static\n         * @sample Ink_Util_Cookie_set.html\n         */\n        set: function(name, value, expires, path, domain, secure)\n        {\n            var sName;\n            if(!name || value===false || typeof(name) === 'undefined' || typeof(value) === 'undefined') {\n                return false;\n            } else {\n                sName = name+'='+encodeURIComponent(value);\n            }\n            var sExpires = false;\n            var sPath = false;\n            var sDomain = false;\n            var sSecure = false;\n\n            if(expires && typeof(expires) !== 'undefined' && !isNaN(expires)) {\n                var oDate = new Date();\n                var sDate = (parseInt(Number(oDate.valueOf()), 10) + (Number(parseInt(expires, 10)) * 1000));\n\n                var nDate = new Date(sDate);\n                var expiresString = nDate.toGMTString();\n\n                var re = new RegExp(\"([^\\\\s]+)(\\\\s\\\\d\\\\d)\\\\s(\\\\w\\\\w\\\\w)\\\\s(.*)\");\n                expiresString = expiresString.replace(re, \"$1$2-$3-$4\");\n\n                sExpires = 'expires='+expiresString;\n            } else {\n                if(typeof(expires) !== 'undefined' && !isNaN(expires) && Number(parseInt(expires, 10))===0) {\n                    sExpires = '';\n                } else {\n                    sExpires = 'expires=Thu, 01-Jan-2037 00:00:01 GMT';\n                }\n            }\n\n            if(path && typeof(path) !== 'undefined') {\n                sPath = 'path='+path;\n            } else {\n                sPath = 'path=/';\n            }\n\n            if(domain && typeof(domain) !== 'undefined') {\n                sDomain = 'domain='+domain;\n            } else {\n                var portClean = new RegExp(\":(.*)\");\n                sDomain = 'domain='+window.location.host;\n                sDomain = sDomain.replace(portClean,\"\");\n            }\n\n            if(secure && typeof(secure) !== 'undefined') {\n                sSecure = secure;\n            } else {\n                sSecure = false;\n            }\n\n            document.cookie = sName+'; '+sExpires+'; '+sPath+'; '+sDomain+'; '+sSecure;\n        },\n\n        /**\n         * Deletes a cookie.\n         *\n         * @method remove\n         * @param {String}  cookieName   Cookie name.\n         * @param {String}  [path]       Path of the cookie. Defaults to '/'.\n         * @param {String}  [domain]     Domain of the cookie. Defaults to current hostname.\n         * @public\n         * @static\n         * @sample Ink_Util_Cookie_remove.html\n         */\n        remove: function(cookieName, path, domain)\n        {\n            //var expiresDate = 'Thu, 01-Jan-1970 00:00:01 GMT';\n            var sPath = false;\n            var sDomain = false;\n            var expiresDate = -999999999;\n\n            if(path && typeof(path) !== 'undefined') {\n                sPath = path;\n            } else {\n                sPath = '/';\n            }\n\n            if(domain && typeof(domain) !== 'undefined') {\n                sDomain = domain;\n            } else {\n                sDomain = window.location.host;\n            }\n\n            this.set(cookieName, 'deleted', expiresDate, sPath, sDomain);\n        }\n    };\n\n    return Cookie;\n\n});\n","/**\n * Date utility functions\n * @module Ink.Util.Date_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Date', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.Date_1 \n     */\n    var InkDate = {\n\n        /**\n         * Function that returns the string representation of the month [PT only]\n         *\n         * @method _months\n         * @param {Number} index Month javascript (0 to 11)\n         * @return {String} The month's name\n         * @private\n         * @static\n         * @example\n         *     console.log( InkDate._months(0) ); // Result: Janeiro\n         */\n        _months: function(index){\n            var _m = ['Janeiro', 'Fevereiro', 'Maro', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];\n            return _m[index];\n        },\n\n        /**\n         * Function that returns the month [PT only] ( 0 to 11 )\n         *\n         * @method _iMonth\n         * @param {String} month Month javascript (0 to 11)\n         * @return {Number} The month's number\n         * @private\n         * @static\n         * @example\n         *     console.log( InkDate._iMonth('maio') ); // Result: 4\n         */\n        _iMonth : function( month )\n        {\n            if ( Number( month ) ) { return +month - 1; }\n            return {\n                'janeiro'   : 0  ,\n                'jan'       : 0  ,\n                'fevereiro' : 1  ,\n                'fev'       : 1  ,\n                'maro'     : 2  ,\n                'mar'       : 2  ,\n                'abril'     : 3  ,\n                'abr'       : 3  ,\n                'maio'      : 4  ,\n                'mai'       : 4  ,\n                'junho'     : 5  ,\n                'jun'       : 5  ,\n                'julho'     : 6  ,\n                'jul'       : 6  ,\n                'agosto'    : 7  ,\n                'ago'       : 7  ,\n                'setembro'  : 8  ,\n                'set'       : 8  ,\n                'outubro'   : 9  ,\n                'out'       : 9  ,\n                'novembro'  : 10 ,\n                'nov'       : 10 ,\n                'dezembro'  : 11 ,\n                'dez'       : 11\n            }[ month.toLowerCase( ) ];\n        } ,\n\n        /**\n         * Function that returns the representation the day of the week [PT Only]\n         *\n         * @method _wDays\n         * @param {Number} index Week's day index\n         * @return {String} The week's day name\n         * @private\n         * @static\n         * @example\n         *     console.log( InkDate._wDays(0) ); // Result: Domingo\n         */\n        _wDays: function(index){\n            var _d = ['Domingo', 'Segunda', 'Tera', 'Quarta', 'Quinta', 'Sexta', 'Sbado'];\n            return _d[index];\n        },\n\n        /**\n         * Function that returns day of the week in javascript 1 to 7\n         *\n         * @method _iWeek\n         * @param {String} week Week's day name\n         * @return {Number} The week's day index\n         * @private\n         * @static\n         * @example\n         *     console.log( InkDate._iWeek('quarta') ); // Result: 3\n         */\n        _iWeek: function( week )\n        {\n            if ( Number( week ) ) { return +week || 7; }\n            return {\n                'segunda' : 1  ,\n                'seg'     : 1  ,\n                'tera'   : 2  ,\n                'ter'     : 2  ,\n                'quarta'  : 3  ,\n                'qua'     : 3  ,\n                'quinta'  : 4  ,\n                'qui'     : 4  ,\n                'sexta'   : 5  ,\n                'sex'     : 5  ,\n                'sbado'  : 6  ,\n                'sb'     : 6  ,\n                'domingo' : 7  ,\n                'dom'     : 7\n            }[ week.toLowerCase( ) ];\n        },\n\n        /**\n         * Function that returns the number of days of a given month (m) on a given year (y)\n         *\n         * @method _daysInMonth\n         * @param {Number} _m Month\n         * @param {Number} _y Year\n         * @return {Number} Number of days of a give month on a given year\n         * @private\n         * @static\n         * @example\n         *     console.log( InkDate._daysInMonth(2,2013) ); // Result: 28\n         */\n        _daysInMonth: function(_m,_y){\n            var nDays;\n\n            if(_m===1 || _m===3 || _m===5 || _m===7 || _m===8 || _m===10 || _m===12)\n            {\n                nDays= 31;\n            }\n            else if ( _m===4 || _m===6 || _m===9 || _m===11)\n            {\n                nDays = 30;\n            }\n            else\n            {\n                if((_y%400===0) || (_y%4===0 && _y%100!==0))\n                {\n                    nDays = 29;\n                }\n                else\n                {\n                    nDays = 28;\n                }\n            }\n            return nDays;\n        },\n\n        /**\n         * Formats a date object.\n         * This works exactly as php date() function. http://php.net/manual/en/function.date.php\n         *\n         * @method get\n         * @param   {String}      format    The format in which the date it will be formatted.\n         * @param   {Date}        [_date]   The date to format. Can receive unix timestamp or a date object. Defaults to current time.\n         * @return  {String}                Formatted date\n         * @public\n         * @static\n         * @sample Ink_Util_Date_get.html \n         */\n        get: function(format, _date){\n            /*jshint maxcomplexity:65 */\n            if(typeof(format) === 'undefined' || format === ''){\n                format = \"Y-m-d\";\n            }\n\n\n            var iFormat = format.split(\"\");\n            var result = new Array(iFormat.length);\n            var escapeChar = \"\\\\\";\n            var jsDate;\n\n        if (typeof(_date) === 'undefined'){\n            jsDate = new Date();\n        } else if (typeof(_date)==='number'){\n            jsDate = new Date(_date*1000);\n        } else {\n            jsDate = new Date(_date);\n        }\n\n        var jsFirstDay, jsThisDay, jsHour;\n        /* This switch is presented in the same order as in php date function (PHP 5.2.2) */\n        for (var i = 0; i < iFormat.length; i++) {\n           switch(iFormat[i]) {\n                case escapeChar:\n                    result[i] = iFormat[i+1];\n                    i++;\n                    break;\n\n\n                /* DAY */\n                case \"d\":   /* Day of the month, 2 digits with leading zeros; ex: 01 to 31  */\n                    var jsDay = jsDate.getDate();\n                    result[i] = (String(jsDay).length > 1) ? jsDay : \"0\" + jsDay;\n                    break;\n\n                case \"D\":   /* A textual representation of a day, three letters; Seg to Dom */\n                    result[i] = this._wDays(jsDate.getDay()).substring(0, 3);\n                    break;\n\n                case \"j\":  /* Day of the month without leading zeros; ex: 1 to 31  */\n                    result[i] = jsDate.getDate();\n                    break;\n\n                case \"l\":   /* A full textual representation of the day of the week; Domingo to Sabado  */\n                    result[i] = this._wDays(jsDate.getDay());\n                    break;\n\n                case \"N\":  /* ISO-8601 numeric representation of the day of the week; 1 (Segunda) to 7 (Domingo)  */\n                    result[i] = jsDate.getDay() || 7;\n                    break;\n\n                case \"S\":  /* English ordinal suffix for the day of the month, 2 characters; st, nd, rd or th. Works well with j */\n                    var temp     = jsDate.getDate();\n                    var suffixes = [\"st\", \"nd\", \"rd\"];\n                    var suffix   = \"\";\n\n                    if (temp >= 11 && temp <= 13) {\n                        result[i] = \"th\";\n                    } else {\n                        result[i]  = (suffix = suffixes[String(temp).substr(-1) - 1]) ? (suffix) : (\"th\");\n                    }\n                    break;\n\n                case \"w\":    /* Numeric representation of the day of the week; 0 (for Sunday) through 6 (for Saturday) */\n                    result[i] = jsDate.getDay();\n                    break;\n\n                case \"z\":    /* The day of the year (starting from 0); 0 to 365 */\n                    jsFirstDay = Date.UTC(jsDate.getFullYear(), 0, 0);\n                    jsThisDay = Date.UTC(jsDate.getFullYear(), jsDate.getMonth(), jsDate.getDate());\n                    result[i] = Math.floor((jsThisDay - jsFirstDay) / (1000 * 60 * 60 * 24));\n                    break;\n\n                /* WEEK */\n                case \"W\":    /* ISO-8601 week number of year, weeks starting on Monday; ex: 42 (the 42nd week in the year)  */\n                    var jsYearStart = new Date( jsDate.getFullYear( ) , 0 , 1 );\n                    jsFirstDay = jsYearStart.getDay() || 7;\n\n                    var days = Math.floor( ( jsDate - jsYearStart ) / ( 24 * 60 * 60 * 1000 ) + 1 );\n\n                    result[ i ] = Math.ceil( ( days - ( 8 - jsFirstDay ) ) / 7 ) + 1;\n                    break;\n\n\n                /* MONTH */\n                case \"F\":   /* A full textual representation of a month, such as Janeiro or Marco; Janeiro a Dezembro */\n                    result[i] = this._months(jsDate.getMonth());\n                    break;\n\n                case \"m\":   /* Numeric representation of a month, with leading zeros; 01 to 12  */\n                    var jsMonth = String(jsDate.getMonth() + 1);\n                    result[i] = (jsMonth.length > 1) ? jsMonth : \"0\" + jsMonth;\n                    break;\n\n                case \"M\":   /* A short textual representation of a month, three letters; Jan a Dez */\n                    result[i] = this._months(jsDate.getMonth()).substring(0,3);\n                    break;\n\n                case \"n\":   /* Numeric representation of a month, without leading zeros; 1 a 12  */\n                    result[i] = jsDate.getMonth() + 1;\n                    break;\n\n                case \"t\":   /* Number of days in the given month; ex: 28 */\n                    result[i] = this._daysInMonth(jsDate.getMonth()+1,jsDate.getYear());\n                    break;\n\n                /* YEAR */\n                case \"L\":   /* Whether it's a leap year; 1 if it is a leap year, 0 otherwise.  */\n                    var jsYear = jsDate.getFullYear();\n                    result[i] = (jsYear % 4) ? false : ( (jsYear % 100) ?  true : ( (jsYear % 400) ? false : true  ) );\n                    break;\n\n                case \"o\":  /* ISO-8601 year number. This has the same value as Y, except that if the ISO week number (W) belongs to the previous or next year, that year is used instead.  */\n                    throw '\"o\" not implemented!';\n\n                case \"Y\":  /* A full numeric representation of a year, 4 digits; 1999  */\n                    result[i] = jsDate.getFullYear();\n                    break;\n\n                case \"y\":  /* A two digit representation of a year; 99  */\n                    result[i] = String(jsDate.getFullYear()).substring(2);\n                    break;\n\n                /* TIME */\n                case \"a\":   /* Lowercase Ante meridiem and Post meridiem; am or pm */\n                    result[i] = (jsDate.getHours() < 12) ? \"am\" : \"pm\";\n                    break;\n\n                case \"A\":   /* Uppercase Ante meridiem and Post meridiem; AM or PM  */\n                    result[i] = (jsDate.getHours < 12) ? \"AM\" : \"PM\";\n                    break;\n\n                case \"B\":  /* Swatch Internet time; 000 through 999  */\n                    throw '\"B\" not implemented!';\n\n                case \"g\":   /* 12-hour format of an hour without leading zeros;  1 to 12 */\n                    jsHour = jsDate.getHours();\n                    result[i] = (jsHour <= 12) ? jsHour : (jsHour - 12);\n                    break;\n\n                case \"G\":   /* 24-hour format of an hour without leading zeros; 1 to 23 */\n                    result[i] = String(jsDate.getHours());\n                    break;\n\n                case \"h\":   /* 12-hour format of an hour with leading zeros; 01 to 12 */\n                    jsHour = String(jsDate.getHours());\n                    jsHour = (jsHour <= 12) ? jsHour : (jsHour - 12);\n                    result[i] = (jsHour.length > 1) ? jsHour : \"0\" + jsHour;\n                    break;\n\n                case \"H\":   /* 24-hour format of an hour with leading zeros; 01 to 24 */\n                    jsHour = String(jsDate.getHours());\n                    result[i] = (jsHour.length > 1) ? jsHour : \"0\" + jsHour;\n                    break;\n\n                case \"i\":   /* Minutes with leading zeros; 00 to 59 */\n                    var jsMinute  = String(jsDate.getMinutes());\n                    result[i] = (jsMinute.length > 1) ? jsMinute : \"0\" + jsMinute;\n                    break;\n\n                case \"s\":   /* Seconds with leading zeros; 00 to 59; */\n                    var jsSecond  = String(jsDate.getSeconds());\n                    result[i]  = (jsSecond.length > 1) ? jsSecond : \"0\" + jsSecond;\n                    break;\n\n                case \"u\":  /* Microseconds */\n                    throw '\"u\" not implemented!';\n\n\n                /* TIMEZONE */\n\n                case \"e\": /* Timezone identifier  */\n                    throw '\"e\" not implemented!';\n\n                case \"I\":   /*  \"1\" if Daylight Savings Time, \"0\" otherwise. Works only on the northern hemisphere */\n                    jsFirstDay = new Date(jsDate.getFullYear(), 0, 1);\n                    result[i] = (jsDate.getTimezoneOffset() !== jsFirstDay.getTimezoneOffset()) ? (1) : (0);\n                    break;\n\n                case \"O\":  /* Difference to Greenwich time (GMT) in hours */\n                    var jsMinZone = jsDate.getTimezoneOffset();\n                    var jsMinutes = jsMinZone % 60;\n                    jsHour = String(((jsMinZone - jsMinutes) / 60) * -1);\n\n                    if (jsHour.charAt(0) !== \"-\") {\n                        jsHour = \"+\" + jsHour;\n                    }\n\n                    jsHour = (jsHour.length === 3) ? (jsHour) : (jsHour.replace(/([+\\-])(\\d)/, \"$1\" + 0 + \"$2\"));\n                    result[i]  = jsHour + jsMinutes + \"0\";\n                    break;\n\n                case \"P\": /* Difference to Greenwich time (GMT) with colon between hours and minutes */\n                    throw '\"P\" not implemented!';\n\n                case \"T\": /* Timezone abbreviation */\n                    throw '\"T\" not implemented!';\n\n                case \"Z\": /* Timezone offset in seconds. The offset for timezones west of UTC is always negative, and for those east of UTC is always positive. */\n                    result[i] = jsDate.getTimezoneOffset() * 60;\n                    break;\n\n\n                /* FULL DATE/TIME  */\n\n                case \"c\": /* ISO 8601 date */\n                    throw '\"c\" not implemented!';\n\n                case \"r\": /* RFC 2822 formatted date  */\n                    var jsDayName = this._wDays(jsDate.getDay()).substr(0, 3);\n                    var jsMonthName = this._months(jsDate.getMonth()).substr(0, 3);\n                    result[i] = jsDayName + \", \" + jsDate.getDate() + \" \" + jsMonthName + this.get(\" Y H:i:s O\",jsDate);\n                    break;\n\n                case \"U\":  /* Seconds since the Unix Epoch (January 1 1970 00:00:00 GMT)  */\n                    result[i] = Math.floor(jsDate.getTime() / 1000);\n                    break;\n\n                default:\n                    result[i] = iFormat[i];\n            }\n        }\n\n        return result.join('');\n\n        },\n\n        /**\n         * Creates a date object based on a format string.\n         * This works exactly as php date() function. http://php.net/manual/en/function.date.php\n         *\n         * @method set\n         * @param   {String}    [format]    The format in which the date will be formatted. Defaults to 'Y-m-d'\n         * @param   {String}    str_date    The date formatted.\n         * @return  {Date}                  Date object based on the formatted date and format\n         * @public\n         * @static\n         * @sample Ink_Util_Date_set.html \n         */\n        set : function( format , str_date ) {\n            if ( typeof str_date === 'undefined' ) { return ; }\n            if ( typeof format === 'undefined' || format === '' ) { format = \"Y-m-d\"; }\n\n            var iFormat = format.split(\"\");\n            var result = new Array( iFormat.length );\n            var escapeChar = \"\\\\\";\n            var mList;\n\n            var objIndex = {\n                year  : undefined ,\n                month : undefined ,\n                day   : undefined ,\n                dayY  : undefined ,\n                dayW  : undefined ,\n                week  : undefined ,\n                hour  : undefined ,\n                hourD : undefined ,\n                min   : undefined ,\n                sec   : undefined ,\n                msec  : undefined ,\n                ampm  : undefined ,\n                diffM : undefined ,\n                diffH : undefined ,\n                date  : undefined\n            };\n\n            var matches = 0;\n\n            /* This switch is presented in the same order as in php date function (PHP 5.2.2) */\n            for ( var i = 0; i < iFormat.length; i++) {\n                switch( iFormat[ i ] ) {\n                    case escapeChar:\n                        result[i]      = iFormat[ i + 1 ];\n                        i++;\n                        break;\n\n                    /* DAY */\n                    case \"d\":   /* Day of the month, 2 digits with leading zeros; ex: 01 to 31  */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.day   = { original : i , match : matches++ };\n                        break;\n\n                    case \"j\":  /* Day of the month without leading zeros; ex: 1 to 31  */\n                        result[ i ]    = '(\\\\d{1,2})';\n                        objIndex.day   = { original : i , match : matches++ };\n                        break;\n\n                    case \"D\":   /* A textual representation of a day, three letters; Seg to Dom */\n                        result[ i ]    = '([\\\\w]{3})';\n                        objIndex.dayW  = { original : i , match : matches++ };\n                        break;\n\n                    case \"l\":   /* A full textual representation of the day of the week; Domingo to Sabado  */\n                        result[i]      = '([\\\\w]{5,7})';\n                        objIndex.dayW  = { original : i , match : matches++ };\n                        break;\n\n                    case \"N\":  /* ISO-8601 numeric representation of the day of the week; 1 (Segunda) to 7 (Domingo)  */\n                        result[ i ]    = '(\\\\d)';\n                        objIndex.dayW  = { original : i , match : matches++ };\n                        break;\n\n                    case \"w\":    /* Numeric representation of the day of the week; 0 (for Sunday) through 6 (for Saturday) */\n                        result[ i ]    = '(\\\\d)';\n                        objIndex.dayW  = { original : i , match : matches++ };\n                        break;\n\n                    case \"S\":  /* English ordinal suffix for the day of the month, 2 characters; st, nd, rd or th. Works well with j */\n                        result[ i ]    = '\\\\w{2}';\n                        break;\n\n                    case \"z\":    /* The day of the year (starting from 0); 0 to 365 */\n                        result[ i ]    = '(\\\\d{1,3})';\n                        objIndex.dayY  = { original : i , match : matches++ };\n                        break;\n\n                    /* WEEK */\n                    case \"W\":    /* ISO-8601 week number of year, weeks starting on Monday; ex: 42 (the 42nd week in the year)  */\n                        result[ i ]    = '(\\\\d{1,2})';\n                        objIndex.week  = { original : i , match : matches++ };\n                        break;\n\n                    /* MONTH */\n                    case \"F\":   /* A full textual representation of a month, such as Janeiro or Marco; Janeiro a Dezembro */\n                        result[ i ]    = '([\\\\w]{4,9})';\n                        objIndex.month = { original : i , match : matches++ };\n                        break;\n\n                    case \"M\":   /* A short textual representation of a month, three letters; Jan a Dez */\n                        result[ i ]    = '(\\\\w{3})';\n                        objIndex.month = { original : i , match : matches++ };\n                        break;\n\n                    case \"m\":   /* Numeric representation of a month, with leading zeros; 01 to 12  */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.month = { original : i , match : matches++ };\n                        break;\n\n                    case \"n\":   /* Numeric representation of a month, without leading zeros; 1 a 12  */\n                        result[ i ]    = '(\\\\d{1,2})';\n                        objIndex.month = { original : i , match : matches++ };\n                        break;\n\n                    case \"t\":   /* Number of days in the given month; ex: 28 */\n                        result[ i ]    = '\\\\d{2}';\n                        break;\n\n                    /* YEAR */\n                    case \"L\":   /* Whether it's a leap year; 1 if it is a leap year, 0 otherwise.  */\n                        result[ i ]    = '\\\\w{4,5}';\n                        break;\n\n                    case \"o\":  /* ISO-8601 year number. This has the same value as Y, except that if the ISO week number (W) belongs to the previous or next year, that year is used instead.  */\n                        throw '\"o\" not implemented!';\n\n                    case \"Y\":  /* A full numeric representation of a year, 4 digits; 1999  */\n                        result[ i ]    = '(\\\\d{4})';\n                        objIndex.year  = { original : i , match : matches++ };\n                        break;\n\n                    case \"y\":  /* A two digit representation of a year; 99  */\n                        result[ i ]    = '(\\\\d{2})';\n                        if ( typeof objIndex.year === 'undefined' || iFormat[ objIndex.year.original ] !== 'Y' ) {\n                            objIndex.year = { original : i , match : matches++ };\n                        }\n                        break;\n\n                    /* TIME */\n                    case \"a\":   /* Lowercase Ante meridiem and Post meridiem; am or pm */\n                        result[ i ]    = '(am|pm)';\n                        objIndex.ampm  = { original : i , match : matches++ };\n                        break;\n\n                    case \"A\":   /* Uppercase Ante meridiem and Post meridiem; AM or PM  */\n                        result[ i ]    = '(AM|PM)';\n                        objIndex.ampm  = { original : i , match : matches++ };\n                        break;\n\n                    case \"B\":  /* Swatch Internet time; 000 through 999  */\n                        throw '\"B\" not implemented!';\n\n                    case \"g\":   /* 12-hour format of an hour without leading zeros;  1 to 12 */\n                        result[ i ]    = '(\\\\d{1,2})';\n                        objIndex.hourD = { original : i , match : matches++ };\n                        break;\n\n                    case \"G\":   /* 24-hour format of an hour without leading zeros; 1 to 23 */\n                        result[ i ]    = '(\\\\d{1,2})';\n                        objIndex.hour  = { original : i , match : matches++ };\n                        break;\n\n                    case \"h\":   /* 12-hour format of an hour with leading zeros; 01 to 12 */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.hourD = { original : i , match : matches++ };\n                        break;\n\n                    case \"H\":   /* 24-hour format of an hour with leading zeros; 01 to 24 */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.hour  = { original : i , match : matches++ };\n                        break;\n\n                    case \"i\":   /* Minutes with leading zeros; 00 to 59 */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.min   = { original : i , match : matches++ };\n                        break;\n\n                    case \"s\":   /* Seconds with leading zeros; 00 to 59; */\n                        result[ i ]    = '(\\\\d{2})';\n                        objIndex.sec   = { original : i , match : matches++ };\n                        break;\n\n                    case \"u\":  /* Microseconds */\n                        throw '\"u\" not implemented!';\n\n                    /* TIMEZONE */\n                    case \"e\": /* Timezone identifier  */\n                        throw '\"e\" not implemented!';\n\n                    case \"I\":   /*  \"1\" if Daylight Savings Time, \"0\" otherwise. Works only on the northern hemisphere */\n                        result[i]      = '\\\\d';\n                        break;\n\n                    case \"O\":  /* Difference to Greenwich time (GMT) in hours */\n                        result[ i ]    = '([-+]\\\\d{4})';\n                        objIndex.diffH = { original : i , match : matches++ };\n                        break;\n\n                    case \"P\": /* Difference to Greenwich time (GMT) with colon between hours and minutes */\n                        throw '\"P\" not implemented!';\n\n                    case \"T\": /* Timezone abbreviation */\n                        throw '\"T\" not implemented!';\n\n                    case \"Z\": /* Timezone offset in seconds. The offset for timezones west of UTC is always negative, and for those east of UTC is always positive. */\n                        result[ i ]    = '(\\\\-?\\\\d{1,5})';\n                        objIndex.diffM = { original : i , match : matches++ };\n                        break;\n\n                    /* FULL DATE/TIME  */\n                    case \"c\": /* ISO 8601 date */\n                        throw '\"c\" not implemented!';\n\n                    case \"r\": /* RFC 2822 formatted date  */\n                        result[ i ]    = '([\\\\w]{3}, \\\\d{1,2} \\\\w{3} \\\\d{4} \\\\d{2}:\\\\d{2}:\\\\d{2} [+\\\\-]\\\\d{4})';\n                        objIndex.date  = { original : i , match : matches++ };\n                        break;\n\n                    case \"U\":  /* Seconds since the Unix Epoch (January 1 1970 00:00:00 GMT)  */\n                        result[ i ]    = '(\\\\d{1,13})';\n                        objIndex.date  = { original : i , match : matches++ };\n                        break;\n\n                    default:\n                        result[ i ]    = iFormat[ i ];\n                }\n            }\n\n            var pattr = new RegExp( result.join('') );\n\n            try {\n                mList = str_date.match( pattr );\n                if ( !mList ) { return; }\n            }\n            catch ( e ) { return ; }\n\n            var _haveDatetime = typeof objIndex.date  !== 'undefined';\n\n            var _haveYear     = typeof objIndex.year  !== 'undefined';\n\n            var _haveYDay     = typeof objIndex.dayY  !== 'undefined';\n\n            var _haveDay      = typeof objIndex.day   !== 'undefined';\n            var _haveMonth    = typeof objIndex.month !== 'undefined';\n            var _haveMonthDay =  _haveMonth && _haveDay;\n            var _haveOnlyDay  = !_haveMonth && _haveDay;\n\n            var _haveWDay     = typeof objIndex.dayW  !== 'undefined';\n            var _haveWeek     = typeof objIndex.week  !== 'undefined';\n            var _haveWeekWDay =  _haveWeek && _haveWDay;\n            var _haveOnlyWDay = !_haveWeek && _haveWDay;\n\n            var _validDate    = _haveYDay || _haveMonthDay || !_haveYear && _haveOnlyDay || _haveWeekWDay || !_haveYear && _haveOnlyWDay;\n            var _noDate       = !_haveYear && !_haveYDay && !_haveDay && !_haveMonth && !_haveWDay && !_haveWeek;\n\n            var _haveHour12   = typeof objIndex.hourD !== 'undefined' && typeof objIndex.ampm !== 'undefined';\n            var _haveHour24   = typeof objIndex.hour  !== 'undefined';\n            var _haveHour     = _haveHour12 || _haveHour24;\n\n            var _haveMin      = typeof objIndex.min   !== 'undefined';\n            var _haveSec      = typeof objIndex.sec   !== 'undefined';\n            var _haveMSec     = typeof objIndex.msec  !== 'undefined';\n\n            var _haveMoreM    = !_noDate || _haveHour;\n            var _haveMoreS    = _haveMoreM || _haveMin;\n\n            var _haveDiffM    = typeof objIndex.diffM !== 'undefined';\n            var _haveDiffH    = typeof objIndex.diffH !== 'undefined';\n            //var _haveGMT      = _haveDiffM || _haveDiffH;\n            var hour;\n            var min;\n\n            if ( _haveDatetime ) {\n                if ( iFormat[ objIndex.date.original ] === 'U' ) {\n                    return new Date( +mList[ objIndex.date.match + 1 ] * 1000 );\n                }\n\n                var dList = mList[ objIndex.date.match + 1 ].match( /\\w{3}, (\\d{1,2}) (\\w{3}) (\\d{4}) (\\d{2}):(\\d{2}):(\\d{2}) ([+\\-]\\d{4})/ );\n                hour  = +dList[ 4 ] + ( +dList[ 7 ].slice( 0 , 3 ) );\n                min   = +dList[ 5 ] + ( dList[ 7 ].slice( 0 , 1 ) + dList[ 7 ].slice( 3 ) ) / 100 * 60;\n\n                return new Date( dList[ 3 ] , this._iMonth( dList[ 2 ] ) , dList[ 1 ] , hour  , min , dList[ 6 ] );\n            }\n\n            var _d = new Date( );\n            var year;\n            var month;\n            var day;\n            var sec;\n            var msec;\n            var gmt;\n\n            if ( !_validDate && !_noDate ) { return ; }\n\n            if ( _validDate ) {\n                if ( _haveYear ) {\n                    var _y = _d.getFullYear( ) - 50 + '';\n                    year   = mList[ objIndex.year.match + 1 ];\n                    if ( iFormat[ objIndex.year.original ] === 'y' ) {\n                        year = +_y.slice( 0 , 2 ) + ( year >= ( _y ).slice( 2 ) ? 0 : 1 ) + year;\n                    }\n                } else {\n                    year = _d.getFullYear();\n                }\n\n                if ( _haveYDay ) {\n                    month = 0;\n                    day   = mList[ objIndex.dayY.match + 1 ];\n                } else if ( _haveDay ) {\n                    if ( _haveMonth ) {\n                        month = this._iMonth( mList[ objIndex.month.match + 1 ] );\n                    } else {\n                        month = _d.getMonth( );\n                    }\n\n                    day = mList[ objIndex.day.match + 1 ];\n                } else {\n                    month = 0;\n\n                    var week;\n                    if ( _haveWeek ) {\n                        week = mList[ objIndex.week.match + 1 ];\n                    } else {\n                        week = this.get( 'W' , _d );\n                    }\n\n                    day = ( week - 2 ) * 7 + ( 8 - ( ( new Date( year , 0 , 1 ) ).getDay( ) || 7 ) ) + this._iWeek( mList[ objIndex.week.match + 1 ] );\n                }\n\n                if ( month === 0 && day > 31 ) {\n                    var aux = new Date( year , month , day );\n                    month   = aux.getMonth( );\n                    day     = aux.getDate( );\n                }\n            }\n            else {\n                year  = _d.getFullYear( );\n                month = _d.getMonth( );\n                day   = _d.getDate( );\n            }\n\n            if      ( _haveHour12 ) { hour = +mList[ objIndex.hourD.match + 1 ] + ( mList[ objIndex.ampm.match + 1 ] === 'pm' ? 12 : 0 ); }\n            else if ( _haveHour24 ) { hour = mList[ objIndex.hour.match + 1 ]; }\n            else if ( _noDate     ) { hour = _d.getHours( ); }\n            else                    { hour = '00'; }\n\n            if      (  _haveMin   ) { min  = mList[ objIndex.min.match + 1 ]; }\n            else if ( !_haveMoreM ) { min  = _d.getMinutes( ); }\n            else                    { min  = '00'; }\n\n            if      (  _haveSec   ) { sec  = mList[ objIndex.sec.match + 1 ]; }\n            else if ( !_haveMoreS ) { sec  = _d.getSeconds( ); }\n            else                    { sec  = '00'; }\n\n            if      ( _haveMSec )   { msec = mList[ objIndex.msec.match + 1 ]; }\n            else                    { msec = '000'; }\n\n            if      ( _haveDiffH )  { gmt  = mList[ objIndex.diffH.match + 1 ]; }\n            else if ( _haveDiffM )  { gmt  = String( -1 * mList[ objIndex.diffM.match + 1 ] / 60 * 100 ).replace( /^(\\d)/ , '+$1' ).replace( /(^[\\-+])(\\d{3}$)/ , '$10$2' ); }\n            else                    { gmt  = '+0000'; }\n\n            return new Date( year, month, day, hour, min, sec );\n        }\n    };\n\n\n    return InkDate;\n\n});\n","/**\n * Dump/Profiling Utilities\n * @module Ink.Util.Dumper_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Dumper', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.Dumper_1 \n     */\n\n    var Dumper = {\n\n        /**\n         * Hex code for the 'tab'\n         * \n         * @property _tab\n         * @type {String}\n         * @private\n         * @readOnly\n         * @static\n         *\n         */\n        _tab: '\\xA0\\xA0\\xA0\\xA0',\n\n        /**\n         * Function that returns the argument passed formatted\n         *\n         * @method _formatParam\n         * @param {Mixed} param\n         * @return {String} The argument passed formatted\n         * @private\n         * @static\n         */\n        _formatParam: function(param)\n        {\n            var formated = '';\n\n            switch(typeof(param)) {\n                case 'string':\n                    formated = '(string) '+param;\n                    break;\n                case 'number':\n                    formated = '(number) '+param;\n                    break;\n                case 'boolean':\n                    formated = '(boolean) '+param;\n                    break;\n                case 'object':\n                    if(param !== null) {\n                        if(param.constructor === Array) {\n                            formated = 'Array \\n{\\n' + this._outputFormat(param, 0) + '\\n}';\n                        } else {\n                            formated = 'Object \\n{\\n' + this._outputFormat(param, 0) + '\\n}';\n                        }\n                    } else {\n                        formated = 'null';\n                    }\n                    break;\n                default:\n                    formated = false;\n            }\n\n            return formated;\n        },\n\n        /**\n         * Function that returns the tabs concatenated\n         *\n         * @method _getTabs\n         * @param {Number} numberOfTabs Number of Tabs\n         * @return {String} Tabs concatenated\n         * @private\n         * @static\n         */\n        _getTabs: function(numberOfTabs)\n        {\n            var tabs = '';\n            for(var _i = 0; _i < numberOfTabs; _i++) {\n                tabs += this._tab;\n            }\n            return tabs;\n        },\n\n        /**\n         * Function that formats the parameter to display.\n         *\n         * @method _outputFormat\n         * @param {Any} param\n         * @param {Number} dim\n         * @return {String} The parameter passed formatted to displat\n         * @private\n         * @static\n         */\n        _outputFormat: function(param, dim)\n        {\n            var formated = '';\n            //var _strVal = false;\n            var _typeof = false;\n            for(var key in param) {\n                if(param[key] !== null) {\n                    if(typeof(param[key]) === 'object' && (param[key].constructor === Array || param[key].constructor === Object)) {\n                        if(param[key].constructor === Array) {\n                            _typeof = 'Array';\n                        } else if(param[key].constructor === Object) {\n                            _typeof = 'Object';\n                        }\n                        formated += this._tab + this._getTabs(dim) + '[' + key + '] => <b>'+_typeof+'</b>\\n';\n                        formated += this._tab + this._getTabs(dim) + '{\\n';\n                        formated += this._outputFormat(param[key], dim + 1) + this._tab + this._getTabs(dim) + '}\\n';\n                    } else if(param[key].constructor === Function) {\n                        continue;\n                    } else {\n                        formated = formated + this._tab + this._getTabs(dim) + '[' + key + '] => ' + param[key] + '\\n';\n                    }\n                } else {\n                    formated = formated + this._tab + this._getTabs(dim) + '[' + key + '] => null \\n';\n                }\n            }\n            return formated;\n        },\n\n        /**\n         * Prints variable structure.\n         *\n         * @method printDump\n         * @param {Any}                 param       Variable to be dumped.\n         * @param {DOMElement|String}   [target]    Element to print the dump on.\n         * @public\n         * @static\n         * @sample Ink_Util_Dumper_printDump.html \n         */\n        printDump: function(param, target)\n        {\n            /*jshint evil:true */\n            if(!target || typeof(target) === 'undefined') {\n                document.write('<pre>'+this._formatParam(param)+'</pre>');\n            } else {\n                if(typeof(target) === 'string') {\n                    document.getElementById(target).innerHTML = '<pre>' + this._formatParam(param) + '</pre>';\n                } else if(typeof(target) === 'object') {\n                    target.innerHTML = '<pre>'+this._formatParam(param)+'</pre>';\n                } else {\n                    throw \"TARGET must be an element or an element ID\";\n                }\n            }\n        },\n\n        /**\n         * Get a variable's structure.\n         *\n         * @method returnDump\n         * @param   {Any}       param   Variable to get the structure.\n         * @return  {String}            The variable's structure.\n         * @public\n         * @static\n         * @sample Ink_Util_Dumper_returnDump.html \n         */\n        returnDump: function(param)\n        {\n            return this._formatParam(param);\n        },\n\n        /**\n         * Alert a variable's structure.\n         *\n         * @method alertDump\n         * @param {Any}     param     Variable to be dumped.\n         * @public\n         * @static\n         * @sample Ink_Util_Dumper_alertDump.html \n         */\n        alertDump: function(param)\n        {\n            window.alert(this._formatParam(param).replace(/(<b>)(Array|Object)(<\\/b>)/g, \"$2\"));\n        },\n\n        /**\n         * Prints the variable structure to a new window.\n         *\n         * @method windowDump\n         * @param {Any}     param   Variable to be dumped.\n         * @public\n         * @static\n         * @sample Ink_Util_Dumper_windowDump.html \n         */\n        windowDump: function(param)\n        {\n            var dumperwindow = 'dumperwindow_'+(Math.random() * 10000);\n            var win = window.open('',\n                dumperwindow,\n                'width=400,height=300,left=50,top=50,status,menubar,scrollbars,resizable'\n            );\n            win.document.open();\n            win.document.write('<pre>'+this._formatParam(param)+'</pre>');\n            win.document.close();\n            win.focus();\n        }\n\n    };\n\n    return Dumper;\n\n});\n","/**\n * Internationalization Utilities \n * @module Ink.Util.I18n_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.I18n', '1', [], function () {\n    'use strict';\n\n    var pattrText = /\\{(?:(\\{.*?})|(?:%s:)?(\\d+)|(?:%s)?|([\\w-]+))}/g;\n\n    var funcOrVal = function( ret , args ) {\n        if ( typeof ret === 'function' ) {\n            return ret.apply(this, args);\n        } else if (typeof ret !== undefined) {\n            return ret;\n        } else {\n            return '';\n        }\n    };\n\n    /**\n     * You can use this module to internationalize your applications. It roughly emulates GNU gettext's API.\n     *\n     * @class Ink.Util.I18n\n     * @constructor\n     *\n     * @param {Object} dict         Object mapping language codes (in the form of `pt_PT`, `pt_BR`, `fr`, `en_US`, etc.) to their `dictionaries`\n     * @param {String} [lang='pt_PT'] language code of the target language\n     *\n     * @sample Ink_Util_I18n_1.html\n     */\n    var I18n = function( dict , lang , testMode ) {\n        if ( !( this instanceof I18n ) ) { return new I18n( dict , lang , testMode ); }\n\n        this.reset( )\n            .lang( lang )\n            .testMode( testMode )\n            .append( dict || { } , lang );\n    };\n\n    I18n.prototype = {\n        reset: function( ) {\n            this._dicts    = [ ];\n            this._dict     = { };\n            this._testMode = false;\n            this._lang     = this._gLang;\n\n            return this;\n        },\n        /**\n         * Adds translation strings for the helper to use.\n         *\n         * @method append\n         * @param   {Object} dict Object containing language objects identified by their language code\n         *\n         * @sample Ink_Util_I18n_1_append.html\n         */\n        append: function( dict ) {\n            this._dicts.push( dict );\n\n            this._dict = Ink.extendObj(this._dict , dict[ this._lang ] );\n\n            return this;\n        },\n        /**\n         * Gets or sets the language.\n         * If there are more dictionaries available in cache, they will be loaded.\n         *\n         * @method  lang\n         * @param   {String}    lang    Language code to set this instance to.\n         */\n        lang: function( lang ) {\n            if ( !arguments.length ) { return this._lang; }\n\n            if ( lang && this._lang !== lang ) {\n                this._lang = lang;\n\n                this._dict = { };\n\n                for ( var i = 0, l = this._dicts.length; i < l; i++ ) {\n                    this._dict = Ink.extendObj( this._dict , this._dicts[ i ][ lang ] || { } );\n                }\n            }\n\n            return this;\n        },\n        /**\n         * Sets or unsets test mode.\n         * In test mode, unknown strings are wrapped in `[ ... ]`. This is useful for debugging your application and to make sure all your translation keys are in place.\n         *\n         * @method  testMode\n         * @param   {Boolean} bool Flag to set the test mode state\n         */\n        testMode: function( bool ) {\n            if ( !arguments.length ) { return !!this._testMode; }\n\n            if ( bool !== undefined  ) { this._testMode = !!bool; }\n\n            return this;\n        },\n\n        /**\n         * Gest a key from the current dictionary\n         *\n         * @method getKey\n         * @param {String} key\n         * @return {Mixed} The object which happened to be in the current language dictionary on the given key.\n         *\n         * @sample Ink_Util_I18n_1_getKey.html\n         */\n        getKey: function( key ) {\n            var ret;\n            var gLang = this._gLang;\n            var lang  = this._lang;\n    \n            if ( key in this._dict ) {\n                ret = this._dict[ key ];\n            } else {\n                I18n.langGlobal( lang );\n    \n                ret = this._gDict[ key ];\n    \n                I18n.langGlobal( gLang );\n            }\n    \n            return ret;\n        },\n\n        /**\n         * Translates a string.\n         * Given a translation key, return a translated string, with replaced parameters.\n         * When a translated string is not available, the original string is returned unchanged.\n         *\n         * @method text\n         * @param {String} str          Key to look for in i18n dictionary (which is returned verbatim if unknown)\n         * @param {Object} [namedParms] Named replacements. Replaces {named} with values in this object.\n         * @param {String} [args]      Replacement #1 (replaces first {} and all {1})\n         * @param {String} [arg2]       Replacement #2 (replaces second {} and all {2})\n         * @param {String} [argn*]      Replacement #n (replaces nth {} and all {n})\n         *\n         * @sample Ink_Util_I18n_1_text.html\n         */\n        text: function( str /*, replacements...*/ ) {\n            if ( typeof str !== 'string' ) { return; } // Backwards-compat\n\n            var pars = Array.prototype.slice.call( arguments , 1 );\n            var idx = 0;\n            var isObj = typeof pars[ 0 ] === 'object';\n\n            var original = this.getKey( str );\n            if ( original === undefined ) { original = this._testMode ? '[' + str + ']' : str; }\n            if ( typeof original === 'number' ) { original += ''; }\n\n            if (typeof original === 'string') {\n                original = original.replace( pattrText , function( m , $1 , $2 , $3 ) {\n                    var ret =\n                        $1 ? $1 :\n                        $2 ? pars[ $2 - ( isObj ? 0 : 1 ) ] :\n                        $3 ? pars[ 0 ][ $3 ] || '' :\n                             pars[ (idx++) + ( isObj ? 1 : 0 ) ];\n                    return funcOrVal( ret , [idx].concat(pars) );\n                });\n                return original;\n            }\n             \n            return (\n                typeof original === 'function' ? original.apply( this , pars ) :\n                original instanceof Array      ? funcOrVal( original[ pars[ 0 ] ] , pars ) :\n                typeof original === 'object'   ? funcOrVal( original[ pars[ 0 ] ] , pars ) :\n                                                 '');\n        },\n\n        /**\n         * Translates and pluralizes text.\n         * Given a singular string, a plural string and a number, translates either the singular or plural string.\n         *\n         * @method ntext\n         * @return {String}\n         *\n         * @param {String} strSin   Word to use when count is 1\n         * @param {String} strPlur  Word to use otherwise\n         * @param {Number} count    Number which defines which word to use\n         * @param [args*]           Extra arguments, to be passed to `text()`\n         *\n         * @sample Ink_Util_I18n_1_ntext.html\n         */\n        ntext: function( strSin , strPlur , count ) {\n            var pars = Array.prototype.slice.apply( arguments );\n            var original;\n\n            if ( pars.length === 2 && typeof strPlur === 'number' ) {\n                original = this.getKey( strSin );\n                if ( !( original instanceof Array ) ) { return ''; }\n\n                pars.splice( 0 , 1 );\n                original = original[ strPlur === 1 ? 0 : 1 ];\n            } else {\n                pars.splice( 0 , 2 );\n                original = count === 1 ? strSin : strPlur;\n            }\n\n            return this.text.apply( this , [ original ].concat( pars ) );\n        },\n\n        /**\n         * Gets the ordinal suffix of a number.\n         *\n         * This works by using transforms (in the form of Objects or Functions) passed into the function or found in the special key `_ordinals` in the active language dictionary.\n         *\n         * @method ordinal\n         *\n         * @param {Number}          num                         Input number\n         * @param {Object|Function} [options]={}                Dictionaries for translating. Each of these options' fallback is found in the current language's dictionary. The lookup order is the following: `exceptions`, `byLastDigit`, `default`. Each of these may be either an `Object` or a `Function`. If it's a function, it is called (with `number` and `digit` for any function except for byLastDigit, which is called with the `lastDigit` of the number in question), and if the function returns a string, that is used. If it's an object, the property is looked up using `obj[prop]`. If what is found is a string, it is used directly.\n         * @param {Object|Function} [options.byLastDigit]={}    If the language requires the last digit to be considered, mappings of last digits to ordinal suffixes can be created here.\n         * @param {Object|Function} [options.exceptions]={}     Map unique, special cases to their ordinal suffixes.\n         *\n         * @returns {String}        Ordinal suffix for `num`.\n         *\n         * @sample Ink_Util_I18n_1_ordinal.html\n         **/\n        ordinal: function( num ) {\n            if ( num === undefined ) { return ''; }\n\n            var lastDig = +num.toString( ).slice( -1 );\n\n            var ordDict  = this.getKey( '_ordinals' );\n            if ( ordDict === undefined ) { return ''; }\n\n            if ( typeof ordDict === 'string' ) { return ordDict; }\n\n            var ret;\n\n            if ( typeof ordDict === 'function' ) {\n                ret = ordDict( num , lastDig );\n\n                if ( typeof ret === 'string' ) { return ret; }\n            }\n\n            if ( 'exceptions' in ordDict ) {\n                ret = typeof ordDict.exceptions === 'function' ? ordDict.exceptions( num , lastDig ) :\n                      num in ordDict.exceptions                ? funcOrVal( ordDict.exceptions[ num ] , [num , lastDig] ) :\n                                                                 undefined;\n\n                if ( typeof ret === 'string' ) { return ret; }\n            }\n\n            if ( 'byLastDigit' in ordDict ) {\n                ret = typeof ordDict.byLastDigit === 'function' ? ordDict.byLastDigit( lastDig , num ) :\n                      lastDig in ordDict.byLastDigit            ? funcOrVal( ordDict.byLastDigit[ lastDig ] , [lastDig , num] ) :\n                                                                  undefined;\n\n                if ( typeof ret === 'string' ) { return ret; }\n            }\n\n            if ( 'default' in ordDict ) {\n                ret = funcOrVal( ordDict['default'] , [ num , lastDig ] );\n\n                if ( typeof ret === 'string' ) { return ret; }\n            }\n\n            return '';\n        },\n\n        /**\n         * Create an alias.\n         *\n         * Returns an alias to this I18n instance. It contains the I18n methods documented here, but is also a function. If you call it, it just calls `text()`. This is commonly assigned to \"_\".\n         *\n         * @method alias\n         * @returns {Function} an alias to `text()` on this instance. You can also access the rest of the translation API through this alias.\n         *\n         * @sample Ink_Util_I18n_1_alias.html\n         */\n        alias: function( ) {\n            var ret      = Ink.bind( I18n.prototype.text     , this );\n            ret.ntext    = Ink.bind( I18n.prototype.ntext    , this );\n            ret.append   = Ink.bind( I18n.prototype.append   , this );\n            ret.ordinal  = Ink.bind( I18n.prototype.ordinal  , this );\n            ret.testMode = Ink.bind( I18n.prototype.testMode , this );\n\n            return ret;\n        }\n    };\n\n    /**\n     * Resets I18n global state (global dictionaries, and default language for instances)\n     *\n     * @method reset\n     * @static\n     *\n     **/\n    I18n.reset = function( ) {\n        I18n.prototype._gDicts = [ ];\n        I18n.prototype._gDict  = { };\n        I18n.prototype._gLang  = 'pt_PT';\n    };\n    I18n.reset( );\n\n    /**\n     * Adds a dictionary to be used in all I18n instances for the corresponding language.\n     *\n     * @method appendGlobal\n     * @static\n     *\n     * @param dict {Object}     Dictionary to be added\n     * @param lang {String}     Language fo the dictionary being added\n     *\n     */\n    I18n.appendGlobal = function( dict , lang ) {\n        if ( lang ) {\n            if ( !( lang in dict ) ) {\n                var obj = { };\n\n                obj[ lang ] = dict;\n\n                dict = obj;\n            }\n\n            if ( lang !== I18n.prototype._gLang ) { I18n.langGlobal( lang ); }\n        }\n\n        I18n.prototype._gDicts.push( dict );\n\n        Ink.extendObj( I18n.prototype._gDict , dict[ I18n.prototype._gLang ] );\n    };\n\n    I18n.append = function () {\n        // [3.1.0] remove this alias\n        Ink.warn('Ink.Util.I18n.append() was renamed to appendGlobal().');\n        return I18n.appendGlobal.apply(I18n, [].slice.call(arguments));\n    };\n\n    /**\n     * Gets or sets the current default language of I18n instances.\n     *\n     * @method langGlobal\n     * @param lang the new language for all I18n instances\n     *\n     * @static\n     *\n     * @return {String} language code\n     */\n    I18n.langGlobal = function( lang ) {\n        if ( !arguments.length ) { return I18n.prototype._gLang; }\n\n        if ( lang && I18n.prototype._gLang !== lang ) {\n            I18n.prototype._gLang = lang;\n\n            I18n.prototype._gDict = { };\n\n            for ( var i = 0, l = I18n.prototype._gDicts.length; i < l; i++ ) {\n                Ink.extendObj( I18n.prototype._gDict , I18n.prototype._gDicts[ i ][ lang ] || { } );\n            }\n        }\n    };\n\n    I18n.lang = function () {\n        // [3.1.0] remove this alias\n        Ink.warn('Ink.Util.I18n.lang() was renamed to langGlobal().');\n        return I18n.langGlobal.apply(I18n, [].slice.call(arguments));\n    };\n    \n    return I18n;\n});","/**\n * JSON Utilities\n * @module Ink.Util.Json_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Json', '1', [], function() {\n    'use strict';\n\n    var function_call = Function.prototype.call;\n    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\n    function twoDigits(n) {\n        var r = '' + n;\n        if (r.length === 1) {\n            return '0' + r;\n        } else {\n            return r;\n        }\n    }\n\n    var dateToISOString = Date.prototype.toISOString ?\n        Ink.bind(function_call, Date.prototype.toISOString) :\n        function(date) {\n            // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString\n            return date.getUTCFullYear() +\n                '-' + twoDigits( date.getUTCMonth() + 1 ) +\n                '-' + twoDigits( date.getUTCDate() ) +\n                'T' + twoDigits( date.getUTCHours() ) +\n                ':' + twoDigits( date.getUTCMinutes() ) +\n                ':' + twoDigits( date.getUTCSeconds() ) +\n                '.' + String( (date.getUTCMilliseconds()/1000).toFixed(3) ).slice( 2, 5 ) +\n                'Z';\n        };\n\n    /**\n     * Use this class to convert JSON strings to JavaScript objects\n     * `.parse()` and also to do the opposite operation `.stringify()`.\n     * Internally, the standard JSON implementation is used if available\n     * Otherwise, the functions mimic the standard implementation.\n     *\n     * Here's how to produce JSON from an existing object:\n     * \n     *      Ink.requireModules(['Ink.Util.Json_1'], function (Json) {\n     *          var obj = {\n     *              key1: 'value1',\n     *              key2: 'value2',\n     *              keyArray: ['arrayValue1', 'arrayValue2', 'arrayValue3']\n     *          };\n     *          Json.stringify(obj);  // The above object as a JSON string\n     *      });\n     *\n     * And here is how to parse JSON:\n     *\n     *      Ink.requireModules(['Ink.Util.Json_1'], function (Json) {\n     *          var source = '{\"key\": \"value\", \"array\": [true, null, false]}';\n     *          Json.parse(source);  // The above JSON string as an object\n     *      });\n     *\n     * @namespace Ink.Util.Json_1 \n     * @static\n     * \n     */\n    var InkJson = {\n        _nativeJSON: window.JSON || null,\n\n        _convertToUnicode: false,\n\n        // Escape characters so as to embed them in JSON strings\n        _escape: function (theString) {\n            var _m = { '\\b': '\\\\b', '\\t': '\\\\t', '\\n': '\\\\n', '\\f': '\\\\f', '\\r': '\\\\r', '\"': '\\\\\"',  '\\\\': '\\\\\\\\' };\n\n            if (/[\"\\\\\\x00-\\x1f]/.test(theString)) {\n                theString = theString.replace(/([\\x00-\\x1f\\\\\"])/g, function(a, b) {\n                    var c = _m[b];\n                    if (c) {\n                        return c;\n                    }\n                    c = b.charCodeAt();\n                    return '\\\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);\n                });\n            }\n\n            return theString;\n        },\n\n        // A character conversion map\n        _toUnicode: function (theString)\n        {\n            if(!this._convertToUnicode) {\n                return this._escape(theString);\n            } else {\n                var unicodeString = '';\n                var inInt = false;\n                var theUnicode = false;\n                var i = 0;\n                var total = theString.length;\n                while(i < total) {\n                    inInt = theString.charCodeAt(i);\n                    if( (inInt >= 32 && inInt <= 126) ||\n                            //(inInt >= 48 && inInt <= 57) ||\n                            //(inInt >= 65 && inInt <= 90) ||\n                            //(inInt >= 97 && inInt <= 122) ||\n                            inInt === 8 ||\n                            inInt === 9 ||\n                            inInt === 10 ||\n                            inInt === 12 ||\n                            inInt === 13 ||\n                            inInt === 32 ||\n                            inInt === 34 ||\n                            inInt === 47 ||\n                            inInt === 58 ||\n                            inInt === 92) {\n\n                        if(inInt === 34 || inInt === 92 || inInt === 47) {\n                            theUnicode = '\\\\'+theString.charAt(i);\n                        } else if(inInt === 8) {\n                            theUnicode = '\\\\b';\n                        } else if(inInt === 9) {\n                            theUnicode = '\\\\t';\n                        } else if(inInt === 10) {\n                            theUnicode = '\\\\n';\n                        } else if(inInt === 12) {\n                            theUnicode = '\\\\f';\n                        } else if(inInt === 13) {\n                            theUnicode = '\\\\r';\n                        } else {\n                            theUnicode = theString.charAt(i);\n                        }\n                    } else {\n                        if(this._convertToUnicode) {\n                            theUnicode = theString.charCodeAt(i).toString(16)+''.toUpperCase();\n                            while (theUnicode.length < 4) {\n                                theUnicode = '0' + theUnicode;\n                            }\n                            theUnicode = '\\\\u' + theUnicode;\n                        } else {\n                            theUnicode = theString.charAt(i);\n                        }\n                    }\n                    unicodeString += theUnicode;\n\n                    i++;\n                }\n\n                return unicodeString;\n            }\n\n        },\n\n        _stringifyValue: function(param) {\n            if (typeof param === 'string') {\n                return '\"' + this._toUnicode(param) + '\"';\n            } else if (typeof param === 'number' && (isNaN(param) || !isFinite(param))) {  // Unusable numbers go null\n                return 'null';\n            } else if (typeof param === 'undefined' || param === null) {  // And so does undefined\n                return 'null';\n            } else if (typeof param.toJSON === 'function') {\n                var t = param.toJSON();\n                if (typeof t === 'string') {\n                    return '\"' + this._escape(t) + '\"';\n                } else {\n                    return this._escape(t.toString());\n                }\n            } else if (typeof param === 'number' || typeof param === 'boolean') {  // These ones' toString methods return valid JSON.\n                return '' + param;\n            } else if (typeof param === 'function') {\n                return 'null';  // match JSON.stringify\n            } else if (param.constructor === Date) {\n                return '\"' + this._escape(dateToISOString(param)) + '\"';\n            } else if (param.constructor === Array) {\n                var arrayString = '';\n                for (var i = 0, len = param.length; i < len; i++) {\n                    if (i > 0) {\n                        arrayString += ',';\n                    }\n                    arrayString += this._stringifyValue(param[i]);\n                }\n                return '[' + arrayString + ']';\n            } else {  // Object\n                var objectString = '';\n                for (var k in param)  {\n                    if ({}.hasOwnProperty.call(param, k)) {\n                        if (objectString !== '') {\n                            objectString += ',';\n                        }\n                        objectString += '\"' + this._escape(k) + '\": ' + this._stringifyValue(param[k]);\n                    }\n                }\n                return '{' + objectString + '}';\n            }\n        },\n\n        /**\n         * Serializes a JSON object into a string.\n         *\n         * @method stringify\n         * @param   {Object}      input                 Data to be serialized into JSON\n         * @param   {Boolean}     convertToUnicode      When `true`, converts string contents to unicode \\uXXXX\n         * @return  {String}                            Serialized string\n         *\n         * @sample Ink_Util_Json_stringify.html \n         */\n        stringify: function(input, convertToUnicode) {\n            this._convertToUnicode = !!convertToUnicode;\n            if(!this._convertToUnicode && this._nativeJSON) {\n                return this._nativeJSON.stringify(input);\n            }\n            return this._stringifyValue(input);  // And recurse.\n        },\n        \n        /**\n         * Parses a JSON text through a function\n         * \n         * @method parse\n         * @param text      {String}    Input string\n         * @param reviver   {Function}  Function receiving `(key, value)`, and `this`=(containing object), used to walk objects.\n         * \n         * @return {Object}             JSON object\n         *\n         * @sample Ink_Util_Json_parse.html \n         */\n        /* From https://github.com/douglascrockford/JSON-js/blob/master/json.js */\n        parse: function (text, reviver) {\n            /*jshint evil:true*/\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k, v, value = holder[key];\n                if (value && typeof value === 'object') {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            cx.lastIndex = 0;\n            if (cx.test(text)) {\n                text = text.replace(cx, function (a) {\n                    return '\\\\u' +\n                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n            if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                        .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                        .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return typeof reviver === 'function' ?\n                    walk({'': j}, '') :\n                    j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError('JSON.parse');\n        }\n    };\n\n    return InkJson;\n});\n","/**\n * String Utilities\n * @module Ink.Util.String_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.String', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.String_1 \n     */\n    var InkUtilString = {\n\n        /**\n         * List of special chars\n         * \n         * @property _chars\n         * @type {Array}\n         * @private\n         * @readOnly\n         * @static\n         */\n        _chars: ['&','','','','','','','','','','',\n                '','','','','','','','','','','',\n                '','','','','','','','','','','',\n                '','','','','','','','','','','',\n                '','','','','','','','','','','',\n                '','','','','','','','','\\\"','','<',\n                '>','','','','','','','','','','',\n                '','\\xad','','','','','','','','','',\n                '','','','','','','',''],\n\n        /**\n         * List of the special characters' html entities\n         * \n         * @property _entities\n         * @type {Array}\n         * @private\n         * @readOnly\n         * @static\n         */\n        _entities: ['amp','agrave','aacute','acirc','atilde','auml','aring',\n                    'aelig','ccedil','egrave','eacute','ecirc','euml','igrave',\n                    'iacute','icirc','iuml','eth','ntilde','ograve','oacute',\n                    'ocirc','otilde','ouml','oslash','ugrave','uacute','ucirc',\n                    'uuml','yacute','thorn','yuml','Agrave','Aacute','Acirc',\n                    'Atilde','Auml','Aring','AElig','Ccedil','Egrave','Eacute',\n                    'Ecirc','Euml','Igrave','Iacute','Icirc','Iuml','ETH','Ntilde',\n                    'Ograve','Oacute','Ocirc','Otilde','Ouml','Oslash','Ugrave',\n                    'Uacute','Ucirc','Uuml','Yacute','THORN','euro','quot','szlig',\n                    'lt','gt','cent','pound','curren','yen','brvbar','sect','uml',\n                    'copy','ordf','laquo','not','shy','reg','macr','deg','plusmn',\n                    'sup2','sup3','acute','micro','para','middot','cedil','sup1',\n                    'ordm','raquo','frac14','frac12','frac34'],\n\n        /**\n         * List of accented chars\n         * \n         * @property _accentedChars\n         * @type {Array}\n         * @private\n         * @readOnly\n         * @static\n         */\n        _accentedChars:['','','','','','',\n                        '','','','',\n                        '','','','',\n                        '','','','','',\n                        '','','','',\n                        '','',\n                        '','','','','','',\n                        '','','','',\n                        '','','','',\n                        '','','','','',\n                        '','','','',\n                        '',''],\n\n        /**\n         * List of the accented chars (above), but without the accents\n         * \n         * @property _accentedRemovedChars\n         * @type {Array}\n         * @private\n         * @readOnly\n         * @static\n         */\n        _accentedRemovedChars:['a','a','a','a','a','a',\n                               'e','e','e','e',\n                               'i','i','i','i',\n                               'o','o','o','o','o',\n                               'u','u','u','u',\n                               'c','n',\n                               'A','A','A','A','A','A',\n                               'E','E','E','E',\n                               'I','I','I','I',\n                               'O','O','O','O','O',\n                               'U','U','U','U',\n                               'C','N'],\n        /**\n         * Object that contains the basic HTML unsafe chars, as keys, and their HTML entities as values\n         * \n         * @property _htmlUnsafeChars\n         * @type {Object}\n         * @private\n         * @readOnly\n         * @static\n         */\n        _htmlUnsafeChars:{'<':'&lt;','>':'&gt;','&':'&amp;','\"':'&quot;',\"'\":'&apos;'},\n\n        /**\n         * Capitalizes a word.\n         * If param as more than one word, it converts first letter of all words that have more than 2 letters\n         *\n         * @method ucFirst\n         * @param   {String}  string                String to capitalize.\n         * @param   {Boolean} [firstWordOnly]=false Flag to capitalize only the first word.\n         * @return  {String}                        Camel cased string.\n         * @public\n         * @static\n         * @sample Ink_Util_String_ucFirst.html \n         */\n        ucFirst: function(string, firstWordOnly) {\n            var replacer = firstWordOnly ? /(^|\\s)(\\w)(\\S{2,})/ : /(^|\\s)(\\w)(\\S{2,})/g;\n            return string ? String(string).replace(replacer, function(_, $1, $2, $3){\n                return $1 + $2.toUpperCase() + $3.toLowerCase();\n            }) : string;\n        },\n\n        /**\n         * Trims whitespace from strings\n         *\n         * @method trim\n         * @param   {String} string     String to be trimmed\n         * @return  {String}            Trimmed string\n         * @public\n         * @static\n         * @sample Ink_Util_String_trim.html \n         */\n        trim: function(string)\n        {\n            if (typeof string === 'string') {\n                return string.replace(/^\\s+|\\s+$|\\n+$/g, '');\n            }\n            return string;\n        },\n\n        /**\n         * Strips HTML tags from strings\n         *\n         * @method stripTags\n         * @param   {String} string     String to strip tags from.\n         * @param   {String} allowed    Comma separated list of allowed tags.\n         * @return  {String}            Stripped string\n         * @public\n         * @static\n         * @sample Ink_Util_String_stripTags.html \n         */\n        stripTags: function(string, allowed)\n        {\n            if (allowed && typeof allowed === 'string') {\n                var aAllowed = InkUtilString.trim(allowed).split(',');\n                var aNewAllowed = [];\n                var cleanedTag = false;\n                for(var i=0; i < aAllowed.length; i++) {\n                    if(InkUtilString.trim(aAllowed[i]) !== '') {\n                        cleanedTag = InkUtilString.trim(aAllowed[i].replace(/(<|\\>)/g, '').replace(/\\s/, ''));\n                        aNewAllowed.push('(<'+cleanedTag+'\\\\s[^>]+>|<(\\\\s|\\\\/)?(\\\\s|\\\\/)?'+cleanedTag+'>)');\n                    }\n                }\n                var strAllowed = aNewAllowed.join('|');\n                var reAllowed = new RegExp(strAllowed, \"i\");\n\n                var aFoundTags = string.match(new RegExp(\"<[^>]*>\", \"g\"));\n\n                for(var j=0; j < aFoundTags.length; j++) {\n                    if(!aFoundTags[j].match(reAllowed)) {\n                        string = string.replace((new RegExp(aFoundTags[j], \"gm\")), '');\n                    }\n                }\n                return string;\n            } else {\n                return string.replace(/<[^\\>]+\\>/g, '');\n            }\n        },\n\n        /**\n         * Encodes string into HTML entities.\n         *\n         * @method htmlEntitiesEncode\n         * @param {String} string\n         * @return {String} string encoded\n         * @public\n         * @static\n         * @sample Ink_Util_String_htmlEntitiesEncode.html \n         */\n        htmlEntitiesEncode: function(string)\n        {\n            if (string && string.replace) {\n                var re = false;\n                for (var i = 0; i < InkUtilString._chars.length; i++) {\n                    re = new RegExp(InkUtilString._chars[i], \"gm\");\n                    string = string.replace(re, '&' + InkUtilString._entities[i] + ';');\n                }\n            }\n            return string;\n        },\n\n        /**\n         * Decodes string from HTML entities.\n         *\n         * @method htmlEntitiesDecode\n         * @param   {String}    string  String to be decoded\n         * @return  {String}            Decoded string\n         * @public\n         * @static\n         * @sample Ink_Util_String_htmlEntitiesDecode.html \n         */\n        htmlEntitiesDecode: function(string)\n        {\n            if (string && string.replace) {\n                var re = false;\n                for (var i = 0; i < InkUtilString._entities.length; i++) {\n                    re = new RegExp(\"&\"+InkUtilString._entities[i]+\";\", \"gm\");\n                    string = string.replace(re, InkUtilString._chars[i]);\n                }\n                string = string.replace(/&#[^;]+;?/g, function($0){\n                    if ($0.charAt(2) === 'x') {\n                        return String.fromCharCode(parseInt($0.substring(3), 16));\n                    }\n                    else {\n                        return String.fromCharCode(parseInt($0.substring(2), 10));\n                    }\n                });\n            }\n            return string;\n        },\n\n        /**\n         * Encode a string to UTF-8.\n         *\n         * @method utf8Encode\n         * @param   {String}    string      String to be encoded\n         * @return  {String}    string      UTF-8 encoded string\n         * @public\n         * @static\n         */\n        utf8Encode: function(string) {\n            /*jshint bitwise:false*/\n            string = string.replace(/\\r\\n/g,\"\\n\");\n            var utfstring = \"\";\n\n            for (var n = 0; n < string.length; n++) {\n\n                var c = string.charCodeAt(n);\n\n                if (c < 128) {\n                    utfstring += String.fromCharCode(c);\n                }\n                else if((c > 127) && (c < 2048)) {\n                    utfstring += String.fromCharCode((c >> 6) | 192);\n                    utfstring += String.fromCharCode((c & 63) | 128);\n                }\n                else {\n                    utfstring += String.fromCharCode((c >> 12) | 224);\n                    utfstring += String.fromCharCode(((c >> 6) & 63) | 128);\n                    utfstring += String.fromCharCode((c & 63) | 128);\n                }\n\n            }\n            return utfstring;\n        },\n\n        /**\n         * Truncates a string without breaking words.\n         *\n         * @method shortString\n         * @param   {String}    str     String to truncate\n         * @param   {Number}    n       Number of chars of the short string\n         * @return  {String}        \n         * @public\n         * @static\n         * @sample Ink_Util_String_shortString.html \n         */\n        shortString: function(str,n) {\n          var words = str.split(' ');\n          var resultstr = '';\n          for(var i = 0; i < words.length; i++ ){\n            if((resultstr + words[i] + ' ').length>=n){\n              resultstr += '&hellip;';\n              break;\n              }\n            resultstr += words[i] + ' ';\n            }\n          return resultstr;\n        },\n\n        /**\n         * Truncates a string, breaking words and adding ... at the end.\n         *\n         * @method truncateString\n         * @param   {String} str        String to truncate\n         * @param   {Number} length     Limit for the returned string, ellipsis included.\n         * @return  {String}            Truncated String\n         * @public\n         * @static\n         * @sample Ink_Util_String_truncateString.html \n         */\n        truncateString: function(str, length) {\n            if(str.length - 1 > length) {\n                return str.substr(0, length - 1) + \"\\u2026\";\n            } else {\n                return str;\n            }\n        },\n\n        /**\n         * Decodes a string from UTF-8.\n         *\n         * @method utf8Decode\n         * @param   {String} string     String to be decoded\n         * @return  {String}            Decoded string\n         * @public\n         * @static\n         */\n        utf8Decode: function(utfstring) {\n            /*jshint bitwise:false*/\n            var string = \"\";\n            var i = 0, c = 0, c2 = 0, c3 = 0;\n\n            while ( i < utfstring.length ) {\n\n                c = utfstring.charCodeAt(i);\n\n                if (c < 128) {\n                    string += String.fromCharCode(c);\n                    i++;\n                }\n                else if((c > 191) && (c < 224)) {\n                    c2 = utfstring.charCodeAt(i+1);\n                    string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                    i += 2;\n                }\n                else {\n                    c2 = utfstring.charCodeAt(i+1);\n                    c3 = utfstring.charCodeAt(i+2);\n                    string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                    i += 3;\n                }\n\n            }\n            return string;\n        },\n\n        /**\n         * Removes all accented characters from a string.\n         *\n         * @method removeAccentedChars\n         * @param   {String} string     String to remove accents from\n         * @return  {String}            String without accented chars\n         * @public\n         * @static\n         * @sample Ink_Util_String_removeAccentedChars.html \n         */\n        removeAccentedChars: function(string)\n        {\n            var newString = string;\n            var re = false;\n            for (var i = 0; i < InkUtilString._accentedChars.length; i++) {\n                re = new RegExp(InkUtilString._accentedChars[i], \"gm\");\n                newString = newString.replace(re, '' + InkUtilString._accentedRemovedChars[i] + '');\n            }\n            return newString;\n        },\n\n        /**\n         * Count the number of occurrences of a specific needle in a haystack\n         *\n         * @method substrCount\n         * @param   {String} haystack   String to search in\n         * @param   {String} needle     String to search for\n         * @return  {Number}            Number of occurrences\n         * @public\n         * @static\n         * @sample Ink_Util_String_substrCount.html \n         */\n        substrCount: function(haystack,needle)\n        {\n            return haystack ? haystack.split(needle).length - 1 : 0;\n        },\n\n        /**\n         * Eval a JSON - We recommend you Ink.Util.Json\n         *\n         * @method evalJSON\n         * @param   {String}    strJSON     JSON string to eval\n         * @param   {Boolean}   sanitize    Flag to sanitize input\n         * @return  {Object}                JS Object\n         * @public\n         * @static\n         */\n        evalJSON: function(strJSON, sanitize) {\n            /* jshint evil:true */\n            if( (typeof sanitize === 'undefined' || sanitize === null) || InkUtilString.isJSON(strJSON)) {\n                try {\n                    if(typeof(JSON) !== \"undefined\" && typeof(JSON.parse) !== 'undefined'){\n                        return JSON.parse(strJSON);\n                    }\n                    return eval('('+strJSON+')');\n                } catch(e) {\n                    throw new Error('ERROR: Bad JSON string...');\n                }\n            }\n        },\n\n        /**\n         * Checks if a string is a valid JSON object (string encoded)\n         *\n         * @method isJSON       \n         * @param   {String}    str      String to check\n         * @return  {Boolean}\n         * @public\n         * @static\n         */\n        isJSON: function(str)\n        {\n            str = str.replace(/\\\\./g, '@').replace(/\"[^\"\\\\\\n\\r]*\"/g, '');\n            return (/^[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t]*$/).test(str);\n        },\n\n        /**\n         * Escapes unsafe html chars as HTML entities\n         *\n         * @method htmlEscapeUnsafe\n         * @param {String} str String to escape\n         * @return {String} Escaped string\n         * @public\n         * @static\n         * @sample Ink_Util_String_htmlEscapeUnsafe.html \n         */\n        htmlEscapeUnsafe: function(str){\n            var chars = InkUtilString._htmlUnsafeChars;\n            return str !== null ? String(str).replace(/[<>&'\"]/g,function(c){return chars[c];}) : str;\n        },\n\n        /**\n         * Normalizes whitespace in string.\n         * String is trimmed and sequences of whitespaces are collapsed.\n         *\n         * @method normalizeWhitespace\n         * @param   {String}    str     String to normalize\n         * @return  {String}            Normalized string\n         * @public\n         * @static\n         * @sample Ink_Util_String_normalizeWhitespace.html \n         */\n        normalizeWhitespace: function(str){\n            return str !== null ? InkUtilString.trim(String(str).replace(/\\s+/g,' ')) : str;\n        },\n\n        /**\n         * Converts string to unicode.\n         *\n         * @method toUnicode\n         * @param   {String} str    String to convert\n         * @return  {String}        Unicoded String\n         * @public\n         * @static\n         * @sample Ink_Util_String_toUnicode.html \n         */\n        toUnicode: function(str) {\n            if (typeof str === 'string') {\n                var unicodeString = '';\n                var inInt = false;\n                var theUnicode = false;\n                var total = str.length;\n                var i=0;\n\n                while(i < total)\n                {\n                    inInt = str.charCodeAt(i);\n                    if( (inInt >= 32 && inInt <= 126) ||\n                            inInt === 8 ||\n                            inInt === 9 ||\n                            inInt === 10 ||\n                            inInt === 12 ||\n                            inInt === 13 ||\n                            inInt === 32 ||\n                            inInt === 34 ||\n                            inInt === 47 ||\n                            inInt === 58 ||\n                            inInt === 92) {\n\n                        /*\n                        if(inInt == 34 || inInt == 92 || inInt == 47) {\n                            theUnicode = '\\\\'+str.charAt(i);\n                        } else {\n                        }\n                        */\n                        if(inInt === 8) {\n                            theUnicode = '\\\\b';\n                        } else if(inInt === 9) {\n                            theUnicode = '\\\\t';\n                        } else if(inInt === 10) {\n                            theUnicode = '\\\\n';\n                        } else if(inInt === 12) {\n                            theUnicode = '\\\\f';\n                        } else if(inInt === 13) {\n                            theUnicode = '\\\\r';\n                        } else {\n                            theUnicode = str.charAt(i);\n                        }\n                    } else {\n                        theUnicode = str.charCodeAt(i).toString(16)+''.toUpperCase();\n                        while (theUnicode.length < 4) {\n                            theUnicode = '0' + theUnicode;\n                        }\n                        theUnicode = '\\\\u' + theUnicode;\n                    }\n                    unicodeString += theUnicode;\n\n                    i++;\n                }\n                return unicodeString;\n            }\n        },\n\n        /**\n         * Escapes a unicode character.\n         *\n         * @method escape\n         * @param {String}  c   Character to escape\n         * @return {String} Escaped character. Returns \\xXX if hex smaller than 0x100, otherwise \\uXXXX\n         * @public\n         * @static\n         * @sample Ink_Util_String_escape.html \n         */\n        escape: function(c) {\n            var hex = (c).charCodeAt(0).toString(16).split('');\n            if (hex.length < 3) {\n                while (hex.length < 2) { hex.unshift('0'); }\n                hex.unshift('x');\n            }\n            else {\n                while (hex.length < 4) { hex.unshift('0'); }\n                hex.unshift('u');\n            }\n\n            hex.unshift('\\\\');\n            return hex.join('');\n        },\n\n        /**\n         * Unescapes a unicode character escape sequence\n         *\n         * @method unescape\n         * @param   {String} es     Escape sequence\n         * @return  {String}        String un-unicoded\n         * @public\n         * @static\n         * @sample Ink_Util_String_unescape.html \n         */\n        unescape: function(es) {\n            var idx = es.lastIndexOf('0');\n            idx = idx === -1 ? 2 : Math.min(idx, 2);\n            //console.log(idx);\n            var hexNum = es.substring(idx);\n            //console.log(hexNum);\n            var num = parseInt(hexNum, 16);\n            return String.fromCharCode(num);\n        },\n\n        /**\n         * Escapes a string to unicode characters\n         *\n         * @method escapeText\n         * @param   {String}    txt             \n         * @param   {Array}     [whiteList]     Whitelist of characters\n         * @return  {String}                    String escaped to Unicode\n         * @public\n         * @static\n         * @sample Ink_Util_String_escapeText.html \n         */\n        escapeText: function(txt, whiteList) {\n            if (whiteList === undefined) {\n                whiteList = ['[', ']', '\\'', ','];\n            }\n            var txt2 = [];\n            var c, C;\n            for (var i = 0, f = txt.length; i < f; ++i) {\n                c = txt[i];\n                C = c.charCodeAt(0);\n                if (C < 32 || C > 126 && whiteList.indexOf(c) === -1) {\n                    c = InkUtilString.escape(c);\n                }\n                txt2.push(c);\n            }\n            return txt2.join('');\n        },\n\n        /**\n         * Regex to check escaped strings\n         *\n         * @property escapedCharRegex\n         * @type {Regex}\n         * @public\n         * @readOnly\n         * @static\n         */\n        escapedCharRegex: /(\\\\x[0-9a-fA-F]{2})|(\\\\u[0-9a-fA-F]{4})/g,\n\n        /**\n         * Unescapes a string\n         *\n         * @method unescapeText\n         * @param {String} txt\n         * @return {String} Unescaped string\n         * @public\n         * @static\n         * @sample Ink_Util_String_unescapeText.html \n         */\n        unescapeText: function(txt) {\n            /*jshint boss:true */\n            var m;\n            while (m = InkUtilString.escapedCharRegex.exec(txt)) {\n                m = m[0];\n                txt = txt.replace(m, InkUtilString.unescape(m));\n                InkUtilString.escapedCharRegex.lastIndex = 0;\n            }\n            return txt;\n        },\n\n        /**\n         * Compares two strings.\n         *\n         * @method strcmp\n         * @param   {String}    str1     First String\n         * @param   {String}    str2     Second String\n         * @return  {Number}\n         * @public\n         * @static\n         * @sample Ink_Util_String_strcmp.html \n         */\n        strcmp: function(str1, str2) {\n            return ((str1 === str2) ? 0 : ((str1 > str2) ? 1 : -1));\n        },\n\n        /**\n         * Splits a string into smaller chunks\n         *\n         * @method packetize\n         * @param   {String} str        String to divide\n         * @param   {Number} maxLen     Maximum chunk size (in characters)\n         * @return  {Array}             Chunks of the original string\n         * @public\n         * @static\n         * @sample Ink_Util_String_packetize.html \n         */\n        packetize: function(str, maxLen) {\n            var len = str.length;\n            var parts = new Array( Math.ceil(len / maxLen) );\n            var chars = str.split('');\n            var sz, i = 0;\n            while (len) {\n                sz = Math.min(maxLen, len);\n                parts[i++] = chars.splice(0, sz).join('');\n                len -= sz;\n            }\n            return parts;\n        }\n    };\n\n    return InkUtilString;\n\n});\n","/**\n * URL Utilities\n * @module Ink.Util.Url_1\n * @version 1\n */\n\nInk.createModule('Ink.Util.Url', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.Url_1\n     */\n    var Url = {\n\n        /**\n         * Auxiliary string for encoding\n         *\n         * @property _keyStr\n         * @type {String}\n         * @readOnly\n         * @private\n         */\n        _keyStr : 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',\n\n\n        /**\n         * Gets URL of current page\n         *\n         * @method getUrl\n         * @return Current URL\n         * @public\n         * @static\n         * @sample Ink_Util_Url_getUrl.html \n         */\n        getUrl: function()\n        {\n            return window.location.href;\n        },\n\n        /**\n         * Generates an URL string.\n         *\n         * @method genQueryString\n         * @param {String} uri      Base URL\n         * @param {Object} params   Object to transform to query string\n         * @return {String} URI with query string set\n         * @public\n         * @static\n         * @sample Ink_Util_Url_genQueryString.html \n         */\n        genQueryString: function(uri, params) {\n            var hasQuestionMark = uri.indexOf('?') !== -1;\n            var sep, pKey, pValue, parts = [uri];\n\n            for (pKey in params) {\n                if (params.hasOwnProperty(pKey)) {\n                    if (!hasQuestionMark) {\n                        sep = '?';\n                        hasQuestionMark = true;\n                    } else {\n                        sep = '&';\n                    }\n                    pValue = params[pKey];\n                    if (typeof pValue !== 'number' && !pValue) {\n                        pValue = '';\n                    }\n                    parts = parts.concat([sep, encodeURIComponent(pKey), '=', encodeURIComponent(pValue)]);\n                }\n            }\n\n            return parts.join('');\n        },\n\n        /**\n         * Gets an object from an URL encoded string.\n         *\n         * @method getQueryString\n         * @param   {String} [str]      URL String. When not specified it uses the current URL.\n         * @return  {Object}            Key-Value pair object\n         * @public\n         * @static\n         * @sample Ink_Util_Url_getQueryString.html \n         */\n        getQueryString: function(str)\n        {\n            var url;\n            if(str && typeof(str) !== 'undefined') {\n                url = str;\n            } else {\n                url = this.getUrl();\n            }\n            var aParams = {};\n            if(url.match(/\\?(.+)/i)) {\n                var queryStr = url.replace(/^(.*)\\?([^\\#]+)(\\#(.*))?/g, \"$2\");\n                if(queryStr.length > 0) {\n                    var aQueryStr = queryStr.split(/[;&]/);\n                    for(var i=0; i < aQueryStr.length; i++) {\n                        var pairVar = aQueryStr[i].split('=');\n                        aParams[decodeURIComponent(pairVar[0])] = (typeof(pairVar[1]) !== 'undefined' && pairVar[1]) ? decodeURIComponent(pairVar[1]) : false;\n                    }\n                }\n            }\n            return aParams;\n        },\n\n        /**\n         * Gets the URL hash value\n         *\n         * @method getAnchor\n         * @param   {String}            [str]   URL String. Defaults to current page URL.\n         * @return  {String|Boolean}            Hash in the URL. If there's no hash, returns false.\n         * @public\n         * @static\n         * @sample Ink_Util_Url_getAnchor.html \n         */\n        getAnchor: function(str)\n        {\n            var url;\n            if(str && typeof(str) !== 'undefined') {\n                url = str;\n            } else {\n                url = this.getUrl();\n            }\n            var anchor = false;\n            if(url.match(/#(.+)/)) {\n                anchor = url.replace(/([^#]+)#(.*)/, \"$2\");\n            }\n            return anchor;\n        },\n\n        /**\n         * Gets the anchor string of an URL\n         *\n         * @method getAnchorString\n         * @param   {String} [string]   URL to parse. Defaults to current URL.\n         * @return  {Object}            Key-value pair object of the URL's hashtag 'variables'\n         * @public\n         * @static\n         * @sample Ink_Util_Url_getAnchorString.html \n         */\n        getAnchorString: function(string)\n        {\n            var url;\n            if(string && typeof(string) !== 'undefined') {\n                url = string;\n            } else {\n                url = this.getUrl();\n            }\n            var aParams = {};\n            if(url.match(/#(.+)/i)) {\n                var anchorStr = url.replace(/^([^#]+)#(.*)?/g, \"$2\");\n                if(anchorStr.length > 0) {\n                    var aAnchorStr = anchorStr.split(/[;&]/);\n                    for(var i=0; i < aAnchorStr.length; i++) {\n                        var pairVar = aAnchorStr[i].split('=');\n                        aParams[decodeURIComponent(pairVar[0])] = (typeof(pairVar[1]) !== 'undefined' && pairVar[1]) ? decodeURIComponent(pairVar[1]) : false;\n                    }\n                }\n            }\n            return aParams;\n        },\n\n\n        /**\n         * Parses URL string into URL parts\n         *\n         * @method parseUrl\n         * @param {String} url URL to be parsed\n         * @return {Object} Parsed URL as a key-value object.\n         * @public\n         * @static\n         * @sample Ink_Util_Url_parseUrl.html \n         */\n        parseUrl: function(url) {\n            var aURL = {};\n            if(url && typeof url === 'string') {\n                if(url.match(/^([^:]+):\\/\\//i)) {\n                    var re = /^([^:]+):\\/\\/([^\\/]*)\\/?([^\\?#]*)\\??([^#]*)#?(.*)/i;\n                    if(url.match(re)) {\n                        aURL.scheme   = url.replace(re, \"$1\");\n                        aURL.host     = url.replace(re, \"$2\");\n                        aURL.path     = '/'+url.replace(re, \"$3\");\n                        aURL.query    = url.replace(re, \"$4\") || false;\n                        aURL.fragment = url.replace(re, \"$5\") || false;\n                    }\n                } else {\n                    var re1 = new RegExp(\"^([^\\\\?]+)\\\\?([^#]+)#(.*)\", \"i\");\n                    var re2 = new RegExp(\"^([^\\\\?]+)\\\\?([^#]+)#?\", \"i\");\n                    var re3 = new RegExp(\"^([^\\\\?]+)\\\\??\", \"i\");\n                    if(url.match(re1)) {\n                        aURL.scheme   = false;\n                        aURL.host     = false;\n                        aURL.path     = url.replace(re1, \"$1\");\n                        aURL.query    = url.replace(re1, \"$2\");\n                        aURL.fragment = url.replace(re1, \"$3\");\n                    } else if(url.match(re2)) {\n                        aURL.scheme = false;\n                        aURL.host   = false;\n                        aURL.path   = url.replace(re2, \"$1\");\n                        aURL.query  = url.replace(re2, \"$2\");\n                        aURL.fragment = false;\n                    } else if(url.match(re3)) {\n                        aURL.scheme   = false;\n                        aURL.host     = false;\n                        aURL.path     = url.replace(re3, \"$1\");\n                        aURL.query    = false;\n                        aURL.fragment = false;\n                    }\n                }\n                if(aURL.host) {\n                    var regPort = /^(.*?)\\\\:(\\\\d+)$/i;\n                    // check for port\n                    if(aURL.host.match(regPort)) {\n                        var tmpHost1 = aURL.host;\n                        aURL.host = tmpHost1.replace(regPort, \"$1\");\n                        aURL.port = tmpHost1.replace(regPort, \"$2\");\n                    } else {\n                        aURL.port = false;\n                    }\n                    // check for user and pass\n                    if(aURL.host.match(/@/i)) {\n                        var tmpHost2 = aURL.host;\n                        aURL.host = tmpHost2.split('@')[1];\n                        var tmpUserPass = tmpHost2.split('@')[0];\n                        if(tmpUserPass.match(/\\:/)) {\n                            aURL.user = tmpUserPass.split(':')[0];\n                            aURL.pass = tmpUserPass.split(':')[1];\n                        } else {\n                            aURL.user = tmpUserPass;\n                            aURL.pass = false;\n                        }\n                    }\n                }\n            }\n            return aURL;\n        },\n\n        /**\n         * Formats an URL object into an URL string.\n         *\n         * @method format\n         * @param urlObj Window.location, a.href, or parseUrl object to format\n         * @return {String} Full URL.\n         */\n        format: function (urlObj) {\n            var protocol = '';\n            var host = '';\n            var path = '';\n            var frag = '';\n            var query = '';\n\n            if (typeof urlObj.protocol === 'string') {\n                protocol = urlObj.protocol + '//';  // here it comes with the colon\n            } else if (typeof urlObj.scheme === 'string')  {\n                protocol = urlObj.scheme + '://';\n            }\n\n            host = urlObj.host || urlObj.hostname || '';\n            path = urlObj.path || '';\n\n            if (typeof urlObj.query === 'string') {\n                query = urlObj.query;\n            } else if (typeof urlObj.search === 'string') {\n                query = urlObj.search.replace(/^\\?/, '');\n            }\n            if (typeof urlObj.fragment === 'string') {\n                frag =  urlObj.fragment;\n            } else if (typeof urlObj.hash === 'string') {\n                frag = urlObj.hash.replace(/#$/, '');\n            }\n\n            return [\n                protocol,\n                host,\n                path,\n                query && '?' + query,\n                frag && '#' + frag\n            ].join('');\n        },\n\n        /**\n         * Gets the last loaded script element\n         *\n         * @method currentScriptElement\n         * @param {String} [match] String to match against the script src attribute\n         * @return {DOMElement|Boolean} Returns the `script` DOM Element or false if unable to find it.\n         * @public\n         * @static\n         * @sample Ink_Util_Url_currentScriptElement.html \n         */\n        currentScriptElement: function(match)\n        {\n            var aScripts = document.getElementsByTagName('script');\n            if(typeof(match) === 'undefined') {\n                if(aScripts.length > 0) {\n                    return aScripts[(aScripts.length - 1)];\n                } else {\n                    return false;\n                }\n            } else {\n                var curScript = false;\n                var re = new RegExp(\"\"+match+\"\", \"i\");\n                for(var i=0, total = aScripts.length; i < total; i++) {\n                    curScript = aScripts[i];\n                    if(re.test(curScript.src)) {\n                        return curScript;\n                    }\n                }\n                return false;\n            }\n        },\n\n        \n        /*\n        base64Encode: function(string)\n        {\n            /**\n         * --function {String} ?\n         * --Convert a string to BASE 64\n         * @param {String} string - string to convert\n         * @return base64 encoded string\n         *\n         * \n            if(!SAPO.Utility.String || typeof(SAPO.Utility.String) === 'undefined') {\n                throw \"SAPO.Utility.Url.base64Encode depends of SAPO.Utility.String, which has not been referred.\";\n            }\n\n            var output = \"\";\n            var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n            var i = 0;\n\n            var input = SAPO.Utility.String.utf8Encode(string);\n\n            while (i < input.length) {\n\n                chr1 = input.charCodeAt(i++);\n                chr2 = input.charCodeAt(i++);\n                chr3 = input.charCodeAt(i++);\n\n                enc1 = chr1 >> 2;\n                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n                enc4 = chr3 & 63;\n\n                if (isNaN(chr2)) {\n                    enc3 = enc4 = 64;\n                } else if (isNaN(chr3)) {\n                    enc4 = 64;\n                }\n\n                output = output +\n                this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\n                this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\n            }\n            return output;\n        },\n        base64Decode: function(string)\n        {\n         * --function {String} ?\n         * Decode a BASE 64 encoded string\n         * --param {String} string base64 encoded string\n         * --return string decoded\n            if(!SAPO.Utility.String || typeof(SAPO.Utility.String) === 'undefined') {\n                throw \"SAPO.Utility.Url.base64Decode depends of SAPO.Utility.String, which has not been referred.\";\n            }\n\n            var output = \"\";\n            var chr1, chr2, chr3;\n            var enc1, enc2, enc3, enc4;\n            var i = 0;\n\n            var input = string.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n            while (i < input.length) {\n\n                enc1 = this._keyStr.indexOf(input.charAt(i++));\n                enc2 = this._keyStr.indexOf(input.charAt(i++));\n                enc3 = this._keyStr.indexOf(input.charAt(i++));\n                enc4 = this._keyStr.indexOf(input.charAt(i++));\n\n                chr1 = (enc1 << 2) | (enc2 >> 4);\n                chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n                chr3 = ((enc3 & 3) << 6) | enc4;\n\n                output = output + String.fromCharCode(chr1);\n\n                if (enc3 !== 64) {\n                    output = output + String.fromCharCode(chr2);\n                }\n                if (enc4 !== 64) {\n                    output = output + String.fromCharCode(chr3);\n                }\n            }\n            output = SAPO.Utility.String.utf8Decode(output);\n            return output;\n        },\n        */\n\n\n        /**\n         * Debug function ?\n         *\n         * @method _debug\n         * @private\n         * @static\n         */\n        _debug: function() {}\n\n    };\n\n    return Url;\n\n});\n","/**\n * Validation Utilities\n * @module Ink.Util.Validator_1\n * @version 1\n */\n \nInk.createModule('Ink.Util.Validator', '1', [], function() {\n\n    'use strict';\n\n    /**\n     * @namespace Ink.Util.Validator_1 \n     */\n    var Validator = {\n\n        /**\n         * List of country codes avaible for the isPhone method\n         *\n         * @property _countryCodes\n         * @type {Array}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _countryCodes : [\n                        'AO',\n                        'CV',\n                        'MZ',\n                        'PT'\n                    ],\n\n        /**\n         * International number for portugal\n         *\n         * @property _internacionalPT\n         * @type {Number}\n         * @private\n         * @static\n         * @readOnly\n         *\n         */\n        _internacionalPT: 351,\n\n        /**\n         * List of all portuguese number prefixes\n         *\n         * @property _indicativosPT\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         *\n         */\n        _indicativosPT: {\n                        21: 'lisboa',\n                        22: 'porto',\n                        231: 'mealhada',\n                        232: 'viseu',\n                        233: 'figueira da foz',\n                        234: 'aveiro',\n                        235: 'arganil',\n                        236: 'pombal',\n                        238: 'seia',\n                        239: 'coimbra',\n                        241: 'abrantes',\n                        242: 'ponte de sr',\n                        243: 'santarm',\n                        244: 'leiria',\n                        245: 'portalegre',\n                        249: 'torres novas',\n                        251: 'valena',\n                        252: 'vila nova de famalico',\n                        253: 'braga',\n                        254: 'peso da rgua',\n                        255: 'penafiel',\n                        256: 'so joo da madeira',\n                        258: 'viana do castelo',\n                        259: 'vila real',\n                        261: 'torres vedras',\n                        262: 'caldas da ranha',\n                        263: 'vila franca de xira',\n                        265: 'setbal',\n                        266: 'vora',\n                        268: 'estremoz',\n                        269: 'santiago do cacm',\n                        271: 'guarda',\n                        272: 'castelo branco',\n                        273: 'bragana',\n                        274: 'proena-a-nova',\n                        275: 'covilh',\n                        276: 'chaves',\n                        277: 'idanha-a-nova',\n                        278: 'mirandela',\n                        279: 'moncorvo',\n                        281: 'tavira',\n                        282: 'portimo',\n                        283: 'odemira',\n                        284: 'beja',\n                        285: 'moura',\n                        286: 'castro verde',\n                        289: 'faro',\n                        291: 'funchal, porto santo',\n                        292: 'corvo, faial, flores, horta, pico',\n                        295: 'angra do herosmo, graciosa, so jorge, terceira',\n                        296: 'ponta delgada, so miguel, santa maria',\n\n                        91 : 'rede mvel 91 (Vodafone / Yorn)',\n                        93 : 'rede mvel 93 (Optimus)',\n                        96 : 'rede mvel 96 (TMN)',\n                        92 : 'rede mvel 92 (TODOS)',\n                        //925 : 'rede mvel 925 (TMN 925)',\n                        //926 : 'rede mvel 926 (TMN 926)',\n                        //927 : 'rede mvel 927 (TMN 927)',\n                        //922 : 'rede mvel 922 (Phone-ix)',\n\n                        707: 'nmero nico',\n                        760: 'nmero nico',\n                        800: 'nmero grtis',\n                        808: 'chamada local',\n                        30:  'voip'\n                          },\n        /**\n         * International number for Cabo Verde\n         *\n         * @property _internacionalCV\n         * @type {Number}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _internacionalCV: 238,\n\n        /**\n         * List of all Cabo Verde number prefixes\n         *\n         * @property _indicativosCV\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _indicativosCV: {\n                        2: 'fixo',\n                        91: 'mvel 91',\n                        95: 'mvel 95',\n                        97: 'mvel 97',\n                        98: 'mvel 98',\n                        99: 'mvel 99'\n                    },\n        /**\n         * International number for Angola\n         *\n         * @property _internacionalAO\n         * @type {Number}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _internacionalAO: 244,\n\n        /**\n         * List of all Angola number prefixes\n         *\n         * @property _indicativosAO\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _indicativosAO: {\n                        2: 'fixo',\n                        91: 'mvel 91',\n                        92: 'mvel 92'\n                    },\n        /**\n         * International number for Mozambique\n         *\n         * @property _internacionalMZ\n         * @type {Number}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _internacionalMZ: 258,\n\n        /**\n         * List of all Mozambique number prefixes\n         *\n         * @property _indicativosMZ\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _indicativosMZ: {\n                        2: 'fixo',\n                        82: 'mvel 82',\n                        84: 'mvel 84'\n                    },\n\n        /**\n         * International number for Timor\n         *\n         * @property _internacionalTL\n         * @type {Number}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _internacionalTL: 670,\n\n        /**\n         * List of all Timor number prefixes\n         *\n         * @property _indicativosTL\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _indicativosTL: {\n                        3: 'fixo',\n                        7: 'mvel 7'\n                    },\n\n        /**\n         * Regular expression groups for several groups of characters\n         *\n         * http://en.wikipedia.org/wiki/C0_Controls_and_Basic_Latin\n         * http://en.wikipedia.org/wiki/Plane_%28Unicode%29#Basic_Multilingual_Plane\n         * http://en.wikipedia.org/wiki/ISO_8859-1\n         *\n         * @property _characterGroups\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _characterGroups: {\n            numbers: ['0-9'],\n            asciiAlpha: ['a-zA-Z'],\n            latin1Alpha: ['a-zA-Z', '\\u00C0-\\u00FF'],\n            unicodeAlpha: ['a-zA-Z', '\\u00C0-\\u00FF', '\\u0100-\\u1FFF', '\\u2C00-\\uD7FF'],\n            /* whitespace characters */\n            space: [' '],\n            dash: ['-'],\n            underscore: ['_'],\n            nicknamePunctuation: ['_.-'],\n\n            singleLineWhitespace: ['\\t '],\n            newline: ['\\n'],\n            whitespace: ['\\t\\n\\u000B\\f\\r\\u00A0 '],\n\n            asciiPunctuation: ['\\u0021-\\u002F', '\\u003A-\\u0040', '\\u005B-\\u0060', '\\u007B-\\u007E'],\n            latin1Punctuation: ['\\u0021-\\u002F', '\\u003A-\\u0040', '\\u005B-\\u0060', '\\u007B-\\u007E', '\\u00A1-\\u00BF', '\\u00D7', '\\u00F7'],\n            unicodePunctuation: ['\\u0021-\\u002F', '\\u003A-\\u0040', '\\u005B-\\u0060', '\\u007B-\\u007E', '\\u00A1-\\u00BF', '\\u00D7', '\\u00F7', '\\u2000-\\u206F', '\\u2E00-\\u2E7F', '\\u3000-\\u303F']\n        },\n\n        /**\n         * Creates a regular expression for several character groups.\n         *\n         * @method createRegExp\n         *\n         * @param Groups* {Object}\n         *  Groups to build regular expressions for. Possible keys are:\n         *\n         * - **numbers**: 0-9\n         * - **asciiAlpha**: a-z, A-Z\n         * - **latin1Alpha**: asciiAlpha, plus printable characters in latin-1\n         * - **unicodeAlpha**: unicode alphanumeric characters.\n         * - **space**: ' ', the space character.\n         * - **dash**: dash character.\n         * - **underscore**: underscore character.\n         * - **nicknamePunctuation**: dash, dot, underscore\n         * - **singleLineWhitespace**: space and tab (whitespace which only spans one line).\n         * - **newline**: newline character ('\\n')\n         * - **whitespace**: whitespace characters in the ASCII character set.\n         * - **asciiPunctuation**: punctuation characters in the ASCII character set.\n         * - **latin1Punctuation**: punctuation characters in latin-1.\n         * - **unicodePunctuation**: punctuation characters in unicode.\n         *\n         */\n        createRegExp: function (groups) {\n            var re = '^[';\n            for (var key in groups) if (groups.hasOwnProperty(key)) {\n                if (!(key in Validator._characterGroups)) {\n                    throw new Error('group ' + key + ' is not a valid character group');\n                } else if (groups[key]) {\n                    re += Validator._characterGroups[key].join('');\n                }\n            }\n            if (re === '^[') {\n                // No changes\n                return new RegExp('$^'); // match nothing\n            }\n            return new RegExp(re + ']*?$');\n        },\n\n        /**\n         * Checks if a field has the required groups.\n         *\n         * @method checkCharacterGroups\n         * @param {String}  s               The validation string\n         * @param {Object}  [groups]={}     What groups are included. See createRegexp\n         * @sample Ink_Util_Validator_checkCharacterGroups.html \n         */\n        checkCharacterGroups: function (s, groups) {\n            return Validator.createRegExp(groups).test(s);\n        },\n\n        /**\n         * Checks if a field contains unicode printable characters.\n         *\n         * @method unicode\n         * @param {String}  s               The validation string\n         * @param {Object}  [options]={}    Optional configuration object. See createRegexp\n         */\n        unicode: function (s, options) {\n            return Validator.checkCharacterGroups(s, Ink.extendObj({\n                unicodeAlpha: true}, options));\n        },\n\n        /**\n         * Checks if a field only contains latin-1 alphanumeric characters. \n         * Takes options for allowing singleline whitespace, cross-line whitespace and punctuation.\n         *\n         * @method latin1\n         *\n         * @param {String}  s               The validation string\n         * @param {Object}  [options]={}    Optional configuration object. See createRegexp\n         * @sample Ink_Util_Validator_latin1.html  \n         */\n        latin1: function (s, options) {\n            return Validator.checkCharacterGroups(s, Ink.extendObj({\n                latin1Alpha: true}, options));\n        },\n\n        /**\n         * Checks if a field only contains only ASCII alphanumeric characters. \n         * Takes options for allowing singleline whitespace, cross-line whitespace and punctuation.\n         *\n         * @method ascii\n         *\n         * @param {String}  s               The validation string\n         * @param {Object}  [options]={}    Optional configuration object. See createRegexp\n         * @sample Ink_Util_Validator_ascii.html \n         */\n        ascii: function (s, options) {\n            return Validator.checkCharacterGroups(s, Ink.extendObj({\n                asciiAlpha: true}, options));\n        },\n\n        /**\n         * Checks if a number is a valid\n         *\n         * @method number\n         * @param {String} numb         The number\n         * @param {Object} [options]    Further options\n         *  @param  [options.decimalSep]='.'    Allow decimal separator.\n         *  @param  [options.thousandSep]=\",\"   Strip this character from the number.\n         *  @param  [options.negative]=false    Allow negative numbers.\n         *  @param  [options.decimalPlaces]=null   Maximum number of decimal places. Use `0` for an integer number.\n         *  @param  [options.max]=null          Maximum number\n         *  @param  [options.min]=null          Minimum number\n         *  @param  [options.returnNumber]=false When this option is true, return the number itself when the value is valid.\n         *  @sample Ink_Util_Validator_number.html \n         */\n        number: function (numb, inOptions) {\n            numb = numb + '';\n            var options = Ink.extendObj({\n                decimalSep: '.',\n                thousandSep: '',\n                negative: true,\n                decimalPlaces: null,\n                maxDigits: null,\n                max: null,\n                min: null,\n                returnNumber: false\n            }, inOptions || {});\n            // smart recursion thing sets up aliases for options.\n            if (options.thousandSep) {\n                numb = numb.replace(new RegExp('\\\\' + options.thousandSep, 'g'), '');\n                options.thousandSep = '';\n                return Validator.number(numb, options);\n            }\n            if (options.negative === false) {\n                options.min = 0;\n                options.negative = true;\n                return Validator.number(numb, options);\n            }\n            if (options.decimalSep !== '.') {\n                numb = numb.replace(new RegExp('\\\\' + options.decimalSep, 'g'), '.');\n            }\n\n            if (!/^(-)?(\\d+)?(\\.\\d+)?$/.test(numb) || numb === '') {\n                return false;  // forbidden character found\n            }\n            \n            var split;\n            if (options.decimalSep && numb.indexOf(options.decimalSep) !== -1) {\n                split = numb.split(options.decimalSep);\n                if (options.decimalPlaces !== null &&\n                        split[1].length > options.decimalPlaces) {\n                    return false;\n                }\n            } else {\n                split = ['' + numb, ''];\n            }\n            \n            if (options.maxDigits!== null) {\n                if (split[0].replace(/-/g, '').length > options.maxDigits) {\n                    return split;\n                }\n            }\n            \n            // Now look at the actual float\n            var ret = parseFloat(numb);\n            \n            if (options.maxExcl !== null && ret >= options.maxExcl ||\n                    options.minExcl !== null && ret <= options.minExcl) {\n                return false;\n            }\n            if (options.max !== null && ret > options.max ||\n                    options.min !== null && ret < options.min) {\n                return false;\n            }\n            \n            if (options.returnNumber) {\n                return ret;\n            } else {\n                return true;\n            }\n        },\n\n        /**\n         * Checks if a year is Leap \"Bissexto\"\n         *\n         * @method _isLeapYear\n         * @param {Number} year Year to be checked\n         * @return {Boolean} True if it is a leap year.\n         * @private\n         * @static\n         * @example\n         *     Ink.requireModules(['Ink.Util.Validator_1'], function( InkValidator ){\n         *         console.log( InkValidator._isLeapYear( 2004 ) ); // Result: true\n         *         console.log( InkValidator._isLeapYear( 2006 ) ); // Result: false\n         *     });\n         */\n        _isLeapYear: function(year){\n\n            var yearRegExp = /^\\d{4}$/;\n\n            if(yearRegExp.test(year)){\n                return ((year%4) ? false: ((year%100) ? true : ((year%400)? false : true)) );\n            }\n\n            return false;\n        },\n\n        /**\n         * Object with the date formats available for validation\n         *\n         * @property _dateParsers\n         * @type {Object}\n         * @private\n         * @static\n         * @readOnly\n         */\n        _dateParsers: {\n            'yyyy-mm-dd': {day:5, month:3, year:1, sep: '-', parser: /^(\\d{4})(\\-)(\\d{1,2})(\\-)(\\d{1,2})$/},\n            'yyyy/mm/dd': {day:5, month:3, year:1, sep: '/', parser: /^(\\d{4})(\\/)(\\d{1,2})(\\/)(\\d{1,2})$/},\n            'yy-mm-dd': {day:5, month:3, year:1, sep: '-', parser: /^(\\d{2})(\\-)(\\d{1,2})(\\-)(\\d{1,2})$/},\n            'yy/mm/dd': {day:5, month:3, year:1, sep: '/', parser: /^(\\d{2})(\\/)(\\d{1,2})(\\/)(\\d{1,2})$/},\n            'dd-mm-yyyy': {day:1, month:3, year:5, sep: '-', parser: /^(\\d{1,2})(\\-)(\\d{1,2})(\\-)(\\d{4})$/},\n            'dd/mm/yyyy': {day:1, month:3, year:5, sep: '/', parser: /^(\\d{1,2})(\\/)(\\d{1,2})(\\/)(\\d{4})$/},\n            'dd-mm-yy': {day:1, month:3, year:5, sep: '-', parser: /^(\\d{1,2})(\\-)(\\d{1,2})(\\-)(\\d{2})$/},\n            'dd/mm/yy': {day:1, month:3, year:5, sep: '/', parser: /^(\\d{1,2})(\\/)(\\d{1,2})(\\/)(\\d{2})$/}\n        },\n\n        /**\n         * Gets the number of days in a given month of a given year\n         *\n         * @method _daysInMonth\n         * @param {Number} _m Month (1 to 12)\n         * @param {Number} _y Year\n         * @return {Number} Returns the number of days in a given month of a given year\n         * @private\n         * @static\n         * @example\n         *     Ink.requireModules(['Ink.Util.Validator_1'], function( InkValidator ){\n         *         console.log( InkValidator._daysInMonth( 2, 2004 ) ); // Result: 29\n         *         console.log( InkValidator._daysInMonth( 2, 2006 ) ); // Result: 28\n         *     });\n         */\n        _daysInMonth: function(_m,_y){\n            var nDays=0;\n\n            _m = parseInt(_m, 10);\n            _y = parseInt(_y, 10);\n\n            if(_m===1 || _m===3 || _m===5 || _m===7 || _m===8 || _m===10 || _m===12) {\n                nDays= 31;\n            } else if ( _m===4 || _m===6 || _m===9 || _m===11) {\n                nDays = 30;\n            } else if (_m===2) {\n                if((_y%400===0) || (_y%4===0 && _y%100!==0)) {\n                    nDays = 29;\n                } else {\n                    nDays = 28;\n                }\n            }\n\n            return nDays;\n        },\n\n\n\n        /**\n         * Checks if a date is valid\n         *\n         * @method _isValidDate\n         * @param {Number} year\n         * @param {Number} month\n         * @param {Number} day\n         * @return {Boolean} True if valid\n         * @private\n         * @static\n         * @example\n         *     Ink.requireModules(['Ink.Util.Validator_1'], function( InkValidator ){\n         *         console.log( InkValidator._isValidDate( 2004, 2, 29 ) ); // Result: true\n         *         console.log( InkValidator._isValidDate( 2006, 2, 29 ) ); // Result: false\n         *     });\n         */\n        _isValidDate: function(year, month, day){\n\n            var yearRegExp = /^\\d{4}$/;\n            var validOneOrTwo = /^\\d{1,2}$/;\n            if(yearRegExp.test(year) && validOneOrTwo.test(month) && validOneOrTwo.test(day)){\n                if(month>=1 && month<=12 && day>=1 && this._daysInMonth(month,year)>=day){\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Checks if an email is valid\n         *\n         * @method mail\n         * @param {String} email\n         * @return {Boolean} True if it's valid\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_mail.html \n         */\n        email: function(email)\n        {\n            var emailValido = new RegExp(\"^[_a-z0-9-]+((\\\\.|\\\\+)[_a-z0-9-]+)*@([\\\\w]*-?[\\\\w]*\\\\.)+[a-z]{2,4}$\", \"i\");\n            if(!emailValido.test(email)) {\n                return false;\n            } else {\n                return true;\n            }\n        },\n\n        /**\n         * Deprecated. Alias for email(). Use it instead.\n         *\n         * @method mail\n         * @public\n         * @static\n         * @private\n         */\n        mail: function (mail) { return Validator.email(mail); },\n\n        /**\n         * Checks if an url is valid\n         *\n         * @method url\n         * @param {String} url URL to be checked\n         * @param {Boolean} [full] If true, validates a full URL (one that should start with 'http')\n         * @return {Boolean} True if valid\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_url.html \n         */\n        url: function(url, full)\n        {\n            if(typeof full === \"undefined\" || full === false) {\n                var reHTTP = new RegExp(\"(^(http\\\\:\\\\/\\\\/|https\\\\:\\\\/\\\\/)(.+))\", \"i\");\n                if(reHTTP.test(url) === false) {\n                    url = 'http://'+url;\n                }\n            }\n\n            var reUrl = new RegExp(\"^(http:\\\\/\\\\/|https:\\\\/\\\\/)([\\\\w]*(-?[\\\\w]*)*\\\\.)+[a-z]{2,4}\", \"i\");\n            if(reUrl.test(url) === false) {\n                return false;\n            } else {\n                return true;\n            }\n        },\n\n        /**\n         * Checks if a phone is valid in Portugal\n         *\n         * @method isPTPhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid Portuguese Phone\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isPTPhone.html\n         */\n        isPTPhone: function(phone)\n        {\n\n            phone = phone.toString();\n            var aInd = [];\n            for(var i in this._indicativosPT) {\n                if(typeof(this._indicativosPT[i]) === 'string') {\n                    aInd.push(i);\n                }\n            }\n            var strInd = aInd.join('|');\n\n            var re351 = /^(00351|\\+351)/;\n            if(re351.test(phone)) {\n                phone = phone.replace(re351, \"\");\n            }\n\n            var reSpecialChars = /(\\s|\\-|\\.)+/g;\n            phone = phone.replace(reSpecialChars, '');\n            //var reInt = new RegExp(\"\\\\d\", \"i\");\n            var reInt = /[\\d]{9}/i;\n            if(phone.length === 9 && reInt.test(phone)) {\n                var reValid = new RegExp(\"^(\"+strInd+\")\");\n                if(reValid.test(phone)) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Alias function for isPTPhone\n         *\n         * @method isPortuguesePhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid Portuguese Phone\n         * @public\n         * @static\n         */\n        isPortuguesePhone: function(phone)\n        {\n            return this.isPTPhone(phone);\n        },\n\n        /**\n         * Checks if a phone is valid in Cabo Verde\n         *\n         * @method isCVPhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid Cape Verdean Phone\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isCVPhone.html \n         */\n        isCVPhone: function(phone)\n        {\n            phone = phone.toString();\n            var aInd = [];\n            for(var i in this._indicativosCV) {\n                if(typeof(this._indicativosCV[i]) === 'string') {\n                    aInd.push(i);\n                }\n            }\n            var strInd = aInd.join('|');\n\n            var re238 = /^(00238|\\+238)/;\n            if(re238.test(phone)) {\n                phone = phone.replace(re238, \"\");\n            }\n\n            var reSpecialChars = /(\\s|\\-|\\.)+/g;\n            phone = phone.replace(reSpecialChars, '');\n            //var reInt = new RegExp(\"\\\\d\", \"i\");\n            var reInt = /[\\d]{7}/i;\n            if(phone.length === 7 && reInt.test(phone)) {\n                var reValid = new RegExp(\"^(\"+strInd+\")\");\n                if(reValid.test(phone)) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Checks if a phone is valid in Angola\n         *\n         * @method isAOPhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid Angolan Phone\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isAOPhone.html \n         */\n        isAOPhone: function(phone)\n        {\n\n            phone = phone.toString();\n            var aInd = [];\n            for(var i in this._indicativosAO) {\n                if(typeof(this._indicativosAO[i]) === 'string') {\n                    aInd.push(i);\n                }\n            }\n            var strInd = aInd.join('|');\n\n            var re244 = /^(00244|\\+244)/;\n            if(re244.test(phone)) {\n                phone = phone.replace(re244, \"\");\n            }\n\n            var reSpecialChars = /(\\s|\\-|\\.)+/g;\n            phone = phone.replace(reSpecialChars, '');\n            //var reInt = new RegExp(\"\\\\d\", \"i\");\n            var reInt = /[\\d]{9}/i;\n            if(phone.length === 9 && reInt.test(phone)) {\n                var reValid = new RegExp(\"^(\"+strInd+\")\");\n                if(reValid.test(phone)) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Checks if a phone is valid in Mozambique\n         *\n         * @method isMZPhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid Mozambican Phone\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isMZPhone.html \n         */\n        isMZPhone: function(phone)\n        {\n\n            phone = phone.toString();\n            var aInd = [];\n            for(var i in this._indicativosMZ) {\n                if(typeof(this._indicativosMZ[i]) === 'string') {\n                    aInd.push(i);\n                }\n            }\n            var strInd = aInd.join('|');\n            var re258 = /^(00258|\\+258)/;\n            if(re258.test(phone)) {\n                phone = phone.replace(re258, \"\");\n            }\n\n            var reSpecialChars = /(\\s|\\-|\\.)+/g;\n            phone = phone.replace(reSpecialChars, '');\n            //var reInt = new RegExp(\"\\\\d\", \"i\");\n            var reInt = /[\\d]{8,9}/i;\n            if((phone.length === 9 || phone.length === 8) && reInt.test(phone)) {\n                var reValid = new RegExp(\"^(\"+strInd+\")\");\n                if(reValid.test(phone)) {\n                   if(phone.indexOf('2') === 0 && phone.length === 8) {\n                       return true;\n                   } else if(phone.indexOf('8') === 0 && phone.length === 9) {\n                       return true;\n                   }\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Checks if a phone is valid in Timor\n         *\n         * @method isTLPhone\n         * @param {Number} phone Phone number to be checked\n         * @return {Boolean} True if it's a valid phone from Timor-Leste\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isTLPhone.html \n         */\n        isTLPhone: function(phone)\n        {\n\n            phone = phone.toString();\n            var aInd = [];\n            for(var i in this._indicativosTL) {\n                if(typeof(this._indicativosTL[i]) === 'string') {\n                    aInd.push(i);\n                }\n            }\n            var strInd = aInd.join('|');\n            var re670 = /^(00670|\\+670)/;\n            if(re670.test(phone)) {\n                phone = phone.replace(re670, \"\");\n            }\n\n\n            var reSpecialChars = /(\\s|\\-|\\.)+/g;\n            phone = phone.replace(reSpecialChars, '');\n            //var reInt = new RegExp(\"\\\\d\", \"i\");\n            var reInt = /[\\d]{7}/i;\n            if(phone.length === 7 && reInt.test(phone)) {\n                var reValid = new RegExp(\"^(\"+strInd+\")\");\n                if(reValid.test(phone)) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Checks if a number is a phone number.\n         * This method validates the number in all country codes available the ones set in the second param\n         *\n         * @method isPhone\n         * @param   {String}        phone           Phone number to validate\n         * @param   {String|Array}  [countryCode]   Country code or  array of countries to validate\n         * @return  {Boolean}                       True if it's a valid phone in any country available\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isPhone.html\n         */\n        isPhone: function(){\n            var index;\n\n            if(arguments.length===0){\n                return false;\n            }\n\n            var phone = arguments[0];\n\n            if(arguments.length>1){\n                if(arguments[1].constructor === Array){\n                    var func;\n                    for(index=0; index<arguments[1].length; index++ ){\n                        if(typeof(func=this['is' + arguments[1][index].toUpperCase() + 'Phone'])==='function'){\n                            if(func(phone)){\n                                return true;\n                            }\n                        } else {\n                            throw \"Invalid Country Code!\";\n                        }\n                    }\n                } else if(typeof(this['is' + arguments[1].toUpperCase() + 'Phone'])==='function'){\n                    return this['is' + arguments[1].toUpperCase() + 'Phone'](phone);\n                } else {\n                    throw \"Invalid Country Code!\";\n                }\n            } else {\n                for(index=0; index<this._countryCodes.length; index++){\n                    if(this['is' + this._countryCodes[index] + 'Phone'](phone)){\n                        return true;\n                    }\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Validates if a zip code is valid in Portugal\n         *\n         * @method codPostal\n         * @param {Number|String} cp1\n         * @param {optional Number|String} cp2\n         * @param {optional Boolean} returnBothResults\n         * @return {Boolean} True if it's a valid zip code\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_codPostal.html \n         */\n        codPostal: function(cp1,cp2,returnBothResults){\n\n\n            var cPostalSep = /^(\\s*\\-\\s*|\\s+)$/;\n            var trim = /^\\s+|\\s+$/g;\n            var cPostal4 = /^[1-9]\\d{3}$/;\n            var cPostal3 = /^\\d{3}$/;\n            var parserCPostal = /^(.{4})(.*)(.{3})$/;\n\n\n            returnBothResults = !!returnBothResults;\n\n            cp1 = cp1.replace(trim,'');\n            if(typeof(cp2)!=='undefined'){\n                cp2 = cp2.replace(trim,'');\n                if(cPostal4.test(cp1) && cPostal3.test(cp2)){\n                    if( returnBothResults === true ){\n                        return [true, true];\n                    } else {\n                        return true;\n                    }\n                }\n            } else {\n                if(cPostal4.test(cp1) ){\n                    if( returnBothResults === true ){\n                        return [true,false];\n                    } else {\n                        return true;\n                    }\n                }\n\n                var cPostal = cp1.match(parserCPostal);\n\n                if(cPostal!==null && cPostal4.test(cPostal[1]) && cPostalSep.test(cPostal[2]) && cPostal3.test(cPostal[3])){\n                    if( returnBothResults === true ){\n                        return [true,false];\n                    } else {\n                        return true;\n                    }\n                }\n            }\n\n            if( returnBothResults === true ){\n                return [false,false];\n            } else {\n                return false;\n            }\n        },\n\n        /**\n         * Checks if a date is valid in a given format\n         *\n         * @method isDate\n         * @param {String} format Format defined in _dateParsers\n         * @param {String} dateStr Date string\n         * @return {Boolean} True if it's a valid date and in the specified format\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isDate.html \n         */\n        isDate: function(format, dateStr){\n\n\n\n            if(typeof(this._dateParsers[format])==='undefined'){\n                return false;\n            }\n            var yearIndex = this._dateParsers[format].year;\n            var monthIndex = this._dateParsers[format].month;\n            var dayIndex = this._dateParsers[format].day;\n            var dateParser = this._dateParsers[format].parser;\n            var separator = this._dateParsers[format].sep;\n\n            /* Trim Deactivated\n            * var trim = /^\\w+|\\w+$/g;\n            * dateStr = dateStr.replace(trim,\"\");\n            */\n            var data = dateStr.match(dateParser);\n            if(data!==null){\n                /* Trim Deactivated\n                * for(i=1;i<=data.length;i++){\n                *   data[i] = data[i].replace(trim,\"\");\n                *}\n                */\n                if(data[2]===data[4] && data[2]===separator){\n\n                    var _y = ((data[yearIndex].length===2) ? \"20\" + data[yearIndex].toString() : data[yearIndex] );\n\n                    if(this._isValidDate(_y,data[monthIndex].toString(),data[dayIndex].toString())){\n                        return true;\n                    }\n                }\n            }\n\n\n            return false;\n        },\n\n        /**\n         * Checks if a string is a valid color\n         *\n         * @method isColor\n         * @param {String} str Color string to be checked\n         * @return {Boolean} True if it's a valid color string\n         * @public\n         * @static\n         * @sample Ink_Util_Validator_isColor.html \n         */\n        isColor: function(str){\n            var match, valid = false,\n                keyword = /^[a-zA-Z]+$/,\n                hexa = /^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,\n                rgb = /^rgb\\(\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*\\)$/,\n                rgba = /^rgba\\(\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*(1(\\.0)?|0(\\.[0-9])?)\\s*\\)$/,\n                hsl = /^hsl\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*\\)$/,\n                hsla = /^hsla\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*([0-9]{1,3})(%)?\\s*,\\s*(1(\\.0)?|0(\\.[0-9])?)\\s*\\)$/;\n\n            // rgb(123, 123, 132) 0 to 255\n            // rgb(123%, 123%, 123%) 0 to 100\n            // rgba( 4 vals) last val: 0 to 1.0\n            // hsl(0 to 360, %, %)\n            // hsla( ..., 0 to 1.0)\n\n            if(\n                keyword.test(str) ||\n                hexa.test(str)\n            ){\n                return true;\n            }\n\n            var i;\n\n            // rgb range check\n            if((match = rgb.exec(str)) !== null || (match = rgba.exec(str)) !== null){\n                i = match.length;\n\n                while(i--){\n                    // check percentage values\n                    if((i===2 || i===4 || i===6) && typeof match[i] !== \"undefined\" && match[i] !== \"\"){\n                        if(typeof match[i-1] !== \"undefined\" && match[i-1] >= 0 && match[i-1] <= 100){\n                            valid = true;\n                        } else {\n                            return false;\n                        }\n                    }\n                    // check 0 to 255 values\n                    if(i===1 || i===3 || i===5 && (typeof match[i+1] === \"undefined\" || match[i+1] === \"\")){\n                        if(typeof match[i] !== \"undefined\" && match[i] >= 0 && match[i] <= 255){\n                            valid = true;\n                        } else {\n                            return false;\n                        }\n                    }\n                }\n            }\n\n            // hsl range check\n            if((match = hsl.exec(str)) !== null || (match = hsla.exec(str)) !== null){\n                i = match.length;\n                while(i--){\n                    // check percentage values\n                    if(i===3 || i===5){\n                        if(typeof match[i-1] !== \"undefined\" && typeof match[i] !== \"undefined\" && match[i] !== \"\" &&\n                        match[i-1] >= 0 && match[i-1] <= 100){\n                            valid = true;\n                        } else {\n                            return false;\n                        }\n                    }\n                    // check 0 to 360 value\n                    if(i===1){\n                        if(typeof match[i] !== \"undefined\" && match[i] >= 0 && match[i] <= 360){\n                            valid = true;\n                        } else {\n                            return false;\n                        }\n                    }\n                }\n            }\n\n            return valid;\n        },\n\n        /**\n         * Checks if the value is a valid IP. \n         *\n         * @method isIP\n         * @param  {String} value   Value to be checked\n         * @param  {String} ipType Type of IP to be validated. The values are: ipv4, ipv6. By default is ipv4.\n         * @return {Boolean}         True if the value is a valid IP address. False if not.\n         * @sample Ink_Util_Validator_isIP.html \n         */\n        isIP: function( value, ipType ){\n            if( typeof value !== 'string' ){\n                return false;\n            }\n\n            ipType = (ipType || 'ipv4').toLowerCase();\n\n            switch( ipType ){\n                case 'ipv4':\n                    return (/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/).test(value);\n                case 'ipv6':\n                    return (/^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/).test(value);\n                default:\n                    return false;\n            }\n        },\n\n        /**\n         * Credit Card specifications, to be used in the credit card verification.\n         *\n         * @property _creditCardSpecs\n         * @type {Object}\n         * @private\n         */\n        _creditCardSpecs: {\n            'default': {\n                'length': '13,14,15,16,17,18,19',\n                'prefix': /^.+/,\n                'luhn': true\n            },\n\n            'american express': {\n                'length': '15',\n                'prefix': /^3[47]/,\n                'luhn'  : true\n            },\n\n            'diners club': {\n                'length': '14,16',\n                'prefix': /^36|55|30[0-5]/,\n                'luhn'  : true\n            },\n\n            'discover': {\n                'length': '16',\n                'prefix': /^6(?:5|011)/,\n                'luhn'  : true\n            },\n\n            'jcb': {\n                'length': '15,16',\n                'prefix': /^3|1800|2131/,\n                'luhn'  : true\n            },\n\n            'maestro': {\n                'length': '16,18',\n                'prefix': /^50(?:20|38)|6(?:304|759)/,\n                'luhn'  : true\n            },\n\n            'mastercard': {\n                'length': '16',\n                'prefix': /^5[1-5]/,\n                'luhn'  : true\n            },\n\n            'visa': {\n                'length': '13,16',\n                'prefix': /^4/,\n                'luhn'  : true\n            }\n        },\n\n        /**\n         * Luhn function, to be used when validating credit cards\n         *\n         */\n        _luhn: function (num){\n\n            num = parseInt(num,10);\n\n            if ( (typeof num !== 'number') && (num % 1 !== 0) ){\n                // Luhn can only be used on nums!\n                return false;\n            }\n\n            num = num+'';\n            // Check num length\n            var length = num.length;\n\n            // Checksum of the card num\n            var\n                i, checksum = 0\n            ;\n\n            for (i = length - 1; i >= 0; i -= 2)\n            {\n                // Add up every 2nd digit, starting from the right\n                checksum += parseInt(num.substr(i, 1),10);\n            }\n\n            for (i = length - 2; i >= 0; i -= 2)\n            {\n                // Add up every 2nd digit doubled, starting from the right\n                var dbl = parseInt(num.substr(i, 1) * 2,10);\n\n                // Subtract 9 from the dbl where value is greater than 10\n                checksum += (dbl >= 10) ? (dbl - 9) : dbl;\n            }\n\n            // If the checksum is a multiple of 10, the number is valid\n            return (checksum % 10 === 0);\n        },\n\n        /**\n         * Checks if a number is of a specific credit card type\n         * @method isCreditCard\n         * @param  {String}  num            Number to be validates\n         * @param  {String|Array}  creditCardType Credit card type. See _creditCardSpecs for the list of supported values.\n         * @return {Boolean}\n         * @sample Ink_Util_Validator_isCreditCard.html \n         */\n        isCreditCard: function(num, creditCardType){\n\n            if ( /\\d+/.test(num) === false ){\n                return false;\n            }\n\n            if ( typeof creditCardType === 'undefined' ){\n                creditCardType = 'default';\n            }\n            else if ( creditCardType instanceof Array ){\n                var i, ccLength = creditCardType.length;\n                for ( i=0; i < ccLength; i++ ){\n                    // Test each type for validity\n                    if (this.isCreditCard(num, creditCardType[i]) ){\n                        return true;\n                    }\n                }\n\n                return false;\n            }\n\n            // Check card type\n            creditCardType = creditCardType.toLowerCase();\n\n            if ( typeof this._creditCardSpecs[creditCardType] === 'undefined' ){\n                return false;\n            }\n\n            // Check card number length\n            var length = num.length+'';\n\n            // Validate the card length by the card type\n            if ( this._creditCardSpecs[creditCardType]['length'].split(\",\").indexOf(length) === -1 ){\n                return false;\n            }\n\n            // Check card number prefix\n            if ( !this._creditCardSpecs[creditCardType]['prefix'].test(num) ){\n                return false;\n            }\n\n            // No Luhn check required\n            if (this._creditCardSpecs[creditCardType]['luhn'] === false){\n                return true;\n            }\n\n            return this._luhn(num);\n        }\n    };\n\n    return Validator;\n\n});\n"]}