al values to decimal\n         * Useful to use with CSS colors\n         *\n         * @method hexToDec\n         * @param {String}  hex  hexadecimal Value with 6, 3, 2 or 1 characters\n         * @return {Number} Object with properties r, g, b if length of number is >= 3 or decimal value instead.\n         * @sample Ink_Dom_Css_hexToDec.html \n         */\n        hexToDec: function(hex){\n            if (hex.indexOf('#') === 0) {\n                hex = hex.substr(1);\n            }\n            if (hex.length === 6) { // will return object RGB\n                return {\n                    r: parseInt(hex.substr(0,2), 16),\n                    g: parseInt(hex.substr(2,2), 16),\n                    b: parseInt(hex.substr(4,2), 16)\n                };\n            }\n            else if (hex.length === 3) { // will return object RGB\n                return {\n                    r: parseInt(hex.charAt(0) + hex.charAt(0), 16),\n                    g: parseInt(hex.charAt(1) + hex.charAt(1), 16),\n                    b: parseInt(hex.charAt(2) + hex.charAt(2), 16)\n                };\n            }\n            else if (hex.length <= 2) { // will return int\n                return parseInt(hex, 16);\n            }\n        },\n\n        /**\n         * Get a single property from a stylesheet.\n         * Use this to obtain the value of a CSS property (searched from loaded CSS documents)\n         *\n         * @method getPropertyFromStylesheet\n         * @param {String}  selector  a CSS rule. must be an exact match\n         * @param {String}  property  a CSS property\n         * @return {String} value of the found property, or null if it wasn't matched\n         */\n        getPropertyFromStylesheet: function(selector, property) {\n            var rule = this.getRuleFromStylesheet(selector);\n            if (rule) {\n                return rule.style[property];\n            }\n            return null;\n        },\n\n        getPropertyFromStylesheet2: function(selector, property) {\n            var rules = this.getRulesFromStylesheet(selector);\n            /*\n            rules.forEach(function(rule) {\n                var x = rule.style[property];\n                if (x !== null && x !== undefined) {\n                    return x;\n                }\n            });\n            */\n            var x;\n            for(var i=0, t=rules.length; i < t; i++) {\n                x = rules[i].style[property];\n                if (x !== null && x !== undefined) {\n                    return x;\n                }\n            }\n            return null;\n        },\n\n        getRuleFromStylesheet: function(selector) {\n            var sheet, rules, ri, rf, rule;\n            var s = document.styleSheets;\n            if (!s) {\n                return null;\n            }\n\n            for (var si = 0, sf = document.styleSheets.length; si < sf; ++si) {\n                sheet = document.styleSheets[si];\n                rules = sheet.rules ? sheet.rules : sheet.cssRules;\n                if (!rules) { return null; }\n\n                for (ri = 0, rf = rules.length; ri < rf; ++ri) {\n                    rule = rules[ri];\n                    if (!rule.selectorText) { continue; }\n                    if (rule.selectorText === selector) {\n                        return rule;\n                    }\n                }\n            }\n\n            return null;\n        },\n\n        getRulesFromStylesheet: function(selector) {\n            var res = [];\n            var sheet, rules, ri, rf, rule;\n            var s = document.styleSheets;\n            if (!s) { return res; }\n\n            for (var si = 0, sf = document.styleSheets.length; si < sf; ++si) {\n                sheet = document.styleSheets[si];\n                rules = sheet.rules ? sheet.rules : sheet.cssRules;\n                if (!rules) {\n                    return null;\n                }\n\n                for (ri = 0, rf = rules.length; ri < rf; ++ri) {\n                    rule = rules[ri];\n                    if (!rule.selectorText) { continue; }\n                    if (rule.selectorText === selector) {\n                        res.push(rule);\n                    }\n                }\n            }\n\n            return res;\n        },\n\n        getPropertiesFromRule: function(selector) {\n            var rule = this.getRuleFromStylesheet(selector);\n            var props = {};\n            var prop, i, f;\n\n            /*if (typeof rule.style.length === 'snumber') {\n                for (i = 0, f = rule.style.length; i < f; ++i) {\n                    prop = this._camelCase( rule.style[i]   );\n                    props[prop] = rule.style[prop];\n                }\n            }\n            else {  // HANDLES IE 8, FIREFOX RULE JOINING... */\n                rule = rule.style.cssText;\n                var parts = rule.split(';');\n                var steps, val, pre, pos;\n                for (i = 0, f = parts.length; i < f; ++i) {\n                    if (parts[i].charAt(0) === ' ') {\n                        parts[i] = parts[i].substring(1);\n                    }\n                    steps = parts[i].split(':');\n                    prop = this._camelCase( steps[0].toLowerCase()  );\n                    val = steps[1];\n                    if (val) {\n                        val = val.substring(1);\n\n                        if (prop === 'padding' || prop === 'margin' || prop === 'borderWidth') {\n\n                            if (prop === 'borderWidth') {   pre = 'border'; pos = 'Width';  }\n                            else {                          pre = prop;     pos = '';       }\n\n                            if (val.indexOf(' ') !== -1) {\n                                val = val.split(' ');\n                                props[pre + 'Top'   + pos]  = val[0];\n                                props[pre + 'Bottom'+ pos]  = val[0];\n                                props[pre + 'Left'  + pos]  = val[1];\n                                props[pre + 'Right' + pos]  = val[1];\n                            }\n                            else {\n                                props[pre + 'Top'   + pos]  = val;\n                                props[pre + 'Bottom'+ pos]  = val;\n                                props[pre + 'Left'  + pos]  = val;\n                                props[pre + 'Right' + pos]  = val;\n                            }\n                        }\n                        else if (prop === 'borderRadius') {\n                            if (val.indexOf(' ') !== -1) {\n                                val = val.split(' ');\n                                props.borderTopLeftRadius       = val[0];\n                                props.borderBottomRightRadius   = val[0];\n                                props.borderTopRightRadius      = val[1];\n                                props.borderBottomLeftRadius    = val[1];\n                            }\n                            else {\n                                props.borderTopLeftRadius       = val;\n                                props.borderTopRightRadius      = val;\n                                props.borderBottomLeftRadius    = val;\n                                props.borderBottomRightRadius   = val;\n                            }\n                        }\n                        else {\n                            props[prop] = val;\n                        }\n                    }\n                }\n            //}\n            //console.log(props);\n\n            return props;\n        },\n\n        /**\n         * Change the font size of elements.\n         * Changes the font size of the elements which match the given CSS rule\n         * For this function to work, the CSS file must be in the same domain than the host page, otherwise JS can't access it.\n         *\n         * @method changeFontSize\n         * @param {String}  selector  CSS selector rule\n         * @param {Number}  delta     Number of pixels to change on font-size\n         * @param {String}  [op]      Supported operations are '+' and '*'. defaults to '+'\n         * @param {Number}  [minVal]  If result gets smaller than minVal, change does not occurr\n         * @param {Number}  [maxVal]  If result gets bigger  than maxVal, change does not occurr\n         */\n        changeFontSize: function(selector, delta, op, minVal, maxVal) {\n            var that = this;\n            Ink.requireModules(['Ink.Dom.Selector_1'], function(Selector) {\n                var e;\n                if      (typeof selector !== 'string') { e = '1st argument must be a CSS selector rule.'; }\n                else if (typeof delta    !== 'number') { e = '2nd argument must be a number.'; }\n                else if (op !== undefined && op !== '+' && op !== '*') { e = '3rd argument must be one of \"+\", \"*\".'; }\n                else if (minVal !== undefined && (typeof minVal !== 'number' || minVal <= 0)) { e = '4th argument must be a positive number.'; }\n                else if (maxVal !== undefined && (typeof maxVal !== 'number' || maxVal < maxVal)) { e = '5th argument must be a positive number greater than minValue.'; }\n                if (e) { throw new TypeError(e); }\n\n                var val, el, els = Selector.select(selector);\n                if (minVal === undefined) { minVal = 1; }\n                op = (op === '*') ? function(a,b){return a*b;} : function(a,b){return a+b;};\n                for (var i = 0, f = els.length; i < f; ++i) {\n                    el = els[i];\n                    val = parseFloat( that.getStyle(el, 'fontSize'));\n                    val = op(val, delta);\n                    if (val < minVal) { continue; }\n                    if (typeof maxVal === 'number' && val > maxVal) { continue; }\n                    el.style.fontSize = val + 'px';\n                }\n            });\n        }\n\n    };\n\n    return Css;\n\n});\n","/**\n * DOM Traversal and manipulation\n * @module Ink.Dom.Element_1\n * @version 1\n */\n\nInk.createModule('Ink.Dom.Element', 1, [], function() {\n\n    'use strict';\n\n    var createContextualFragmentSupport = (\n        typeof document.createRange === 'function' &&\n        typeof window.Range.prototype.createContextualFragment === 'function');\n\n    var deleteThisTbodyToken = 'Ink.Dom.Element tbody: ' + Math.random();\n    var browserCreatesTbodies = (function () {\n        var div = document.createElement('div');\n        div.innerHTML = '<table>';\n        return div.getElementsByTagName('tbody').length !== 0;\n    }());\n\n    function rect(elem){\n        var dimensions = {};\n        try {\n            dimensions = elem.getBoundingClientRect();\n        } catch(e){\n            dimensions = { top: elem.offsetTop, left: elem.offsetLeft };\n        }\n        return dimensions;\n    }\n\n    /**\n     * @namespace Ink.Dom.Element_1\n     */\n\n    var InkElement = {\n\n        /**\n         * Checks if something is a DOM Element.\n         *\n         * @method isDOMElement\n         * @static\n         * @param   {Mixed}     o   The object to be checked.\n         * @return  {Boolean}       True if it's a valid DOM Element.\n         * @example\n         *     var el = Ink.s('#element');\n         *     if( InkElement.isDOMElement( el ) === true ){\n         *         // It is a DOM Element.\n         *     } else {\n         *         // It is NOT a DOM Element.\n         *     }\n         */\n        isDOMElement: function(o) {\n            return o !== null && typeof o === 'object' && 'nodeType' in o && o.nodeType === 1;\n        },\n\n        /**\n         * Shortcut for `document.getElementById`\n         *\n         * @method get\n         * @param {String|DOMElement} elm   Either an ID of an element, or an element.\n         * @return {DOMElement|null} The DOM element with the given id or null when it was not found\n         * @sample Ink_Dom_Element_1_get.html\n         */\n        get: function(elm) {\n            if(typeof elm !== 'undefined') {\n                if(typeof elm === 'string') {\n                    return document.getElementById(elm);\n                }\n                return elm;\n            }\n            return null;\n        },\n\n        /**\n         * Creates a DOM element\n         *\n         * @method create\n         * @param {String} tag        tag name\n         * @param {Object} properties  object with properties to be set on the element. You can also call other functions in Ink.Dom.Element like this\n         * @sample Ink_Dom_Element_1_create.html\n         */\n        create: function(tag, properties) {\n            var el = document.createElement(tag);\n            //Ink.extendObj(el, properties);\n            for(var property in properties) {\n                if(properties.hasOwnProperty(property)) {\n                    if (property in InkElement) {\n                        InkElement[property](el, properties[property]);\n                    } else {\n                        if(property === 'className' || property === 'class') {\n                            el.className = properties.className || properties['class'];\n                        } else {\n                            el.setAttribute(property, properties[property]);\n                        }\n                    }\n                }\n            }\n            return el;\n        },\n\n        /**\n         * Removes a DOM Element\n         *\n         * @method remove\n         * @param {DOMElement} elm  The element to remove\n         * @sample Ink_Dom_Element_1_remove.html\n         */\n        remove: function(el) {\n            el = Ink.i(el);\n            var parEl;\n            if (el && (parEl = el.parentNode)) {\n                parEl.removeChild(el);\n            }\n        },\n\n        /**\n         * Scrolls the window to an element\n         *\n         * @method scrollTo\n         * @param {DOMElement|String} elm  Element where to scroll\n         * @sample Ink_Dom_Element_1_scrollTo.html\n         */\n        scrollTo: function(elm) {\n            elm = InkElement.get(elm);\n            if(elm) {\n                if (elm.scrollIntoView) {\n                    return elm.scrollIntoView();\n                }\n\n                var elmOffset = {},\n                    elmTop = 0, elmLeft = 0;\n\n                do {\n                    elmTop += elm.offsetTop || 0;\n                    elmLeft += elm.offsetLeft || 0;\n\n                    elm = elm.offsetParent;\n                } while(elm);\n\n                elmOffset = {x: elmLeft, y: elmTop};\n\n                window.scrollTo(elmOffset.x, elmOffset.y);\n            }\n        },\n\n        /**\n         * Gets the top offset of an element\n         *\n         * @method offsetTop\n         * @uses Ink.Dom.Browser\n         *\n         * @param {DOMElement|String} elm  Target element\n         * @return {Number} Offset from the target element to the top of the document\n         * @sample Ink_Dom_Element_1_offsetTop.html\n         */\n        offsetTop: function(elm) {\n            return InkElement.offset(elm)[1];\n        },\n\n        /**\n         * Gets the left offset of an element\n         *\n         * @method offsetLeft\n         * @uses Ink.Dom.Browser\n         *\n         * @param {DOMElement|String} elm  Target element\n         * @return {Number} Offset from the target element to the left of the document\n         * @sample Ink_Dom_Element_1_offsetLeft.html\n         */\n        offsetLeft: function(elm) {\n            return InkElement.offset(elm)[0];\n        },\n\n        /**\n        * Gets the relative offset of an element\n        *\n        * @method positionedOffset\n        * @param {DOMElement|String} elm  Target element\n        * @return {Array} Array with the element offsetleft and offsettop relative to the closest positioned ancestor\n        * @sample Ink_Dom_Element_1_positionedOffset.html\n        */\n        positionedOffset: function(element) {\n            var valueTop = 0, valueLeft = 0;\n            element = InkElement.get(element);\n            do {\n                valueTop  += element.offsetTop  || 0;\n                valueLeft += element.offsetLeft || 0;\n                element = element.offsetParent;\n                if (element) {\n                    if (element.tagName.toLowerCase() === 'body') { break;  }\n\n                    var value = element.style.position;\n                    if (!value && element.currentStyle) {\n                        value = element.currentStyle.position;\n                    }\n                    if ((!value || value === 'auto') && typeof getComputedStyle !== 'undefined') {\n                        var css = getComputedStyle(element, null);\n                        value = css ? css.position : null;\n                    }\n                    if (value === 'relative' || value === 'absolute') { break;  }\n                }\n            } while (element);\n            return [valueLeft, valueTop];\n        },\n\n        /**\n         * Gets the cumulative offset for an element\n         *\n         * Returns the top left position of the element on the page\n         *\n         * @method offset\n         * @uses Ink.Dom.Browser\n         *\n         * @method offset\n         * @param {DOMElement|String}   elm     Target element\n         * @return {[Number, Number]}   Array with pixel distance from the target element to the top left corner of the document\n         * @sample Ink_Dom_Element_1_offset.html\n         */\n        offset: function(el) {\n            /*jshint boss:true */\n            el = Ink.i(el);\n            var res = [0, 0];\n            var doc = el.ownerDocument,\n                docElem = doc.documentElement,\n                box = rect(el),\n                body = doc.body,\n                clientTop  = docElem.clientTop  || body.clientTop  || 0,\n                clientLeft = docElem.clientLeft || body.clientLeft || 0,\n                scrollTop  = doc.pageYOffset || docElem.scrollTop  || body.scrollTop,\n                scrollLeft = doc.pageXOffset || docElem.scrollLeft || body.scrollLeft,\n                top  = box.top  + scrollTop  - clientTop,\n                left = box.left + scrollLeft - clientLeft;\n            res = [left, top];\n            return res;\n        },\n\n        /**\n         * Gets the scroll of the element\n         *\n         * @method scroll\n         * @param {DOMElement|String} [elm] Target element or document.body\n         * @returns {Array} offset values for x and y scroll\n         * @sample Ink_Dom_Element_1_scroll.html\n         */\n        scroll: function(elm) {\n            elm = elm ? Ink.i(elm) : document.body;\n            return [\n                ( ( !window.pageXOffset ) ? elm.scrollLeft : window.pageXOffset ),\n                ( ( !window.pageYOffset ) ? elm.scrollTop : window.pageYOffset )\n            ];\n        },\n\n        _getPropPx: function(cs, prop) {\n            var n, c;\n            var val = cs.getPropertyValue ? cs.getPropertyValue(prop) : cs[prop];\n            if (!val) { n = 0; }\n            else {\n                c = val.indexOf('px');\n                if (c === -1) { n = 0; }\n                else {\n                    n = parseFloat(val, 10);\n                }\n            }\n\n            //console.log([prop, ' \"', val, '\" ', n].join(''));\n\n            return n;\n        },\n\n        /**\n         * Alias for offset()\n         *\n         * @method offset2\n         * @deprecated Kept for historic reasons. Use offset() instead.\n         */\n        offset2: function(el) {\n            return InkElement.offset(el);\n        },\n\n        /**\n         * Checks if an element has an attribute\n         *\n         * @method hasAttribute\n         * @param {Object} elm   Target element\n         * @param {String} attr  Attribute name\n         * @return {Boolean} Boolean based on existance of attribute\n         * @sample Ink_Dom_Element_1_hasAttribute.html\n         */\n        hasAttribute: function(elm, attr){\n            elm = Ink.i(elm);\n            return elm.hasAttribute ? elm.hasAttribute(attr) : !!elm.getAttribute(attr);\n        },\n        /**\n         * Inserts an element right after another\n         *\n         * @method insertAfter\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertAfter.html\n         */\n        insertAfter: function(newElm, targetElm) {\n            /*jshint boss:true */\n            if (targetElm = InkElement.get(targetElm)) {\n                if (targetElm.nextSibling !== null) {\n                    targetElm.parentNode.insertBefore(newElm, targetElm.nextSibling);\n                } else {\n                    targetElm.parentNode.appendChild(newElm);\n                }\n            }\n        },\n\n        /**\n         * Inserts an element before another\n         *\n         * @method insertBefore\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertBefore.html\n         */\n        insertBefore: function (newElm, targetElm) {\n            /*jshint boss:true */\n            if ( (targetElm = InkElement.get(targetElm)) ) {\n                targetElm.parentNode.insertBefore(newElm, targetElm);\n            }\n        },\n\n        /**\n         * Inserts an element as the first child of another\n         *\n         * @method insertTop\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertTop.html\n         */\n        insertTop: function(newElm,targetElm) {\n            /*jshint boss:true */\n            if (targetElm = InkElement.get(targetElm)) {\n                if (targetElm.firstChild) {\n                    targetElm.insertBefore(newElm, targetElm.firstChild);\n                } else {\n                    targetElm.appendChild(newElm);\n                }\n            }\n        },\n\n        /**\n         * Inserts an element as the last child of another\n         *\n         * @method insertBottom\n         * @param {DOMElement}         newElm     Element to be inserted\n         * @param {DOMElement|String}  targetElm  Key element\n         * @sample Ink_Dom_Element_1_insertBottom.html\n         */\n        insertBottom: function(newElm, targetElm) {\n            /*jshint boss:true */\n            targetElm = Ink.i(targetElm);\n            targetElm.appendChild(newElm);\n        },\n\n        /**\n         * Retrieves textContent from node\n         *\n         * @method textContent\n         * @param {DOMNode} node Where to retreive text from. Can be any node type.\n         * @return {String} the text\n         * @sample Ink_Dom_Element_1_textContent.html\n         */\n        textContent: function(node){\n            node = Ink.i(node);\n            var text, k, cs, m;\n\n            switch(node && node.nodeType) {\n            case 9: /*DOCUMENT_NODE*/\n                // IE quirks mode does not have documentElement\n                return InkElement.textContent(node.documentElement || node.body && node.body.parentNode || node.body);\n\n            case 1: /*ELEMENT_NODE*/\n                text = node.innerText;\n                if (typeof text !== 'undefined') {\n                    return text;\n                }\n                /* falls through */\n            case 11: /*DOCUMENT_FRAGMENT_NODE*/\n                text = node.textContent;\n                if (typeof text !== 'undefined') {\n                    return text;\n                }\n\n                if (node.firstChild === node.lastChild) {\n                    // Common case: 0 or 1 children\n                    return InkElement.textContent(node.firstChild);\n                }\n\n                text = [];\n                cs = node.childNodes;\n                for (k = 0, m = cs.length; k < m; ++k) {\n                    text.push( InkElement.textContent( cs[k] ) );\n                }\n                return text.join('');\n\n            case 3: /*TEXT_NODE*/\n            case 4: /*CDATA_SECTION_NODE*/\n                return node.nodeValue;\n            }\n            return '';\n        },\n\n        /**\n         * Replaces text content of a DOM Node\n         * This method removes any child node previously present\n         *\n         * @method setTextContent\n         * @param {DOMNode} node    node Target node where the text will be added.\n         * @param {String}  text    text Text to be added on the node.\n         * @sample Ink_Dom_Element_1_setTextContent.html\n         */\n        setTextContent: function(node, text){\n            node = Ink.i(node);\n            switch(node && node.nodeType)\n            {\n            case 1: /*ELEMENT_NODE*/\n                if ('innerText' in node) {\n                    node.innerText = text;\n                    break;\n                }\n                /* falls through */\n            case 11: /*DOCUMENT_FRAGMENT_NODE*/\n                if ('textContent' in node) {\n                    node.textContent = text;\n                    break;\n                }\n                /* falls through */\n            case 9: /*DOCUMENT_NODE*/\n                while(node.firstChild) {\n                    node.removeChild(node.firstChild);\n                }\n                if (text !== '') {\n                    var doc = node.ownerDocument || node;\n                    node.appendChild(doc.createTextNode(text));\n                }\n                break;\n\n            case 3: /*TEXT_NODE*/\n            case 4: /*CDATA_SECTION_NODE*/\n                node.nodeValue = text;\n                break;\n            }\n        },\n\n        /**\n         * Checks if an element is a link\n         *\n         * @method isLink\n         * @param {DOMNode} node    Node to check if it's link\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isLink.html\n         */\n        isLink: function(element){\n            var b = element && element.nodeType === 1 && ((/^a|area$/i).test(element.tagName) ||\n                element.hasAttributeNS && element.hasAttributeNS('http://www.w3.org/1999/xlink','href'));\n            return !!b;\n        },\n\n        /**\n         * Checks if a node is an ancestor of another\n         *\n         * @method isAncestorOf\n         * @param {DOMNode} ancestor  Ancestor node\n         * @param {DOMNode} node      Descendant node\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isAncestorOf.html\n         */\n        isAncestorOf: function(ancestor, node){\n            /*jshint boss:true */\n            if (!node || !ancestor) {\n                return false;\n            }\n            if (node.compareDocumentPosition) {\n                return (ancestor.compareDocumentPosition(node) & 0x10) !== 0;/*Node.DOCUMENT_POSITION_CONTAINED_BY*/\n            }\n            while (node = node.parentNode){\n                if (node === ancestor){\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Checks if a node is descendant of another\n         *\n         * @method descendantOf\n         * @param {DOMNode} node        The ancestor\n         * @param {DOMNode} descendant  The descendant\n         * @return {Boolean} true if 'descendant' is descendant of 'node'\n         * @sample Ink_Dom_Element_1_descendantOf.html\n         */\n        descendantOf: function(node, descendant){\n            return node !== descendant && InkElement.isAncestorOf(node, descendant);\n        },\n\n        /**\n         * Get first child element of another\n         * @method firstElementChild\n         * @param {DOMElement} elm Parent node\n         * @return {DOMElement} the Element child\n         * @sample Ink_Dom_Element_1_firstElementChild.html\n         */\n        firstElementChild: function(elm){\n            if(!elm) {\n                return null;\n            }\n            if ('firstElementChild' in elm) {\n                return elm.firstElementChild;\n            }\n            var child = elm.firstChild;\n            while(child && child.nodeType !== 1) {\n                child = child.nextSibling;\n            }\n            return child;\n        },\n\n        /**\n         * Get the last child element of another\n         * @method lastElementChild\n         * @param {DOMElement} elm Parent node\n         * @return {DOMElement} the Element child\n         * @sample Ink_Dom_Element_1_lastElementChild.html\n         */\n        lastElementChild: function(elm){\n            if(!elm) {\n                return null;\n            }\n            if ('lastElementChild' in elm) {\n                return elm.lastElementChild;\n            }\n            var child = elm.lastChild;\n            while(child && child.nodeType !== 1) {\n                child = child.previousSibling;\n            }\n            return child;\n        },\n\n        /**\n         * Get the first sibling element after the node\n         *\n         * @method nextElementSibling\n         * @param {DOMNode} node  The current node\n         * @return {DOMElement|Null} The first sibling element after node or null if none is found\n         * @sample Ink_Dom_Element_1_nextElementSibling.html \n         */\n        nextElementSibling: function(node){\n            var sibling = null;\n\n            if(!node){ return sibling; }\n\n            if(\"nextElementSibling\" in node){\n                return node.nextElementSibling;\n            } else {\n                sibling = node.nextSibling;\n\n                // 1 === Node.ELEMENT_NODE\n                while(sibling && sibling.nodeType !== 1){\n                    sibling = sibling.nextSibling;\n                }\n\n                return sibling;\n            }\n        },\n\n        /**\n         * Get the first sibling element before the node\n         *\n         * @method previousElementSibling\n         * @param {DOMNode}        node The current node\n         * @return {DOMElement|Null} The first element sibling before node or null if none is found\n         * @sample Ink_Dom_Element_1_previousElementSibling.html \n         */\n        previousElementSibling: function(node){\n            var sibling = null;\n\n            if(!node){ return sibling; }\n\n            if(\"previousElementSibling\" in node){\n                return node.previousElementSibling;\n            } else {\n                sibling = node.previousSibling;\n\n                // 1 === Node.ELEMENT_NODE\n                while(sibling && sibling.nodeType !== 1){\n                    sibling = sibling.previousSibling;\n                }\n\n                return sibling;\n            }\n        },\n\n        /**\n         * Get an element's width in pixels.\n         *\n         * @method elementWidth\n         * @param {DOMElement|String} element Target DOM element or target ID\n         * @return {Number} The element's width\n         * @sample Ink_Dom_Element_1_elementWidth.html \n         */\n        elementWidth: function(element) {\n            if(typeof element === \"string\") {\n                element = document.getElementById(element);\n            }\n            return element.offsetWidth;\n        },\n\n        /**\n         * Get an element's height in pixels.\n         *\n         * @method elementHeight\n         * @param {DOMElement|String} element DOM element or target ID\n         * @return {Number} The element's height\n         * @sample Ink_Dom_Element_1_elementHeight.html \n         */\n        elementHeight: function(element) {\n            if(typeof element === \"string\") {\n                element = document.getElementById(element);\n            }\n            return element.offsetHeight;\n        },\n\n        /**\n         * Deprecated. Alias for offsetLeft()\n         *\n         * @method elementLeft\n         * @param {DOMElement|String}       element     DOM element or target ID\n         * @return {Number} Element's left position\n         */\n        elementLeft: function(element) {\n            return InkElement.offsetLeft(element);\n        },\n\n        /**\n         * Deprecated. Alias for offsetTop()\n         *\n         * @method elementTop\n         * @param {DOMElement|string}   element     Target DOM element or target ID\n         * @return {Number} element's top position\n         */\n        elementTop: function(element) {\n            return InkElement.offsetTop(element);\n        },\n\n        /**\n         * Get an element's dimensions in pixels.\n         *\n         * @method elementDimensions\n         * @param {DOMElement|string}   element     DOM element or target ID\n         * @return {Array} Array with element's width and height\n         * @sample Ink_Dom_Element_1_elementDimensions.html \n         */\n        elementDimensions: function(element) {\n            element = Ink.i(element);\n            return [element.offsetWidth, element.offsetHeight];\n        },\n\n        /**\n         * Get the outer dimensions of an element in pixels.\n         *\n         * @method outerDimensions\n         * @uses Ink.Dom.Css\n         *\n         * @param {DOMElement} element Target element\n         * @return {Array} Array with element width and height.\n         * @sample Ink_Dom_Element_1_outerDimensions.html \n         */\n        outerDimensions: function (element) {\n            var bbox = rect(element);\n\n            var Css = Ink.getModule('Ink.Dom.Css_1');\n            var getStyle = Ink.bindMethod(Css, 'getStyle', element);\n\n            return [\n                bbox.right - bbox.left + parseFloat(getStyle('marginLeft') || 0) + parseFloat(getStyle('marginRight') || 0),  // w\n                bbox.bottom - bbox.top + parseFloat(getStyle('marginTop') || 0) + parseFloat(getStyle('marginBottom') || 0)  // h\n            ];\n        },\n\n        /**\n         * Check if an element is inside the viewport\n         *\n         * @method inViewport\n         * @param {DOMElement} element DOM Element\n         * @param {Object}  [options]  Options object. If you pass a Boolean value here, it is interpreted as `options.partial`\n         * @param {Boolean} [options.partial]=false    Return `true` even if it is only partially visible.\n         * @param {Number}  [options.margin]=0         Consider a margin all around the viewport with `opts.margin` width a dead zone.\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_inViewport.html \n         */\n        inViewport: function (element, opts) {\n            var dims = rect(Ink.i(element));\n            if (typeof opts === 'boolean') {\n                opts = {partial: opts, margin: 0};\n            }\n            opts = Ink.extendObj({ partial: false, margin: 0}, opts || {});\n            if (opts.partial) {\n                return  dims.bottom + opts.margin > 0                           && // from the top\n                        dims.left   - opts.margin < InkElement.viewportWidth()  && // from the right\n                        dims.top    - opts.margin < InkElement.viewportHeight() && // from the bottom\n                        dims.right  + opts.margin > 0;                             // from the left\n            } else {\n                return  dims.top    + opts.margin > 0                           && // from the top\n                        dims.right  - opts.margin < InkElement.viewportWidth()  && // from the right\n                        dims.bottom - opts.margin < InkElement.viewportHeight() && // from the bottom\n                        dims.left   + opts.margin > 0;                             // from the left\n            }\n        },\n\n        /**\n         * Check if an element is hidden.\n         * Taken from Mootools Element extras ( https://gist.github.com/cheeaun/73342 )\n         * Does not take into account visibility:hidden\n         * @method isHidden\n         * @param {DOMElement} element Element to check\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isHidden.html \n         */\n\n        isHidden: function (element) {\n            var w = element.offsetWidth, \n                h = element.offsetHeight,\n                force = (element.tagName.toLowerCase() === 'tr');\n\n            var Css = Ink.getModule('Ink.Dom.Css_1');\n\n            return (w===0 && h===0 && !force) ? true :\n                (w!==0 && h!==0 && !force) ? false :\n                Css.getStyle(element, 'display').toLowerCase() === 'none';\n         },\n\n        /**\n         * Check if an element is visible \n         *\n         * @method isVisible\n         * @uses isHidden\n         * @param {DOMElement} element Element to check\n         * @return {Boolean}\n         * @sample Ink_Dom_Element_1_isVisible.html \n         */\n\n        isVisible: function (element) {\n            return !this.isHidden(element);\n        },\n\n        /**\n         * Clones an element's position to another\n         *\n         * @method clonePosition\n         * @param {DOMElement} cloneTo    element to be position cloned\n         * @param {DOMElement} cloneFrom  element to get the cloned position\n         * @return {DOMElement} The element with positionClone\n         * @sample Ink_Dom_Element_1_clonePosition.html \n         */\n        clonePosition: function(cloneTo, cloneFrom){\n            var pos = InkElement.offset(cloneFrom);\n            cloneTo.style.left = pos[0]+'px';\n            cloneTo.style.top = pos[1]+'px';\n\n            return cloneTo;\n        },\n\n        /**\n         * Text-overflow: ellipsis emulation\n         * Slices off a piece of text at the end of the element and adds the ellipsis so all text fits inside.\n         *\n         * @method ellipsizeText\n         * @param {DOMElement} element              Element to modify text content\n         * @param {String}     [ellipsis]='\\u2026'  String to append to the chopped text\n         */\n        ellipsizeText: function(element/*, ellipsis*/){\n            if ((element = Ink.i(element))) {\n                element.style.overflow = 'hidden';\n                element.style.whiteSpace = 'nowrap';\n                element.style.textOverflow = 'ellipsis';\n            }\n        },\n\n        /**\n         * Finds the closest ancestor element matching your test function\n         * \n         *\n         * @method findUpwardsHaving\n         * @param {DOMElement} element     Element to base the search from\n         * @param {Function}    boolTest   Testing function\n         * @return {DOMElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsHaving.html \n         */\n        findUpwardsHaving: function(element, boolTest) {\n            while (element && element.nodeType === 1) {\n                if (boolTest(element)) {\n                    return element;\n                }\n                element = element.parentNode;\n            }\n            return false;\n        },\n\n        /**\n         * Finds the closest ancestor by class name\n         *\n         * @method findUpwardsByClass\n         * @uses findUpwardsHaving\n         * @param {DOMElement} element      Element to base the search from\n         * @param {String}      className   Class name to search\n         * @returns {DOMElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsByClass.html \n         */\n        findUpwardsByClass: function(element, className) {\n            var re = new RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\n            var tst = function(el) {\n                var cls = el.className;\n                return cls && re.test(cls);\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by tag name\n         *\n         * @method findUpwardsByTag\n         * @param {DOMElement} element  Element to base the search from\n         * @param {String}      tag     Tag to search\n         * @returns {DOMElement|false} the matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsByTag.html \n         */\n        findUpwardsByTag: function(element, tag) {\n            tag = tag.toUpperCase();\n            var tst = function(el) {\n                return el.nodeName && el.nodeName.toUpperCase() === tag;\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by id\n         *\n         * @method findUpwardsById\n         * @param {HtmlElement} element     Element to base the search from\n         * @param {String}      id          ID to search\n         * @returns {HtmlElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsById.html \n         */\n        findUpwardsById: function(element, id) {\n            var tst = function(el) {\n                return el.id === id;\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Finds the closest ancestor by CSS selector\n         *\n         * @method findUpwardsBySelector\n         * @param {HtmlElement} element     Element to base the search from\n         * @param {String}      sel         CSS selector\n         * @returns {HtmlElement|false} The matched element or false if did not match\n         * @sample Ink_Dom_Element_1_findUpwardsBySelector.html \n         */\n        findUpwardsBySelector: function(element, sel) {\n            var Selector = Ink.getModule('Ink.Dom.Selector', '1');\n            if (!Selector) {\n                throw new Error('This method requires Ink.Dom.Selector');\n            }\n            var tst = function(el) {\n                return Selector.matchesSelector(el, sel);\n            };\n            return InkElement.findUpwardsHaving(element, tst);\n        },\n\n        /**\n         * Gets the trimmed text of an element\n         *\n         * @method getChildrenText\n         * @param {DOMElement}  el          Element to base the search from\n         * @param {Boolean}     [removeIt]  Flag to remove the text from the element\n         * @return {String} Text found\n         * @sample Ink_Dom_Element_1_getChildrenText.html \n         */\n        getChildrenText: function(el, removeIt) {\n            var node,\n                j,\n                part,\n                nodes = el.childNodes,\n                jLen = nodes.length,\n                text = '';\n\n            if (!el) {\n                return text;\n            }\n\n            for (j = 0; j < jLen; ++j) {\n                node = nodes[j];\n                if (!node) {    continue;   }\n                if (node.nodeType === 3) {  // TEXT NODE\n                    part = InkElement._trimString( String(node.data) );\n                    if (part.length > 0) {\n                        text += part;\n                        if (removeIt) { el.removeChild(node);   }\n                    }\n                    else {  el.removeChild(node);   }\n                }\n            }\n\n            return text;\n        },\n\n        /**\n         * String trim implementation\n         * Used by getChildrenText\n         *\n         * function _trimString\n         * param {String} text\n         * return {String} trimmed text\n         */\n        _trimString: function(text) {\n            return (String.prototype.trim) ? text.trim() : text.replace(/^\\s*/, '').replace(/\\s*$/, '');\n        },\n\n        /**\n         * Gets value of a select element\n         *\n         * @method getSelectValues\n         * @param {DOMElement|String} select element\n         * @return {Array} The selected values\n         * @sample Ink_Dom_Element_1_getSelectValues.html \n         */\n        getSelectValues: function (select) {\n            var selectEl = Ink.i(select);\n            var values = [];\n            for (var i = 0; i < selectEl.options.length; ++i) {\n                values.push( selectEl.options[i].value );\n            }\n            return values;\n        },\n\n\n        /* used by fills */\n        _normalizeData: function(data) {\n            var d, data2 = [];\n            for (var i = 0, f = data.length; i < f; ++i) {\n                d = data[i];\n\n                if (!(d instanceof Array)) {    // if not array, wraps primitive twice:     val -> [val, val]\n                    d = [d, d];\n                }\n                else if (d.length === 1) {      // if 1 element array:                      [val] -> [val, val]\n                    d.push(d[0]);\n                }\n                data2.push(d);\n            }\n            return data2;\n        },\n\n\n        /**\n         * Fills a select element with options\n         *\n         * @method fillSelect\n         * @param {DOMElement|String}  container       Select element which will get filled\n         * @param {Array}              data            Data to populate the component\n         * @param {Boolean}            [skipEmpty]     Flag to skip empty option\n         * @param {String|Number}      [defaultValue]  Initial selected value\n         *\n         * @sample Ink_Dom_Element_1_fillSelect.html \n         */\n        fillSelect: function(container, data, skipEmpty, defaultValue) {\n            var containerEl = Ink.i(container);\n            if (!containerEl) {   return; }\n\n            containerEl.innerHTML = '';\n            var d, optionEl;\n\n            if (!skipEmpty) {\n                // add initial empty option\n                optionEl = document.createElement('option');\n                optionEl.setAttribute('value', '');\n                containerEl.appendChild(optionEl);\n            }\n\n            data = InkElement._normalizeData(data);\n\n            for (var i = 0, f = data.length; i < f; ++i) {\n                d = data[i];\n\n                optionEl = document.createElement('option');\n                optionEl.setAttribute('value', d[0]);\n                if (d.length > 2) {\n                    optionEl.setAttribute('extra', d[2]);\n                }\n                optionEl.appendChild( document.createTextNode(d[1]) );\n\n                if (d[0] === defaultValue) {\n                    optionEl.setAttribute('selected', 'selected');\n                }\n\n                containerEl.appendChild(optionEl);\n            }\n        },\n\n\n        /**\n         * Creates a set of radio buttons from an array of data\n         *\n         * @method fillRadios\n         * @param {DOMElement|String}  insertAfterEl    Element after which the input elements will be created\n         * @param {String}             name             Name for the form field ([] is added if not present as a suffix)\n         * @param {Array}              data             Data to populate the component\n         * @param {Boolean}            [skipEmpty]      Flag to skip creation of empty options\n         * @param {String|Number}      [defaultValue]   Initial selected value\n         * @param {String}             [splitEl]        Name of element to add after each input element (example: 'br')\n         * @return {DOMElement} Wrapper element around the radio buttons\n         */\n        fillRadios: function(insertAfterEl, name, data, skipEmpty, defaultValue, splitEl) {\n            insertAfterEl = Ink.i(insertAfterEl);\n            var containerEl = document.createElement('span');\n            InkElement.insertAfter(containerEl, insertAfterEl);\n\n            data = InkElement._normalizeData(data);\n\n            /*\n            if (name.substring(name.length - 1) !== ']') {\n                name += '[]';\n            }\n            */\n\n            var d, inputEl;\n\n            if (!skipEmpty) {\n                // add initial empty option\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'radio');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', '');\n                containerEl.appendChild(inputEl);\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n            }\n\n            for (var i = 0; i < data.length; ++i) {\n                d = data[i];\n\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'radio');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', d[0]);\n                containerEl.appendChild(inputEl);\n                containerEl.appendChild( document.createTextNode(d[1]) );\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n\n                if (d[0] === defaultValue) {\n                    inputEl.checked = true;\n                }\n            }\n\n            return containerEl;\n        },\n\n\n        /**\n         * Creates set of checkbox buttons\n         *\n         * @method fillChecks\n         * @param {DOMElement|String}  insertAfterEl   Element after which the input elements will be created\n         * @param {String}             name            Name for the form field ([] is added if not present as a suffix)\n         * @param {Array}              data            Data to populate the component\n         * @param {Boolean}            [skipEmpty]     Flag to skip creation of empty options\n         * @param {String|Number}      [defaultValue]  Initial selected value\n         * @param {String}             [splitEl]       Name of element to add after each input element (example: 'br')\n         * @return {DOMElement} Wrapper element around the checkboxes\n         */\n        fillChecks: function(insertAfterEl, name, data, defaultValue, splitEl) {\n            insertAfterEl = Ink.i(insertAfterEl);\n            var containerEl = document.createElement('span');\n            InkElement.insertAfter(containerEl, insertAfterEl);\n\n            data = InkElement._normalizeData(data);\n\n            if (name.substring(name.length - 1) !== ']') {\n                name += '[]';\n            }\n\n            var d, inputEl;\n\n            for (var i = 0; i < data.length; ++i) {\n                d = data[i];\n\n                inputEl = document.createElement('input');\n                inputEl.setAttribute('type', 'checkbox');\n                inputEl.setAttribute('name', name);\n                inputEl.setAttribute('value', d[0]);\n                containerEl.appendChild(inputEl);\n                containerEl.appendChild( document.createTextNode(d[1]) );\n                if (splitEl) {  containerEl.appendChild( document.createElement(splitEl) ); }\n\n                if (d[0] === defaultValue) {\n                    inputEl.checked = true;\n                }\n            }\n\n            return containerEl;\n        },\n\n\n        /**\n         * Gets the index of an element relative to a parent\n         *\n         * @method parentIndexOf\n         * @param {DOMElement}  parentEl  Element to parse\n         * @param {DOMElement}  childEl   Child Element to look for\n         * @return {Number} The index of the childEl inside parentEl. Returns -1 if it's not a direct child\n         * @sample Ink_Dom_Element_1_parentIndexOf.html \n         */\n        parentIndexOf: function(parentEl, childEl) {\n            var node, idx = 0;\n            for (var i = 0, f = parentEl.childNodes.length; i < f; ++i) {\n                node = parentEl.childNodes[i];\n                if (node.nodeType === 1) {  // ELEMENT\n                    if (node === childEl) { return idx; }\n                    ++idx;\n                }\n            }\n            return -1;\n        },\n\n\n        /**\n         * Gets the next siblings of an element\n         *\n         * @method nextSiblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of next sibling elements\n         * @sample Ink_Dom_Element_1_nextSiblings.html \n         */\n        nextSiblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements = [],\n                    siblings = elm.parentNode.children,\n                    index    = InkElement.parentIndexOf(elm.parentNode, elm);\n\n                for(var i = ++index, len = siblings.length; i<len; i++) {\n                    elements.push(siblings[i]);\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n\n        /**\n         * Gets the previous siblings of an element\n         *\n         * @method previousSiblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of previous sibling elements\n         * @sample Ink_Dom_Element_1_previousSiblings.html \n         */\n        previousSiblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements    = [],\n                    siblings    = elm.parentNode.children,\n                    index       = InkElement.parentIndexOf(elm.parentNode, elm);\n\n                for(var i = 0, len = index; i<len; i++) {\n                    elements.push(siblings[i]);\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n\n        /**\n         * Gets the all siblings of an element\n         *\n         * @method siblings\n         * @param {String|DOMElement} elm Element\n         * @return {Array} Array of sibling elements\n         * @sample Ink_Dom_Element_1_siblings.html \n         */\n        siblings: function(elm) {\n            elm = Ink.i(elm);\n            if(typeof(elm) === 'object' && elm !== null && elm.nodeType && elm.nodeType === 1) {\n                var elements   = [],\n                    siblings   = elm.parentNode.children;\n\n                for(var i = 0, len = siblings.length; i<len; i++) {\n                    if(elm !== siblings[i]) {\n                        elements.push(siblings[i]);\n                    }\n                }\n\n                return elements;\n            }\n            return [];\n        },\n\n        /**\n         * Counts the number of children of an element\n         *\n         * @method childElementCount\n         * @param {String|DOMElement} elm element\n         * @return {Number} number of child elements\n         * @sample Ink_Dom_Element_1_childElementCount.html \n         */\n        childElementCount: function(elm) {\n            elm = Ink.i(elm);\n            if ('childElementCount' in elm) {\n                return elm.childElementCount;\n            }\n            if (!elm) { return 0; }\n            return InkElement.siblings(elm).length + 1;\n        },\n\n        _wrapElements: {\n            TABLE: function (div, html) {\n                /* If we don't create a tbody, IE7 does that for us. Adding a tbody with a random string and then filtering for that random string is the only way to avoid double insertion of tbodies. */\n                if (browserCreatesTbodies) {\n                    div.innerHTML = \"<table>\" + html + \"<tbody><tr><td>\" + deleteThisTbodyToken + \"</tr></td></tbody></table>\";\n                } else {\n                    div.innerHTML = \"<table>\" + html + \"</table>\";\n                }\n                return div.firstChild;\n            },\n            TBODY: function (div, html) {\n                div.innerHTML = '<table><tbody>' + html + '</tbody></table>';\n                return div.firstChild.getElementsByTagName('tbody')[0];\n            },\n            THEAD: function (div, html) {\n                div.innerHTML = '<table><thead>' + html + '</thead><tbody></tbody></table>';\n                return div.firstChild.getElementsByTagName('thead')[0];\n            },\n            TFOOT: function (div, html) {\n                div.innerHTML = '<table><tfoot>' + html + '</tfoot><tbody></tbody></table>';\n                return div.firstChild.getElementsByTagName('tfoot')[0];\n            },\n            TR: function (div, html) {\n                div.innerHTML = '<table><tbody><tr>' + html + '</tr></tbody></table>';\n                return div.firstChild.firstChild.firstChild;\n            }\n        },\n\n        /**\n         * Gets a wrapper DIV with a certain HTML content to be inserted inside another element.\n         * This is necessary for appendHTML,prependHTML functions, because they need a container element to copy the children from.\n         *\n         * Works around IE table quirks\n         * @method _getWrapper\n         * @private\n         * @param elm\n         * @param html\n         */\n        _getWrapper: function (elm, html) {\n            var nodeName = elm.nodeName && elm.nodeName.toUpperCase();\n            var wrapper = document.createElement('div');\n            var wrapFunc = InkElement._wrapElements[nodeName];\n\n            if ( !wrapFunc ) {\n                wrapper.innerHTML = html;\n                return wrapper;\n            }\n            // special cases\n            wrapper = wrapFunc(wrapper, html);\n            // worst case: tbody auto-creation even when our HTML has a tbody.\n            if (browserCreatesTbodies && nodeName === 'TABLE') {\n                // terrible case. Deal with tbody creation too.\n                var tds = wrapper.getElementsByTagName('td');\n                for (var i = 0, len = tds.length; i < len; i++) {\n                    if (tds[i].innerHTML === deleteThisTbodyToken) {\n                        var tbody = tds[i].parentNode.parentNode;\n                        tbody.parentNode.removeChild(tbody);\n                    }\n                }\n            }\n            return wrapper;\n        },\n\n        /**\n         * Appends HTML to an element.\n         * This method parses the html string and doesn't modify its contents\n         *\n         * @method appendHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_appendHTML.html \n         */\n        appendHTML: function(elm, html){\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                var wrapper = InkElement._getWrapper(elm, html);\n                while (wrapper.firstChild) {\n                    elm.appendChild(wrapper.firstChild);\n                }\n            }\n        },\n\n        /**\n         * Prepends HTML to an element.\n         * This method parses the html string and doesn't modify its contents\n         *\n         * @method prependHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_prependHTML.html \n         */\n        prependHTML: function(elm, html){\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                var wrapper = InkElement._getWrapper(elm, html);\n                while (wrapper.lastChild) {\n                    elm.insertBefore(wrapper.lastChild, elm.firstChild);\n                }\n            }\n        },\n\n        /**\n         * Sets the inner HTML of an element.\n         *\n         * @method setHTML\n         * @param {String|DOMElement} elm   Element\n         * @param {String}            html  Markup string\n         * @sample Ink_Dom_Element_1_setHTML.html \n         */\n        setHTML: function (elm, html) {\n            elm = Ink.i(elm);\n            if(elm !== null) {\n                try {\n                    elm.innerHTML = html;\n                } catch (e) {\n                    // Tables in IE7\n                    while (elm.firstChild) {\n                        elm.removeChild(elm.firstChild);\n                    }\n                    InkElement.appendHTML(elm, html);\n                }\n            }\n        },\n\n        /**\n         * Wraps an element inside a container.\n         *\n         * The container may or may not be in the document yet.\n         *\n         * @method wrap\n         * @param {String|DOMElement}   target      Element to be wrapped\n         * @param {String|DOMElement}   container   Element to wrap the target\n         * @return Container element\n         * @sample Ink_Dom_Element_1_wrap.html \n         *\n         * @example\n         * before:\n         *\n         *     <div id=\"target\"></div>\n         *\n         * call this function to wrap #target with a wrapper div.\n         *\n         *     InkElement.wrap('target', InkElement.create('div', {id: 'container'});\n         * \n         * after: \n         *\n         *     <div id=\"container\"><div id=\"target\"></div></div>\n         */\n        wrap: function (target, container) {\n            target = Ink.i(target);\n            container = Ink.i(container);\n            \n            var nextNode = target.nextSibling;\n            var parent = target.parentNode;\n\n            container.appendChild(target);\n\n            if (nextNode !== null) {\n                parent.insertBefore(container, nextNode);\n            } else {\n                parent.appendChild(container);\n            }\n\n            return container;\n        },\n\n        /**\n         * Places an element outside a wrapper.\n         *\n         * @method unwrap\n         * @param {DOMElement}  elem                The element you're trying to unwrap. This should be an ancestor of the wrapper.\n         * @param {String}      [wrapperSelector]   CSS Selector for the ancestor. Use this if your wrapper is not the direct parent of elem.\n         * @sample Ink_Dom_Element_1_unwrap.html \n         *\n         * @example\n         *\n         * When you have this:\n         *\n         *      <div id=\"wrapper\">\n         *          <div id=\"unwrapMe\"></div>\n         *      </div>\n         *\n         * If you do this:\n         *\n         *      InkElement.unwrap('unwrapMe');\n         *\n         * You get this:\n         *\n         *      <div id=\"unwrapMe\"></div>\n         *      <div id=\"wrapper\"></div>\n         *      \n         **/\n        unwrap: function (elem, wrapperSelector) {\n            elem = Ink.i(elem);\n            var wrapper;\n            if (typeof wrapperSelector === 'string') {\n                wrapper = InkElement.findUpwardsBySelector(elem, wrapperSelector);\n            } else if (typeof wrapperSelector === 'object' && wrapperSelector.tagName) {\n                wrapper = InkElement.findUpwardsHaving(elem, function (ancestor) {\n                    return ancestor === wrapperSelector;\n                });\n            } else {\n                wrapper = elem.parentNode;\n            }\n            if (!wrapper || !wrapper.parentNode) { return; }\n\n            InkElement.insertBefore(elem, wrapper);\n        },\n\n        /**\n         * Replaces an element with another.\n         *\n         * @method replace\n         * @param element       The element to be replaced.\n         * @param replacement   The new element.\n         * @sample Ink_Dom_Element_1_replace.html \n         *\n         * @example\n         *       var newelement1 = InkElement.create('div');\n         *       // ...\n         *       replace(Ink.i('element1'), newelement1);\n         */\n        replace: function (element, replacement) {\n            element = Ink.i(element);\n            if(element !== null) {\n                element.parentNode.replaceChild(replacement, element);\n            }\n        },\n\n        /**\n         * Removes direct text children.\n         * Useful to remove nasty layout gaps generated by whitespace on the markup.\n         *\n         * @method removeTextNodeChildren\n         * @param  {DOMElement} el          Element to remove text from\n         * @sample Ink_Dom_Element_1_removeTextNodeChildren.html \n         */\n        removeTextNodeChildren: function(el) {\n            el = Ink.i(el);\n            if(el !== null) {\n                var prevEl, toRemove, parent = el;\n                el = el.firstChild;\n                while (el) {\n                    toRemove = (el.nodeType === 3);\n                    prevEl = el;\n                    el = el.nextSibling;\n                    if (toRemove) {\n                        parent.removeChild(prevEl);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Creates a documentFragment from an HTML string.\n         *\n         * @method htmlToFragment\n         * @param  {String} html  HTML string\n         * @return {DocumentFragment} DocumentFragment containing all of the elements from the html string\n         * @sample Ink_Dom_Element_1_htmlToFragment.html \n         */\n        htmlToFragment: (createContextualFragmentSupport ?\n            function(html){\n                var range;\n\n                if(typeof html !== 'string'){ return document.createDocumentFragment(); }\n\n                range = document.createRange();\n\n                // set the context to document.body (firefox does this already, webkit doesn't)\n                range.selectNode(document.body);\n\n                return range.createContextualFragment(html);\n            } : function (html) {\n                var fragment = document.createDocumentFragment(),\n                    tempElement,\n                    current;\n\n                if(typeof html !== 'string'){ return fragment; }\n\n                tempElement = document.createElement('div');\n                tempElement.innerHTML = html;\n\n                // append child removes elements from the original parent\n                while( (current = tempElement.firstChild) ){ // intentional assignment\n                    fragment.appendChild(current);\n                }\n\n                return fragment;\n            }),\n\n        _camelCase: function(str)\n        {\n            return str ? str.replace(/-(\\w)/g, function (_, $1){\n                return $1.toUpperCase();\n            }) : str;\n        },\n\n        /**\n         * Gets data attributes from an element\n         *\n         * @method data\n         * @param {String|DOMElement} selector Element or CSS selector\n         * @return {Object} Object with the data-* properties. If no data-attributes are present, an empty object is returned.\n         * @sample Ink_Dom_Element_1_data.html \n        */\n        data: function(selector) {\n            var el;\n            if (typeof selector !== 'object' && typeof selector !== 'string') {\n                throw '[Ink.Dom.Element.data] :: Invalid selector defined';\n            }\n\n            if (typeof selector === 'object') {\n                el = selector;\n            }\n            else {\n                var InkDomSelector = Ink.getModule('Ink.Dom.Selector', 1);\n                if (!InkDomSelector) {\n                    throw \"[Ink.Dom.Element.data] :: this method requires Ink.Dom.Selector - v1\";\n                }\n                el = InkDomSelector.select(selector);\n                if (el.length <= 0) {\n                    throw \"[Ink.Dom.Element.data] :: Can't find any element with the specified selector\";\n                }\n                el = el[0];\n            }\n\n            var dataset = {};\n            var attrs = el.attributes || [];\n\n            var curAttr, curAttrName, curAttrValue;\n            if (attrs) {\n                for (var i = 0, total = attrs.length; i < total; ++i) {\n                    curAttr = attrs[i];\n                    curAttrName = curAttr.name;\n                    curAttrValue = curAttr.value;\n                    if (curAttrName && curAttrName.indexOf('data-') === 0) {\n                        dataset[InkElement._camelCase(curAttrName.replace('data-', ''))] = curAttrValue;\n                    }\n                }\n            }\n\n            return dataset;\n        },\n\n        /**\n         * Move the cursor on an input or textarea element.\n         * @method moveCursorTo\n         * @param  {DOMElement} el  Input or Textarea element\n         * @param  {Number}     t   Index of the character to move the cursor to\n         * @sample Ink_Dom_Element_1_moveCursorTo.html \n         */\n        moveCursorTo: function(el, t) {\n            el = Ink.i(el);\n            if(el !== null) {\n                if (el.setSelectionRange) {\n                    el.setSelectionRange(t, t);\n                    //el.focus();\n                }\n                else {\n                    var range = el.createTextRange();\n                    range.collapse(true);\n                    range.moveEnd(  'character', t);\n                    range.moveStart('character', t);\n                    range.select();\n                }\n            }\n        },\n\n        /**\n         * Get the page's width.\n         * @method pageWidth\n         * @return {Number} Page width in pixels\n         * @sample Ink_Dom_Element_1_pageWidth.html \n         */\n        pageWidth: function() {\n            var xScroll;\n\n            if (window.innerWidth && window.scrollMaxX) {\n                xScroll = window.innerWidth + window.scrollMaxX;\n            } else if (document.body.scrollWidth > document.body.offsetWidth){\n                xScroll = document.body.scrollWidth;\n            } else {\n                xScroll = document.body.offsetWidth;\n            }\n\n            var windowWidth;\n\n            if (window.self.innerWidth) {\n                if(document.documentElement.clientWidth){\n                    windowWidth = document.documentElement.clientWidth;\n                } else {\n                    windowWidth = window.self.innerWidth;\n                }\n            } else if (document.documentElement && document.documentElement.clientWidth) {\n                windowWidth = document.documentElement.clientWidth;\n            } else if (document.body) {\n                windowWidth = document.body.clientWidth;\n            }\n\n            if(xScroll < windowWidth){\n                return xScroll;\n            } else {\n                return windowWidth;\n            }\n        },\n\n        /**\n         * Get the page's height.\n         * @method pageHeight\n         * @return {Number} Page height in pixels\n         * @sample Ink_Dom_Element_1_pageHeight.html \n         */\n        pageHeight: function() {\n            var yScroll;\n\n            if (window.innerHeight && window.scrollMaxY) {\n                yScroll = window.innerHeight + window.scrollMaxY;\n            } else if (document.body.scrollHeight > document.body.offsetHeight){\n                yScroll = document.body.scrollHeight;\n            } else {\n                yScroll = document.body.offsetHeight;\n            }\n\n            var windowHeight;\n\n            if (window.self.innerHeight) {\n                windowHeight = window.self.innerHeight;\n            } else if (document.documentElement && document.documentElement.clientHeight) {\n                windowHeight = document.documentElement.clientHeight;\n            } else if (document.body) {\n                windowHeight = document.body.clientHeight;\n            }\n\n            if(yScroll < windowHeight){\n                return windowHeight;\n            } else {\n                return yScroll;\n            }\n        },\n\n       /**\n         * Get the viewport's width.\n         * @method viewportWidth\n         * @return {Number} Viewport width in pixels\n         * @sample Ink_Dom_Element_1_viewportWidth.html \n         */\n        viewportWidth: function() {\n            if(typeof window.innerWidth !== \"undefined\") {\n                return window.innerWidth;\n            }\n            if (document.documentElement && typeof document.documentElement.offsetWidth !== \"undefined\") {\n                return document.documentElement.offsetWidth;\n            }\n        },\n\n        /**\n         * Get the viewport's height.\n         * @method viewportHeight\n         * @return {Number} Viewport height in pixels\n         * @sample Ink_Dom_Element_1_viewportHeight.html \n         */\n        viewportHeight: function() {\n            if (typeof window.innerHeight !== \"undefined\") {\n                return window.innerHeight;\n            }\n            if (document.documentElement && typeof document.documentElement.offsetHeight !== \"undefined\") {\n                return document.documentElement.offsetHeight;\n            }\n        },\n\n        /**\n         * Get the scroll's width.\n         * @method scrollWidth\n         * @return {Number} Scroll width\n         */\n        scrollWidth: function() {\n            if (typeof window.self.pageXOffset !== 'undefined') {\n                return window.self.pageXOffset;\n            }\n            if (typeof document.documentElement !== 'undefined' && typeof document.documentElement.scrollLeft !== 'undefined') {\n                return document.documentElement.scrollLeft;\n            }\n            return document.body.scrollLeft;\n        },\n\n        /**\n         * Get the scroll's height.\n         * @method scrollHeight\n         * @return {Number} Scroll height\n         */\n        scrollHeight: function() {\n            if (typeof window.self.pageYOffset !== 'undefined') {\n                return window.self.pageYOffset;\n            }\n            if (typeof document.documentElement !== 'undefined' && typeof document.documentElement.scrollTop !== 'undefined') {\n                return document.documentElement.scrollTop;\n            }\n            return document.body.scrollTop;\n        }\n    };\n\n    return InkElement;\n\n});\n","/**\n * Event management\n * @module Ink.Dom.Event_1\n * @version 1\n */\n\nInk.createModule('Ink.Dom.Event', 1, [], function() {\n    /* jshint\n           asi:true,\n           strict:false,\n           laxcomma:true,\n           eqeqeq:false,\n           laxbreak:true,\n           boss:true,\n           curly:false,\n           expr:true\n           */\n\n    /**\n     * @namespace Ink.Dom.Event_1\n     * @static\n     */\n\n    /*!\n      * Bean - copyright (c) Jacob Thornton 2011-2012\n      * https://github.com/fat/bean\n      * MIT license\n      */\n    var bean = (function (name, context, definition) {\n      return definition()\n    })('bean', this, function (name, context) {\n      name    = name    || 'bean'\n      context = context || this\n\n      var win            = window\n        , old            = context[name]\n        , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\n        , nameRegex      = /\\..*/\n        , addEvent       = 'addEventListener'\n        , removeEvent    = 'removeEventListener'\n        , doc            = document || {}\n        , root           = doc.documentElement || {}\n        , W3C_MODEL      = root[addEvent]\n        , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\n        , ONE            = {} // singleton for quick matching making add() do one()\n\n        , slice          = Array.prototype.slice\n        , str2arr        = function (s, d) { return s.split(d || ' ') }\n        , isString       = function (o) { return typeof o == 'string' }\n        , isFunction     = function (o) { return typeof o == 'function' }\n\n          // events that we consider to be 'native', anything not in this list will\n          // be treated as a custom event\n        , standardNativeEvents =\n            'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\n            'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\n            'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\n            'keydown keypress keyup '                                        + // keyboard\n            'orientationchange '                                             + // mobile\n            'focus blur change reset select submit '                         + // form elements\n            'load unload beforeunload resize move DOMContentLoaded '         + // window\n            'readystatechange message '                                      + // window\n            'error abort scroll '                                              // misc\n          // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\n          // that doesn't actually exist, so make sure we only do these on newer browsers\n        , w3cNativeEvents =\n            'show '                                                          + // mouse buttons\n            'input invalid '                                                 + // form elements\n            'touchstart touchmove touchend touchcancel '                     + // touch\n            'gesturestart gesturechange gestureend '                         + // gesture\n            'textinput'                                                      + // TextEvent\n            'readystatechange pageshow pagehide popstate '                   + // window\n            'hashchange offline online '                                     + // window\n            'afterprint beforeprint '                                        + // printing\n            'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\n            'loadstart progress suspend emptied stalled loadmetadata '       + // media\n            'loadeddata canplay canplaythrough playing waiting seeking '     + // media\n            'seeked ended durationchange timeupdate play pause ratechange '  + // media\n            'volumechange cuechange '                                        + // media\n            'checking noupdate downloading cached updateready obsolete '       // appcache\n\n          // convert to a hash for quick lookups\n        , nativeEvents = (function (hash, events, i) {\n            for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\n            return hash\n          }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\n\n          // custom events are events that we *fake*, they are not provided natively but\n          // we can use native events to generate them\n        , customEvents = (function () {\n            var isAncestor = 'compareDocumentPosition' in root\n                  ? function (element, container) {\n                      return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\n                    }\n                  : 'contains' in root\n                    ? function (element, container) {\n                        container = container.nodeType === 9 || container === window ? root : container\n                        return container !== element && container.contains(element)\n                      }\n                    : function (element, container) {\n                        while (element = element.parentNode) if (element === container) return 1\n                        return 0\n                      }\n              , check = function (event) {\n                  var related = event.relatedTarget\n                  return !related\n                    ? related == null\n                    : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\n                        && !isAncestor(related, this))\n                }\n\n            return {\n                mouseenter: { base: 'mouseover', condition: check }\n              , mouseleave: { base: 'mouseout', condition: check }\n              , mousewheel: { base: /Firefox/.test(navigator.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\n            }\n          }())\n\n          // we provide a consistent Event object across browsers by taking the actual DOM\n          // event object and generating a new one from its properties.\n        , Event = (function () {\n                // a whitelist of properties (for different event types) tells us what to check for and copy\n            var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\n                  'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\n                  'srcElement target timeStamp type view which propertyName')\n              , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\n                  'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\n              , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\n                  'axis')) // 'axis' is FF specific\n              , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\n                  'keyLocation location'))\n              , textProps    = commonProps.concat(str2arr('data'))\n              , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\n              , messageProps = commonProps.concat(str2arr('data origin source'))\n              , stateProps   = commonProps.concat(str2arr('state'))\n              , overOutRegex = /over|out/\n                // some event types need special handling and some need special properties, do that all here\n              , typeFixers   = [\n                    { // key events\n                        reg: /key/i\n                      , fix: function (event, newEvent) {\n                          newEvent.keyCode = event.keyCode || event.which\n                          return keyProps\n                        }\n                    }\n                  , { // mouse events\n                        reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\n                      , fix: function (event, newEvent, type) {\n                          newEvent.rightClick = event.which === 3 || event.button === 2\n                          newEvent.pos = { x: 0, y: 0 }\n                          if (event.pageX || event.pageY) {\n                            newEvent.clientX = event.pageX\n                            newEvent.clientY = event.pageY\n                          } else if (event.clientX || event.clientY) {\n                            newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\n                            newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\n                          }\n                          if (overOutRegex.test(type)) {\n                            newEvent.relatedTarget = event.relatedTarget\n                              || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\n                          }\n                          return mouseProps\n                        }\n                    }\n                  , { // mouse wheel events\n                        reg: /mouse.*(wheel|scroll)/i\n                      , fix: function () { return mouseWheelProps }\n                    }\n                  , { // TextEvent\n                        reg: /^text/i\n                      , fix: function () { return textProps }\n                    }\n                  , { // touch and gesture events\n                        reg: /^touch|^gesture/i\n                      , fix: function () { return touchProps }\n                    }\n                  , { // message events\n                        reg: /^message$/i\n                      , fix: function () { return messageProps }\n                    }\n                  , { // popstate events\n                        reg: /^popstate$/i\n                      , fix: function () { return stateProps }\n                    }\n                  , { // everything else\n                        reg: /.*/\n                      , fix: function () { return commonProps }\n                    }\n                ]\n              , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\n\n              , Event = function (event, element, isNative) {\n                  if (!arguments.length) return\n                  event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\n                  this.originalEvent = event\n                  this.isNative       = isNative\n                  this.isBean         = true\n\n                  if (!event) return\n\n                  var type   = event.type\n                    , target = event.target || event.srcElement\n                    , i, l, p, props, fixer\n\n                  this.target = target && target.nodeType === 3 ? target.parentNode : target\n\n                  if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\n                    fixer = typeFixerMap[type]\n                    if (!fixer) { // haven't encountered this event type before, map a fixer function for it\n                      for (i = 0, l = typeFixers.length; i < l; i++) {\n                        if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\n                          typeFixerMap[type] = fixer = typeFixers[i].fix\n                          break\n                        }\n                      }\n                    }\n\n                    props = fixer(event, this, type)\n                    for (i = props.length; i--;) {\n                      if (!((p = props[i]) in this) && p in event) this[p] = event[p]\n                    }\n                  }\n                }\n\n            // preventDefault() and stopPropagation() are a consistent interface to those functions\n            // on the DOM, stop() is an alias for both of them together\n            Event.prototype.preventDefault = function () {\n              if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\n              else this.originalEvent.returnValue = false\n            }\n            Event.prototype.stopPropagation = function () {\n              if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\n              else this.originalEvent.cancelBubble = true\n            }\n            Event.prototype.stop = function () {\n              this.preventDefault()\n              this.stopPropagation()\n              this.stopped = true\n            }\n            // stopImmediatePropagation() has to be handled internally because we manage the event list for\n            // each element\n            // note that originalElement may be a Bean#Event object in some situations\n            Event.prototype.stopImmediatePropagation = function () {\n              if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\n              this.isImmediatePropagationStopped = function () { return true }\n            }\n            Event.prototype.isImmediatePropagationStopped = function () {\n              return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\n            }\n            Event.prototype.clone = function (currentTarget) {\n              //TODO: this is ripe for optimisation, new events are *expensive*\n              // improving this will speed up delegated events\n              var ne = new Event(this, this.element, this.isNative)\n              ne.currentTarget = currentTarget\n              return ne\n            }\n\n            return Event\n          }())\n\n          // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\n        , targetElement = function (element, isNative) {\n            return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\n          }\n\n          /**\n            * Bean maintains an internal registry for event listeners. We don't touch elements, objects\n            * or functions to identify them, instead we store everything in the registry.\n            * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\n            */\n        , RegEntry = (function () {\n            // each handler is wrapped so we can handle delegation and custom events\n            var wrappedHandler = function (element, fn, condition, args) {\n                var call = function (event, eargs) {\n                      return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)\n                    }\n                  , findTarget = function (event, eventElement) {\n                      return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement\n                    }\n                  , handler = condition\n                      ? function (event) {\n                          var target = findTarget(event, this) // deleated event\n                          if (condition.apply(target, arguments)) {\n                            if (event) event.currentTarget = target\n                            return call(event, arguments)\n                          }\n                        }\n                      : function (event) {\n                          if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix\n                          return call(event, arguments)\n                        }\n                handler.__beanDel = fn.__beanDel\n                return handler\n              }\n\n            , RegEntry = function (element, type, handler, original, namespaces, args, root) {\n                var customType     = customEvents[type]\n                  , isNative\n\n                if (type == 'unload') {\n                  // self clean-up\n                  handler = once(removeListener, element, type, handler, original)\n                }\n\n                if (customType) {\n                  if (customType.condition) {\n                    handler = wrappedHandler(element, handler, customType.condition, args)\n                  }\n                  type = customType.base || type\n                }\n\n                this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]\n                this.customType    = !W3C_MODEL && !isNative && type\n                this.element       = element\n                this.type          = type\n                this.original      = original\n                this.namespaces    = namespaces\n                this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'\n                this.target        = targetElement(element, isNative)\n                this[eventSupport] = !!this.target[eventSupport]\n                this.root          = root\n                this.handler       = wrappedHandler(element, handler, null, args)\n              }\n\n            // given a list of namespaces, is our entry in any of them?\n            RegEntry.prototype.inNamespaces = function (checkNamespaces) {\n              var i, j, c = 0\n              if (!checkNamespaces) return true\n              if (!this.namespaces) return false\n              for (i = checkNamespaces.length; i--;) {\n                for (j = this.namespaces.length; j--;) {\n                  if (checkNamespaces[i] == this.namespaces[j]) c++\n                }\n              }\n              return checkNamespaces.length === c\n            }\n\n            // match by element, original fn (opt), handler fn (opt)\n            RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {\n              return this.element === checkElement &&\n                (!checkOriginal || this.original === checkOriginal) &&\n                (!checkHandler || this.handler === checkHandler)\n            }\n\n            return RegEntry\n          }())\n\n        , registry = (function () {\n            // our map stores arrays by event type, just because it's better than storing\n            // everything in a single array.\n            // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for\n            // rootListeners so we can look them up fast\n            var map = {}\n\n              // generic functional search of our registry for matching listeners,\n              // `fn` returns false to break out of the loop\n              , forAll = function (element, type, original, handler, root, fn) {\n                  var pfx = root ? 'r' : '$'\n                  if (!type || type == '*') {\n                    // search the whole registry\n                    for (var t in map) {\n                      if (t.charAt(0) == pfx) {\n                        forAll(element, t.substr(1), original, handler, root, fn)\n                      }\n                    }\n                  } else {\n                    var i = 0, l, list = map[pfx + type], all = element == '*'\n                    if (!list) return\n                    for (l = list.length; i < l; i++) {\n                      if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return\n                    }\n                  }\n                }\n\n              , has = function (element, type, original, root) {\n                  // we're not using forAll here simply because it's a bit slower and this\n                  // needs to be fast\n                  var i, list = map[(root ? 'r' : '$') + type]\n                  if (list) {\n                    for (i = list.length; i--;) {\n                      if (!list[i].root && list[i].matches(element, original, null)) return true\n                    }\n                  }\n                  return false\n                }\n\n              , get = function (element, type, original, root) {\n                  var entries = []\n                  forAll(element, type, original, null, root, function (entry) {\n                    return entries.push(entry)\n                  })\n                  return entries\n                }\n\n              , put = function (entry) {\n                  var has = !entry.root && !this.has(entry.element, entry.type, null, false)\n                    , key = (entry.root ? 'r' : '$') + entry.type\n                  ;(map[key] || (map[key] = [])).push(entry)\n                  return has\n                }\n\n              , del = function (entry) {\n                  forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {\n                    list.splice(i, 1)\n                    entry.removed = true\n                    if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]\n                    return false\n                  })\n                }\n\n                // dump all entries, used for onunload\n              , entries = function () {\n                  var t, entries = []\n                  for (t in map) {\n                    if (t.charAt(0) == '$') entries = entries.concat(map[t])\n                  }\n                  return entries\n                }\n\n            return { has: has, get: get, put: put, del: del, entries: entries }\n          }())\n\n          // we need a selector engine for delegated events, use querySelectorAll if it exists\n          // but for older browsers we need Qwery, Sizzle or similar\n        , selectorEngine\n        , setSelectorEngine = function (e) {\n            if (!arguments.length) {\n              selectorEngine = doc.querySelectorAll\n                ? function (s, r) {\n                    return r.querySelectorAll(s)\n                  }\n                : function () {\n                    throw new Error('Bean: No selector engine installed') // eeek\n                  }\n            } else {\n              selectorEngine = e\n            }\n          }\n\n          // we attach this listener to each DOM event that we need to listen to, only once\n          // per event type per DOM element\n        , rootListener = function (event, type) {\n            if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return\n\n            var listeners = registry.get(this, type || event.type, null, false)\n              , l = listeners.length\n              , i = 0\n\n            event = new Event(event, this, true)\n            if (type) event.type = type\n\n            // iterate through all handlers registered for this type, calling them unless they have\n            // been removed by a previous handler or stopImmediatePropagation() has been called\n            for (; i < l && !event.isImmediatePropagationStopped(); i++) {\n              if (!listeners[i].removed) listeners[i].handler.call(this, event)\n            }\n          }\n\n          // add and remove listeners to DOM elements\n        , listener = W3C_MODEL\n            ? function (element, type, add) {\n                // new browsers\n                element[add ? addEvent : removeEvent](type, rootListener, false)\n              }\n            : function (element, type, add, custom) {\n                // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events\n                // to simulate event bubbling etc.\n                var entry\n                if (add) {\n                  registry.put(entry = new RegEntry(\n                      element\n                    , custom || type\n                    , function (event) { // handler\n                        rootListener.call(element, event, custom)\n                      }\n                    , rootListener\n                    , null\n                    , null\n                    , true // is root\n                  ))\n                  if (custom && element['_on' + custom] == null) element['_on' + custom] = 0\n                  entry.target.attachEvent('on' + entry.eventType, entry.handler)\n                } else {\n                  entry = registry.get(element, custom || type, rootListener, true)[0]\n                  if (entry) {\n                    entry.target.detachEvent('on' + entry.eventType, entry.handler)\n                    registry.del(entry)\n                  }\n                }\n              }\n\n        , once = function (rm, element, type, fn, originalFn) {\n            // wrap the handler in a handler that does a remove as well\n            return function () {\n              fn.apply(this, arguments)\n              rm(element, type, originalFn)\n            }\n          }\n\n        , removeListener = function (element, orgType, handler, namespaces) {\n            var type     = orgType && orgType.replace(nameRegex, '')\n              , handlers = registry.get(element, type, null, false)\n              , removed  = {}\n              , i, l\n\n            for (i = 0, l = handlers.length; i < l; i++) {\n              if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {\n                // TODO: this is problematic, we have a registry.get() and registry.del() that\n                // both do registry searches so we waste cycles doing this. Needs to be rolled into\n                // a single registry.forAll(fn) that removes while finding, but the catch is that\n                // we'll be splicing the arrays that we're iterating over. Needs extra tests to\n                // make sure we don't screw it up. @rvagg\n                registry.del(handlers[i])\n                if (!removed[handlers[i].eventType] && handlers[i][eventSupport])\n                  removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }\n              }\n            }\n            // check each type/element for removed listeners and remove the rootListener where it's no longer needed\n            for (i in removed) {\n              if (!registry.has(element, removed[i].t, null, false)) {\n                // last listener of this type, remove the rootListener\n                listener(element, removed[i].t, false, removed[i].c)\n              }\n            }\n          }\n\n          // set up a delegate helper using the given selector, wrap the handler function\n        , delegate = function (selector, fn) {\n            //TODO: findTarget (therefore $) is called twice, once for match and once for\n            // setting e.currentTarget, fix this so it's only needed once\n            var findTarget = function (target, root) {\n                  var i, array = isString(selector) ? selectorEngine(selector, root) : selector\n                  for (; target && target !== root; target = target.parentNode) {\n                    for (i = array.length; i--;) {\n                      if (array[i] === target) return target\n                    }\n                  }\n                }\n              , handler = function (e) {\n                  var match = findTarget(e.target, this)\n                  if (match) fn.apply(match, arguments)\n                }\n\n            // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean\n            handler.__beanDel = {\n                ft       : findTarget // attach it here for customEvents to use too\n              , selector : selector\n            }\n            return handler\n          }\n\n        , fireListener = W3C_MODEL ? function (isNative, type, element) {\n            // modern browsers, do a proper dispatchEvent()\n            var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')\n            evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)\n            element.dispatchEvent(evt)\n          } : function (isNative, type, element) {\n            // old browser use onpropertychange, just increment a custom property to trigger the event\n            element = targetElement(element, isNative)\n            isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++\n          }\n\n          /**\n            * Public API: off(), on(), add(), (remove()), one(), fire(), clone()\n            */\n\n          /**\n            * off(element[, eventType(s)[, handler ]])\n            */\n        , off = function (element, typeSpec, fn) {\n            var isTypeStr = isString(typeSpec)\n              , k, type, namespaces, i\n\n            if (isTypeStr && typeSpec.indexOf(' ') > 0) {\n              // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')\n              typeSpec = str2arr(typeSpec)\n              for (i = typeSpec.length; i--;)\n                off(element, typeSpec[i], fn)\n              return element\n            }\n\n            type = isTypeStr && typeSpec.replace(nameRegex, '')\n            if (type && customEvents[type]) type = customEvents[type].base\n\n            if (!typeSpec || isTypeStr) {\n              // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)\n              if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')\n              removeListener(element, type, fn, namespaces)\n            } else if (isFunction(typeSpec)) {\n              // off(el, fn)\n              removeListener(element, null, typeSpec)\n            } else {\n              // off(el, { t1: fn1, t2, fn2 })\n              for (k in typeSpec) {\n                if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])\n              }\n            }\n\n            return element\n          }\n\n          /**\n            * on(element, eventType(s)[, selector], handler[, args ])\n            */\n        , on = function(element, events, selector, fn) {\n            var originalFn, type, types, i, args, entry, first\n\n            //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?\n            if (selector === undefined && typeof events == 'object') {\n              //TODO: this can't handle delegated events\n              for (type in events) {\n                if (events.hasOwnProperty(type)) {\n                  on.call(this, element, type, events[type])\n                }\n              }\n              return\n            }\n\n            if (!isFunction(selector)) {\n              // delegated event\n              originalFn = fn\n              args       = slice.call(arguments, 4)\n              fn         = delegate(selector, originalFn, selectorEngine)\n            } else {\n              args       = slice.call(arguments, 3)\n              fn         = originalFn = selector\n            }\n\n            types = str2arr(events)\n\n            // special case for one(), wrap in a self-removing handler\n            if (this === ONE) {\n              fn = once(off, element, events, fn, originalFn)\n            }\n\n            for (i = types.length; i--;) {\n              // add new handler to the registry and check if it's the first for this element/type\n              first = registry.put(entry = new RegEntry(\n                  element\n                , types[i].replace(nameRegex, '') // event type\n                , fn\n                , originalFn\n                , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces\n                , args\n                , false // not root\n              ))\n              if (entry[eventSupport] && first) {\n                // first event of this type on this element, add root listener\n                listener(element, entry.eventType, true, entry.customType)\n              }\n            }\n\n            return element\n          }\n\n          /**\n            * add(element[, selector], eventType(s), handler[, args ])\n            *\n            * Deprecated: kept (for now) for backward-compatibility\n            */\n        , add = function (element, events, fn, delfn) {\n            return on.apply(\n                null\n              , !isString(fn)\n                  ? slice.call(arguments)\n                  : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])\n            )\n          }\n\n          /**\n            * one(element, eventType(s)[, selector], handler[, args ])\n            */\n        , one = function () {\n            return on.apply(ONE, arguments)\n          }\n\n          /**\n            * fire(element, eventType(s)[, args ])\n            *\n            * The optional 'args' argument must be an array, if no 'args' argument is provided\n            * then we can use the browser's DOM event system, otherwise we trigger handlers manually\n            */\n        , fire = function (element, type, args) {\n            var types = str2arr(type)\n              , i, j, l, names, handlers\n\n            for (i = types.length; i--;) {\n              type = types[i].replace(nameRegex, '')\n              if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')\n              if (!names && !args && element[eventSupport]) {\n                fireListener(nativeEvents[type], type, element)\n              } else {\n                // non-native event, either because of a namespace, arguments or a non DOM element\n                // iterate over all listeners and manually 'fire'\n                handlers = registry.get(element, type, null, false)\n                args = [false].concat(args)\n                for (j = 0, l = handlers.length; j < l; j++) {\n                  if (handlers[j].inNamespaces(names)) {\n                    handlers[j].handler.apply(element, args)\n                  }\n                }\n              }\n            }\n            return element\n          }\n\n          /**\n            * clone(dstElement, srcElement[, eventType ])\n            *\n            * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?\n            */\n        , clone = function (element, from, type) {\n            var handlers = registry.get(from, type, null, false)\n              , l = handlers.length\n              , i = 0\n              , args, beanDel\n\n            for (; i < l; i++) {\n              if (handlers[i].original) {\n                args = [ element, handlers[i].type ]\n                if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)\n                args.push(handlers[i].original)\n                on.apply(null, args)\n              }\n            }\n            return element\n          }\n\n        , bean = {\n              'on'                : on\n            , 'add'               : add\n            , 'one'               : one\n            , 'off'               : off\n            , 'remove'            : off\n            , 'clone'             : clone\n            , 'fire'              : fire\n            , 'Event'             : Event\n            , 'setSelectorEngine' : setSelectorEngine\n            , 'noConflict'        : function () {\n                context[name] = old\n                return this\n              }\n          }\n\n      // for IE, clean up on unload to avoid leaks\n      if (win.attachEvent) {\n        var cleanup = function () {\n          var i, entries = registry.entries()\n          for (i in entries) {\n            if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)\n          }\n          win.detachEvent('onunload', cleanup)\n          win.CollectGarbage && win.CollectGarbage()\n        }\n        win.attachEvent('onunload', cleanup)\n      }\n\n      // initialize selector engine to internal default (qSA or throw Error)\n      setSelectorEngine(Ink.ss)\n\n      return bean\n    });\n\n    /**\n     * Keep this declaration here and off Bean as it extends the Event\n     * object and some properties are readonly in strict mode\n     */\n    'use strict';\n\n    var InkEvent = {\n\n    KEY_BACKSPACE: 8,\n    KEY_TAB:       9,\n    KEY_RETURN:   13,\n    KEY_ESC:      27,\n    KEY_SPACE:    32,\n    KEY_LEFT:     37,\n    KEY_UP:       38,\n    KEY_RIGHT:    39,\n    KEY_DOWN:     40,\n    KEY_DELETE:   46,\n    KEY_HOME:     36,\n    KEY_END:      35,\n    KEY_PAGEUP:   33,\n    KEY_PAGEDOWN: 34,\n    KEY_INSERT:   45,\n    \n    /**\n     * Creates a debounced version of a function.\n     * Returns a function which calls `func`, waiting at least `wait` milliseconds between calls. This is useful for events such as `scroll` or `resize`, which can be triggered too many times per second, slowing down the browser with needless function calls.\n     *\n     * *note:* This does not delay the first function call to the function.\n     *\n     * @method throttle\n     * @param {Function} func   Function to call. Arguments and context are both passed.\n     * @param {Number} [wait]=0 Milliseconds to wait between calls.\n     * @sample Ink_Dom_Event_1_throttle.html \n     **/\n    throttle: function (func, wait) {\n        wait = wait || 0;\n        var lastCall = 0;  // Warning: This breaks on Jan 1st 1970 0:00\n        var timeout;\n        var throttled = function () {\n            var now = +new Date();\n            var timeDiff = now - lastCall;\n            if (timeDiff >= wait) {\n                lastCall = now;\n                return func.apply(this, [].slice.call(arguments));\n            } else {\n                var that = this;\n                var args = [].slice.call(arguments);\n                if (!timeout) {\n                    timeout = setTimeout(function () {\n                        timeout = null;\n                        return throttled.apply(that, args);\n                    }, wait - timeDiff);\n                }\n            }\n        };\n        return throttled;\n    },\n\n    /**\n     * Gets the event's target element.\n     *\n     * @method element\n     * @param {Object} ev  Event object\n     * @return {DOMNode} The target\n     * @sample Ink_Dom_Event_1_element.html \n     */\n    element: function(ev) {\n        var node = ev.delegationTarget ||\n            ev.target ||\n            // IE stuff\n            (ev.type === 'mouseout'   && ev.fromElement) ||\n            (ev.type === 'mouseleave' && ev.fromElement) ||\n            (ev.type === 'mouseover'  && ev.toElement) ||\n            (ev.type === 'mouseenter' && ev.toElement) ||\n            ev.srcElement ||\n            null;\n        return node && (node.nodeType === 3 || node.nodeType === 4) ? node.parentNode : node;\n    },\n\n    /**\n     * Gets the event's related target element.\n     *\n     * @method relatedTarget\n     * @param {Object} ev event object\n     * @return {DOMNode} The related target\n     * @sample Ink_Dom_Event_1_relatedTarget.html \n     */\n    relatedTarget: function(ev){\n        var node = ev.relatedTarget ||\n            // IE stuff\n            (ev.type === 'mouseout'   && ev.toElement) ||\n            (ev.type === 'mouseleave' && ev.toElement) ||\n            (ev.type === 'mouseover'  && ev.fromElement) ||\n            (ev.type === 'mouseenter' && ev.fromElement) ||\n            null;\n        return node && (node.nodeType === 3 || node.nodeType === 4) ? node.parentNode : node;\n    },\n\n    /**\n     * Find closest ancestor element by tag name related to the event target.\n     * Navigate up the DOM tree, looking for a tag with the name `elmTagName`.\n     *\n     * If such tag is not found, `document` is returned.\n     *\n     * @method findElement\n     * @param {Object}  ev              Event object\n     * @param {String}  elmTagName      Tag name to find\n     * @param {Boolean} [force]=false   Flag to skip returning `document` and to return `false` instead.\n     * @return {DOMElement} the first element which matches given tag name or the document element if the wanted tag is not found\n     * @sample Ink_Dom_Event_1_findElement.html \n     */\n    findElement: function(ev, elmTagName, force)\n    {\n        var node = this.element(ev);\n        while(true) {\n            if(node.nodeName.toLowerCase() === elmTagName.toLowerCase()) {\n                return node;\n            } else {\n                node = node.parentNode;\n                if(!node) {\n                    if(force) {\n                        return false;\n                    }\n                    return document;\n                }\n                if(!node.parentNode){\n                    if(force){ return false; }\n                    return document;\n                }\n            }\n        }\n    },\n\n    /**\n     * Attaches an event to element\n     *\n     * @method observe\n     * @param {DOMElement|String}  element      Element id or element\n     * @param {String}             eventName    Event name\n     * @param {Function}           callBack     Receives the event object as a parameter. If you're manually firing custom events, check it's eventName property to make sure you're handling the right event.\n     * @param {Boolean}            [useCapture] Flag to change event listening from bubbling to capture.\n     * @return {Function} The event handler used. Hang on to this if you want to `stopObserving` later.\n     * @sample Ink_Dom_Event_1_observe.html \n     */\n    observe: function(element, eventName, callBack, useCapture) {\n        element = Ink.i(element);\n        if(element) {\n            if(element.addEventListener) {\n                element.addEventListener(eventName, callBack, !!useCapture);\n            } else {\n                element.attachEvent('on' + eventName, (callBack = Ink.bind(callBack, element)));\n            }\n            return callBack;\n        }\n    },\n\n    /**\n     * Like observe, but listen to the event only once.\n     *\n     * @method observeOnce\n     * @param {DOMElement|String}  element      Element id or element\n     * @param {String}             eventName    Event name\n     * @param {Function}           callBack     Receives the event object as a parameter. If you're manually firing custom events, check it's eventName property to make sure you're handling the right event.\n     * @param {Boolean}            [useCapture] Flag to change event listening from bubbling to capture.\n     * @return {Function} The event handler used. Hang on to this if you want to `stopObserving` later.\n     * @sample Ink_Dom_Event_1_observeOnce.html \n     */\n    observeOnce: function (element, eventName, callBack, useCapture) {\n        var onceBack = function () {\n            InkEvent.stopObserving(element, eventName, onceBack);\n            return callBack();\n        };\n        return InkEvent.observe(element, eventName, onceBack, useCapture);\n    },\n\n    /**\n     * Attaches an event to a selector or array of elements.\n     *\n     * @method observeMulti\n     * @param {Array|String}        elements       \n     * @param {String}              eventName    Event name\n     * @param {Function}            callBack     Receives the event object as a parameter. If you're manually firing custom events, check it's eventName property to make sure you're handling the right event.\n     * @param {Boolean}            [useCapture]  Flag change event listening from bubbling to capture.\n     * @return {Function} The used callback.\n     * @sample Ink_Dom_Event_1_observeMulti.html \n     */\n    observeMulti: function (elements, eventName, callBack, useCapture) {\n        if (typeof elements === 'string') {\n            elements = Ink.ss(elements);\n        } else if ( /* is an element */ elements && elements.nodeType === 1) {\n            elements = [elements];\n        }\n        if (!elements[0]) { return false; }\n\n        for (var i = 0, len = elements.length; i < len; i++) {\n            this.observe(elements[i], eventName, callBack, useCapture);\n        }\n        return callBack;\n    },\n\n    /**\n     * Observes an event on an element and its descendants matching the selector.\n     *\n     * Requires Ink.Dom.Selector if you need to use a selector.\n     *\n     * @method observeDelegated\n     * @param {DOMElement|String} element   Element to observe.\n     * @param {String}            eventName Event name to observe.\n     * @param {String}            selector  Child element selector. When null, finds any element.\n     * @param {Function}          callback  Callback to be called when the event is fired\n     * @return {Function} The used callback, for ceasing to listen to the event later.\n     * @sample Ink_Dom_Event_1_observeDelegated.html \n     **/\n    observeDelegated: function (element, eventName, selector, callback) {\n        return InkEvent.observe(element, eventName, function (event) {\n            var fromElement = InkEvent.element(event);\n            if (!fromElement || fromElement === element) { return; }\n\n            var cursor = fromElement;\n\n            // Go up the document tree until we hit the element itself.\n            while (cursor !== element && cursor !== document && cursor) {\n                if (Ink.Dom.Selector_1.matchesSelector(cursor, selector)) {\n                    event.delegationTarget = cursor;\n                    return callback(event);\n                }\n                cursor = cursor.parentNode;\n            }\n        });\n    },\n\n    /**\n     * Removes an event attached to an element.\n     *\n     * @method stopObserving\n     * @param {DOMElement|String}  element       Element id or element\n     * @param {String}             eventName     Event name\n     * @param {Function}           callBack      Callback function\n     * @param {Boolean}            [useCapture]  Set to true if the event was being observed with useCapture set to true as well.\n     * @sample Ink_Dom_Event_1_stopObserving.html \n     */\n    stopObserving: function(element, eventName, callBack, useCapture) {\n        element = Ink.i(element);\n\n        if(element) {\n            if(element.removeEventListener) {\n                element.removeEventListener(eventName, callBack, !!useCapture);\n            } else {\n                element.detachEvent('on' + eventName, callBack);\n            }\n        }\n    },\n\n    /**\n     * Stops event propagation and bubbling.\n     *\n     * @method stop\n     * @param {Object} event  Event handle\n     * @sample Ink_Dom_Event_1_stop.html \n     */\n    stop: function(event)\n    {\n        if(event.cancelBubble !== null) {\n            event.cancelBubble = true;\n        }\n        if(event.stopPropagation) {\n            event.stopPropagation();\n        }\n        if(event.preventDefault) {\n            event.preventDefault();\n        }\n        if(window.attachEvent) {\n            event.returnValue = false;\n        }\n        if(event.cancel !== null) {\n            event.cancel = true;\n        }\n    },\n\n    /**\n     * Stops event propagation.\n     *\n     * @method stopPropagation\n     * @param {Object} event  Event handle\n     * @sample Ink_Dom_Event_1_stopPropagation.html \n     */\n    stopPropagation: function(event) {\n        if(event.cancelBubble !== null) {\n            event.cancelBubble = true;\n        }\n        if(event.stopPropagation) {\n            event.stopPropagation();\n        }\n    },\n\n    /**\n     * Stops event default behaviour.\n     *\n     * @method stopDefault\n     * @param {Object} event  Event handle\n     * @sample Ink_Dom_Event_1_stopDefault.html \n     */\n    stopDefault: function(event)\n    {\n        if(event.preventDefault) {\n            event.preventDefault();\n        }\n        if(window.attachEvent) {\n            event.returnValue = false;\n        }\n        if(event.cancel !== null) {\n            event.cancel = true;\n        }\n    },\n\n    /**\n     * Gets the pointer's coordinates from the event object.\n     *\n     * @method pointer\n     * @param {Object} ev Event object\n     * @return {Object} An object with the mouse X and Y position\n     * @sample Ink_Dom_Event_1_pointer.html \n     */\n    pointer: function(ev)\n    {\n        return {\n            x: this.pointerX(ev),\n            y: this.pointerY(ev)\n        };\n    },\n\n    /**\n     * Gets the pointer's X coordinate.\n     *\n     * @method pointerX\n     * @param {Object} ev Event object\n     * @return {Number} Mouse X position\n     */\n    pointerX: function(ev)\n    {\n        return (ev.touches && ev.touches[0] && ev.touches[0].clientX) ||\n            (ev.pageX) ||\n            (ev.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft));\n    },\n\n    /**\n     * Gets the pointer's Y coordinate.\n     *\n     * @method pointerY\n     * @param {Object} ev Event object\n     * @return {Number} Mouse Y position\n     */\n    pointerY: function(ev)\n    {\n        return (ev.touches && ev.touches[0] && ev.touches[0].clientY) ||\n            (ev.pageY) ||\n            (ev.clientY + (document.documentElement.scrollTop || document.body.scrollTop));\n    },\n\n    /**\n     * Checks if an event is a left click.\n     *\n     * @method isLeftClick\n     * @param {Object} ev  Event object\n     * @return {Boolean} True if the event is a left click\n     * @sample Ink_Dom_Event_1_isLeftClick.html \n     */\n    isLeftClick: function(ev) {\n        if (window.addEventListener) {\n            if(ev.button === 0){\n                return true;\n            } else if(ev.type === 'touchend' && ev.button === null){\n                // [todo] do the above check for pointerEvents too\n                return true;\n            }\n        }\n        else {\n            if(ev.button === 1){ return true; }\n        }\n        return false;\n    },\n\n    /**\n     * Checks if an event is a right click.\n     *\n     * @method isRightClick\n     * @param {Object} ev  Event object\n     * @return {Boolean} True if the event is a right click\n     * @sample Ink_Dom_Event_1_isRightClick.html \n     */\n    isRightClick: function(ev) {\n        return (ev.button === 2);\n    },\n\n    /**\n     * Checks if an event is a middle click.\n     *\n     * @method isMiddleClick\n     * @param {Object} ev  Event object\n     * @return {Boolean} True if the event is a middle click\n     * @sample Ink_Dom_Event_1_isMiddleClick.html \n     */\n    isMiddleClick: function(ev) {\n        if (window.addEventListener) {\n            return (ev.button === 1);\n        }\n        else {\n            return (ev.button === 4);\n        }\n        return false;\n    },\n\n    /**\n     * Gets character from an event.\n     *\n     * @method getCharFromKeyboardEvent\n     * @param {Object}   event           Keyboard event\n     * @param {Boolean}  [changeCasing]  If true uppercases, if false lowercases, otherwise keeps casing\n     * @return {String} Character representation of pressed key combination\n     * @sample Ink_Dom_Event_1_getCharFromKeyboardEvent.html \n     */\n    getCharFromKeyboardEvent: function(event, changeCasing) {\n        var k = event.keyCode;\n        var c = String.fromCharCode(k);\n\n        var shiftOn = event.shiftKey;\n        if (k >= 65 && k <= 90) {   // A-Z\n            if (typeof changeCasing === 'boolean') {\n                shiftOn = changeCasing;\n            }\n            return (shiftOn) ? c : c.toLowerCase();\n        }\n        else if (k >= 96 && k <= 105) { // numpad digits\n            return String.fromCharCode( 48 + (k-96) );\n        }\n        switch (k) {\n            case 109:   case 189:   return '-';\n            case 107:   case 187:   return '+';\n        }\n        return c;\n    },\n\n    debug: function(){}\n};\n\n/**\n * Lets you attach event listeners to both elements and objects.\n * http://github.com/fat/bean#on\n *\n * @method on\n * @param {DOMElement|Object} element An HTML DOM element or any JavaScript Object\n * @param {String}            eventType An Event (or multiple events, space separated) to listen to\n * @param {String}            [selector] A CSS DOM Element selector string to bind the listener to child elements matching the selector\n * @param {Function}          [handler] The callback function\n * @param {Object}            [args...] Additional arguments to pass to the callback function when triggered\n * \n * @return {DOMElement|Object} Returns the original DOM Element or Javascript Object\n * @sample Ink_Dom_Event_1_on.html \n */\n\n/**\n * Alias for `on` but will only be executed once.\n * bean.one() is an alias for bean.on() except that the handler will only be executed once and then removed for the event type(s).\n * http://github.com/fat/bean#one\n *\n * @method one\n * @param {DOMElement|Object} element An HTML DOM element or any JavaScript Object\n * @param {String}            eventType An Event (or multiple events, space separated) to listen to\n * @param {String}            [selector] A CSS DOM Element selector string to bind the listener to child elements matching the selector\n * @param {Function}          [handler] The callback function\n * @param                     [args...] Additional arguments to pass to the callback function when triggered\n * \n * @return {DOMElement|Object} Returns the original DOM Element or Javascript Object\n * @sample Ink_Dom_Event_1_one.html \n */\n\n/**\n * Removes event handlers.\n * bean.off() is how you get rid of handlers once you no longer want them active. It's also a good idea to call off on elements before you remove them from your DOM; this gives Bean a chance to clean up some things and prevents memory leaks.\n * http://github.com/fat/bean#off\n *\n * @method off\n * @param {DOMElement|Object} element An HTML DOM element or any JavaScript Object\n * @param {String}            eventType An Event (or multiple events, space separated) to remove\n * @param {Function}          [handler] The specific callback function to remove\n * \n * @return {DOMElement|Object} Returns the original DOM Element or Javascript Object\n * @sample Ink_Dom_Event_1_off.html \n */\n\n/**\n * Clones events from one object to another\n * bean.clone() is a method for cloning events from one DOM element or object to another.\n * http://github.com/fat/bean#clone\n *\n * @method clone\n * @param {DOMElement|Object} destElement An HTML DOM element or any JavaScript Object to copy events to\n * @param {String}            srcElement An HTML DOM element or any JavaScript Object to copy events from\n * @param {String}            [eventType] An Event (or multiple events, space separated) to clone\n * \n * @return {DOMElement|Object} Returns the original DOM Element or Javascript Object\n * @sample Ink_Dom_Event_1_clone.html \n */\n\n/**\n * Triggers events.\n * http://github.com/fat/bean#fire\n *\n * @method fire\n * @param {DOMElement|Object} destElement An HTML DOM element or any JavaScript Object fire the event on\n * @param {String}            eventType An Event (or multiple events, space separated) to fire\n * @param                     [args...] Additional arguments to pass to the callback function when triggered\n *\n * @return {DOMElement|Object} Returns the original DOM Element or Javascript Object\n * @sample Ink_Dom_Event_1_fire.html \n */\n\nreturn Ink.extendObj(InkEvent, bean);\n\n});\n","/**\n * @module Ink.Dom.FormSerialize_1\n * Two way serialization of form data and javascript objects.\n * Valid applications are ad hoc AJAX/syndicated submission of forms, restoring form values from server side state, etc.\n */\n\nInk.createModule('Ink.Dom.FormSerialize', 1, ['Ink.Util.Array_1', 'Ink.Dom.Element_1', 'Ink.Dom.Selector_1'], function (InkArray, InkElement, Selector) {\n    'use strict';\n\n    // Check whether something is not a string or a DOM element, but still has length.\n    function isArrayIsh(obj) {\n        return obj != null &&\n            (!InkElement.isDOMElement(obj)) &&\n            (InkArray.isArray(obj) || (typeof obj !== 'string' && typeof obj.length === 'number'));\n    }\n\n    function toArray(obj) {\n        if (isArrayIsh(obj)) { return obj; }\n        else { return [obj]; }\n    }\n\n    /**\n     * @namespace Ink.Dom.FormSerialize\n     * @static\n     **/\n    var FormSerialize = {\n\n        /**\n         * Serializes a form element into a JS object\n         * It turns field names into keys and field values into values.\n         *\n         * note: Multi-select and checkboxes with multiple values will result in arrays\n         *\n         * @method serialize\n         * @param {DOMElement|String}   form    Form element to extract data\n         * @return {Object} Map of fieldName -> String|String[]|Boolean\n         * @sample Ink_Dom_FormSerialize_serialize.html \n         */\n        serialize: function(form) {\n            var out = {};\n            var emptyArrayToken = {};  // A hack so tha